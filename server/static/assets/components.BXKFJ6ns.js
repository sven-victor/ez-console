import{j as e,S as de,u as S,aw as U,ax as J,c as O,D as te,h as _,ay as ue,r as p,az as me,aA as he,M as V,a as z,aB as pe,aC as xe,aD as ge,aE as D,a6 as se,aF as fe,aG as je,aH as ye,aI as ve,aJ as we,aK as Se,W as ne,B as v,af as be,T as M,aL as Ie,aM as g,ao as k,s as w,R as ke,aq as E,ag as Ce,aN as Fe,aO as Le,aP as Te,aQ as X,aR as Ae,aS as ae,aT as ze,f as T,aU as Re,aV as _e,aW as Pe,aX as Me,aY as q,aZ as $e,a_ as W,a$ as G,b0 as P,g as A,b1 as De,b2 as Ee,d as Ve,b3 as Ne,p as Be,b4 as Q,b5 as He,b6 as Ue}from"./vendor.CyaXoMFn.js";import{a as re,b as ie,c as oe,d as qe}from"./contexts.DcBdfNkE.js";import{g as Oe,f as We,c as Ke}from"./base.CIILqgsu.js";import{a as b}from"./index.Dwpr26wG.js";import{b as N,A as Je}from"./client.CicVKWRR.js";import{a as Xe}from"./lodash.BDtH7uFP.js";import{X as Ge,M as Qe,d as Ze}from"./ant-design-x.DtIK71LU.js";const Z=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsx(de,{size:"large"})}),St=({element:t,requiredPermission:a,requiredPermissions:n})=>{const{t:s}=S(),{user:l,loading:d,error:i}=re(),{hasPermission:u,hasAllPermissions:o}=ie();return d?e.jsx(Z,{}):i?i.code==="E4011"?e.jsx(Z,{}):e.jsx(U,{status:"500",title:"500",subTitle:s("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(i==null?void 0:i.message)||i})}):l?a&&!u(a)?e.jsx(J,{to:"/forbidden",replace:!0}):n&&!o(n)?e.jsx(J,{to:"/forbidden",replace:!0}):t:(window.location.href=Oe("/login?redirect="+encodeURIComponent(window.location.href)),null)},Ye=O(({token:t,css:a})=>({container:a`
      ${a`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),K=({overlayClassName:t,overlay:a,hidden:n,children:s,...l})=>{if(n)return e.jsx(e.Fragment,{});const{styles:d}=Ye();return e.jsx(te,{dropdownRender:a,overlayClassName:_(d.container,t),...l,children:e.jsx("span",{className:d.iconStyle,children:s})})},et=()=>e.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),tt=O(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),st=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],bt=({transformLangConfig:t=n=>n,className:a})=>{const{i18n:n}=S(),{styles:s}=tt(),l=i=>{n.changeLanguage(i)},d={selectedKeys:[n.language],onClick:i=>{l(i.key)},items:t(st).map(i=>({key:i.lang,className:s.menuItemStyle,label:e.jsxs(e.Fragment,{children:[e.jsx("span",{role:"img","aria-label":(i==null?void 0:i.label)||"en-US",className:s.menuItemIconStyle,children:(i==null?void 0:i.icon)||"ðŸŒ"}),(i==null?void 0:i.label)||"en-US"]})}))};return e.jsx(K,{className:a,menu:d,children:e.jsx(et,{})})},nt=O(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),le=t=>Xe(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?N.endsWith("/")?N+`files/${t}`:N+`/files/${t}`:t,at=({src:t,fallback:a,...n})=>e.jsx(ue,{src:le(t),icon:a,...n}),rt=({onChange:t,shape:a="square"})=>{const[n,s]=p.useState([]),{styles:l}=nt(),[d,i]=p.useState(!1),[u,o]=p.useState(!0),[h,m]=p.useState(0),{run:c,loading:r}=z(()=>b.base.listFiles({current:h+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:j})=>{s([...n,...j]),o(j.length===40),m(h+1)}}),y=()=>{o(!0),m(0),s([])};return e.jsx(pe,{style:{zIndex:1e3},onOpenChange:j=>{i(j),j?c():y()},open:d,content:e.jsx("div",{style:{width:360,height:200},children:e.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsx(ge,{dataLength:n.length,next:()=>{c()},hasMore:u,loader:e.jsx(fe,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsx(se,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsx(D,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:r,renderItem:({id:j})=>e.jsx("div",{className:l.avatarItem,onClick:f=>{f.stopPropagation(),t==null||t(j),i(!1),y()},children:e.jsx(at,{shape:a,src:j})})})})})}),placement:"bottom",trigger:"hover",children:e.jsx(xe,{shape:a,style:{width:112,height:112,placeContent:"center"}})})},it=({value:t,onChange:a,shape:n,...s})=>{const[l,d]=p.useState(void 0),[i,u]=p.useState(!1),[o,h]=p.useState(void 0),m=async c=>{u(!0),h(c.url??c.preview)};return p.useEffect(()=>{d(t?{uid:t,name:t,url:le(t)}:void 0)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(me,{beforeCrop:async c=>{if(c.type==="image/svg+xml"){const r=await b.base.uploadFile({type:"avatar"},c);return r.length>0&&(a==null||a(r[0].id)),!1}return!0},children:e.jsx(he,{customRequest:async c=>{var y,j;const r=await b.base.uploadFile({type:"avatar",access:"public"},c.file);r.length>0?((y=c.onSuccess)==null||y.call(c,r[0].id),a==null||a(r[0].id)):(j=c.onError)==null||j.call(c,new Error("Upload file failed"))},listType:"picture-card",onPreview:m,maxCount:1,onChange:({file:c})=>{switch(c.status){case"removed":a==null||a(void 0);break;case"done":break;default:d(c);break}},fileList:l?[l]:[],...s,children:l?void 0:e.jsx(rt,{shape:n,onChange:a})})}),e.jsx(V,{open:i,footer:null,onCancel:()=>u(!1),children:e.jsx("img",{style:{width:"100%"},src:o})})]})},It=({className:t})=>{const{t:a}=S("common"),{user:n}=re(),{currentOrgId:s,setCurrentOrgId:l}=oe(),d=(n==null?void 0:n.organizations)||[],i=m=>{l(m),window.location.reload()};if(d.length===0)return null;const u=d.find(m=>m.id===s),o=u?u.name:a("organization.global",{defaultValue:"Global"}),h=[...d.map(m=>({key:m.id,label:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:m.name}),s===m.id&&e.jsx(je,{})]}),onClick:()=>i(m.id)}))];return e.jsxs(K,{className:t,menu:{items:h,selectedKeys:s?[s]:[""]},children:[e.jsx(ye,{style:{marginRight:4}}),e.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:o})]})},ot={pending:"default",running:"processing",success:"success",failed:"error",cancelled:"default"},kt=({className:t})=>{const{t:a}=S("task"),n=ve(),{tasks:s,tasksDropdownOpen:l,setTasksDropdownOpen:d}=oe(),i=async o=>{const h=await b.base.downloadFile({fileKey:o},{params:{method:"sign"}}),m=`/api/files/${o}?signature=${h.signature}&expires=${h.expires}`;window.open(m,"_blank")},u=()=>e.jsxs("div",{style:{width:520,maxHeight:500,overflow:"auto",padding:8},children:[e.jsx(D,{size:"small",dataSource:s,renderItem:o=>e.jsx(D.Item,{extra:e.jsx(M,{color:ot[o.status],style:{marginLeft:6},children:a(`status.${o.status}`,{defaultValue:o.status})}),actions:[o.artifact_file_key&&e.jsx(v,{type:"text",size:"small",icon:e.jsx(be,{}),onClick:()=>i(o.artifact_file_key)})].filter(Boolean),children:e.jsx(D.Item.Meta,{title:e.jsx("span",{style:{fontSize:13},children:e.jsxs(ne.Text,{ellipsis:{tooltip:!0},children:[a(`type.${o.type}`,{defaultValue:o.type})," ",o.artifact_file_name&&`- ${o.artifact_file_name}`]})}),description:(o.status==="running"||o.status==="pending")&&e.jsx(Se,{percent:o.progress??0,size:"small",style:{marginTop:4}})})},o.id)}),e.jsx("div",{style:{borderTop:"1px solid #f0f0f0",paddingTop:8,marginTop:8,textAlign:"center"},children:e.jsx(v,{type:"link",size:"small",onClick:()=>n("/tasks"),children:a("more",{defaultValue:"More"})})})]});return!s||s.length===0?null:e.jsxs(K,{className:t,overlay:u,placement:"bottomRight",open:l,onOpenChange:d,children:[e.jsx(we,{style:{marginRight:4}}),e.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:2},children:a("tasks",{defaultValue:"Tasks"})})]})},Ct=({onResize:t,minWidth:a=300,maxWidth:n=window.innerWidth*.5})=>{const[s,l]=p.useState(!1),[d,i]=p.useState(!1),u=p.useCallback(m=>{m.preventDefault(),l(!0)},[]),o=p.useCallback(m=>{if(!s)return;const c=window.innerWidth-m.clientX,r=Math.max(a,Math.min(n,c));t(r)},[s,a,n,t]),h=p.useCallback(()=>{l(!1)},[]);return p.useEffect(()=>{if(s)return document.addEventListener("mousemove",o),document.addEventListener("mouseup",h),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",h),document.body.style.cursor="",document.body.style.userSelect=""}},[s,o,h]),e.jsx("div",{onMouseDown:u,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:s?"none":"background-color 0.2s ease",backgroundColor:s?"#1890ff":d?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:s||d?"#fff":"#999",opacity:s||d?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},lt=Ie,ct=t=>lt[t],Ft=({iconName:t})=>{if(!t)return null;const a=ct(t);return a?e.jsx(p.Suspense,{fallback:null,children:e.jsx(a,{})}):null},Lt=({className:t,onSuccess:a,token:n})=>{const{t:s}=S("authorization"),{t:l}=S("common"),[d]=g.useForm(),{run:i,loading:u}=z(async o=>b.authorization.changePassword(o,n?{headers:{Authorization:`Bearer ${n}`}}:{}),{manual:!0,onSuccess:()=>{w.success(s("user.passwordChanged")),d.resetFields(),a==null||a()},onError:o=>{if(o instanceof Je){const h=o.code??"normal";w.error(s(`user.passwordChangeFailed.${h}`,{error:o.message,defaultValue:"Password change failed: {{error}}"}))}else w.error(s("user.passwordChangeFailed.normal",{error:o.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",o)}});return e.jsxs(g,{form:d,layout:"vertical",onFinish:i,style:{maxWidth:500,margin:"0 auto"},className:_("profile-password",t),children:[e.jsx(g.Item,{name:"old_password",label:s("user.oldPassword"),rules:[{required:!0,message:s("validation.oldPasswordRequired")}],className:_("profile-password-item","profile-password-item-old-password"),children:e.jsx(k.Password,{})}),e.jsx(g.Item,{name:"new_password",label:s("user.newPassword"),rules:[{required:!0,message:s("validation.newPasswordRequired")},{min:8,message:s("validation.passwordMinLength")}],className:_("profile-password-item","profile-password-item-new-password"),children:e.jsx(k.Password,{})}),e.jsx(g.Item,{name:"confirm_password",label:s("user.confirmPassword"),className:_("profile-password-item","profile-password-item-confirm-password"),rules:[{required:!0,message:s("validation.confirmPasswordRequired")},({getFieldValue:o})=>({validator(h,m){return!m||o("new_password")===m?Promise.resolve():Promise.reject(new Error(s("validation.passwordMismatch")))}})],children:e.jsx(k.Password,{})}),e.jsx(g.Item,{className:_("profile-password-item","profile-password-item-submit"),children:e.jsx(v,{type:"primary",htmlType:"submit",loading:u,children:l("save")})})]})},Tt=({user:t,onSuccess:a})=>{const{t:n}=S("authorization"),{t:s}=S("common"),[l]=g.useForm(),[d,i]=p.useState(!1);ke.useEffect(()=>{t&&l.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,l]);const u=async o=>{try{i(!0),await b.authorization.updateCurrentUser(o),w.success(s("updateSuccess")),a()}catch(h){w.error(s("updateFailed")),console.error("Failed to update user information:",h)}finally{i(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxs("div",{children:[n("user.roles"),": ",t.roles.map(o=>o.name).join(", ")]})]}),e.jsxs(g,{form:l,layout:"vertical",onFinish:u,style:{width:"100%",maxWidth:500},children:[e.jsx(g.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsx(it,{})}),e.jsx(g.Item,{name:"username",label:n("user.username"),children:e.jsx(k,{disabled:!0})}),e.jsx(g.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsx(k,{})}),e.jsx(g.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsx(k,{})}),e.jsx(g.Item,{name:"phone",label:n("user.phone"),children:e.jsx(k,{})}),e.jsx(g.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",loading:d,children:s("save")})})]})]})},At=({user:t,onSuccess:a})=>{const{t:n}=S("authorization"),{t:s}=S("common"),[l,d]=p.useState(0),[i,u]=p.useState(!1),[o,h]=p.useState(!0),[m,c]=p.useState(""),[r,y]=p.useState("totp"),{run:j,data:f={secret:"",qr_code:"",token:void 0}}=z(()=>b.authorization.enableMfa(r),{manual:!0,onSuccess:()=>{d(1)},onBefore:()=>{u(!0)},onFinally:()=>{u(!1)}}),I=async()=>{if(!m){w.warning(n("mfa.enterVerificationCode"));return}const C={code:m,mfa_type:r};"token"in f&&(C.token=f.token);try{u(!0),await b.authorization.verifyAndActivateMfa(C),w.success(n("mfa.enableSuccess")),d(2),a()}catch(L){w.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",L)}finally{u(!1)}},x=async()=>{try{u(!0),await b.authorization.disableMfa(),w.success(n("mfa.disableSuccess")),a()}catch(C){w.error(s("operationFailed")),console.error("Failed to disable MFA:",C)}finally{u(!1)}},F=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsx(U,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsx(v,{danger:!0,onClick:()=>{V.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:x,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const C=()=>{var L;switch(l){case 0:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(X,{message:e.jsxs("div",{children:[e.jsx("p",{children:n("mfa.setupInfo")}),e.jsx("p",{children:n(r==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsx(v,{type:"primary",onClick:j,loading:i,children:n("mfa.startSetup")})]});case 1:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(X,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:r==="totp"?"block":"none"}}),e.jsx("div",{style:{display:r==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsx(Ae,{value:f.qr_code??"",size:200})}),e.jsx("div",{style:{marginBottom:16,display:r==="email"?"block":"none"},children:e.jsxs("p",{children:[n("user.email"),": ",e.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsx("div",{style:{marginBottom:16,display:r==="totp"?"block":"none"},children:e.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsx("strong",{children:o?"*".repeat(((L=f.secret)==null?void 0:L.length)??0):f.secret}),e.jsx(v,{type:"link",onClick:()=>h(!o),icon:o?e.jsx(ae,{}):e.jsx(ze,{})})]})}),e.jsx("div",{style:{marginBottom:24},children:e.jsx(k,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:m,onChange:$=>c($.target.value)})}),e.jsxs(T,{children:[e.jsx(v,{onClick:()=>d(0),children:s("previous")}),e.jsx(v,{type:"primary",onClick:I,loading:i,children:s("verify")})]})]});case 2:return e.jsx(U,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsx(v,{type:"primary",onClick:()=>d(0),children:s("done")})});default:return null}};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:l===2?"none":"unset"},children:[e.jsx(Ce,{defaultValue:"totp",onChange:L=>{y(L),d(0)},value:r,options:[{value:"totp",icon:e.jsx(Fe,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsx(Le,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsx(se,{})]}),e.jsx(Te,{current:l,items:[{title:n(r==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(r==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(r==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(r==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(r==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(r==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),C()]})};return e.jsx(E,{title:n("mfa.title"),children:F()})},{Text:B}=ne,zt=()=>{const{t}=S("authorization"),{t:a}=S("common"),[n,s]=p.useState(null),[l,d]=p.useState(!1),{data:i=[],loading:u,run:o}=z(()=>b.authorization.getUserSessions({}),{onError:r=>{w.error(t("session.getSessionsFailed",{error:r,defaultValue:"Failed to get session list: {{error}}"}))}}),{run:h}=z(r=>b.authorization.terminateSession({id:r}),{onSuccess:()=>{w.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"})),o()},onError:r=>{w.error(t("session.terminateFailed",{error:r,defaultValue:"Failed to terminate session: {{error}}"}))},onFinally:()=>{s(null)},onBefore:([r])=>{s(r)},manual:!0}),{run:m}=z(()=>b.authorization.terminateOtherSessions(),{onSuccess:()=>{w.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"})),o()},onError:r=>{w.error(t("session.terminateAllFailed",{error:r,defaultValue:"Failed to terminate all other sessions: {{error}}"}))},onFinally:()=>{d(!1)},onBefore:()=>{d(!0)},manual:!0}),c=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(r,y)=>e.jsxs(T,{direction:"vertical",size:0,children:[e.jsxs(T,{children:[e.jsx(Re,{}),e.jsx(B,{strong:!0,children:r})]}),e.jsxs(T,{children:[e.jsx(_e,{}),e.jsx(B,{type:"secondary",children:y.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:r=>e.jsxs(T,{children:[e.jsx(Pe,{}),e.jsx("span",{children:r})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:r=>e.jsxs(T,{children:[e.jsx(Me,{}),e.jsx("span",{children:new Date(r).toLocaleString()})]})},{title:t("session.status"),key:"status",render:r=>r.is_current?e.jsx(M,{color:"green",children:t("session.current")}):e.jsx(M,{color:"blue",children:t("session.active")})},{title:a("actions"),key:"action",render:r=>r.is_current?e.jsx(B,{type:"secondary",children:t("session.currentSession")}):e.jsx(q,{title:t("session.confirmTerminate"),onConfirm:()=>h(r.id),okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{type:"link",danger:!0,loading:n===r.id,children:t("session.terminate")})})}];return e.jsx(E,{title:t("session.title"),loading:u,extra:e.jsxs(T,{children:[i.length>1&&e.jsx(q,{title:t("session.confirmTerminateAll"),onConfirm:m,okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{danger:!0,loading:l,children:t("session.terminateOthers")})}),e.jsx(v,{onClick:()=>o(),loading:u,children:a("refresh")})]}),children:!u&&i.length===0?e.jsx($e,{description:t("session.noSessions")}):e.jsx(W,{columns:c,dataSource:i,rowKey:"id",loading:u,pagination:!1})})},{RangePicker:dt}=De,{Option:R}=A,ut=t=>t||"N/A",mt=(t,a)=>t==="success"?e.jsx(M,{color:"success",children:a("statuses.success")}):e.jsx(M,{color:"error",children:a("statuses.failed")}),Rt=({userId:t,request:a=s=>t?b.authorization.getUserLogs({id:t,...s}):b.authorization.getCurrentUserLogs(s),columnsFilter:n=s=>s})=>{const{t:s}=S("authorization"),{t:l}=S("common"),[d,i]=p.useState({current:1,pageSize:10,total:0}),[u,o]=p.useState({}),[h]=g.useForm(),{loading:m,run:c,data:{data:r}={}}=z(async(x=u,F=1,C=10)=>a({...x,current:F??1,page_size:C??10}),{onError(x){w.error(s("auditLog.fetchFailed",{error:x}))},onSuccess({total:x}){i({...d,total:x})}});p.useEffect(()=>{c(u,1,d.pageSize)},[]);const y=x=>{i({...d,current:x.current,pageSize:x.pageSize}),c({},x.current,x.pageSize)},j=x=>{var F,C,L,$;c({...x,start_time:(C=(F=x.dateRange)==null?void 0:F[0])==null?void 0:C.toISOString(),end_time:($=(L=x.dateRange)==null?void 0:L[1])==null?void 0:$.toISOString()},1,d.pageSize)},f=()=>{h.resetFields(),o({}),i({...d,current:1}),c({},1,d.pageSize)},I=[{title:s("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:x=>We(x)},{title:s("auditLog.action"),dataIndex:"action",key:"action",render:(x,F)=>x?s(`action.${x.replace(":",".")}`,{defaultValue:F.action_name}):F.action_name??F.action},{title:s("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:s("auditLog.ip"),dataIndex:"ip",key:"ip",render:x=>ut(x)},{title:s("auditLog.status"),dataIndex:"status",key:"status",render:x=>mt(x,s)},{title:s("auditLog.details"),dataIndex:"details",key:"details",render:x=>e.jsx(v,{type:"link",icon:e.jsx(ae,{}),onClick:()=>{V.info({title:s("auditLog.details"),content:JSON.stringify(x)})}})}];return e.jsxs("div",{children:[e.jsx(E,{style:{marginBottom:16},children:e.jsxs(g,{form:h,layout:"horizontal",onFinish:j,initialValues:u,children:[e.jsxs(G,{gutter:24,children:[e.jsx(P,{span:6,children:e.jsx(g.Item,{name:"search",label:s("auditLog.search"),children:e.jsx(k,{placeholder:s("auditLog.searchPlaceholder")})})}),e.jsx(P,{span:6,children:e.jsx(g.Item,{name:"action",label:s("auditLog.action"),children:e.jsxs(A,{allowClear:!0,placeholder:s("auditLog.selectAction"),children:[e.jsx(R,{value:"login",children:s("actions.login")}),e.jsx(R,{value:"logout",children:s("actions.logout")}),e.jsx(R,{value:"password_reset",children:s("actions.passwordReset")}),e.jsx(R,{value:"mfa_change",children:s("actions.mfaChange")})]})})}),e.jsx(P,{span:6,children:e.jsx(g.Item,{name:"status",label:s("auditLog.status"),children:e.jsxs(A,{allowClear:!0,placeholder:s("auditLog.selectStatus"),children:[e.jsx(R,{value:"success",children:s("statuses.success")}),e.jsx(R,{value:"failed",children:s("statuses.failed")})]})})}),e.jsx(P,{span:6,children:e.jsx(g.Item,{name:"dateRange",label:s("auditLog.dateRange"),children:e.jsx(dt,{style:{width:"100%"}})})})]}),e.jsx(G,{children:e.jsx(P,{span:24,style:{textAlign:"right"},children:e.jsxs(T,{children:[e.jsx(v,{onClick:f,children:l("reset")}),e.jsx(v,{type:"primary",htmlType:"submit",icon:e.jsx(Ee,{}),children:l("search")})]})})})]})}),e.jsxs(E,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(v,{type:"primary",icon:e.jsx(Ve,{}),onClick:f,style:{marginRight:8},children:l("refresh")})}),e.jsx(W,{rowKey:"id",columns:n(I),dataSource:r,pagination:{...d,showSizeChanger:!0,showTotal:x=>l("totalItems",{total:x})},loading:m,onChange:y,scroll:{x:"max-content"}})]})]})},ce=({permission:t,permissions:a=[],checkAll:n=!1,fallback:s=null,children:l})=>{const{hasPermission:d,hasAnyPermission:i,hasAllPermissions:u,isAdmin:o,loading:h}=ie();return h?null:o?e.jsx(e.Fragment,{children:l}):t?d(t)?e.jsx(e.Fragment,{children:l}):e.jsx(e.Fragment,{children:s}):a.length>0?(n?u(a):i(a))?e.jsx(e.Fragment,{children:l}):e.jsx(e.Fragment,{children:s}):e.jsx(e.Fragment,{children:l})},Y=t=>{const[a,n]=p.useState(!1),{permission:s,icon:l,tooltip:d,onClick:i,confirm:u,label:o,...h}=t,m=i?async()=>{n(!0);try{await i()}finally{n(!1)}}:void 0;let c=e.jsx(v,{type:"text",size:"small",loading:a,icon:l,onClick:u?void 0:m,...h,children:o&&e.jsx("span",{style:{position:"inherit",top:"-2px"},children:o})});if(d&&(c=e.jsx(Be,{title:d,children:c})),u){const r=async()=>{u.onConfirm?u.onConfirm():m&&await m()};c=e.jsx(q,{title:u.title,description:u.description,onConfirm:r,okText:u.okText,cancelText:u.cancelText,children:c})}return s&&(c=e.jsx(ce,{permission:s,children:c})),c},_t=({actions:t,maxVisibleItems:a})=>{const n=t.filter(i=>!i.hidden);if(!a||n.length<=a)return e.jsx(e.Fragment,{children:n.map(({key:i,...u})=>e.jsx(Y,{...u},i))});const s=n.slice(0,a-1),d=n.slice(a-1).map(i=>{const{key:u,label:o,icon:h,permission:m,onClick:c,confirm:r,disabled:y,tooltip:j}=i,I={key:u,label:o,icon:h,disabled:y,onClick:async()=>{r?V.confirm({title:r.title,content:r.description,onOk:r.onConfirm,okText:r.okText,cancelText:r.cancelText}):c&&await c()}};return m?{...I,label:e.jsx(ce,{permission:m,children:e.jsx("span",{children:o??j})})}:I});return e.jsxs(e.Fragment,{children:[s.map(({key:i,...u})=>e.jsx(Y,{...u},i)),e.jsx(te,{menu:{items:d},trigger:["click"],children:e.jsx(v,{type:"text",size:"small",icon:e.jsx(Ne,{})})})]})},ht=({request:t,tableRef:a,...n},s)=>{const[l,d]=p.useState({current:1,pageSize:10}),[i,u]=p.useState(0),{data:o,loading:h,refresh:m}=z(async()=>{const c=await t({current:l.current,page_size:l.pageSize});return u(c.total),c.data},{refreshDeps:[l]});return p.useImperativeHandle(s,()=>({reload:()=>{m()}})),e.jsx(W,{rowKey:"id",loading:h,dataSource:o??[],pagination:{...l,total:i,onChange:(c,r)=>{d({current:c,pageSize:r})}},...n,ref:a})},Pt=({actionRef:t,...a})=>{const[n,s]=p.useState();return p.useEffect(()=>{s(p.forwardRef(ht))},[]),n?e.jsx(n,{...a,ref:t}):null},{TextArea:ee}=k,{Option:H}=A,Mt=({field:t,selectedType:a,dependentValues:n,formValues:s={}})=>{const{t:l}=S("system"),{t:d}=S("common"),i=p.useMemo(()=>Ke(t.visible_when,s),[t.visible_when,s]),{options:u,loading:o}=qe(t.data_source,t.options,n),h=p.useMemo(()=>t.data_source&&t.data_source.type!=="static"?u:t.options||[],[t.data_source,t.options,u]),m=h&&h.length>0;if(!i)return null;const c=[{required:t.required,message:l("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],r=()=>l(`settings.toolsets.${a}.${t.name}`,{defaultValue:t.display_name||t.name}),y=()=>l(`settings.toolsets.${a}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${d("enter",{defaultValue:"Enter"})} ${t.name}`}),j=()=>{if(t.description)return l(`settings.toolsets.${a}.${t.name}Tooltip`,{defaultValue:t.description})};if(!i)return null;if(t.type==="select"||t.data_source)return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(A,{loading:o,allowClear:!0,placeholder:y(),showSearch:!0,filterOption:(f,I)=>{var x;return(x=I==null?void 0:I.children)==null?void 0:x.toLowerCase().includes(f.toLowerCase())},children:h.map(f=>e.jsx(H,{value:f.value,children:f.label},f.value))})},t.name);switch(t.type){case"text":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,children:e.jsx(ee,{placeholder:y(),rows:4})},t.name);case"string":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(A,{allowClear:!0,placeholder:y(),children:h.map(f=>e.jsx(H,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(k,{placeholder:y()})},t.name);case"password":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(k.Password,{placeholder:y(),autoComplete:"new-password"})},t.name);case"number":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(A,{allowClear:!0,placeholder:y(),children:h.map(f=>e.jsx(H,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(Ue,{style:{width:"100%"},placeholder:y()})},t.name);case"boolean":return e.jsx(g.Item,{name:["config",t.name],label:r(),valuePropName:"checked",tooltip:j(),children:e.jsx(He,{})},t.name);case"array":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(Q.Group,{style:{width:"100%"},children:e.jsx(T,{direction:"vertical",children:h.map(f=>e.jsx(Q,{value:f.value,children:f.label},f.value))})})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:c,tooltip:j(),children:e.jsx(A,{mode:"tags",style:{width:"100%"},placeholder:y(),tokenSeparators:[","]})},t.name);case"object":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:[...c,{validator:(f,I)=>{if(!I)return Promise.resolve();try{return JSON.parse(I),Promise.resolve()}catch{return Promise.reject(new Error(l("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:j(),children:e.jsx(ee,{rows:4,placeholder:y()})},t.name);default:return null}},pt=t=>{var l;const{className:a,children:n}=t,s=((l=a==null?void 0:a.match(/language-(\w+)/))==null?void 0:l[1])||"";return typeof n!="string"?null:s==="mermaid"?e.jsx(Qe,{children:n}):e.jsx(Ze,{lang:s,children:n})},$t=({content:t,className:a,style:n,paragraphTag:s="div",rootClassName:l,components:d={code:pt}})=>e.jsx(Ge,{content:t,className:a,style:n,components:d,paragraphTag:s,rootClassName:l});export{at as A,Ft as D,K as H,Z as L,$t as M,It as O,St as P,Ct as R,kt as T,Rt as U,bt as a,Lt as b,Tt as c,At as d,zt as e,ce as f,Pt as g,st as h,_t as i,Mt as j,it as k};
