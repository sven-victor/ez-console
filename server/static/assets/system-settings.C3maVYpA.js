import{u as F,F as s,r as j,e as I,j as e,S as R,a_ as k,_ as A,m as i,g as B,x as Q,E as $,n as _,b5 as z,a1 as H,s as V,b6 as P,M as G,h as Y,b3 as q,w as J,b7 as ee,b8 as te,O as K,X as se,b9 as M,ba as D,aM as W,ac as ae,al as le,C as ie}from"./vendor.Bo5zsZF4.js";import{T as ne,U as re,V as oe,W as de,X as ue,Y as ce,Z as X,_ as me,$ as pe,a0 as he,a1 as fe,a2 as ge,a3 as be}from"./base.BwF3eh7m.js";import{f as U,g as xe}from"./components.BU5zOqAN.js";import"./vite.BF1G3H_w.js";import"./contexts.B1xQmLr_.js";const L=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,je={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},Ve=({initialData:t,onRefresh:f})=>{const{t:a}=F("system"),{t:g}=F("common"),[d]=s.useForm(),[m,h]=j.useState((t==null?void 0:t.provider)||"custom"),[p,c]=j.useState((t==null?void 0:t.provider)==="custom"),[l,o]=j.useState((t==null?void 0:t.enabled)||!1),[n,w]=j.useState((t==null?void 0:t.auto_create_user)||!1),{loading:x,data:v,refresh:r}=I(ne,{manual:!!t,onSuccess:b=>{d.setFieldsValue(b),h(b.provider),c(b.provider==="custom"),o(b.enabled),w(b.auto_create_user)},onError:b=>{V.error(a("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",b)}});j.useEffect(()=>{t&&(d.setFieldsValue(t),h(t.provider),c(t.provider==="custom"),o(t.enabled),w(t.auto_create_user))},[t,d]);const y=b=>{h(b),c(b==="custom");const S=je[b];S&&d.setFieldsValue({auth_endpoint:S.endpoints.auth_endpoint,token_endpoint:S.endpoints.token_endpoint,userinfo_endpoint:S.endpoints.userinfo_endpoint,scope:S.scope,email_field:S.email_field,username_field:S.username_field,full_name_field:S.full_name_field,avatar_field:S.avatar_field,role_field:S.role_field,icon_url:S.icon_url,display_name:S.display_name})},T=b=>{o(b)},C=b=>{w(b)},{loading:u,run:E}=I(re,{manual:!0,onSuccess:()=>{V.success(a("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),f?f():r()},onError:b=>{V.error(a("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",b)}}),Z=b=>{E(b)},N=()=>{f?f():r()},O=()=>m==="custom";return e.jsx(R,{spinning:x,children:e.jsxs(s,{form:d,layout:"vertical",onFinish:Z,initialValues:t||v,children:[e.jsx(s.Item,{name:"enabled",label:a("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:a("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsx(k,{onChange:T})}),e.jsx(s.Item,{name:"provider",label:a("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:a("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:l,message:a("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxs(A,{onChange:y,disabled:!l,children:[e.jsx(A.Option,{value:"github",children:a("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsx(A.Option,{value:"google",children:a("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsx(A.Option,{value:"dingtalk",children:a("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsx(A.Option,{value:"wechat",children:a("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsx(A.Option,{value:"custom",children:a("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsx(s.Item,{name:"display_name",label:a("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:a("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsx(i,{disabled:!l,placeholder:m!=="custom"?a(`settings.oauth.provider.options.${m}`,{defaultValue:m}):""})}),e.jsx(s.Item,{name:"icon_url",label:a("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:a("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:L,message:a("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!l,placeholder:"https://example.com/icon.png"})}),e.jsx(s.Item,{name:"client_id",label:a("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:a("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:l,message:a("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsx(i,{disabled:!l})}),e.jsx(s.Item,{name:"client_secret",label:a("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:a("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:l,message:a("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsx(i.Password,{disabled:!l,visibilityToggle:!1,placeholder:a("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),O()&&e.jsx(s.Item,{name:"auth_endpoint",label:a("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:a("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:l&&m==="custom",message:a("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:L,message:a("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!l})}),O()&&e.jsx(s.Item,{name:"token_endpoint",label:a("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:a("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:l&&m==="custom",message:a("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:L,message:a("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!l})}),O()&&e.jsx(s.Item,{name:"userinfo_endpoint",label:a("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:a("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:l&&m==="custom",message:a("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:L,message:a("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!l})}),e.jsx(s.Item,{name:"scope",label:a("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:a("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:l,message:a("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsx(i,{disabled:!l})}),e.jsx(s.Item,{name:"redirect_uri",label:a("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:a("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[{required:l,message:a("settings.oauth.redirectUri.required",{defaultValue:"Redirect URI is required."})},{pattern:L,message:a("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!l})}),e.jsx(s.Item,{name:"auto_create_user",label:a("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:a("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsx(k,{onChange:C,disabled:!l})}),e.jsx(s.Item,{name:"default_role",label:a("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:a("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:l&&n,message:a("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsx(i,{disabled:!l||!n})}),e.jsx(B,{children:a("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsx(Q,{style:{marginBottom:16},type:"info",showIcon:!0,message:a("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:p?"":a("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsx(s.Item,{name:"email_field",label:a("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:a("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsx(i,{placeholder:"email",disabled:!l||!p})}),e.jsx(s.Item,{name:"username_field",label:a("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:a("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsx(i,{placeholder:"login",disabled:!l||!p})}),e.jsx(s.Item,{name:"full_name_field",label:a("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:a("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsx(i,{placeholder:"name",disabled:!l||!p})}),e.jsx(s.Item,{name:"avatar_field",label:a("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:a("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsx(i,{placeholder:"avatar_url",disabled:!l||!p})}),e.jsx(s.Item,{name:"role_field",label:a("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:a("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsx(i,{placeholder:"role",disabled:!l||!p})}),e.jsx(s.Item,{children:e.jsxs($,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:u,icon:e.jsx(z,{}),children:g("save",{defaultValue:"Save"})}),e.jsx(_,{onClick:N,icon:e.jsx(H,{}),children:g("refresh",{defaultValue:"Refresh"})})]})})]})})},ye=()=>{const{t}=F("system"),{t:f}=F("common"),[a]=s.useForm(),{loading:g,data:d,refresh:m}=I(oe,{onSuccess:l=>{a.setFieldsValue(l)},onError:l=>{V.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",l)}}),{loading:h,run:p}=I(de,{manual:!0,onSuccess:()=>{V.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),m()},onError:l=>{V.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",l)}}),c=l=>{p(l)};return e.jsx(R,{spinning:g,children:e.jsxs(s,{form:a,layout:"vertical",onFinish:c,initialValues:d,children:[e.jsx(s.Item,{name:"mfa_enforced",label:t("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:t("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsx(k,{})}),e.jsx(s.Item,{name:"password_complexity",label:t("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:t("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxs(A,{children:[e.jsx(A.Option,{value:"low",children:t("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsx(A.Option,{value:"medium",children:t("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsx(A.Option,{value:"high",children:t("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsx(A.Option,{value:"very_high",children:t("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsx(s.Item,{name:"password_min_length",label:t("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:t("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsx(P,{min:6,max:32,style:{width:"100%"}})}),e.jsx(s.Item,{name:"password_expiry_days",label:t("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:t("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsx(P,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsx(s.Item,{name:"login_failure_lock",label:t("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:t("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsx(k,{})}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:(l,o)=>l.login_failure_lock!==o.login_failure_lock,children:({getFieldValue:l})=>l("login_failure_lock")?e.jsx(s.Item,{name:"login_failure_attempts",label:t("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:t("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsx(P,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:(l,o)=>l.login_failure_lock!==o.login_failure_lock,children:({getFieldValue:l})=>l("login_failure_lock")?e.jsx(s.Item,{name:"login_failure_lockout_minutes",label:t("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:t("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsx(P,{min:1,max:10,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsx(s.Item,{name:"history_password_check",label:t("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:t("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsx(k,{})}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:(l,o)=>l.history_password_check!==o.history_password_check,children:({getFieldValue:l})=>l("history_password_check")?e.jsx(s.Item,{name:"history_password_count",label:t("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:t("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsx(P,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsx(s.Item,{name:"inactive_account_lock_days",label:t("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:t("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsx(P,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsx(s.Item,{name:"session_timeout_minutes",label:t("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:t("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsx(P,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsx(s.Item,{name:"session_idle_timeout_minutes",label:t("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:t("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsx(P,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsx(s.Item,{children:e.jsxs($,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:h,icon:e.jsx(z,{}),children:f("save",{defaultValue:"Save"})}),e.jsx(_,{onClick:()=>m(),icon:e.jsx(H,{}),children:f("refresh",{defaultValue:"Refresh"})})]})})]})})},_e=({fetchItems:t,importItems:f,columns:a,...g})=>{const{t:d}=F("system"),[m,h]=j.useState([]),[p,c]=j.useState([]),{run:l,loading:o}=I(t,{onError:x=>{V.error(d("settings.ldap.importError",{error:`${x.message}`}))},onSuccess:x=>{h(x)},manual:!0}),{run:n,loading:w}=I(async()=>{for(const x of p.filter(v=>{const r=m.find(y=>y.ldap_dn===v);return!(!r||r.imported)})){const v=await f([x]);h(r=>[...r].map(T=>{for(const C of v)if(T.ldap_dn===C.ldap_dn)return{...C,imported:!0};return T}))}},{manual:!0});return j.useEffect(()=>{g.visible&&(h([]),l(),c([]))},[g.visible]),e.jsx(G,{title:d("settings.ldap.importTitle"),...g,onOk:()=>{n()},width:900,confirmLoading:w,loading:o,children:e.jsx(se,{rowKey:"ldap_dn",rowSelection:{onChange:x=>{c(x)},getCheckboxProps:x=>({disabled:x.imported})},columns:a.map(({render:x,...v})=>x?{...v,render:(r,y,T)=>{const C=p.includes(y.ldap_dn)&&w&&!y.imported;return x(r,y,T,C)}}:v),dataSource:m,pagination:!1,scroll:{y:400,x:"max-content"}})})},ve=()=>{var y,T,C;const{t}=F("system"),[f]=s.useForm(),[a,g]=j.useState(!1),[d,m]=j.useState(null),[h,p]=j.useState(!1),[c,l]=j.useState(!1),[o]=s.useForm(),[n,w]=j.useState(!1);I(ue,{onSuccess:u=>{f.setFieldsValue(u),w(u.enabled)},onError:u=>{V.error(t("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${u.message}`}))}}),j.useEffect(()=>{m(null)},[h]);const x=async u=>{g(!0);try{await me(u),V.success(t("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{V.error(t("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{g(!1)}},{run:v,loading:r}=I(async u=>{const E=await f.validateFields();return await ce({...u,...E})},{onSuccess:u=>{m(u)},onError:u=>{V.error(t("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${u.message}`}))},manual:!0});return e.jsxs(e.Fragment,{children:[e.jsxs(s,{form:f,layout:"vertical",onFinish:x,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsx(s.Item,{label:t("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsx(k,{onChange:u=>w(u)})}),e.jsx(s.Item,{label:t("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:n,message:t("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsx(i,{disabled:!n,placeholder:"ldap://ldap.example.com:389"})}),e.jsx(s.Item,{label:t("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:n,message:t("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsx(i,{disabled:!n,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsx(s.Item,{label:t("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:n,message:t("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsx(i.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsx(s.Item,{label:t("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:n,message:t("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsx(i,{disabled:!n,placeholder:"dc=example,dc=com"})}),e.jsx(s.Item,{label:t("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsx(i,{disabled:!n,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsx(s.Item,{label:t("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:n,message:t("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:n,message:t("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:n,message:t("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:n,message:t("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(B,{children:t("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsx(s.Item,{label:t("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsx(k,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsx(k,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!n})}),e.jsxs(s.Item,{children:[e.jsx(U,{permissions:["system:settings:update"],children:e.jsx(_,{type:"primary",htmlType:"submit",loading:a,children:t("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsx(U,{permissions:["system:settings:update"],children:e.jsx(_,{disabled:!n,style:{marginLeft:8},onClick:()=>p(!0),children:t("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsx(U,{permissions:["authorization:user:create"],children:e.jsx(_,{disabled:!n,style:{marginLeft:8},onClick:()=>{l(!0)},children:t("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxs(G,{title:t("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:h,onCancel:()=>p(!1),footer:null,children:[e.jsxs(s,{form:o,layout:"vertical",onFinish:v,children:[e.jsx(s.Item,{label:t("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:t("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(s.Item,{label:t("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:t("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsx(i.Password,{disabled:!n})}),e.jsxs(s.Item,{children:[e.jsx(U,{permissions:["system:settings:update"],children:e.jsx(_,{disabled:!n,type:"primary",htmlType:"submit",children:t("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsx(_,{style:{marginLeft:8},onClick:()=>p(!1),children:t("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsx(R,{spinning:r,children:e.jsx(Y,{active:r,loading:r,children:d&&(d.user?e.jsxs(q,{bordered:!0,children:[e.jsx(q.Item,{label:"Username",span:3,children:d.user.username}),e.jsx(q.Item,{label:"Email",span:3,children:d.user.email}),e.jsx(q.Item,{label:"FullName",span:3,children:d.user.full_name}),e.jsx(q.Item,{label:"CreatedAt",span:3,children:d.user.created_at}),e.jsx(q.Item,{label:"UpdatedAt",span:3,children:d.user.updated_at})]}):e.jsx(J,{direction:"vertical",current:(y=d.message)==null?void 0:y.findIndex(u=>!u.success),status:(T=d.message)!=null&&T.find(u=>!u.success)?"error":"finish",items:(C=d.message)==null?void 0:C.map(u=>({status:u.success?"finish":"error",title:u.message}))}))})})]}),e.jsx(_e,{visible:c,onCancel:()=>l(!1),fetchItems:()=>X(),importItems:u=>X({user_dn:u}),columns:[{title:t("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:t("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:t("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:t("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(u,E,Z,N)=>N?e.jsx(R,{indicator:e.jsx(ee,{spin:!0})}):u?e.jsx(te,{twoToneColor:"#52c41a"}):E.id?e.jsx(K,{color:"blue",children:t("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsx(K,{color:"green",children:t("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},Ie=()=>{const{t}=F("system"),{t:f}=F("common"),[a]=s.useForm(),[g,d]=j.useState(null),[m,h]=j.useState(!1),[p]=s.useForm(),[c,l]=j.useState(!1),{loading:o}=I(pe,{onSuccess:r=>{a.setFieldsValue(r),l(r.enabled)},onError:r=>{V.error(t("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${r.message}`}))}});j.useEffect(()=>{d(null)},[m]);const{run:n,loading:w}=I(({port:r,...y})=>he({...y,port:Number(r)}),{manual:!0,onSuccess:()=>{V.success(t("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:r=>{V.error(t("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${r.message}`}))}}),{run:x,loading:v}=I(async r=>{const{port:y,...T}=await a.validateFields();return await fe({...r,...T,port:Number(y)})},{onSuccess:r=>{d(r)},onError:r=>{V.error(t("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${r.message}`}))},manual:!0});return e.jsxs(e.Fragment,{children:[e.jsx(R,{spinning:o,children:e.jsxs(s,{form:a,layout:"vertical",onFinish:n,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsx(s.Item,{label:t("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsx(k,{onChange:r=>l(r)})}),e.jsx(s.Item,{label:t("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:c,message:t("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsx(i,{disabled:!c,placeholder:"smtp.example.com"})}),e.jsx(s.Item,{label:t("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:c,message:t("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsx(i,{type:"number",disabled:!c,placeholder:"587"})}),e.jsx(s.Item,{label:t("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:c,message:t("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsx(i,{disabled:!c,placeholder:"user@example.com"})}),e.jsx(s.Item,{label:t("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsx(i.Password,{disabled:!c,autoComplete:"new-password"})}),e.jsx(s.Item,{label:t("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:c,message:t("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxs(M.Group,{disabled:!c,children:[e.jsx(M.Button,{value:"None",children:t("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsx(M.Button,{value:"SSL/TLS",children:t("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsx(M.Button,{value:"STARTTLS",children:t("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsx(s.Item,{label:t("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:c,message:t("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:t("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsx(i,{disabled:!c,placeholder:"noreply@example.com"})}),e.jsx(s.Item,{label:t("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsx(i,{disabled:!c,placeholder:t("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsx(B,{children:t("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsx(s.Item,{label:t("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsx(D,{theme:"snow"})}),e.jsx(s.Item,{label:t("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsx(D,{theme:"snow"})}),e.jsx(s.Item,{label:t("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsx(D,{theme:"snow"})}),e.jsxs(s.Item,{children:[e.jsx(U,{permission:"system:setting:update",children:e.jsx(_,{type:"primary",htmlType:"submit",loading:w,style:{marginRight:8},children:f("save",{defaultValue:"Save"})})}),e.jsx(_,{onClick:()=>h(!0),disabled:!c||v,loading:v,children:t("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsx(G,{title:t("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:m,onCancel:()=>h(!1),footer:[e.jsx(_,{onClick:()=>h(!1),children:f("cancel",{defaultValue:"Cancel"})},"back"),e.jsx(_,{type:"primary",loading:v,onClick:()=>p.submit(),children:t("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxs(s,{form:p,layout:"vertical",onFinish:r=>x(r),children:[e.jsx(s.Item,{label:t("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:t("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:t("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsx(i,{placeholder:"test@example.com"})}),g&&e.jsx(s.Item,{label:t("settings.smtp.testResult",{defaultValue:"Test Result"}),children:g.success?e.jsx("span",{style:{color:"green"},children:t("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsx("span",{style:{color:"red"},children:t("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:g.message})})})]})})]})},Se=()=>{const{t,i18n:f}=F("system"),{t:a}=F("common"),[g]=s.useForm(),{loading:d,data:m,refresh:h}=I(ge,{onSuccess:o=>{g.setFieldsValue(o)},onError:o=>{V.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",o)}}),{loading:p,run:c}=I(be,{manual:!0,onSuccess:()=>{V.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),h()},onError:o=>{V.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",o)}}),l=o=>{c(o)};return e.jsx(R,{spinning:d,children:e.jsxs(s,{form:g,layout:"vertical",onFinish:l,initialValues:m,children:[e.jsx(s.Item,{label:t("settings.base.name",{defaultValue:"Name"}),children:e.jsx(W,{items:[{key:"default",label:a("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:"name",children:e.jsx(i,{})})})},...xe.map(o=>({key:o.lang,label:f.language!==o.lang?a(`language.${o.lang}`,{defaultValue:o.label,lang:o.label}):o.label,forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(s.Item,{name:["name_i18n",o.lang],children:e.jsx(i,{})})})}))]})}),e.jsx(s.Item,{label:t("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsx(i,{})}),e.jsx(s.Item,{label:t("settings.base.home_page",{defaultValue:"Home Page"}),name:"home_page",children:e.jsx(i,{})}),e.jsx(s.Item,{children:e.jsxs($,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:p,icon:e.jsx(z,{}),children:a("save",{defaultValue:"Save"})}),e.jsx(_,{onClick:()=>h(),icon:e.jsx(H,{}),children:a("refresh",{defaultValue:"Refresh"})})]})})]})})},ke=()=>{const{t}=F("system"),f=ae(),a=le(),m=a.hash.replace("#","")||"base",h=[{key:"base",label:t("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsx(Se,{})},{key:"security",label:t("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsx(ye,{})},{key:"oauth",label:t("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsx(Ve,{})},{key:"ldap",label:t("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsx(ve,{})},{key:"smtp",label:t("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsx(Ie,{})}];return e.jsx(ie,{title:t("settings.title",{defaultValue:"System Settings"}),children:e.jsx(W,{defaultActiveKey:m,onChange:p=>{f(`${a.pathname}#${p}`)},items:h})})};export{ke as default};
