import{u as F,F as m,r as u,e as $,j as e,M as X,m as ee,aU as de,E as k,n as d,s as f,ac as fe,am as je,a2 as U,aV as R,O as G,aW as te,aX as Ve,y as Se,aN as Y,aK as H,V as ae,aO as le,C as M,Y as se,Z as W,a0 as ge,aY as be,a1 as oe,aP as he,X as ye,aJ as ce,T as pe,aZ as xe,a_ as _e,$ as we,x as ke,a$ as Ee,b0 as Ce,b1 as ze,h as Ie,W as Q,_ as me,c as Fe,al as Re,b2 as Te,S as ne,aM as ve,b3 as K,b4 as De,af as Ke}from"./vendor.BL40-5vE.js";import{f as I}from"./components.Dud8GRKo.js";import{a as V}from"./index.CFGX7lSC.js";import{P as q,f as P}from"./base.D4vFg2QQ.js";import Pe from"./not_found.D8SvSEXl.js";import{a as Ne}from"./contexts.Dt3wwJ0J.js";const Ae=({serviceAccountID:s,onClose:t,open:j=!1,onSuccess:E})=>{const{t:n}=F("authorization"),{t:a}=F("common"),[r]=m.useForm(),[x,p]=u.useState(!1),{run:S,loading:o}=$(g=>s?V.authorization.updateServiceAccount({id:s},g):V.authorization.createServiceAccount(g),{onSuccess:()=>{f.success(n("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),t(),E==null||E()},onError:()=>{f.error(n("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return u.useEffect(()=>{const g=async v=>{p(!0);try{const b=await V.authorization.getServiceAccountById({id:v});r.setFieldsValue({name:b.name,description:b.description})}catch{f.error(n("serviceAccount.loadError",{defaultValue:"Failed to load service account."}))}finally{p(!1)}};j&&(r.resetFields(),s&&g(s))},[s,j]),e.jsx(X,{title:s?n("serviceAccount.edit",{defaultValue:"Edit Service Account"}):n("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:()=>{r.resetFields(),t()},open:j,footer:e.jsxs(k,{children:[e.jsx(d,{onClick:t,children:a("cancel",{defaultValue:"Cancel"})}),e.jsx(d,{type:"primary",onClick:r.submit,loading:o||x,children:a("save",{defaultValue:"Save"})})]}),children:e.jsxs(m,{form:r,layout:"vertical",onFinish:S,children:[e.jsx(m.Item,{label:n("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:n("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsx(ee,{placeholder:n("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsx(m.Item,{label:n("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsx(de,{rows:4,placeholder:n("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},Ue=()=>{const{t:s}=F("authorization"),{t}=F("common"),j=fe(),[E]=m.useForm(),[n]=m.useForm(),[a,r]=u.useState(!1),[x,p]=u.useState([]),[S,o]=u.useState(0),[g,v]=u.useState(!1),[b,_]=u.useState(null),[w,i]=u.useState({current:q.DEFAULT_CURRENT,page_size:q.DEFAULT_PAGE_SIZE,search:void 0}),h=u.useCallback(async()=>{try{r(!0);const c=await V.authorization.getServiceAccounts(w);p(c.data||[]),o(c.total||0)}catch(c){console.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),c),f.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{r(!1)}},[w,s]);u.useEffect(()=>{h()},[h]);const C=c=>{i({...w,current:q.DEFAULT_CURRENT,search:c.search})},T=()=>{E.resetFields(),i({current:q.DEFAULT_CURRENT,page_size:q.DEFAULT_PAGE_SIZE,search:void 0})},D=(c,y)=>{i(N=>({...N,current:c,page_size:y}))},L=()=>{_(null),v(!0)},O=c=>{_(c.id),v(!0)},B=()=>{v(!1),n.resetFields()},A=async c=>{try{await V.authorization.deleteServiceAccount({id:c}),f.success(s("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),h()}catch(y){console.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),y),f.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},z=async c=>{const y=c.status==="active"?"disabled":"active";try{await V.authorization.updateServiceAccountStatus({id:c.id},{status:y}),f.success(s("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),h()}catch(N){console.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),N),f.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},l=[{title:s("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(c,y)=>e.jsx(I,{permission:"authorization:service_account:view",fallback:c,children:e.jsx(je,{to:`/authorization/service-accounts/${y.id}`,children:c})})},{title:s("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:c=>e.jsx(U,{title:c,children:e.jsx("span",{children:(c==null?void 0:c.length)>30?`${c.substring(0,30)}...`:c})})},{title:s("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:c=>c==="active"?e.jsx(R,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:s("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(c,y)=>{var N;return e.jsxs(k,{size:[0,4],wrap:!0,children:[(N=y.roles)==null?void 0:N.map(ie=>e.jsx(G,{color:"blue",children:ie.name},ie.id)),(!y.roles||y.roles.length===0)&&e.jsx(G,{children:s("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(c,y)=>y.policy_document&&y.policy_document.Statement&&y.policy_document.Statement.length>0?e.jsx(G,{color:"green",icon:e.jsx(te,{}),children:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsx(G,{color:"default",icon:e.jsx(Ve,{}),children:s("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:s("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:c=>P(c)},{title:s("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:c=>c?P(c):s("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:t("actions",{defaultValue:"Actions"}),key:"action",render:(c,y)=>e.jsxs(k,{size:"small",children:[e.jsx(I,{permission:"authorization:service_account:view",children:e.jsx(U,{title:s("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsx(d,{type:"text",size:"small",icon:e.jsx(Se,{}),onClick:()=>j(`/authorization/service-accounts/${y.id}`)})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(U,{title:s("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsx(d,{type:"text",size:"small",icon:e.jsx(Y,{}),onClick:()=>O(y)})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(U,{title:y.status==="active"?t("disable",{defaultValue:"Disable"}):t("enable",{defaultValue:"Enable"}),children:e.jsx(d,{type:"text",size:"small",icon:y.status==="active"?e.jsx(H,{}):e.jsx(te,{}),onClick:()=>z(y)})})}),e.jsx(I,{permission:"authorization:service_account:delete",children:e.jsx(U,{title:s("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsx(ae,{title:s("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>A(y.id),okText:t("confirm",{defaultValue:"Confirm"}),cancelText:t("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{type:"text",size:"small",danger:!0,icon:e.jsx(le,{})})})})})]})}];return e.jsxs("div",{children:[e.jsx(M,{style:{marginBottom:16},children:e.jsx(m,{form:E,layout:"horizontal",onFinish:C,initialValues:{search:w.search},style:{marginBottom:0},children:e.jsxs(se,{gutter:16,children:[e.jsx(W,{xs:24,sm:12,md:8,lg:6,children:e.jsx(m.Item,{name:"search",label:t("keyword",{defaultValue:"Keyword"}),children:e.jsx(ee,{placeholder:s("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsx(ge,{})})})}),e.jsx(W,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsx(m.Item,{children:e.jsxs(k,{children:[e.jsx(d,{type:"primary",htmlType:"submit",icon:e.jsx(be,{}),children:t("filter",{defaultValue:"Filter"})}),e.jsx(d,{onClick:T,icon:e.jsx(oe,{}),children:t("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxs(M,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(se,{justify:"space-between",align:"middle",children:[e.jsx(W,{children:e.jsx(d,{type:"primary",onClick:T,icon:e.jsx(oe,{}),children:t("refresh",{defaultValue:"Refresh"})})}),e.jsx(W,{children:e.jsx(I,{permission:"authorization:service_account:create",children:e.jsx(d,{type:"primary",icon:e.jsx(he,{}),onClick:L,children:s("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsx(ye,{rowKey:"id",dataSource:x,columns:l,loading:a,pagination:{current:w.current,pageSize:w.page_size,total:S,onChange:D,showSizeChanger:!0,showQuickJumper:!0,showTotal:c=>t("totalItems",{defaultValue:`Total ${c} items`,total:c})}})]}),e.jsx(Ae,{serviceAccountID:b,onClose:B,open:g,onSuccess:()=>{h()}})]})},He=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),{Text:J,Paragraph:re}=pe,{TextArea:$e}=ee,Me=({serviceAccountID:s})=>{const{t}=F("authorization"),{t:j}=F("common"),[E,n]=u.useState([]),[a,r]=u.useState(!1),[x,p]=u.useState(!1),[S]=m.useForm(),[o,g]=u.useState(null),[v,b]=u.useState(null),[_,w]=u.useState(!1),i=async()=>{if(s){r(!0);try{const l=await V.authorization.getServiceAccountAccessKeys({id:s});n(l)}catch(l){console.error("Failed to load access keys:",l),f.error(t("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{r(!1)}}};u.useEffect(()=>{i()},[s]);const h=l=>{navigator.clipboard.writeText(l).then(()=>{f.success(t("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},c=>{console.error("Could not copy text: ",c)})},C=()=>{g(null),S.resetFields(),p(!0)},T=l=>{g(l),S.setFieldsValue({name:l.name,description:l.description,status:l.status==="active",expires_at:l.expires_at?ze(l.expires_at):void 0}),p(!0)},D=()=>{p(!1),S.resetFields()},{run:L,loading:O}=$(async()=>{const l=await S.validateFields();if(o){const c=await V.authorization.updateServiceAccountAccessKey({id:s,keyId:o.id},{name:l.name,description:l.description,status:l.status?"active":"disabled",expires_at:l.expires_at?l.expires_at.toISOString():void 0});return p(!1),c}else{const c=await V.authorization.createServiceAccountAccessKey({id:s},{name:l.name,description:l.description,expires_at:l.expires_at?l.expires_at.toISOString():void 0});b(c),p(!1),w(!0)}},{manual:!0,onSuccess:()=>{f.success(t("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),i()},onError:()=>{f.error(t("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),B=async l=>{try{await V.authorization.deleteServiceAccountAccessKey({id:s,keyId:l}),f.success(t("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),i()}catch(c){console.error("Failed to delete key:",c),f.error(t("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},A=()=>{w(!1),b(null)},z=[{title:t("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:l=>e.jsxs(k,{children:[e.jsx(ce,{}),e.jsx(J,{copyable:!0,children:l})]})},{title:t("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:t("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:l=>l==="active"?e.jsx(R,{status:"success",text:t("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:l=>l?P(l):e.jsx(J,{type:"secondary",children:t("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:t("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:l=>l?P(l):e.jsx(J,{type:"secondary",children:t("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:j("actions",{defaultValue:"Actions"}),key:"action",render:(l,c)=>e.jsxs(k,{size:"small",children:[e.jsx(U,{title:t("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsx(d,{type:"text",icon:e.jsx(Y,{}),onClick:()=>T(c)})}),e.jsx(ae,{title:t("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>B(c.id),okText:j("confirm",{defaultValue:"Confirm"}),cancelText:j("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{type:"text",danger:!0,icon:e.jsx(le,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:e.jsxs(k,{children:[e.jsx(ce,{}),t("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxs(k,{children:[e.jsx(d,{icon:e.jsx(xe,{}),onClick:i,loading:a,children:j("refresh",{defaultValue:"Refresh"})}),e.jsx(d,{type:"primary",icon:e.jsx(he,{}),onClick:C,children:t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsx(ye,{columns:z,dataSource:E,rowKey:"id",loading:a,pagination:!1})}),e.jsx(X,{title:o?t("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:x,onOk:L,confirmLoading:O,onCancel:D,children:e.jsxs(m,{form:S,layout:"vertical",children:[e.jsx(m.Item,{name:"name",label:t("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:t("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsx(ee,{placeholder:t("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsx(m.Item,{name:"description",label:t("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsx($e,{rows:3,placeholder:t("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),o&&e.jsx(m.Item,{name:"status",label:t("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsx(_e,{checkedChildren:t("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsx(m.Item,{name:"expires_at",label:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsx(we,{showTime:!0,placeholder:t("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxs(X,{title:e.jsxs(k,{children:[e.jsx(Ce,{style:{color:"#faad14"}}),t("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:_,footer:[e.jsx(d,{onClick:A,children:j("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsx(ke,{message:t("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(J,{strong:!0,children:[t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsx(re,{copyable:{text:v.access_key_id},children:v.access_key_id})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(J,{strong:!0,children:[t("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsx(re,{copyable:{text:v.secret_access_key||""},children:v.secret_access_key})]}),e.jsx(d,{type:"primary",icon:e.jsx(Ee,{}),onClick:()=>{const l=`Access Key: ${v.access_key_id}
Secret Key: ${v.secret_access_key}`;h(l)},block:!0,children:t("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:ue}=pe,Le=({serviceAccount:s,onRefresh:t,loading:j})=>{const{id:E}=s||{},{t:n}=F("authorization"),{t:a}=F("common"),[r,x]=u.useState([]),[p,S]=u.useState([]);u.useEffect(()=>{S((s==null?void 0:s.roles)||[])},[s]);const[o,g]=u.useState(void 0),{loading:v}=$(async()=>V.authorization.listRoles({current:1,page_size:20,search:o}),{onSuccess:i=>{const h=i.data;p.forEach(C=>{h.find(D=>D.id===C.id)||h.push(C)}),x(h)},onError:i=>{console.error("Failed to load roles:",i),f.error(n("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[o]}),{run:b,loading:_}=$(async()=>{if(E)return V.authorization.assignServiceAccountRoles({id:E},{role_ids:p.map(i=>i.id)})},{onSuccess:()=>{f.success(n("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),t()},onError:i=>{console.error("Failed to assign roles:",i),f.error(n("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),w=i=>{S(i.map(h=>r.find(C=>C.id===h)||{id:h,name:h,description:h}))};return e.jsx(M,{title:e.jsxs(k,{children:[e.jsx(H,{}),n("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsx(d,{icon:e.jsx(xe,{}),onClick:()=>{t()},disabled:j||_,loading:_,children:a("refresh",{defaultValue:"Refresh"})}),children:_?e.jsx(Ie,{active:!0,paragraph:{rows:4}}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(ue,{children:n("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsx("div",{style:{marginTop:8},children:p.length>0?r.filter(i=>p.some(h=>h.id===i.id)).map(i=>e.jsx(G,{color:"blue",children:i.name},i.id)):e.jsx(Q,{image:Q.PRESENTED_IMAGE_SIMPLE,description:n("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(ue,{children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsx(me,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:n("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:p.map(i=>i.id),onSearch:i=>{g(i)},onDropdownVisibleChange:i=>{i&&g(void 0)},onChange:w,loading:j||v,optionFilterProp:"label",options:r.map(i=>({label:i.name,value:i.id,title:i.description}))})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(d,{type:"primary",onClick:b,loading:_,disabled:j,children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:Z}=ve,Oe={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},Be=Fe(({css:s})=>({rolePolicy:s`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:s`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:s`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),qe=()=>{const{styles:s}=Be(),n=Re().hash.replace("#","")||"basic",{t:a}=F("authorization"),{t:r}=F("common"),{id:x}=Te(),p=fe(),{hasPermission:S}=Ne(),[o,g]=u.useState(null),[v,b]=u.useState(!1),[_]=m.useForm(),[w,i]=u.useState(!1);if(!x)return e.jsx(Pe,{});const{run:h,loading:C}=$(async()=>{if(x)return V.authorization.getServiceAccountById({id:x})},{onSuccess:A=>{g(A||null)}});u.useEffect(()=>{h()},[x]);const T=A=>{p(`#${A}`)},D=async()=>{if(x)try{await V.authorization.deleteServiceAccount({id:x}),f.success(a("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),p("/authorization/service-accounts")}catch(A){console.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),A),f.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:L,loading:O}=$(async()=>{if(o)return V.authorization.updateServiceAccountStatus({id:x},{status:o.status==="active"?"disabled":"active"})},{onSuccess:A=>{g(A||null),f.success(a("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:A=>{console.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),A),f.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),B=async A=>{if(x)try{let z;try{z=JSON.parse(A.policy_document)}catch{f.error(a("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await V.authorization.setServiceAccountPolicy({id:x},{policy_document:z}),f.success(a("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),b(!1),h()}catch(z){console.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),z),f.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return C?e.jsx(ne,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):o?e.jsxs(M,{title:e.jsxs(k,{children:[e.jsx(Ke,{}),o.name,o.status==="active"?e.jsx(R,{status:"success",text:a("serviceAccount.status.active",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:a("serviceAccount.status.disabled",{defaultValue:"Disabled"})})]}),extra:e.jsxs(k,{children:[e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(d,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>i(!0),disabled:w,children:r("edit",{defaultValue:"Edit"})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(d,{icon:o.status==="active"?e.jsx(H,{}):e.jsx(te,{}),onClick:L,loading:O,children:o.status==="active"?r("disable",{defaultValue:"Disable"}):r("enable",{defaultValue:"Enable"})})}),e.jsx(I,{permission:"authorization:service_account:delete",children:e.jsx(ae,{title:a("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:D,okText:r("confirm",{defaultValue:"Confirm"}),cancelText:r("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{danger:!0,icon:e.jsx(le,{}),children:r("delete",{defaultValue:"Delete"})})})}),e.jsx(d,{icon:e.jsx(De,{}),onClick:()=>p("/authorization/service-accounts"),children:r("back",{defaultValue:"Back"})})]}),children:[e.jsxs(ve,{defaultActiveKey:n,onChange:T,children:[e.jsx(Z,{tab:a("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxs(K,{bordered:!0,column:2,children:[e.jsx(K.Item,{label:a("serviceAccount.name",{defaultValue:"Name"}),span:2,children:o.name}),e.jsx(K.Item,{label:a("serviceAccount.description",{defaultValue:"Description"}),span:2,children:o.description||a("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsx(K.Item,{label:a("serviceAccount.status",{defaultValue:"Status"}),children:o.status==="active"?e.jsx(R,{status:"success",text:a("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:a("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsx(K.Item,{label:a("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:o.last_access?P(o.last_access):a("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsx(K.Item,{label:a("serviceAccount.createdAt",{defaultValue:"Created At"}),children:P(o.created_at)}),e.jsx(K.Item,{label:a("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:P(o.updated_at)})]})},"basic"),e.jsx(Z,{tab:e.jsxs("span",{children:[e.jsx(ce,{}),a("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!S("authorization:service_account:access_key:list"),children:e.jsx(Me,{serviceAccountID:x})},"access-keys"),e.jsx(Z,{tab:e.jsxs("span",{children:[e.jsx(H,{}),a("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!S("authorization:service_account:role:list"),children:e.jsx(Le,{serviceAccount:o,onRefresh:h})},"authorization"),e.jsxs(Z,{tab:a("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(se,{justify:"end",children:e.jsx(W,{children:e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(d,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>{b(!0),_.setFieldsValue({policy_document:JSON.stringify(o.policy_document,null,2)})},children:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsx(ne,{spinning:C,children:o.policy_document&&o.policy_document.Statement&&o.policy_document.Statement.length>0?e.jsx(M,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(o.policy_document,null,2)})}):e.jsx(Q,{description:a("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsx(X,{title:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:v,onCancel:()=>{b(!1),_.resetFields()},footer:null,width:700,children:e.jsxs(m,{form:_,layout:"vertical",onFinish:B,children:[e.jsx(m.Item,{name:"policy_document",extra:e.jsx("span",{className:s.rolePolicyExtra,children:e.jsx(me,{style:{width:120},placeholder:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:a("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:a("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:a("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:a("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:a("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:A=>{const z=Oe[A];z&&_.setFieldValue("policy_document",JSON.stringify(z,null,2))}})}),children:e.jsx(de,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsx(m.Item,{children:e.jsxs(k,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:r("save",{defaultValue:"Save"})}),e.jsx(d,{onClick:()=>b(!1),children:r("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsx(Ae,{serviceAccountID:x,onClose:()=>i(!1),open:w})]}):e.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsx(Q,{description:a("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},Qe=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{He as S,Qe as a};
