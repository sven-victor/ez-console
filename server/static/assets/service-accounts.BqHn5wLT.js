import{u as I,q as v,r as u,e as U,j as e,M as H,s as Y,bh as ue,K as _,t as d,v as h,aC as de,aM as Ae,T as N,bi as F,Z as G,bj as ee,bk as je,H as Ve,bc as Z,b8 as Q,_ as ce,ag as ae,C as $,a1 as te,a2 as J,a5 as Se,bl as ge,a6 as ie,ae as he,a0 as fe,b7 as se,V as ye,bm as pe,a9 as be,a4 as _e,G as ke,bn as we,bo as Ee,aq as Ce,k as ze,$ as X,a3 as xe,c as Ie,aL as Fe,bd as Re,S as oe,bb as ve,bp as T,bq as Te,aF as De}from"./vendor.MZTBlccq.js";import{i as z}from"./components.D-VDnegO.js";import{a as S}from"./index.BC1A130I.js";import{P as O,f as D}from"./base.De0_vyxt.js";import Ke from"./not_found.DwPxddIV.js";import{a as Pe}from"./contexts.CSoxAagf.js";const me=({serviceAccountID:c,onClose:s,open:j=!1,onSuccess:k})=>{const{t:n}=I("authorization"),{t:a}=I("common"),[r]=v.useForm(),[y,f]=u.useState(!1),{run:g,loading:o}=U(m=>c?S.authorization.updateServiceAccount({id:c},m):S.authorization.createServiceAccount(m),{onSuccess:()=>{h.success(n("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),s(),k==null||k()},onError:()=>{h.error(n("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return u.useEffect(()=>{const m=async b=>{f(!0);try{const V=await S.authorization.getServiceAccountById({id:b});r.setFieldsValue({name:V.name,description:V.description})}catch{h.error(n("serviceAccount.loadError",{defaultValue:"Failed to load service account."}))}finally{f(!1)}};j&&(r.resetFields(),c&&m(c))},[c,j]),e.jsx(H,{title:c?n("serviceAccount.edit",{defaultValue:"Edit Service Account"}):n("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:()=>{r.resetFields(),s()},onCancel:()=>{r.resetFields(),s()},open:j,footer:e.jsxs(_,{children:[e.jsx(d,{onClick:s,children:a("cancel",{defaultValue:"Cancel"})}),e.jsx(d,{type:"primary",onClick:r.submit,loading:o||y,children:a("save",{defaultValue:"Save"})})]}),children:e.jsxs(v,{form:r,layout:"vertical",onFinish:g,children:[e.jsx(v.Item,{label:n("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:n("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsx(Y,{placeholder:n("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsx(v.Item,{label:n("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsx(ue,{rows:4,placeholder:n("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},Ne=()=>{const{t:c}=I("authorization"),{t:s}=I("common"),j=de(),[k]=v.useForm(),[n,a]=u.useState(!1),[r,y]=u.useState([]),[f,g]=u.useState(0),[o,m]=u.useState(!1),[b,V]=u.useState(null),[p,E]=u.useState({current:O.DEFAULT_CURRENT,page_size:O.DEFAULT_PAGE_SIZE,search:void 0}),l=u.useCallback(async()=>{try{a(!0);const t=await S.authorization.getServiceAccounts(p);y(t.data||[]),g(t.total||0)}catch(t){console.error(c("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),t),h.error(c("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{a(!1)}},[p,c]);u.useEffect(()=>{l()},[l]);const x=t=>{E({...p,current:O.DEFAULT_CURRENT,search:t.search})},w=()=>{k.resetFields(),E({current:O.DEFAULT_CURRENT,page_size:O.DEFAULT_PAGE_SIZE,search:void 0})},K=(t,i)=>{E(P=>({...P,current:t,page_size:i}))},R=()=>{V(null),m(!0)},M=t=>{V(t.id),m(!0)},L=()=>{m(!1)},B=async t=>{try{await S.authorization.deleteServiceAccount({id:t}),h.success(c("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),l()}catch(i){console.error(c("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),i),h.error(c("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},A=async t=>{const i=t.status==="active"?"disabled":"active";try{await S.authorization.updateServiceAccountStatus({id:t.id},{status:i}),h.success(c("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),l()}catch(P){console.error(c("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),P),h.error(c("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},C=[{title:c("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(t,i)=>e.jsx(z,{permission:"authorization:service_account:view",fallback:t,children:e.jsx(Ae,{to:`/authorization/service-accounts/${i.id}`,children:t})})},{title:c("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:t=>e.jsx(N,{title:t,children:e.jsx("span",{children:(t==null?void 0:t.length)>30?`${t.substring(0,30)}...`:t})})},{title:c("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:t=>t==="active"?e.jsx(F,{status:"success",text:c("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(F,{status:"error",text:c("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:c("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(t,i)=>{var P;return e.jsxs(_,{size:[0,4],wrap:!0,children:[(P=i.roles)==null?void 0:P.map(le=>e.jsx(G,{color:"blue",children:le.name},le.id)),(!i.roles||i.roles.length===0)&&e.jsx(G,{children:c("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:c("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(t,i)=>i.policy_document&&i.policy_document.Statement&&i.policy_document.Statement.length>0?e.jsx(G,{color:"green",icon:e.jsx(ee,{}),children:c("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsx(G,{color:"default",icon:e.jsx(je,{}),children:c("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:c("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:t=>D(t)},{title:c("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:t=>t?D(t):c("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:s("actions",{defaultValue:"Actions"}),key:"action",render:(t,i)=>e.jsxs(_,{size:"small",children:[e.jsx(z,{permission:"authorization:service_account:view",children:e.jsx(N,{title:c("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsx(d,{type:"text",size:"small",icon:e.jsx(Ve,{}),onClick:()=>j(`/authorization/service-accounts/${i.id}`)})})}),e.jsx(z,{permission:"authorization:service_account:update",children:e.jsx(N,{title:c("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsx(d,{type:"text",size:"small",icon:e.jsx(Z,{}),onClick:()=>M(i)})})}),e.jsx(z,{permission:"authorization:service_account:update",children:e.jsx(N,{title:i.status==="active"?s("disable",{defaultValue:"Disable"}):s("enable",{defaultValue:"Enable"}),children:e.jsx(d,{type:"text",size:"small",icon:i.status==="active"?e.jsx(Q,{}):e.jsx(ee,{}),onClick:()=>A(i)})})}),e.jsx(z,{permission:"authorization:service_account:delete",children:e.jsx(N,{title:c("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsx(ce,{title:c("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>B(i.id),okText:s("confirm",{defaultValue:"Confirm"}),cancelText:s("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{type:"text",size:"small",danger:!0,icon:e.jsx(ae,{})})})})})]})}];return e.jsxs("div",{children:[e.jsx($,{style:{marginBottom:16},children:e.jsx(v,{form:k,layout:"horizontal",onFinish:x,initialValues:{search:p.search},style:{marginBottom:0},children:e.jsxs(te,{gutter:16,children:[e.jsx(J,{xs:24,sm:12,md:8,lg:6,children:e.jsx(v.Item,{name:"search",label:s("keyword",{defaultValue:"Keyword"}),children:e.jsx(Y,{placeholder:c("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsx(Se,{})})})}),e.jsx(J,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsx(v.Item,{children:e.jsxs(_,{children:[e.jsx(d,{type:"primary",htmlType:"submit",icon:e.jsx(ge,{}),children:s("filter",{defaultValue:"Filter"})}),e.jsx(d,{onClick:w,icon:e.jsx(ie,{}),children:s("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxs($,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(te,{justify:"space-between",align:"middle",children:[e.jsx(J,{children:e.jsx(d,{type:"primary",onClick:w,icon:e.jsx(ie,{}),children:s("refresh",{defaultValue:"Refresh"})})}),e.jsx(J,{children:e.jsx(z,{permission:"authorization:service_account:create",children:e.jsx(d,{type:"primary",icon:e.jsx(he,{}),onClick:R,children:c("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsx(fe,{rowKey:"id",dataSource:r,columns:C,loading:n,pagination:{current:p.current,pageSize:p.page_size,total:f,onChange:K,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>s("totalItems",{defaultValue:`Total ${t} items`,total:t})}})]}),e.jsx(me,{serviceAccountID:b,onClose:L,open:o,onSuccess:()=>{l()}})]})},Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),{Text:q,Paragraph:ne}=ye,{TextArea:Ue}=Y,$e=({serviceAccountID:c})=>{const{t:s}=I("authorization"),{t:j}=I("common"),[k,n]=u.useState([]),[a,r]=u.useState(!1),[y,f]=u.useState(!1),[g]=v.useForm(),[o,m]=u.useState(null),[b,V]=u.useState(null),[p,E]=u.useState(!1),l=async()=>{if(c){r(!0);try{const t=await S.authorization.getServiceAccountAccessKeys({id:c});n(t)}catch(t){console.error("Failed to load access keys:",t),h.error(s("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{r(!1)}}};u.useEffect(()=>{l()},[c]);const x=t=>{navigator.clipboard.writeText(t).then(()=>{h.success(s("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},i=>{console.error("Could not copy text: ",i)})},w=()=>{m(null),g.resetFields(),f(!0)},K=t=>{m(t),g.setFieldsValue({name:t.name,description:t.description,status:t.status==="active",expires_at:t.expires_at?Ce(t.expires_at):void 0}),f(!0)},R=()=>{f(!1),g.resetFields()},{run:M,loading:L}=U(async()=>{const t=await g.validateFields();if(o){const i=await S.authorization.updateServiceAccountAccessKey({id:c,keyId:o.id},{name:t.name,description:t.description,status:t.status?"active":"disabled",expires_at:t.expires_at?t.expires_at.toISOString():void 0});return f(!1),i}else{const i=await S.authorization.createServiceAccountAccessKey({id:c},{name:t.name,description:t.description,expires_at:t.expires_at?t.expires_at.toISOString():void 0});V(i),f(!1),E(!0)}},{manual:!0,onSuccess:()=>{h.success(s("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),l()},onError:()=>{h.error(s("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),B=async t=>{try{await S.authorization.deleteServiceAccountAccessKey({id:c,keyId:t}),h.success(s("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),l()}catch(i){console.error("Failed to delete key:",i),h.error(s("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},A=()=>{E(!1),V(null)},C=[{title:s("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:t=>e.jsxs(_,{children:[e.jsx(se,{}),e.jsx(q,{copyable:!0,children:t})]})},{title:s("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:s("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:t=>t==="active"?e.jsx(F,{status:"success",text:s("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsx(F,{status:"error",text:s("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:s("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:t=>t?D(t):e.jsx(q,{type:"secondary",children:s("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:s("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:t=>t?D(t):e.jsx(q,{type:"secondary",children:s("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:j("actions",{defaultValue:"Actions"}),key:"action",render:(t,i)=>e.jsxs(_,{size:"small",children:[e.jsx(N,{title:s("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsx(d,{type:"text",icon:e.jsx(Z,{}),onClick:()=>K(i)})}),e.jsx(ce,{title:s("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>B(i.id),okText:j("confirm",{defaultValue:"Confirm"}),cancelText:j("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{type:"text",danger:!0,icon:e.jsx(ae,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx($,{title:e.jsxs(_,{children:[e.jsx(se,{}),s("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxs(_,{children:[e.jsx(d,{icon:e.jsx(pe,{}),onClick:l,loading:a,children:j("refresh",{defaultValue:"Refresh"})}),e.jsx(d,{type:"primary",icon:e.jsx(he,{}),onClick:w,children:s("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsx(fe,{columns:C,dataSource:k,rowKey:"id",loading:a,pagination:!1})}),e.jsx(H,{title:o?s("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):s("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:y,onOk:M,confirmLoading:L,onCancel:R,children:e.jsxs(v,{form:g,layout:"vertical",children:[e.jsx(v.Item,{name:"name",label:s("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:s("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsx(Y,{placeholder:s("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsx(v.Item,{name:"description",label:s("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsx(Ue,{rows:3,placeholder:s("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),o&&e.jsx(v.Item,{name:"status",label:s("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsx(be,{checkedChildren:s("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:s("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsx(v.Item,{name:"expires_at",label:s("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsx(_e,{showTime:!0,placeholder:s("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxs(H,{title:e.jsxs(_,{children:[e.jsx(Ee,{style:{color:"#faad14"}}),s("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:p,footer:[e.jsx(d,{onClick:A,children:j("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsx(ke,{message:s("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(q,{strong:!0,children:[s("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsx(ne,{copyable:{text:b.access_key_id},children:b.access_key_id})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(q,{strong:!0,children:[s("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsx(ne,{copyable:{text:b.secret_access_key||""},children:b.secret_access_key})]}),e.jsx(d,{type:"primary",icon:e.jsx(we,{}),onClick:()=>{const t=`Access Key: ${b.access_key_id}
Secret Key: ${b.secret_access_key}`;x(t)},block:!0,children:s("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:re}=ye,Me=({serviceAccount:c,onRefresh:s,loading:j})=>{const{id:k}=c||{},{t:n}=I("authorization"),{t:a}=I("common"),[r,y]=u.useState([]),[f,g]=u.useState([]);u.useEffect(()=>{g((c==null?void 0:c.roles)||[])},[c]);const[o,m]=u.useState(void 0),{loading:b}=U(async()=>S.authorization.listRoles({current:1,page_size:20,search:o}),{onSuccess:l=>{const x=l.data;f.forEach(w=>{x.find(R=>R.id===w.id)||x.push(w)}),y(x)},onError:l=>{console.error("Failed to load roles:",l),h.error(n("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[o]}),{run:V,loading:p}=U(async()=>{if(k)return S.authorization.assignServiceAccountRoles({id:k},{role_ids:f.map(l=>l.id)})},{onSuccess:()=>{h.success(n("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),s()},onError:l=>{console.error("Failed to assign roles:",l),h.error(n("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),E=l=>{g(l.map(x=>r.find(w=>w.id===x)||{id:x,name:x,description:x}))};return e.jsx($,{title:e.jsxs(_,{children:[e.jsx(Q,{}),n("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsx(d,{icon:e.jsx(pe,{}),onClick:()=>{s()},disabled:j||p,loading:p,children:a("refresh",{defaultValue:"Refresh"})}),children:p?e.jsx(ze,{active:!0,paragraph:{rows:4}}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(re,{children:n("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsx("div",{style:{marginTop:8},children:f.length>0?r.filter(l=>f.some(x=>x.id===l.id)).map(l=>e.jsx(G,{color:"blue",children:l.name},l.id)):e.jsx(X,{image:X.PRESENTED_IMAGE_SIMPLE,description:n("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(re,{children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsx(xe,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:n("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:f.map(l=>l.id),onSearch:l=>{m(l)},onDropdownVisibleChange:l=>{l&&m(void 0)},onChange:E,loading:j||b,optionFilterProp:"label",options:r.map(l=>({label:l.name,value:l.id,title:l.description}))})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(d,{type:"primary",onClick:V,loading:p,disabled:j,children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:W}=ve,Le={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},Be=Ie(({css:c})=>({rolePolicy:c`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:c`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:c`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),Oe=()=>{const{styles:c}=Be(),n=Fe().hash.replace("#","")||"basic",{t:a}=I("authorization"),{t:r}=I("common"),{id:y}=Re(),f=de(),{hasPermission:g}=Pe(),[o,m]=u.useState(null),[b,V]=u.useState(!1),[p]=v.useForm(),[E,l]=u.useState(!1);if(!y)return e.jsx(Ke,{});const{run:x,loading:w}=U(async()=>{if(y)return S.authorization.getServiceAccountById({id:y})},{onSuccess:A=>{m(A||null)}});u.useEffect(()=>{x()},[y]);const K=A=>{f(`#${A}`)},R=async()=>{if(y)try{await S.authorization.deleteServiceAccount({id:y}),h.success(a("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),f("/authorization/service-accounts")}catch(A){console.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),A),h.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:M,loading:L}=U(async()=>{if(o)return S.authorization.updateServiceAccountStatus({id:y},{status:o.status==="active"?"disabled":"active"})},{onSuccess:A=>{m(A||null),h.success(a("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:A=>{console.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),A),h.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),B=async A=>{if(y)try{let C;try{C=JSON.parse(A.policy_document)}catch{h.error(a("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await S.authorization.setServiceAccountPolicy({id:y},{policy_document:C}),h.success(a("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),V(!1),x()}catch(C){console.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),C),h.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return w?e.jsx(oe,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):o?e.jsxs($,{title:e.jsxs(_,{children:[e.jsx(De,{}),o.name,o.status==="active"?e.jsx(F,{status:"success",text:a("serviceAccount.status.active",{defaultValue:"Active"})}):e.jsx(F,{status:"error",text:a("serviceAccount.status.disabled",{defaultValue:"Disabled"})})]}),extra:e.jsxs(_,{children:[e.jsx(z,{permission:"authorization:service_account:update",children:e.jsx(d,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>l(!0),disabled:E,children:r("edit",{defaultValue:"Edit"})})}),e.jsx(z,{permission:"authorization:service_account:update",children:e.jsx(d,{icon:o.status==="active"?e.jsx(Q,{}):e.jsx(ee,{}),onClick:M,loading:L,children:o.status==="active"?r("disable",{defaultValue:"Disable"}):r("enable",{defaultValue:"Enable"})})}),e.jsx(z,{permission:"authorization:service_account:delete",children:e.jsx(ce,{title:a("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:R,okText:r("confirm",{defaultValue:"Confirm"}),cancelText:r("cancel",{defaultValue:"Cancel"}),children:e.jsx(d,{danger:!0,icon:e.jsx(ae,{}),children:r("delete",{defaultValue:"Delete"})})})}),e.jsx(d,{icon:e.jsx(Te,{}),onClick:()=>f("/authorization/service-accounts"),children:r("back",{defaultValue:"Back"})})]}),children:[e.jsxs(ve,{defaultActiveKey:n,onChange:K,children:[e.jsx(W,{tab:a("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxs(T,{bordered:!0,column:2,children:[e.jsx(T.Item,{label:a("serviceAccount.name",{defaultValue:"Name"}),span:2,children:o.name}),e.jsx(T.Item,{label:a("serviceAccount.description",{defaultValue:"Description"}),span:2,children:o.description||a("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsx(T.Item,{label:a("serviceAccount.status",{defaultValue:"Status"}),children:o.status==="active"?e.jsx(F,{status:"success",text:a("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(F,{status:"error",text:a("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsx(T.Item,{label:a("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:o.last_access?D(o.last_access):a("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsx(T.Item,{label:a("serviceAccount.createdAt",{defaultValue:"Created At"}),children:D(o.created_at)}),e.jsx(T.Item,{label:a("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:D(o.updated_at)})]})},"basic"),e.jsx(W,{tab:e.jsxs("span",{children:[e.jsx(se,{}),a("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!g("authorization:service_account:access_key:list"),children:e.jsx($e,{serviceAccountID:y})},"access-keys"),e.jsx(W,{tab:e.jsxs("span",{children:[e.jsx(Q,{}),a("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!g("authorization:service_account:role:list"),children:e.jsx(Me,{serviceAccount:o,onRefresh:x})},"authorization"),e.jsxs(W,{tab:a("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(te,{justify:"end",children:e.jsx(J,{children:e.jsx(z,{permission:"authorization:service_account:update",children:e.jsx(d,{type:"primary",icon:e.jsx(Z,{}),onClick:()=>{V(!0),p.setFieldsValue({policy_document:JSON.stringify(o.policy_document,null,2)})},children:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsx(oe,{spinning:w,children:o.policy_document&&o.policy_document.Statement&&o.policy_document.Statement.length>0?e.jsx($,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(o.policy_document,null,2)})}):e.jsx(X,{description:a("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsx(H,{title:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:b,onCancel:()=>{V(!1),p.resetFields()},footer:null,width:700,children:e.jsxs(v,{form:p,layout:"vertical",onFinish:B,children:[e.jsx(v.Item,{name:"policy_document",extra:e.jsx("span",{className:c.rolePolicyExtra,children:e.jsx(xe,{style:{width:120},placeholder:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:a("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:a("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:a("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:a("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:a("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:A=>{const C=Le[A];C&&p.setFieldValue("policy_document",JSON.stringify(C,null,2))}})}),children:e.jsx(ue,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsx(v.Item,{children:e.jsxs(_,{children:[e.jsx(d,{type:"primary",htmlType:"submit",children:r("save",{defaultValue:"Save"})}),e.jsx(d,{onClick:()=>V(!1),children:r("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsx(me,{serviceAccountID:y,onClose:()=>l(!1),open:E})]}):e.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsx(X,{description:a("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},Xe=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"}));export{Qe as S,Xe as a};
