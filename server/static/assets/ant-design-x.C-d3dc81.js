var Vn=Object.defineProperty;var Un=(e,t,r)=>t in e?Vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var L=(e,t,r)=>Un(e,typeof t!="symbol"?t+"":t,r);import{r as p,R as i,p as Gn,C as mn,_ as re,q as be,K as je,t as Pt,v as Yn,w as Zn,x as Jn,y as Qn,z as er,A as tr,E as Ve,G as se,H as we,o as M,T as qe,I as nr,J as rr,L as sr,N as fn,O as or,P as ir,Q as ar,U as lr,V as gn,D as kt,W as _t,X as cr,Y as st,Z as pn,B as We,$ as ur,a0 as hn,a1 as dr,a2 as mr,a3 as zt,a4 as yn,b as fr,a5 as gr,a6 as pr,a7 as hr,a8 as yr,a9 as br,aa as Sr,ab as Cr,ac as $r,ad as xr,ae as vr,af as bn,l as Sn,ag as Vt,ah as Er,ai as Cn,aj as Rr,ak as wr,al as Nr,am as Tr,an as Ir}from"./vendor.B4UNC6a-.js";import{h as Mr,o as Ut,a as Ar}from"./highlighter.Dk-5PZQ8.js";import{m as Tt}from"./mermaid.DCWVJolG.js";function ot(e,t){return p.useImperativeHandle(e,()=>{const r=t(),{nativeElement:n}=r;return new Proxy(n,{get(s,o){return r[o]?r[o]:Reflect.get(s,o)}})})}const $n=i.createContext({}),Pr={classNames:{},styles:{},className:"",style:{},shortcutKeys:{}},Ne=e=>{const t=i.useContext($n);return i.useMemo(()=>({...Pr,...t[e]}),[t[e]])};function Dr(){}let Hr=Dr;const xn=p.createContext(void 0),Re={locale:"en",Conversations:{create:"New chat"},Sender:{stopLoading:"Stop loading",speechRecording:"Speech recording"},Actions:{feedbackLike:"Like",feedbackDislike:"Dislike",audio:"Play audio",audioRunning:"Audio playing",audioError:"Playback error",audioLoading:"Loading audio"},Bubble:{editableOk:"OK",editableCancel:"Cancel"},Mermaid:{zoomIn:"Zoom in",zoomOut:"Zoom out",zoomReset:"Reset",download:"Download",code:"Code",image:"Image"}},Xe=(e,t)=>{const r=p.useContext(xn),n=p.useMemo(()=>{var a;const o=t||(Re==null?void 0:Re[e])||((a=Gn)==null?void 0:a[e]),l=(r==null?void 0:r[e])??{};return{...typeof o=="function"?o():o,...l||{}}},[e,t,r]),s=p.useMemo(()=>{const o=r==null?void 0:r.locale;return r!=null&&r.exist&&!o?Re.locale:o},[r]);return[n,s]},Br="internalMark",Lr=e=>{const{locale:t={},children:r,_ANT_MARK__:n}=e,s=p.useMemo(()=>({...t,exist:!0}),[t]);return p.createElement(xn.Provider,{value:s},r)},kr="ant";function fe(){const{getPrefixCls:e,direction:t,csp:r,iconPrefixCls:n,theme:s}=i.useContext(mn.ConfigContext);return{theme:s,getPrefixCls:e,direction:t,csp:r,iconPrefixCls:n}}const ri=e=>{const{actions:t,attachments:r,bubble:n,conversations:s,prompts:o,sender:l,suggestion:a,thoughtChain:c,welcome:u,fileCard:d,think:m,theme:g,locale:f,children:y,mermaid:b,codeHighlighter:C,...$}=e,v=i.useMemo(()=>({actions:t,attachments:r,bubble:n,conversations:s,prompts:o,sender:l,suggestion:a,thoughtChain:c,fileCard:d,think:m,mermaid:b,codeHighlighter:C,welcome:u}),[t,r,n,s,o,l,a,c,u,b,m,d,C]);let E=y;return f&&(E=i.createElement(Lr,{locale:f,_ANT_MARK__:Br},E)),i.createElement($n.Provider,{value:v},i.createElement(mn,re({},$,{theme:g,locale:f}),E))},Qe=1e3,et=4,bt=140,Gt=bt/2,pt=250,Yt=500,ht=.8;function vn({className:e}){const[t]=Xe("Sender",Re.Sender);return i.createElement("svg",{color:"currentColor",viewBox:`0 0 ${Qe} ${Qe}`,xmlns:"http://www.w3.org/2000/svg",className:e},i.createElement("title",null,t.speechRecording),Array.from({length:et}).map((r,n)=>{const s=(Qe-bt*et)/(et-1),o=n*(s+bt),l=Qe/2-pt/2,a=Qe/2-Yt/2;return i.createElement("rect",{fill:"currentColor",rx:Gt,ry:Gt,height:pt,width:bt,x:o,y:l,key:n},i.createElement("animate",{attributeName:"height",values:`${pt}; ${Yt}; ${pt}`,keyTimes:"0; 0.5; 1",dur:`${ht}s`,begin:`${ht/et*n}s`,repeatCount:"indefinite"}),i.createElement("animate",{attributeName:"y",values:`${l}; ${a}; ${l}`,keyTimes:"0; 0.5; 1",dur:`${ht}s`,begin:`${ht/et*n}s`,repeatCount:"indefinite"}))}))}const _r=e=>({[e.componentCls]:{[`${e.antCls}-motion-collapse-legacy`]:{overflow:"hidden","&-active":{transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}},[`${e.antCls}-motion-collapse`]:{overflow:"hidden",transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}}}),zr=e=>({animationDuration:e,animationFillMode:"both"}),Xr=e=>({animationDuration:e,animationFillMode:"both"}),En=(e,t,r,n,s=!1)=>{const o=s?"&":"";return{[`
      ${o}${e}-enter,
      ${o}${e}-appear
    `]:{...zr(n),animationPlayState:"paused"},[`${o}${e}-leave`]:{...Xr(n),animationPlayState:"paused"},[`
      ${o}${e}-enter${e}-enter-active,
      ${o}${e}-appear${e}-appear-active
    `]:{animationName:t,animationPlayState:"running"},[`${o}${e}-leave${e}-leave-active`]:{animationName:r,animationPlayState:"running",pointerEvents:"none"}}},Or=new je("antXFadeInLeft",{"0%":{maskPosition:"100% 0"},"100%":{maskPosition:"0% 0%"}}),Fr=new je("antXFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),Rn=new je("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),Kr=(e,t=!1)=>{const{antCls:r}=e,n=`${r}-x-fade-left`,s=t?"&":"";return[{[e.componentCls]:{"&":En(n,Or,Rn,"1s",t),[`${s}${n}-enter,${s}${n}-appear`]:{transitionProperty:"mask-position",animationTimingFunction:"linear",maskImage:`linear-gradient(90deg, ${e.colorTextBase} 33%, ${new be(e.colorTextBase).setA(0)} 66%)`,maskSize:"300% 100%",maskPosition:"100% 0%"},[`${s}${n}-leave`]:{animationTimingFunction:"linear"}}}]},qr=(e,t=!1)=>{const{antCls:r}=e,n=`${r}-x-fade`,s=t?"&":"";return[{[e.componentCls]:{"&":En(n,Fr,Rn,"1.2s",t),[`${s}${n}-enter,${s}${n}-appear`]:{opacity:0},[`${s}${n}-leave`]:{animationTimingFunction:"linear"}}}]},Wr="2.1.1",jr=Qn(Pt.defaultAlgorithm),Vr={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},wn=(e,t,r)=>{const n=r.getDerivativeToken(e),{override:s,...o}=t;let l={...n,override:s};return l=er(l),o&&Object.entries(o).forEach(([a,c])=>{const{theme:u,...d}=c;let m=d;u&&(m=wn({...l,...d},{override:d},u)),l[a]=m}),l};function Nn(){const{token:e,hashed:t,theme:r,override:n,cssVar:s}=i.useContext(Pt._internalContext),o={prefix:(s==null?void 0:s.prefix)||"ant",key:(s==null?void 0:s.key)||"css-var-root"},l=r||jr,[a,c,u]=Yn(l,[Pt.defaultSeed,e],{salt:`${Wr}-${t||""}`,override:n,getComputedToken:wn,cssVar:{...o,unitless:Jn,ignore:Zn,preserve:Vr}});return[l,u,t?c:"",a,o]}function Ur(){const[e,t,r]=Nn();return{theme:e,token:t,hashId:r}}const{genStyleHooks:Ue}=tr({usePrefix:()=>{const{getPrefixCls:e,iconPrefixCls:t}=fe();return{iconPrefixCls:t,rootPrefixCls:e()}},useToken:()=>{const[e,t,r,n,s]=Nn();return{theme:e,realToken:t,hashId:r,token:n,cssVar:s}},useCSP:()=>{const{csp:e}=fe();return e??{}},layer:{name:"antdx",dependencies:["antd"]}}),Gr=e=>{const{componentCls:t}=e,r=`${t}-audio`;return{[r]:{[`&${r}-rtl`]:{direction:"rtl"},[`${r}-recording-icon`]:{width:e.fontSize,height:e.fontSize}}}},Yr=e=>{const{componentCls:t}=e,r=`${t}-copy`;return{[t]:{[`&${r}-rtl`]:{direction:"rtl"},[`${r}-copy`]:{fontSize:"inherit",[`&:not(${t}-copy-success)`]:{color:"inherit!important"}}}}},Zr=e=>{const{componentCls:t}=e,r=`${t}-feedback`;return{[t]:{[`&${r}-rtl`]:{direction:"rtl"}}}},Jr=e=>{const{componentCls:t,antCls:r,calc:n}=e;return{[t]:{[`&${t}-rtl`]:{direction:"rtl"},[`${r}-pagination-item-link`]:{width:e.controlHeightSM},[`${t}-variant-outlined`]:{paddingInline:se(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadius,border:`${se(e.lineWidth)} ${e.lineType}, ${e.colorBorderSecondary}`},[`${t}-variant-filled`]:{paddingInline:se(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadius,backgroundColor:e.colorBorderSecondary,[`${t}-item`]:{paddingInline:se(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,"&:hover":{color:e.colorTextSecondary,background:"transparent"}}},[`${t}-list-danger`]:{color:e.colorError},[`&${t}-item,${t}-item`]:{cursor:"pointer",fontSize:e.fontSize,paddingInline:se(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadiusSM,height:e.controlHeightSM,boxSizing:"border-box",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeight,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`${t}-icon`]:{display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:e.fontSize},"&:hover":{background:e.colorBgTextHover}},[`&${t}-list,${t}-list`]:{display:"inline-flex",flexDirection:"row",alignItems:"center",color:e.colorText,gap:e.paddingXS}}}},Qr=()=>({}),it=Ue("Actions",e=>{const t=Ve(e,{});return[Jr(t),Yr(t),Zr(t),Gr(t),Kr(t),qr(t)]},Qr);let Ae=function(e){return e.LOADING="loading",e.ERROR="error",e.RUNNING="running",e.DEFAULT="default",e}({});const Tn=e=>{const{status:t="default",defaultIcon:r,runningIcon:n,label:s,className:o,classNames:l={},styles:a={},style:c,prefixCls:u,rootClassName:d,...m}=e,g=we(m,{attr:!0,aria:!0,data:!0}),{direction:f,getPrefixCls:y}=fe(),b=y("actions",u),[C,$]=it(b),v=`${b}-button-item`,E=M(v,C,$,d,o,l.root,b,`${b}-item`,{[`${v}-rtl`]:f==="rtl",[`${l[t]}`]:l[t]}),H={[Ae.LOADING]:i.createElement(rr,null),[Ae.ERROR]:i.createElement(nr,null),[Ae.RUNNING]:n,[Ae.DEFAULT]:r},j=t&&H[t]?H[t]:r;return i.createElement(qe,{title:s},i.createElement("div",re({},g,{className:E,style:{...c,...a.root,...a==null?void 0:a[t]}}),j))},es=e=>{const{status:t=Ae.DEFAULT,className:r,style:n,prefixCls:s,rootClassName:o,classNames:l={},styles:a={},...c}=e,{direction:u,getPrefixCls:d}=fe(),m=d("actions",s),[g,f]=it(m),y=`${m}-audio`,b=M(m,y,g,f,o,r,l.root,{[`${y}-rtl`]:u==="rtl",[`${y}-${t}`]:t}),[C]=Xe("Actions",Re.Actions),$={[Ae.LOADING]:C.audioLoading,[Ae.ERROR]:C.audioError,[Ae.RUNNING]:C.audioRunning,[Ae.DEFAULT]:C.audio};return i.createElement(Tn,re({label:t?$[t]:"",style:n,styles:a,classNames:{...l,root:b},status:t,defaultIcon:i.createElement(sr,null),runningIcon:i.createElement(vn,{className:`${y}-recording-icon`})},c))},{Text:ts}=fn,ns=e=>{const{text:t="",icon:r,className:n,style:s,prefixCls:o,rootClassName:l,classNames:a={},styles:c={},...u}=e,d=we(u,{attr:!0,aria:!0,data:!0}),{direction:m,getPrefixCls:g}=fe(),f=g("actions",o),[y,b]=it(f),C=`${f}-copy`,$=M(f,`${f}-item`,y,b,l,n,a.root,{[`${C}-rtl`]:m==="rtl"});return i.createElement(ts,re({},d,{className:$,style:{...s,...c.root},prefixCls:C,copyable:{text:t,icon:r}}))};var xe=function(e){return e.like="like",e.dislike="dislike",e.default="default",e}(xe||{});const rs=e=>{const{value:t="default",onChange:r,className:n,style:s,classNames:o={},styles:l={},prefixCls:a,rootClassName:c,...u}=e,d=we(u,{attr:!0,aria:!0,data:!0}),[m]=Xe("Actions",Re.Actions),{direction:g,getPrefixCls:f}=fe(),y=f("actions",a),[b,C]=it(y),$=`${y}-feedback`,v=M(y,$,b,C,c,o.root,`${y}-list`,n,{[`${$}-rtl`]:g==="rtl"}),E=()=>r==null?void 0:r(t===xe.dislike?xe.default:xe.dislike);return i.createElement("div",re({},d,{className:v,style:{...s,...l.root}}),[xe.default,xe.like].includes(t)&&i.createElement(qe,{title:m.feedbackLike},i.createElement("span",{onClick:()=>r==null?void 0:r(t===xe.like?xe.default:xe.like),style:{...l.like,...t==="like"?l.liked:{}},className:M(`${$}-item`,`${y}-item`,`${$}-item-like`,o.like,{[`${o.liked}`]:o.liked&&t==="like",[`${$}-item-like-active`]:t==="like"})},t===xe.like?i.createElement(or,null):i.createElement(ir,null))),[xe.default,xe.dislike].includes(t)&&i.createElement(qe,{title:m.feedbackDislike},i.createElement("span",{onClick:E,style:{...l.dislike,...t==="dislike"?l.disliked:{}},className:M(`${$}-item`,`${y}-item`,`${$}-item-dislike`,o.dislike,{[`${o.disliked}`]:o.disliked&&t==="like",[`${$}-item-dislike-active`]:t==="dislike"})},t===xe.dislike?i.createElement(ar,null):i.createElement(lr,null))))},Xt=i.createContext(null),nt=(e,t)=>{const r=e[0];for(const n of t){if(!n)return null;if(n.key===r){if(e.length===1)return n;if(n.subItems)return nt(e.slice(1),n==null?void 0:n.subItems)}}return null},ss=e=>{const{onClick:t,item:r,dropdownProps:n={}}=e,{prefixCls:s,classNames:o={},styles:l={}}=i.useContext(Xt)||{},{subItems:a=[],triggerSubMenuAction:c="hover"}=r,u=(r==null?void 0:r.icon)??i.createElement(gn,null),d={items:a,onClick:({key:m,keyPath:g,domEvent:f})=>{var y,b,C;if((y=nt(g,a))!=null&&y.onItemClick){(C=(b=nt(g,a))==null?void 0:b.onItemClick)==null||C.call(b,nt(g,a));return}t==null||t({key:m,keyPath:[...g,(r==null?void 0:r.key)||""],domEvent:f,item:nt(g,a)})}};return i.createElement(kt,re({menu:d,trigger:[c]},n,{className:M(`${s}-dropdown`,o.itemDropdown,n==null?void 0:n.className),styles:{root:l.itemDropdown,...n==null?void 0:n.styles}}),i.createElement("div",{className:M(`${s}-item`,`${s}-sub-item`,o==null?void 0:o.item),style:l==null?void 0:l.item},i.createElement("div",{className:`${s}-icon`},u)))},os=e=>{const{item:t,onClick:r,dropdownProps:n={}}=e,{prefixCls:s,classNames:o={},styles:l={}}=i.useContext(Xt)||{},a=i.useId(),c=(t==null?void 0:t.key)||a;return t?t.actionRender?typeof t.actionRender=="function"?t.actionRender(t):t.actionRender:t.subItems?i.createElement(ss,{key:c,item:t,onClick:r,dropdownProps:n}):i.createElement("div",{className:M(`${s}-item`,o.item,{[`${s}-list-danger`]:t==null?void 0:t.danger}),style:l.item,onClick:u=>{if(t!=null&&t.onItemClick){t.onItemClick(t);return}r==null||r({key:c,item:t,keyPath:[c],domEvent:u})},key:c},i.createElement(qe,{title:t.label},i.createElement("div",{className:`${s}-icon`},t==null?void 0:t.icon))):null},is=i.forwardRef((e,t)=>{const{items:r=[],onClick:n,dropdownProps:s={},fadeIn:o,fadeInLeft:l,variant:a="borderless",prefixCls:c,classNames:u={},rootClassName:d="",className:m="",styles:g={},style:f={},...y}=e,b=we(y,{attr:!0,aria:!0,data:!0}),{getPrefixCls:C,direction:$}=fe(),v=C("actions",c),E=Ne("actions"),[H,j]=it(v),W=C(),U=o||l?`${W}-x-fade${l?"-left":""}`:"",N=M(v,E.className,E.classNames.root,d,m,u.root,j,H,{[`${v}-rtl`]:$==="rtl"}),A={...E.style,...g.root,...f},P=i.useRef(null);return ot(t,()=>({nativeElement:P.current})),i.createElement(_t,{motionName:U},({className:I},T)=>i.createElement("div",re({ref:cr(P,T)},b,{className:N,style:A}),i.createElement(Xt.Provider,{value:{prefixCls:v,classNames:{item:M(E.classNames.item,u.item),itemDropdown:M(E.classNames.itemDropdown,u.itemDropdown)},styles:{item:{...E.styles.item,...g.item},itemDropdown:{...E.styles.itemDropdown,...g.itemDropdown}}}},i.createElement("div",{className:M(`${v}-list`,`${v}-variant-${a}`,I)},r.map((G,V)=>i.createElement(os,{item:G,onClick:n,dropdownProps:s,key:G.key||V}))))))}),ze=is;ze.Feedback=rs;ze.Copy=ns;ze.Item=Tn;ze.Audio=es;const In=i.createContext({});function as(e){const t=getComputedStyle(e).display;return t==="block"||t==="flex"||t==="list-item"||t==="table"}function ls(e){var n;const t=[""],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(;r.nextNode();){const s=r.currentNode;if(s.nodeType===Node.TEXT_NODE){t[t.length-1]+=s.textContent;continue}s.tagName==="BR"&&((n=s.parentNode)==null?void 0:n.childElementCount)===1||(s.tagName==="BR"||as(s))&&t.push("")}return t.join(`
`)}const cs=({content:e,prefixCls:t,okText:r,cancelText:n,onEditConfirm:s,onEditCancel:o})=>{const l=i.useRef(null),[a]=Xe("Bubble",Re.Bubble),c=st(()=>{s==null||s(ls(l.current))}),u=st(()=>o==null?void 0:o());if(i.useEffect(()=>{l.current.textContent=e,l.current.focus();const m=window.getSelection(),g=document.createRange();g.selectNodeContents(l.current),g.collapse(!1),m.removeAllRanges(),m.addRange(g)},[]),typeof e!="string")throw new Error("Content of editable Bubble should be string");const d=i.useMemo(()=>i.createElement("div",{ref:l,contentEditable:!0}),[]);return i.createElement(i.Fragment,null,d,i.createElement(pn,{rootClassName:`${t}-editing-opts`,gap:8},i.createElement(We,{type:"primary",shape:"round",size:"small",onClick:c},r||a.editableOk),i.createElement(We,{type:"text",shape:"round",size:"small",onClick:u},n||a.editableCancel)))},us=({prefixCls:e})=>i.createElement("span",{className:`${e}-dot`},i.createElement("i",{className:`${e}-dot-item`,key:"item-1"}),i.createElement("i",{className:`${e}-dot-item`,key:"item-2"}),i.createElement("i",{className:`${e}-dot-item`,key:"item-3"})),ds=new je("loadingMove",{"0%":{transform:"translateY(0)"},"10%":{transform:"translateY(4px)"},"20%":{transform:"translateY(0)"},"30%":{transform:"translateY(-4px)"},"40%":{transform:"translateY(0)"}}),ms=new je("cursorBlink",{"0%":{opacity:1},"50%":{opacity:0},"100%":{opacity:1}}),fs=new je("fadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),gs=e=>{const{componentCls:t,fontSize:r,typingContent:n,typingAnimationDuration:s,typingAnimationName:o,lineHeight:l,paddingSM:a,colorText:c,calc:u}=e;return[{[t]:{display:"flex",columnGap:a,[`&${t}-rtl`]:{direction:"rtl"},[`&${t}-loading`]:{alignItems:"center"},[`${t}-body`]:{display:"flex",flexDirection:"column",maxWidth:"100%"},[`${t}-content`]:{position:"relative",boxSizing:"border-box",minWidth:0,maxWidth:"100%",minHeight:u(a).mul(2).add(u(l).mul(r)).equal(),paddingInline:`${se(e.padding)}`,paddingBlock:`${se(a)}`,color:c,fontSize:e.fontSize,lineHeight:e.lineHeight,wordBreak:"break-word","&-string":{whiteSpace:"pre-wrap"}},[`${t}-typing:last-child::after`]:{content:n,fontWeight:900,userSelect:"none",opacity:1,marginInlineStart:"0.1em",animationName:o,animationDuration:se(s),animationIterationCount:"infinite",animationTimingFunction:"linear"},[`${t}-fade-in .fade-in`]:{display:"inline",animationName:fs,animationDuration:"1s",animationTimingFunction:"linear"},[`${t}-dot`]:{position:"relative",height:e.controlHeight,display:"flex",alignItems:"center",columnGap:e.marginXS,padding:`0 ${se(e.paddingXXS)}`,alignSelf:"center","&-item":{backgroundColor:e.colorPrimary,borderRadius:"100%",width:4,height:4,animationName:ds,animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"linear","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}}},[`&${t}-start`]:{flexDirection:"row",[`& ${t}-header`]:{flexDirection:"row"}},[`&${t}-end`]:{flexDirection:"row-reverse",justifySelf:"flex-end",[`& ${t}-header`]:{flexDirection:"row-reverse"},[`& ${t}-editing-opts`]:{flexDirection:"row-reverse"}}}},ms]},ps=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-content`]:{"&-filled":{backgroundColor:e.colorFillContent},"&-outlined":{border:`1px solid ${e.colorBorderSecondary}`},"&-shadow":{boxShadow:e.boxShadowTertiary},"&-borderless":{backgroundColor:"transparent",padding:0,minHeight:0}}}}},hs=e=>{const{componentCls:t,fontSize:r,lineHeight:n,paddingSM:s,borderRadius:o,calc:l}=e,a=l(r).mul(n).div(2).add(s).equal(),c=l(o).mul(2).equal(),u=`${t}-content`;return{[t]:{[u]:{"&-default":{borderRadius:{_skip_check_:!0,value:c}},"&-round":{borderRadius:{_skip_check_:!0,value:a}},"&-corner":{borderRadius:{_skip_check_:!0,value:c}},"&-editing":{"div:first-child":{outline:"none"},[`${t}-editing-opts`]:{marginBlockStart:e.marginSM,"button:last-child":{backgroundColor:e.colorBgContainer,"&:hover":{backgroundColor:e.colorBgLayout}}}}},[`&${t}-start ${t}-content-corner`]:{borderStartStartRadius:e.borderRadiusXS},[`&${t}-end ${t}-content-corner`]:{borderStartEndRadius:e.borderRadiusXS}}}},ys=e=>{const{componentCls:t}=e;return{[t]:{"&-divider":{width:"100%",justifyContent:"center",[`& ${t}-body`]:{width:"100%"}}}}},bs=e=>{const{componentCls:t,padding:r}=e;return{[`${t}-list`]:{gap:r,maxHeight:"100%",width:"100%",boxSizing:"border-box",[`& ${t}`]:{width:"100%",boxSizing:"border-box",paddingBlock:e.padding},[`& ${t}-start:not(${t}-divider):not(${t}-system)`]:{paddingInlineEnd:"15%"},[`& ${t}-end:not(${t}-divider):not(${t}-system)`]:{paddingInlineStart:"15%"},[`${t}-list-scroll-box`]:{overflowY:"auto",display:"flex",alignItems:"center",width:"100%",scrollbarWidth:"thin",maxHeight:"100%",flexDirection:"column",boxSizing:"border-box",paddingInline:e.paddingXS,scrollbarColor:`${e.colorTextTertiary} transparent`,"&::-webkit-scrollbar":{width:8,backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:e.colorTextTertiary,borderRadius:e.borderRadiusSM}},[`${t}-list-autoscroll`]:{flexDirection:"column-reverse"}}}},Ss=e=>{const{componentCls:t,fontSize:r,lineHeight:n,paddingXXS:s,margin:o,colorText:l,fontSizeLG:a,calc:c}=e;return{[t]:{[`${t}-header`]:{display:"flex",marginBottom:s,fontSize:r,lineHeight:n,color:l},[`${t}-footer`]:{display:"flex",marginBlockStart:o,fontSize:r,lineHeight:n,color:l,"&-start":{flexDirection:"row"},"&-end":{flexDirection:"row-reverse"}},[`${t}-avatar`]:{minWidth:c(a).mul(2).equal()}}}},Cs=e=>{const{componentCls:t,paddingSM:r,paddingXS:n,lineHeight:s,fontSize:o,fontSizeSM:l,calc:a}=e;return{[t]:{[`&${t}-system`]:{width:"100%",justifyContent:"center",[`${t}-content`]:{display:"flex",gap:`${se(l)}`,alignItems:"center",minHeight:a(n).mul(2).add(a(s).mul(o)).equal(),fontSize:`${se(o)}`,paddingInline:`${se(r)}`,paddingBlock:`${se(n)}`},[`${t}-system-content`]:{},[`${t}-system-extra`]:{}}}}},$s=()=>({typingContent:'"|"',typingAnimationName:"cursorBlink",typingAnimationDuration:"0.8s"}),Ct=Ue("Bubble",e=>{const t=Ve(e,{});return[gs(t),ps(t),hs(t),Ss(t),bs(t),Cs(t),ys(t)]},$s);function xs(e){return!e||e.length===0?"":e.reduce((t,r)=>{let n=0;for(;n<t.length&&n<r.length&&t[n]===r[n];)n++;return t.slice(0,n)})}function vs({streaming:e,content:t,typing:r,onTyping:n,onTypingComplete:s}){const[o,l]=i.useState([]),a=i.useRef(!1),c=i.useRef(""),u=i.useRef(1),d=i.useRef(-1),m=i.useRef(e);m.current=e;const g=i.useMemo(()=>{const $={effect:"fade-in",interval:100,step:6,keepPrefix:!0};if(r===!0)return $;const{step:v=6,interval:E=100}=r,H=j=>typeof j=="number";if(!H(E)||E<=0)throw"[Bubble] invalid prop typing.interval, expect positive number.";if(!H(v)&&!Array.isArray(v))throw"[Bubble] invalid prop typing.step, expect positive number or positive number array";if(H(v)&&v<=0)throw"[Bubble] invalid prop typing.step, expect positive number";if(Array.isArray(v)){if(!H(v[0])||v[0]<=0)throw"[Bubble] invalid prop typing.step[0], expect positive number";if(!H(v[1])||v[1]<=0)throw"[Bubble] invalid prop typing.step[1], expect positive number";if(v[0]>v[1])throw"[Bubble] invalid prop typing.step, step[0] should less than step[1]"}return{...$,...r}},[r]),f=i.useRef({content:t,interval:g.interval,step:g.step});f.current={content:t,interval:g.interval,step:g.step};const y=()=>Math.random().toString().slice(2),b=i.useCallback($=>{let v=0;c.current=g.keepPrefix?xs([f.current.content,c.current]):"",l(c.current?[{text:c.current,id:y(),taskId:$,done:!0}]:[]);const E=()=>{if($!==u.current)return;const H=performance.now(),{content:j,interval:W,step:U}=f.current;if(H-v<W){d.current=requestAnimationFrame(E);return}const N=c.current.length,A=typeof U=="number"?U:Math.floor(Math.random()*(U[1]-U[0]))+U[0],P=j.slice(N,N+A);if(!P){if(m.current){d.current=requestAnimationFrame(E);return}l(T=>[{text:T.map(({text:G})=>G).join(""),id:y(),taskId:$,done:!0}]),s==null||s(j),a.current=!1,u.current++;return}c.current+=P;const I={id:y(),text:P,taskId:$,done:!1};l(T=>T.concat(I)),a.current||(a.current=!0),v=H,d.current=requestAnimationFrame(E),n==null||n(c.current,j)};E()},[g.keepPrefix,n,s]),C=i.useCallback(()=>{cancelAnimationFrame(d.current),l([]),c.current="",a.current=!1},[]);return ur(()=>{if(!t)return C();t!==c.current&&(a.current&&!t.startsWith(c.current)?(cancelAnimationFrame(d.current),a.current=!1,requestAnimationFrame(()=>b(++u.current))):a.current===!1&&b(u.current))},[t,b]),{renderedData:o,animating:a.current,memoedAnimationCfg:g}}const Es=({prefixCls:e,streaming:t,content:r,typing:n,onTyping:s,onTypingComplete:o})=>{const{renderedData:l,animating:a,memoedAnimationCfg:c}=vs({streaming:t,content:r,typing:n,onTyping:s,onTypingComplete:o}),{effect:u}=c,d=l.map(g=>u==="fade-in"&&!g.done?i.createElement("span",{key:g.id,className:"fade-in"},g.text):g.text),m=n===!0?!1:u==="typing";return i.createElement("div",{className:M({[`${e}-typing`]:m&&a,[`${e}-fade-in`]:!m})},d)},Rs=({prefixCls:e,rootClassName:t,style:r,className:n,styles:s={},classNames:o={},placement:l="start",content:a,contentRender:c,editable:u=!1,typing:d,streaming:m=!1,variant:g="filled",shape:f="default",header:y,footer:b,avatar:C,extra:$,footerPlacement:v,loading:E,loadingRender:H,onTyping:j,onTypingComplete:W,onEditConfirm:U,onEditCancel:N,...A},P)=>{const I=i.useRef(null);i.useImperativeHandle(P,()=>({nativeElement:I.current}));const T=Ne("bubble"),{direction:G,getPrefixCls:V}=fe(),K=V("bubble",e),D=i.useContext(In),[F,J]=Ct(K),_={...T.style,...T.styles.root,...s.root,...r},z=M(K,T.className,T.classNames.root,o.root,t,n,F,J,`${K}-${l}`,{[`${K}-${D.status}`]:D.status,[`${K}-rtl`]:G==="rtl",[`${K}-loading`]:E}),X=we(A,{attr:!0,aria:!0,data:!0}),q={key:D==null?void 0:D.key,status:D==null?void 0:D.status,extraInfo:D==null?void 0:D.extraInfo},O=i.useMemo(()=>c?c(a,q):a,[a,c,q.key,q.status,q.extraInfo]),oe=typeof d=="function"?d(a,q):d,Q=!!oe&&typeof O=="string";i.useEffect(()=>{Q||m||a&&(W==null||W(a))},[O,Q,m]);const x=v||(l==="start"?"outer-start":"outer-end"),ne=typeof u=="boolean"?u:u.editing,ee=()=>{if(E)return H?H():i.createElement(us,{prefixCls:K});const ue=i.createElement(i.Fragment,null,Q?i.createElement(Es,{prefixCls:K,streaming:m,typing:oe,content:O,onTyping:j,onTypingComplete:W}):O),De=x.includes("inner");return i.createElement("div",{className:Y("body"),style:ae("body")},Pe(),i.createElement("div",{style:{...T.styles.content,...s.content},className:M(`${K}-content`,`${K}-content-${g}`,T.classNames.content,o.content,{[`${K}-content-${D==null?void 0:D.status}`]:D==null?void 0:D.status,[`${K}-content-${f}`]:g!=="borderless",[`${K}-content-editing`]:ne,[`${K}-content-string`]:typeof O=="string"})},ne?i.createElement(cs,{prefixCls:K,content:a,okText:u==null?void 0:u.okText,cancelText:u==null?void 0:u.cancelText,onEditConfirm:U,onEditCancel:N}):i.createElement(i.Fragment,null,De?i.createElement("div",{className:M(`${K}-content-with-footer`)},ue):ue,De&&Ce())),!ne&&!De&&Ce())},Y=ue=>M(`${K}-${ue}`,T.classNames[ue],o[ue]),ae=ue=>({...T.styles[ue],...s[ue]}),le=ue=>typeof ue=="function"?ue(a,q):ue,Se=()=>C?i.createElement("div",{className:Y("avatar"),style:ae("avatar")},le(C)):null,he=()=>$?i.createElement("div",{className:Y("extra"),style:ae("extra")},le($)):null,Pe=()=>y?i.createElement("div",{className:Y("header"),style:ae("header")},le(y)):null,Ce=()=>{if(!b)return null;const ue=M(Y("footer"),{[`${K}-footer-start`]:x.includes("start"),[`${K}-footer-end`]:x.includes("end")});return i.createElement("div",{className:ue,style:ae("footer")},le(b))};return i.createElement("div",re({className:z,style:_},A,X,{ref:I}),Se(),ee(),!ne&&!E&&he())},Ge=i.forwardRef(Rs),ws=({prefixCls:e,content:t="",rootClassName:r,style:n,className:s,styles:o={},classNames:l={},dividerProps:a,...c},u)=>{const{getPrefixCls:d}=fe(),m=Ne("bubble"),g=d("bubble",e),[f,y]=Ct(g),b=M(f,y,g,`${g}-divider`,m.className,m.classNames.root,s,l.root,r),C=$=>i.createElement(hn,a,$);return i.createElement(Ge,re({ref:u,style:n,styles:o,className:b,classNames:l,prefixCls:g,variant:"borderless",content:t,contentRender:C},c))},Mn=i.forwardRef(ws);function Ns(e){const t=p.useRef(null),r=p.useRef(!0),n=p.useRef(!1),s=p.useRef(0),o=p.useRef(void 0),l=p.useRef(!1),a=!e||getComputedStyle(e).flexDirection!=="column-reverse";p.useEffect(()=>{if(a)return;if(!t.current){const f=document.createElement("div");f.style.bottom="0",f.style.flexShrink="0",f.style.pointerEvents="none",f.style.height="10px",f.style.visibility="hidden",e.insertBefore(f,e.firstChild),t.current=f}const m=new IntersectionObserver(([f])=>{r.current=f.isIntersecting,n.current=!f.isIntersecting},{root:e,threshold:0});m.observe(t.current);const g=new MutationObserver(()=>{n.current&&!a&&u()});return g.observe(e,{childList:!0,subtree:!0,attributes:!1}),()=>{m.disconnect(),g.disconnect(),clearTimeout(o.current),t.current&&t.current.parentNode&&(t.current.parentNode.removeChild(t.current),t.current=null)}},[e,a]);const c=p.useCallback(()=>{const{scrollTop:m,scrollHeight:g}=e;if(s.current=g+m,l.current){l.current=!1;return}o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{clearTimeout(o.current),o.current=void 0},50)},[e]);p.useEffect(()=>(a||e.addEventListener("scroll",c,{capture:!0}),()=>e==null?void 0:e.removeEventListener("scroll",c,{capture:!0})),[e,a,c]);const u=p.useCallback(()=>{if(o.current)return;const m=s.current-e.scrollHeight;e.scrollTop=m,l.current=!0},[e]);return{reset:p.useCallback(()=>{a||(r.current=!0,n.current=!1,s.current=e.scrollHeight)},[e,a])}}const Ts=({prefixCls:e,content:t,variant:r="shadow",shape:n,style:s,className:o,styles:l={},classNames:a={},rootClassName:c,...u},d)=>{const m=Ne("bubble"),{getPrefixCls:g}=fe(),f=g("bubble",e),[y,b]=Ct(f),C=`${f}-system`,$=M(y,b,C,f,m.className,m.classNames.root,a.root,o,c);return i.createElement(Ge,re({ref:d,style:s,className:$,styles:l,classNames:a,variant:r,shape:n,content:t},u))},An=i.forwardRef(Ts);function Is(e){return typeof e=="function"&&e instanceof Function}const Ms=p.memo(Ge),As=p.memo(Mn),Ps=p.memo(An),Ds=e=>{const{_key:t,bubblesRef:r,extraInfo:n,status:s,role:o,classNames:l={},styles:a={},...c}=e,u=p.useCallback(E=>{E?r.current[t]=E:delete r.current[t]},[t]),{bubble:d,divider:m,system:g,...f}=l,{bubble:y,divider:b,system:C,...$}=a;let v=p.createElement(Ms,re({ref:u,style:y,className:d,classNames:f,styles:$},c));return o==="divider"?v=p.createElement(As,re({ref:u,style:b,className:m,classNames:f,styles:$},c)):o==="system"&&(v=p.createElement(Ps,re({ref:u,style:C,className:g,classNames:f,styles:$},c))),p.createElement(In.Provider,{value:{key:t,status:s,extraInfo:n}},v)},Hs=(e,t)=>{var I;const{prefixCls:r,rootClassName:n,className:s,styles:o={},classNames:l={},style:a,items:c,autoScroll:u=!0,role:d,onScroll:m,...g}=e,f=dr(g,{attr:!0,aria:!0}),y=p.useRef(null),b=p.useRef(null),C=p.useRef({}),{reset:$}=Ns(u?b.current:null),{getPrefixCls:v}=fe(),E=v("bubble",r),H=`${E}-list`,[j,W]=Ct(E),U=M(H,n,s,l.root,j,W),N={...o.root,...a},A=((I=c[c.length-1])==null?void 0:I.key)||c.length;p.useEffect(()=>{var T;b.current&&($(),(T=b.current)==null||T.scrollTo({top:u?0:b.current.scrollHeight}))},[A,u,$]),ot(t,()=>({nativeElement:y.current,scrollBoxNativeElement:b.current,scrollTo:({key:T,top:G,behavior:V="smooth",block:K})=>{var J,_,z;const{scrollHeight:D,clientHeight:F}=b.current;if(typeof G=="number")(J=b.current)==null||J.scrollTo({top:u?-D+F+G:G,behavior:V});else if(G==="bottom"){const X=u?0:D;(_=b.current)==null||_.scrollTo({top:X,behavior:V})}else if(G==="top"){const X=u?-D:0;(z=b.current)==null||z.scrollTo({top:X,behavior:V})}else T&&C.current[T]&&C.current[T].nativeElement.scrollIntoView({behavior:V,block:K})}}));const P=u?[...c].reverse():c;return p.createElement("div",re({},f,{className:U,style:N,ref:y}),p.createElement("div",{className:M(`${H}-scroll-box`,l.scroll,{[`${H}-autoscroll`]:u}),style:o.scroll,ref:b,onScroll:m},P.map(T=>{let G;if(T.role&&d){const V=d[T.role];G={...Is(V)?V(T):V,...T}}else G=T;return p.createElement(Ds,re({classNames:l,styles:o},mr(G,["key"]),{key:T.key,_key:T.key,bubblesRef:C}))})))},Bs=p.forwardRef(Hs);Ge.List=Bs;Ge.System=An;Ge.Divider=Mn;const Ls=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-header`]:{display:"flex",alignItems:"center",justifyContent:"space-between",color:e.colorText,background:e.colorFillContent,padding:e.paddingSM,borderStartStartRadius:e.borderRadius,borderStartEndRadius:e.borderRadius},[`${t}-header-title`]:{fontSize:e.fontSize,fontWeight:e.fontWeightStrong},[`${t}-code`]:{borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,borderStartStartRadius:0,borderStartEndRadius:0,background:e.colorBgContainer,border:`1px solid ${e.colorBorderSecondary}`,borderTop:"none",overflow:"hidden","pre,code":{whiteSpace:"pre",fontSize:e.fontSize,fontFamily:e.fontFamilyCode,lineHeight:2,borderRadius:0,border:"none"},"code[class*='language-'],pre[class*='language-']":{background:"none"}},[`&${t}-rtl`]:{direction:"rtl"}}}},ks=e=>({colorBgTitle:e.colorFillContent,colorBorderCode:e.colorBorderSecondary,colorTextTitle:e.colorText}),_s=Ue("CodeHighlighter",e=>{const t=Ve(e,{});return[Ls(t)]},ks),zs={...Ut,'pre[class*="language-"]':{...Ut['pre[class*="language-"]'],margin:0}},si=i.forwardRef((e,t)=>{var j,W;const{lang:r,children:n,header:s,prefixCls:o,className:l,classNames:a={},styles:c={},style:u={},highlightProps:d,...m}=e,{getPrefixCls:g,direction:f}=fe(),y=g("codeHighlighter",o),[b,C]=_s(y),$=Ne("codeHighlighter"),v=M(y,$.className,l,(j=$.classNames)==null?void 0:j.root,a.root,b,C,{[`${y}-rtl`]:f==="rtl"}),E={...$.style,...c==null?void 0:c.root,...u},H=()=>{var U,N,A,P;return s===null?null:s||i.createElement("div",{className:M(`${y}-header`,(U=$.classNames)==null?void 0:U.header,a.header),style:{...(N=$.styles)==null?void 0:N.header,...c.header}},i.createElement("span",{className:M(`${y}-header-title`,a.headerTitle,(A=$.classNames)==null?void 0:A.headerTitle),style:{...(P=$.styles)==null?void 0:P.headerTitle,...c.headerTitle}},r),i.createElement(ze.Copy,{text:n}))};return n?r?i.createElement("div",re({ref:t,className:v,style:E},m),H(),i.createElement("div",{className:M(`${y}-code`,(W=$.classNames)==null?void 0:W.code,a.code),style:{...$.styles.code,...c.code}},i.createElement(Mr,re({language:r,wrapLines:!0,style:zs},d),n.replace(/\n$/,"")))):i.createElement("code",null,n):null}),It=()=>({height:0,opacity:0}),Zt=e=>{const{scrollHeight:t}=e;return{height:t,opacity:1}},Xs=e=>({height:e?e.offsetHeight:0}),Mt=(e,t)=>(t==null?void 0:t.deadline)===!0||t.propertyName==="height",Os=(e=kr)=>({motionName:`${e}-motion-collapse`,onAppearStart:It,onEnterStart:It,onAppearActive:Zt,onEnterActive:Zt,onLeaveStart:Xs,onLeaveActive:It,onAppearEnd:Mt,onEnterEnd:Mt,onLeaveEnd:Mt,motionDeadline:500}),Fs=(e,t,r)=>{const n=typeof e=="boolean"||(e==null?void 0:e.expandedKeys)===void 0,[s,o,l,a]=i.useMemo(()=>{let g={expandedKeys:[],defaultExpandedKeys:[],onExpand:()=>{}};return e?(typeof e=="object"&&(g={...g,...e}),[!0,g.defaultExpandedKeys,g.expandedKeys,g.onExpand]):[!1,g.defaultExpandedKeys,g.expandedKeys,g.onExpand]},[e]),[c,u]=zt(o||[],{value:n?void 0:l,onChange:a}),d=g=>{u(f=>{const y=n?f:l,b=y.includes(g)?y.filter(C=>C!==g):[...y,g];return a==null||a(b),b})},m=i.useMemo(()=>s?{...Os(r),motionAppear:!1,leavedClassName:`${t}-content-hidden`}:{},[r,t,s]);return[s,c,s?d:void 0,m]},ke={Alt:["altKey","⌥","Alt"],Ctrl:["ctrlKey","⌃","Ctrl"],Meta:["metaKey","⌘","Win"],Shift:["shiftKey","⇧","Shift"]},Dt=Array.from({length:9},(e,t)=>yn.ONE+t),Jt=/(mac|iphone|ipod|ipad)/i.test(typeof navigator<"u"?navigator==null?void 0:navigator.platform:""),Qt=e=>{var t,r,n;return e==="number"?e:typeof e=="string"&&((t=ke==null?void 0:ke[e])!=null&&t[Jt?1:2])?ke[e][Jt?1:2]:((n=(r=Object.entries(yn||{}))==null?void 0:r.find(([s,o])=>o===e))==null?void 0:n[0])||""},Ks=(e,t)=>{const r=[...e],n=r.pop();return r.reduce((l,a)=>{var c;return l&&(t[(c=ke==null?void 0:ke[a])==null?void 0:c[0]]||!1)},n===t.keyCode)?{actionShortcutKey:e,actionKeyCodeNumber:Dt.indexOf(t.keyCode)>-1?Dt.indexOf(t.keyCode):!1,actionKeyCode:t.keyCode,timeStamp:t.timeStamp}:!1},qs=e=>{const t=[...e],r=t.pop();return{keyCodeDict:r==="number"?Dt:[r],prefixKeys:t}},en=(e,t,r)=>{const n=!!e.find(({shortcutKey:s})=>s.toString()===t.toString());Hr(!n,r,`Same shortcutKey ${t.toString()}`)},Ws=(e,t,r)=>{const n=Object.assign({},t||{},r);return Object.keys(n).reduce(({flattenShortcutKeys:s,shortcutKeysInfo:o},l)=>{const a=n[l];if(!Array.isArray(a))return{flattenShortcutKeys:s,shortcutKeysInfo:o};if(o={...o,[l]:{shortcutKeys:a,shortcutKeysIcon:[]}},a.every(c=>Array.isArray(c)))a.forEach((c,u)=>{const d=c;en(s,d,e),s.push({name:l,shortcutKey:d,index:u}),o[l].shortcutKeysIcon.push(d==null?void 0:d.map(m=>Qt(m)))});else{const{keyCodeDict:c,prefixKeys:u}=qs(a);c.forEach(d=>{en(s,[...u,d],e),s.push({name:l,shortcutKey:[...u,d]})}),o[l].shortcutKeysIcon=a.map(d=>Qt(d))}return{flattenShortcutKeys:s,shortcutKeysInfo:o}},{flattenShortcutKeys:[],shortcutKeysInfo:{}})},js=()=>{const e=p.useRef(void 0);return[e,r=>{e.current=r}]},Vs=(e,t)=>{const r=Ne(e),{flattenShortcutKeys:n,shortcutKeysInfo:s}=Ws(e,r.shortcutKeys,t),[o,l]=p.useState(null),[a,c]=js(),u=p.useRef(!1),d=g=>{var f;for(const y of n){const b=Ks(y.shortcutKey,g);if(b){const C={...b,name:y.name,index:y==null?void 0:y.index};if(u.current)return;u.current=!0,l(C),(f=a==null?void 0:a.current)==null||f.call(a,C)}}},m=()=>{u.current=!1};return p.useEffect(()=>{if(n.length!==0)return document.addEventListener("keydown",d),document.addEventListener("keyup",m),()=>{document.removeEventListener("keydown",d),document.addEventListener("keyup",m)}},[n.length,a]),[o,s,c]},tn=({shortcutKeysIcon:e,prefixCls:t})=>{const[r]=Xe("Conversations",Re.Conversations),n=!!(e!=null&&e.length);return i.createElement("div",{className:M(t,{[`${t}-shortcut-keys-show`]:n})},i.createElement("span",null,r.create),n&&i.createElement("span",{className:M(`${t}-shortcut-keys`)},e.map(s=>i.createElement("span",{className:M(`${t}-shortcut-key`),key:s},s))))},Us=({icon:e,label:t,align:r,shortcutKeyInfo:n,prefixCls:s})=>{const{shortcutKeysIcon:o}=n||{},l={label:i.createElement(tn,{prefixCls:`${s}-label`,shortcutKeysIcon:o}),icon:i.createElement(fr,{className:`${s}-icon`}),align:"center"};return t&&(l.label=typeof t=="function"?t({shortcutKeyInfo:n,components:{CreationLabel:tn}}):t),e&&(l.icon=typeof e=="function"?e():e),[l.icon,l.label,r||l.align]},Pn=({className:e,icon:t,label:r,align:n,style:s,disabled:o,onClick:l,prefixCls:a,shortcutKeyInfo:c})=>{const[u,d,m]=Us({prefixCls:a,label:r,icon:t,align:n,shortcutKeyInfo:c});return p.createElement("button",{type:"button",onClick:g=>{o||l==null||l(g)},style:s,className:M(a,e,`${a}-${m}`,{[`${a}-disabled`]:o})},u,d)},Dn=i.createContext(null),Gs=({className:e,children:t})=>{var b;const{prefixCls:r,groupInfo:n,enableCollapse:s,expandedKeys:o,onItemExpand:l,collapseMotion:a}=i.useContext(Dn)||{},{label:c,name:u,collapsible:d}=n||{},m=typeof c=="function"?c(u,{groupInfo:n}):c||u,g=d&&s,f=()=>{g&&(l==null||l(n.name))},y=g&&!!((b=o==null?void 0:o.includes)!=null&&b.call(o,u));return i.createElement("li",{className:e},i.createElement("div",{className:M(`${r}-group-title`,{[`${r}-group-title-collapsible`]:g}),onClick:f},m&&i.createElement("div",{className:M(`${r}-group-label`)},m),g&&i.createElement("div",{className:M(`${r}-group-collapse-trigger `,`${r}-group-collapse-trigger-${y?"open":"close"}`)},i.createElement(gr,null))),i.createElement(_t,re({},a,{visible:g?y:!0}),({className:C,style:$},v)=>i.createElement("div",{className:M(C),ref:v,style:$},t)))},Ys=(e,t=[])=>{const[r,n,s]=p.useMemo(()=>{let o={label:"",collapsibleHandle:!1,collapsibleOptions:{}};if(!e)return["",o.collapsibleHandle,o.collapsibleOptions];if(typeof e=="object"){const{collapsible:l,defaultExpandedKeys:a,expandedKeys:c,onExpand:u,...d}=e;o={...o,...d,collapsibleHandle:l,collapsibleOptions:{defaultExpandedKeys:a,expandedKeys:c,onExpand:u}}}return[o.label,o.collapsibleHandle,o.collapsibleOptions]},[e]);return i.useMemo(()=>{const o=t.reduce((a,c)=>{if((c==null?void 0:c.type)==="divider"||!c.group||!e)return a.push({data:[c],name:"",label:"",enableGroup:!1,collapsible:!1}),a;const u=c,d=a.some((g,f)=>g.name===(u==null?void 0:u.group)?(a[f].data.push(u),!0):!1),m=typeof n=="function"?n==null?void 0:n(u==null?void 0:u.group):n;return d||a.push({data:[u],enableGroup:!0,name:u==null?void 0:u.group,label:r,collapsible:m}),a},[]),l=o.reduce((a,c)=>(c.data.forEach(u=>{u.type!=="divider"&&a.push({key:u.key,disabled:u.disabled})}),a),[]);return[o,s,l]},[t,s])},nn=e=>{e.stopPropagation()},Zs=e=>{const{prefixCls:t,info:r,className:n,direction:s,onClick:o,active:l,menu:a,...c}=e,u=we(c,{aria:!0,data:!0,attr:!0}),{disabled:d}=r,m=M(n,`${t}-item`,{[`${t}-item-active`]:l&&!d},{[`${t}-item-disabled`]:d}),g=()=>{!d&&o&&o(r.key)},{trigger:f,...y}=a||{},b=y==null?void 0:y.getPopupContainer,C=$=>{const v=i.createElement(gn,{onClick:nn,className:`${t}-menu-icon`});return f?typeof f=="function"?f($,{originNode:v}):f:v};return i.createElement("li",re({title:typeof r.label=="object"?void 0:`${r.label}`},u,{className:m,onClick:g}),r.icon&&i.createElement("div",{className:`${t}-icon`},r.icon),i.createElement(fn.Text,{className:`${t}-label`},r.label),!d&&a&&i.createElement("div",{onClick:nn},i.createElement(kt,{menu:y,placement:s==="rtl"?"bottomLeft":"bottomRight",trigger:["click"],disabled:d,getPopupContainer:b},C(r))))},Js=e=>{const{componentCls:t,calc:r}=e;return{[t]:{display:"flex",flexDirection:"column",gap:e.paddingXXS,overflowY:"auto",padding:e.paddingSM,margin:0,listStyle:"none","ul, ol":{margin:0,padding:0,listStyle:"none"},[`&${t}-rtl`]:{direction:"rtl"},[`${t}-creation`]:{backgroundColor:e.creationBgColor,color:e.colorPrimary,border:"none",fontWeight:500,paddingBlock:e.paddingXS,paddingInline:e.paddingSM,fontSize:e.fontSize,cursor:"pointer",display:"flex",gap:e.paddingXS,marginBlockEnd:e.marginSM,lineHeight:e.lineHeight,borderRadius:e.borderRadiusLG,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`&:not(${t}-creation-disabled):hover`]:{color:e.colorPrimary,background:e.creationHoverColor},[`&:not(${t}-creation-disabled)`]:{border:`${se(e.lineWidth)} ${e.lineType}, ${e.creationBorderColor}`},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-label":{display:"flex",justifyContent:"space-between",alignItems:"center"},"&-label-shortcut-keys-show":{flex:1},"&-label-shortcut-keys":{height:e.controlHeightXS,display:"flex",alignItems:"center",gap:se(4)},"&-label-shortcut-key":{borderRadius:e.borderRadiusSM,height:"100%",boxSizing:"border-box",fontSize:e.fontSizeIcon,paddingInline:`${se(r(e.paddingXXS).sub(1).equal())}`,display:"flex",justifyContent:"center",alignItems:"center",color:e.shortcutKeyTextColor,border:`${se(e.lineWidth)} ${e.lineType}, ${e.creationBorderColor}`},"&-disabled":{cursor:"not-allowed",background:e.colorBgContainerDisabled,[`& ${t}-creation-label, ${t}-creation-icon`]:{color:e.colorTextDisabled},[`& ${t}-creation-label-shortcut-keys`]:{color:e.colorTextDisabled,border:`${se(e.lineWidth)} ${e.lineType}, ${e.colorBgContainerDisabled}`}}},[`${t}-divider`]:{marginBlock:e.marginXXS},[`${t}-item`]:{display:"flex",height:e.controlHeightLG,minHeight:e.controlHeightLG,gap:e.paddingXS,padding:`0 ${se(e.paddingXS)}`,alignItems:"center",borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`&:not(${t}-item-disabled):hover`]:{backgroundColor:e.colorBgTextHover},"&-active":{backgroundColor:e.colorBgTextHover,[`& ${t}-label, ${t}-menu-icon`]:{color:e.colorText}},"&-disabled":{cursor:"not-allowed",[`& ${t}-label, ${t}-icon, ${t}-menu-icon`]:{color:e.colorTextDisabled}},"&:hover, &-active":{[`& ${t}-menu-icon`]:{opacity:.6}},[`${t}-menu-icon:hover`]:{opacity:1}},[`${t}-content-hidden`]:{display:"none"},[`${t}-label`]:{flex:1,color:e.colorText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},[`${t}-menu-icon`]:{opacity:0,fontSize:e.fontSizeXL},[`${t}-list`]:{display:"flex",gap:e.paddingXXS,flexDirection:"column"},[`${t}-group-collapsible-list`]:{paddingBlockStart:e.paddingXXS,[`& ${t}-item`]:{paddingInlineStart:e.paddingXL}},[`${t}-group-title`]:{display:"flex",alignItems:"center",color:e.colorTextDescription,height:e.controlHeightLG,minHeight:e.controlHeightLG,padding:`0 ${se(e.paddingXS)}`},[`${t}-group-title-collapsible`]:{justifyContent:"space-between",cursor:"pointer",color:e.colorText,borderRadius:e.borderRadiusLG,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,"&:hover":{backgroundColor:e.colorBgTextHover}},[`${t}-group-collapse-trigger`]:{transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,transform:"rotate(0deg)",transformOrigin:"center center"},[`${t}-group-collapse-trigger-open`]:{transform:"rotate(90deg)"},[`${t}-group-collapse-trigger-close`]:{transform:"rotate(0deg)"}}}},Qs=e=>{const t=new be(e.colorPrimary).setA(.15),r=new be(e.colorPrimary).setA(.22),n=new be(e.colorPrimary).setA(.25),s=new be(e.colorPrimary).setA(.65);return{creationBgColor:t.toRgbString(),creationBorderColor:r.toRgbString(),creationHoverColor:n.toRgbString(),shortcutKeyTextColor:s.toRgbString()}},eo=Ue("Conversations",e=>{const t=Ve(e,{});return[Js(t),_r(t)]},Qs),to=i.forwardRef((e,t)=>{const{prefixCls:r,shortcutKeys:n,rootClassName:s,items:o,activeKey:l,defaultActiveKey:a,onActiveChange:c,menu:u,styles:d={},classNames:m={},groupable:g,className:f,style:y,creation:b,...C}=e,$=we(C,{attr:!0,aria:!0,data:!0}),v=i.useRef(null);ot(t,()=>({nativeElement:v.current}));const[E,H]=zt(a,{value:l,onChange:x=>{x&&(c==null||c(x))}}),[j,W,U]=Ys(g,o),{getPrefixCls:N,direction:A}=fe(),P=N("conversations",r),I=Ne("conversations"),[T,G]=eo(P),V=M(P,I.className,I.classNames.root,f,m.root,s,T,G,{[`${P}-rtl`]:A==="rtl"}),K=x=>{H(x)},[D,F,J]=Vs("conversations",n);J(x=>{var ne,ee,Y;switch(x==null?void 0:x.name){case"items":{const ae=(x==null?void 0:x.actionKeyCodeNumber)??(x==null?void 0:x.index);typeof ae=="number"&&!((ne=U==null?void 0:U[ae])!=null&&ne.disabled)&&((ee=U==null?void 0:U[ae])!=null&&ee.key)&&H((Y=U==null?void 0:U[ae])==null?void 0:Y.key)}break;case"creation":typeof(b==null?void 0:b.onClick)=="function"&&!(b!=null&&b.disabled)&&b.onClick();break}});const z=x=>x.map((ne,ee)=>{if(ne.type==="divider")return i.createElement(hn,{key:`key-divider-${ee}`,className:`${P}-divider`,dashed:ne.dashed});const Y=ne,{label:ae,disabled:le,icon:Se,...he}=Y;return i.createElement(Zs,re({},he,{key:Y.key||`key-${ee}`,info:Y,prefixCls:P,direction:A,className:M(m.item,I.classNames.item,Y.className),style:{...I.styles.item,...d.item,...Y.style},menu:typeof u=="function"?u(Y):u,active:E===Y.key,onClick:K}))}),X=N(),[q,O,oe,Q]=Fs(W,P,X);return i.createElement("ul",re({},$,{style:{...I.style,...y,...I.styles.root,...d.root},className:V,ref:v}),!!b&&i.createElement(Pn,re({className:M(I.classNames.creation,m.creation),style:{...I.styles.creation,...d.creation},shortcutKeyInfo:F==null?void 0:F.creation,prefixCls:`${P}-creation`},b)),j.map((x,ne)=>{const ee=z(x.data);return x.enableGroup?i.createElement(Dn.Provider,{key:x.name||`key-${ne}`,value:{prefixCls:P,groupInfo:x,enableCollapse:q,expandedKeys:O,onItemExpand:oe,collapseMotion:Q}},i.createElement(Gs,{className:M(I.classNames.group,m.group)},i.createElement("ul",{className:M(`${P}-list`,{[`${P}-group-collapsible-list`]:x.collapsible}),style:{...I.styles.group,...d.group}},ee))):ee}))}),no=to;no.Creation=Pn;const ro=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-header`]:{display:"flex",alignItems:"center",justifyContent:"space-between",background:e.colorBgTitle,color:e.colorTextTitle,padding:e.paddingSM,borderStartStartRadius:e.borderRadius,borderStartEndRadius:e.borderRadius},[`${t}-graph`]:{display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${e.colorBgTitle}`,borderTop:"none",padding:e.paddingSM,background:e.colorBgContainer,overflow:"auto",borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,height:"400px"},[`${t}-graph-hidden`]:{display:"none"},[`${t}-graph svg`]:{maxWidth:"100%",maxHeight:"100%",height:"auto",width:"auto"},[`${t}-code`]:{borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,borderBottom:`1px solid ${e.colorBgTitle}`,borderInlineStart:`1px solid ${e.colorBgTitle}`,borderInlineEnd:`1px solid ${e.colorBgTitle}`,background:e.colorBgContainer,paddingInline:e.paddingSM,paddingBlock:e.paddingSM,overflow:"auto",height:"400px","pre,code":{whiteSpace:"pre",fontSize:e.fontSize,fontFamily:e.fontFamilyCode,lineHeight:2,borderRadius:0,border:"none"},"code[class*='language-'],pre[class*='language-']":{background:"none"}},[`&${t}-rtl`]:{direction:"rtl"}}}},so=e=>({colorBgTitle:e.colorFillContent,colorBorderCode:e.colorBorderSecondary,colorBorderGraph:e.colorBorderSecondary,colorTextTitle:e.colorText}),oo=Ue("Mermaid",e=>{const t=Ve(e,{});return[ro(t)]},so);var ve=function(e){return e.Code="code",e.Image="image",e}(ve||{});let io=0;const oi=i.memo(e=>{var oe,Q;const{prefixCls:t,className:r,style:n,classNames:s={},styles:o={},header:l,children:a,highlightProps:c,onRenderTypeChange:u}=e,[d,m]=p.useState(ve.Image),[g,f]=p.useState(1),[y,b]=p.useState({x:0,y:0}),[C,$]=p.useState(!1),[v,E]=p.useState({x:0,y:0}),H=p.useRef(null),j=`mermaid-${io++}-${(a==null?void 0:a.length)||0}`;p.useEffect(()=>{Tt.initialize({startOnLoad:!1,securityLevel:"strict",theme:"default",fontFamily:"monospace"})},[]);const[W]=Xe("Mermaid",Re.Mermaid),{getPrefixCls:U,direction:N}=fe(),A=U("mermaid",t),[P,I]=oo(A),T=Ne("mermaid"),G=M(A,T.className,(oe=T.classNames)==null?void 0:oe.root,r,s.root,P,I,{[`${A}-rtl`]:N==="rtl"}),V=pr(async()=>{if(!(!a||!H.current||d===ve.Code))try{if(!await Tt.parse(a,{suppressErrors:!0}))throw new Error("Invalid Mermaid syntax");const ne=a.replace(/[`\s]+$/g,""),{svg:ee}=await Tt.render(j,ne,H.current);H.current.innerHTML=ee}catch(x){console.warn(`Mermaid render failed: ${x}`)}},100);p.useEffect(()=>{d===ve.Code&&H.current?H.current.innerHTML="":V()},[a,d]),p.useEffect(()=>{const x=H.current;if(!x||d!==ve.Image)return;let ne=0;const ee=Y=>{Y.preventDefault(),Y.stopPropagation();const ae=Date.now();if(ae-ne<16)return;ne=ae;const le=Y.deltaY>0?-.1:.1;f(Se=>Math.max(.5,Math.min(3,Se+le)))};return x.addEventListener("wheel",ee,{passive:!1}),()=>{x.removeEventListener("wheel",ee)}},[d]),p.useEffect(()=>{if(H.current&&d===ve.Image){const x=H.current.querySelector("svg");x&&(x.style.transform=`scale(${g}) translate(${y.x}px, ${y.y}px)`,x.style.transformOrigin="center",x.style.transition=C?"none":"transform 0.1s ease-out",x.style.cursor=C?"grabbing":"grab")}},[g,y,d,C]);const K=x=>{d===ve.Image&&(x.preventDefault(),$(!0),E({x:x.clientX,y:x.clientY}))},D=x=>{if(!C||d!==ve.Image)return;x.preventDefault();const ne=x.clientX-v.x,ee=x.clientY-v.y;b(Y=>({x:Y.x+ne/g,y:Y.y+ee/g})),E({x:x.clientX,y:x.clientY})},F=()=>{$(!1)},J=()=>{f(1),b({x:0,y:0})};if(!a)return null;const _=async()=>{var Pe;const x=(Pe=H.current)==null?void 0:Pe.querySelector("svg");if(!x)return;const ne=new XMLSerializer().serializeToString(x),ee=document.createElement("canvas"),Y=ee.getContext("2d");if(!Y)return;const{width:ae,height:le}=x.getBoundingClientRect(),Se=window.devicePixelRatio||1;ee.width=ae*Se,ee.height=le*Se,ee.style.width=`${ae}px`,ee.style.height=`${le}px`,Y.scale(Se,Se);const he=new Image;he.onload=()=>{Y.drawImage(he,0,0,ae,le);const Ce=document.createElement("a");Ce.download=`${Date.now()}.png`,Ce.href=ee.toDataURL("image/png",1),Ce.click()},he.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(ne)}`},z=()=>{f(x=>Math.min(x+.2,3))},X=()=>{f(x=>Math.max(x-.2,.5))},q=()=>{var ne,ee;if(l===null)return null;if(l)return l;const x=d===ve.Image?[{key:"zoomIn",icon:i.createElement(hr,null),label:W.zoomIn,onItemClick:z},{key:"zoomOut",icon:i.createElement(yr,null),label:W.zoomOut,onItemClick:X},{key:"zoomReset",actionRender:()=>i.createElement(qe,{title:W.zoomReset},i.createElement(We,{type:"text",size:"small",onClick:J},W.zoomReset))},{key:"download",icon:i.createElement(br,null),label:W.download,onItemClick:_}]:[{key:"copy",actionRender:()=>i.createElement(ze.Copy,{text:a})}];return i.createElement("div",{className:M(`${A}-header`,(ne=T.classNames)==null?void 0:ne.header,s==null?void 0:s.header),style:{...(ee=T.styles)==null?void 0:ee.header,...o.header}},i.createElement(Sr,{options:[{label:W.image,value:ve.Image},{label:W.code,value:ve.Code}],value:d,onChange:Y=>{m(Y),u==null||u(Y)}}),i.createElement(ze,{items:x}))},O=()=>{var x,ne,ee,Y;return i.createElement(i.Fragment,null,i.createElement("div",{className:M(`${A}-graph`,(x=T.classNames)==null?void 0:x.graph,d===ve.Code&&`${A}-graph-hidden`,s==null?void 0:s.graph),style:{...(ne=T.styles)==null?void 0:ne.graph,...o.graph},ref:H,onMouseDown:K,onMouseMove:D,onMouseUp:F,onMouseLeave:F}),d===ve.Code?i.createElement("div",{className:M(`${A}-code`,(ee=T.classNames)==null?void 0:ee.code,s==null?void 0:s.code),style:{...(Y=T.styles)==null?void 0:Y.code,...o.code}},i.createElement(Ar,re({customStyle:{padding:0,background:"transparent"},language:"mermaid",wrapLines:!0},c),a.replace(/\n$/,""))):null)};return i.createElement("div",{className:G,style:{...n,...T.style,...(Q=T.styles)==null?void 0:Q.root,...o.root}},q(),O())}),$t=i.createContext(null);function ao(e,t){const{className:r,action:n,onClick:s,...o}=e,l=p.useContext($t),{prefixCls:a,disabled:c,setSubmitDisabled:u}=l,d=o.disabled??c??l[`${n}Disabled`];return p.useEffect(()=>{n==="onSend"&&(u==null||u(d))},[d,n,u]),i.createElement(We,re({type:"text"},o,{ref:t,onClick:m=>{var g;d||((g=l[n])==null||g.call(l),s==null||s(m))},disabled:d,className:M(a,r,{[`${a}-disabled`]:d})}))}const xt=i.forwardRef(ao);function lo(e,t){return p.createElement(xt,re({icon:p.createElement(Cr,null)},e,{action:"onClear",ref:t}))}const co=p.forwardRef(lo),uo=p.memo(e=>{const{className:t}=e,[r]=Xe("Sender",Re.Sender);return i.createElement("svg",{color:"currentColor",viewBox:"0 0 1000 1000",xmlns:"http://www.w3.org/2000/svg",className:t},i.createElement("title",null,r.stopLoading),i.createElement("rect",{fill:"currentColor",height:"250",rx:"24",ry:"24",width:"250",x:"375",y:"375"}),i.createElement("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor",strokeWidth:"100",opacity:"0.45"}),i.createElement("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor",strokeWidth:"100",strokeDasharray:"600 9999999"},i.createElement("animateTransform",{attributeName:"transform",dur:"1s",from:"0 500 500",repeatCount:"indefinite",to:"360 500 500",type:"rotate"})))});function mo(e,t){const{prefixCls:r}=p.useContext($t),{className:n}=e;return p.createElement(xt,re({icon:p.createElement(uo,{className:`${r}-loading-icon`}),color:"primary",variant:"text",shape:"circle"},e,{className:M(n,`${r}-loading-button`),action:"onCancel",ref:t}))}const Hn=p.forwardRef(mo);function fo(e,t){return p.createElement(xt,re({icon:p.createElement($r,null),type:"primary",shape:"circle"},e,{action:"onSend",ref:t}))}const Bn=p.forwardRef(fo);function go(e,t){const{speechRecording:r,onSpeechDisabled:n,prefixCls:s}=p.useContext($t);let o=null;return r?o=p.createElement(vn,{className:`${s}-recording-icon`}):n?o=p.createElement(xr,null):o=p.createElement(vr,null),p.createElement(xt,re({icon:o,color:"primary",variant:"text"},e,{action:"onSpeech",ref:t}))}const Ln=p.forwardRef(go),vt=i.createContext({});function po(e,t){const r=st(e),[n,s,o]=i.useMemo(()=>typeof t=="object"?[t.recording,t.onRecordingChange,typeof t.recording=="boolean"]:[void 0,void 0,!1],[t]),[l,a]=i.useState(null);i.useEffect(()=>{if(!o&&"permissions"in navigator){let C=null;return navigator.permissions.query({name:"microphone"}).then($=>{a($.state),$.onchange=function(){a(this.state)},C=$}),()=>{C&&(C.onchange=null)}}},[o]);let c;!c&&typeof window<"u"&&(c=window.SpeechRecognition||window.webkitSpeechRecognition);const u=!!(o||c&&l!=="denied"),d=i.useRef(null),[m,g]=bn(!1,{value:n}),f=i.useRef(!1),y=()=>{if(u&&!d.current){const C=new c;C.onstart=()=>{g(!0)},C.onend=()=>{g(!1)},C.onresult=$=>{var v,E,H;if(!f.current){const j=(H=(E=(v=$.results)==null?void 0:v[0])==null?void 0:E[0])==null?void 0:H.transcript;r(j)}f.current=!1},d.current=C}},b=st(C=>{C&&!m||(f.current=C,o?s==null||s(!m):(y(),d.current&&(m?(d.current.stop(),s==null||s(!1)):(d.current.start(),s==null||s(!0)))))});return[u,b,m]}const kn=p.createContext({}),rn=()=>({height:0}),sn=e=>({height:e.scrollHeight});function ho(e){const{title:t,onOpenChange:r,open:n,children:s,className:o,style:l,classNames:a={},styles:c={},prefixCls:u,closable:d,forceRender:m}=e,{prefixCls:g}=p.useContext(kn),{direction:f,getPrefixCls:y}=fe(),b=y("sender",u||g),C=`${b}-header`,$=()=>{r==null||r(!n)};return p.createElement(_t,{motionEnter:!0,motionLeave:!0,motionName:`${C}-motion`,leavedClassName:`${C}-motion-hidden`,onEnterStart:rn,onEnterActive:sn,onLeaveStart:sn,onLeaveActive:rn,visible:n,forceRender:m},({className:v,style:E})=>p.createElement("div",{className:M(b,C,v,o,{[`${C}-rtl`]:f==="rtl"}),style:{...E,...l}},(d!==!1||t)&&p.createElement("div",{className:M(`${C}-header`,a.header),style:{...c.header}},p.createElement("div",{className:`${C}-title`},t),d!==!1&&p.createElement("div",{className:`${C}-close`},p.createElement(We,{type:"text",icon:p.createElement(Sn,null),size:"small",onClick:$}))),s&&p.createElement("div",{className:M(`${C}-content`,a.content),style:{...c.content}},s)))}const yo=e=>{const{componentCls:t,calc:r}=e,n=`${t}-header`;return{[t]:{[`&${n}-rtl`]:{direction:"rtl"},[`${n}`]:{borderBottomWidth:e.lineWidth,borderBottomStyle:"solid",borderBottomColor:e.colorBorderInput,[`${n}-header`]:{background:e.colorFillAlter,fontSize:e.fontSize,lineHeight:e.lineHeight,paddingBlock:r(e.paddingSM).sub(e.lineWidthBold).equal(),paddingInlineStart:e.padding,paddingInlineEnd:e.paddingXS,display:"flex",borderRadius:{_skip_check_:!0,value:r(e.borderRadius).mul(2).equal()},borderEndStartRadius:0,borderEndEndRadius:0,[`${n}-title`]:{flex:"auto"}},[`${n}-content`]:{padding:e.padding}},[`${n}-motion`]:{transition:["height","border"].map(s=>`${s} ${e.motionDurationSlow}`).join(","),overflow:"hidden","&-enter-start, &-leave-active":{borderBottomColor:"transparent"},"&-hidden":{display:"none"}}}}},bo=e=>{const{componentCls:t,antCls:r,calc:n}=e,s=`${t}-slot`,o=`${r}-input`,l=`${r}-dropdown-trigger`,a=`${t}-slot-input`,c=`${t}-slot-select`,u=`${t}-slot-tag`,d=`${t}-slot-content`,m=`${t}-skill`;return{[t]:{[`${t}-input-slot`]:{outline:"none",cursor:"text",whiteSpace:"pre-wrap",width:"100%",caretColor:e.colorPrimary,fontSize:e.fontSize,lineHeight:e.lineHeight,"&:empty::before":{content:"attr(data-placeholder)",color:e.colorTextPlaceholder}},[`${s}:not(${d})`]:{display:"inline-block",verticalAlign:"middle",alignItems:"center",marginBlock:1,height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),wordBreak:"break-all",marginInline:e.marginXXS},[`${o}${a}`]:{height:"100%",background:e.colorBgSlot,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,paddingInline:e.paddingXXS,fontSize:"inherit",lineHeight:"inherit",position:"relative","&::placeholder":{color:e.colorTextSlotPlaceholder,fontSize:"inherit",lineHeight:"inherit"},[s]:{display:"inline-flex",margin:`0 ${se(e.marginXXS)}`,verticalAlign:"bottom",alignItems:"center",marginBlock:se(n(e.marginXXS).div(2).equal()),minHeight:e.controlHeightSM,wordBreak:"break-all"}},[c]:{fontSize:e.fontSize,lineHeight:e.lineHeight,paddingInline:e.paddingXXS,transition:`border-color  ${e.motionDurationMid}`,position:"relative",display:"inline-flex",alignItems:"center",cursor:"pointer",background:e.colorBgSlot,height:"100%",boxSizing:"border-box",borderRadius:e.borderRadius,color:e.colorTextSlot,border:`1px solid ${e.colorBorderSlot}`,"&.placeholder":{color:e.colorTextSlotPlaceholder},[`${c}`]:{fontSize:e.fontSize,lineHeight:e.lineHeight,padding:`0 ${se(e.paddingXXS)}`,transition:`border-color  ${e.motionDurationMid}`,position:"relative",display:"inline",cursor:"pointer",background:e.colorBgSlot,alignItems:"center",justifyContent:"center",borderRadius:e.borderRadius,color:e.colorTextSlot,border:`1px solid ${e.colorBorderSlot}`,"&.placeholder":{color:e.colorTextSlotPlaceholder},[`&${l}-open`]:{borderColor:e.colorBorderSlotHover}},[`${c}-value`]:{flex:1,fontSize:e.fontSize,lineHeight:e.lineHeight,"&:empty::before":{content:"attr(data-placeholder)"}},[`${c}-arrow`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSize,lineHeight:e.lineHeight,display:"inline-flex",alignItems:"center",justifyContent:"center"},[`${u}`]:{background:e.colorBgSlot,border:`1px solid ${e.colorBorderSlot}`,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,padding:`0 ${se(e.paddingXXS)}`,fontSize:e.fontSize,lineHeight:e.lineHeight,position:"relative",cursor:"default"}},[`${c}-arrow`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSize,lineHeight:e.lineHeight,display:"inline-flex",alignItems:"center",justifyContent:"center"},[u]:{background:e.colorBgSlot,border:`1px solid ${e.colorBorderSlot}`,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,padding:`0 ${se(e.paddingXXS)}`,fontSize:e.fontSize,lineHeight:e.lineHeight,height:"100%",boxSizing:"border-box",position:"relative",cursor:"default"},[d]:{height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),caretColor:e.colorPrimary,background:e.colorBgSlot,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,paddingInline:e.paddingXXS,boxSizing:"border-box",verticalAlign:"middle",fontSize:e.fontSize,marginBlock:1,lineHeight:e.lineHeight,display:"inline-block",position:"relative",cursor:"text","&:empty":{width:"fit-content","&::after":{display:"inline-block",height:"inherit",content:"attr(data-placeholder)",color:e.colorTextSlotPlaceholder}}},[`${s}-no-width`]:{userSelect:"none",width:"3px",display:"inline-block",lineHeight:"inherit"},[m]:{display:"inline-block",verticalAlign:"baseline",alignItems:"center",marginBlock:1,height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),wordBreak:"break-all",paddingInlineEnd:0,paddingInlineStart:0,marginInlineEnd:0,marginInlineStart:-1,[`&${m}-empty`]:{"&::after":{display:"inline-block",pointerEvents:"none",height:"inherit",content:"attr(data-placeholder)",color:e.colorTextPlaceholder}}},[`${m}-wrapper`]:{height:"100%",display:"inline-flex"},[`${m}-tag`]:{paddingInline:e.paddingXS,height:"100%",backgroundColor:e.colorBgSkill,borderRadius:e.borderRadius,color:e.colorPrimary,alignItems:"center",fontWeight:500,display:"inline-flex",cursor:"pointer",gap:e.marginXXS,transition:`background-color ${e.motionDurationMid}`,"&:hover":{backgroundColor:e.colorBgSkillHover,[`${m}-tag-close:not(${m}-tag-close-disabled)`]:{color:e.colorPrimaryHover}},"&-close":{fontSize:e.fontSizeSM,display:"inline-flex",transition:`color ${e.motionDurationMid}`,color:e.colorPrimary},"&-close-disabled":{cursor:"not-allowed",color:e.colorTextDisabled}},[`${m}-holder`]:{width:e.marginXS,height:"100%"}}}},So=e=>{const{componentCls:t,antCls:r}=e,n=`${t}-switch`;return{[t]:{[`&${n}-rtl`]:{direction:"rtl"},[`&${n}`]:{display:"inline-block",[`${r}-btn:not(:disabled):not(${r}-btn-disabled):hover`]:{background:e.switchUncheckedHoverBg,borderColor:e.colorBorder,color:e.colorText},[`&${n}-checked`]:{[`${r}-btn:not(:disabled):not(${r}-btn-disabled):hover`]:{background:e.switchCheckedHoverBg,borderColor:e.colorPrimary,color:e.colorPrimaryText},[`${n}-content`]:{background:e.switchCheckedBg}}}}}},Co=e=>{const{componentCls:t,paddingSM:r,paddingXS:n,paddingXXS:s,lineWidth:o,calc:l}=e;return{[t]:{[`&${t}-main`]:{position:"relative",width:"100%",boxSizing:"border-box",boxShadow:`${e.boxShadowTertiary}`,borderRadius:{_skip_check_:!0,value:l(e.borderRadius).mul(2).equal()},borderColor:e.colorBorderInput,borderWidth:o,borderStyle:"solid"},[`&${t}-disabled`]:{background:e.colorBgContainerDisabled},[`&${t}-rtl`]:{direction:"rtl"},[`${t}-content`]:{display:"flex",gap:n,width:"100%",paddingBlock:r,paddingInlineStart:r,paddingInlineEnd:r,boxSizing:"border-box",alignItems:"flex-end"},[`${t}-prefix`]:{flex:"none"},[`${t}-input`]:{paddingInline:0,borderRadius:0,flex:"auto",alignSelf:"center",caretColor:e.colorPrimary,fontSize:e.fontSize},[`${t}-actions-list`]:{flex:"none",display:"flex","&-presets":{gap:e.paddingXS}},[`${t}-actions-btn`]:{"&-disabled":{background:e.colorPrimary,opacity:.45,color:e.colorTextLightSolid},"&-loading-button":{padding:0,border:0},"&-loading-icon":{height:e.controlHeight,width:e.controlHeight,verticalAlign:"top"},"&-recording-icon":{height:"1.2em",width:"1.2em",verticalAlign:"top"}},[`${t}-footer`]:{paddingInlineStart:r,paddingInlineEnd:r,paddingBlockEnd:r,paddingBlockStart:s,boxSizing:"border-box"}}}},$o=e=>{const{colorPrimary:t,colorFillTertiary:r}=e,n=new be(t).setA(.06).toRgbString(),s=new be(t).setA(.08).toRgbString(),o=new be(t).setA(.15).toRgbString(),l=t,a=new be(t).setA(.25).toRgbString(),c=new be(t).setA(.1).toRgbString(),u=n,d=new be(t).setA(.08).toRgbString(),m=new be(r).setA(.04).toRgbString(),g=new be(t).setA(.1).toRgbString(),f=new be(r).setA(.1).toRgbString(),y=`0 4px 12px 0 ${new be(t).setA(.1).toRgbString()}`;return{colorBgSlot:n,colorBgSkill:s,colorBgSkillHover:o,colorTextSlot:l,colorTextSlotPlaceholder:a,colorBorderSlotHover:c,colorBorderSlot:u,switchCheckedBg:d,switchCheckedHoverBg:g,switchUncheckedHoverBg:m,colorBorderInput:f,boxShadowInput:y}},_n=Ue("Sender",e=>{const{paddingXS:t,calc:r}=e,n=Ve(e,{SenderContentMaxWidth:`calc(100% - ${se(r(t).add(32).equal())})`});return[Co(n),yo(n),So(n),bo(n)]},$o),xo=p.forwardRef((e,t)=>{const{children:r,className:n,classNames:s={},styles:o={},icon:l,style:a,onChange:c,rootClassName:u,loading:d,defaultValue:m,value:g,checkedChildren:f,unCheckedChildren:y,disabled:b,prefixCls:C,...$}=e,{styles:v={},classNames:E={},prefixCls:H}=p.useContext(vt),j=we($,{attr:!0,aria:!0,data:!0}),W=p.useId(),{direction:U,getPrefixCls:N}=fe(),A=N("sender",C||H),P=`${A}-switch`,[I,T]=_n(A),G=p.useRef(null);ot(t,()=>({nativeElement:G.current}));const[V,K]=zt(m,{value:g,onChange:J=>{c==null||c(J)}}),D=Ne("sender"),F=M(A,P,n,u,D.classNames.switch,E.switch,s.root,I,T,{[`${P}-checked`]:V,[`${P}-rtl`]:U==="rtl"});return p.createElement("div",re({ref:G,className:F,key:W,style:{...a,...D.styles.switch,...v.switch,...o.root}},j),p.createElement(We,{disabled:b,loading:d,className:M(`${P}-content`,s.content),style:o.content,styles:{icon:o.icon,content:o.title},classNames:{icon:s.icon,content:s.title},variant:"outlined",color:V?"primary":"default",icon:l,onClick:()=>{K(!V)}},V?f:y,r))}),zn=({removeSkill:e,prefixCls:t,toolTip:r,closable:n,title:s,value:o})=>{const l=`${t}-skill`,a=p.useMemo(()=>{if(!n)return[null];const d=typeof n=="boolean"?{}:n,m=y=>{var b;d.disabled||(y.stopPropagation(),e(),(b=d.onClose)==null||b.call(d,y))},g=d.closeIcon||i.createElement(Sn,{className:`${l}-close-icon`});return i.createElement("div",{className:M(`${l}-close`,{[`${l}-close-disabled`]:d.disabled}),onClick:m,role:"button","aria-label":"Close skill",tabIndex:0},g)},[n,e]),c=s||o,u=r?i.createElement(qe,r,c):c;return i.createElement("div",{className:`${l}-wrapper`,contentEditable:!1},i.createElement("div",{className:`${l}-tag`,contentEditable:!1,role:"button",tabIndex:0},i.createElement("span",{className:`${l}-tag-text`},u),a),i.createElement("div",{className:`${l}-holder`}))};zn.displayName="Skill";const on=4.35,vo=(e,t,r)=>{const{token:n}=Ur(),s=r.current?window.getComputedStyle(r.current):{},o=parseFloat(`${e.lineHeight||n.lineHeight}`),l=parseFloat(`${(s==null?void 0:s.fontSize)||e.fontSize||n.fontSize}`),a=s!=null&&s.lineHeight?parseFloat(`${s==null?void 0:s.lineHeight}`):o*l;return t===!1||!t?{}:t===!0?{height:"auto"}:{minHeight:t.minRows?(a+on)*t.minRows:"auto",maxHeight:t.maxRows?(a+on)*t.maxRows:"auto",overflowY:"auto"}},Eo=(e,t)=>e==null?void 0:e.reduce((r,n)=>{var s,o,l;return n.key&&(n.type==="input"||n.type==="select"||n.type==="custom"||n.type==="content"?r[n.key]=((s=n.props)==null?void 0:s.defaultValue)||"":n.type==="tag"&&(r[n.key]=((o=n.props)==null?void 0:o.value)||((l=n.props)==null?void 0:l.label)||""),t.current.set(n.key,n)),r},{});function Ro(e){const[t,r]=p.useState({}),n=p.useRef(t),s=p.useRef(new Map);p.useEffect(()=>{if(!e)return;const c=Eo(e,s);r(c),n.current=c},[e]);const o=p.useCallback(c=>{const u=typeof c=="function"?c(n.current):c;n.current=u,r(u)},[]),l=p.useCallback(c=>{c.forEach(u=>{u.key&&s.current.set(u.key,u)})},[]),a=p.useCallback(()=>n.current,[]);return[s.current,a,o,l]}const wo=i.forwardRef((e,t)=>{var qt;const{onChange:r,onKeyUp:n,onKeyDown:s,onPaste:o,onPasteFile:l,disabled:a,readOnly:c,submitType:u="enter",prefixCls:d,styles:m={},classNames:g={},autoSize:f,triggerSend:y,placeholder:b,onFocus:C,onBlur:$,slotConfig:v,skill:E,submitDisabled:H,...j}=i.useContext(vt),{direction:W,getPrefixCls:U}=fe(),N=`${U("sender",d)}`,A=Ne("sender"),P=`${N}-input`,I=p.useRef(null),T=p.useRef(new Map),G=p.useRef(!1),V=p.useRef(!1),K=p.useRef(null),D=p.useRef(null),F=p.useRef(null),J=p.useRef(!1),_={...(qt=A.styles)==null?void 0:qt.input,...m.input},z=vo(_,f,I),q={...we(j,{attr:!0,aria:!0,data:!0}),ref:I},[O,oe,Q,x]=Ro(v),[ne,ee]=p.useState(new Map),[Y,ae]=p.useState(null),le=h=>{const S=Ie();D.current&&(!(S!=null&&S.value)&&S.slotConfig.length===0?(D.current.setAttribute("contenteditable","true"),D.current.classList.add(`${N}-skill-empty`)):(D.current.setAttribute("contenteditable","false"),D.current.classList.remove(`${N}-skill-empty`))),r==null||r(S.value,h,S.slotConfig,S.skill)},Se=h=>{const S=document.createElement("span");return S.setAttribute("contenteditable","false"),S.dataset.slotKey=h,S.className=`${N}-slot`,S},he=h=>{const S=document.createElement("span");return S.setAttribute("contenteditable","false"),S.dataset.skillKey=h,S.dataset.placeholder=b,S.className=`${N}-skill`,S},Pe=h=>{const S=document.createElement("span");return S.setAttribute("contenteditable","true"),S.dataset.slotKey=h.key,S.className=M(`${N}-slot`,`${N}-slot-content`),S},Ce=(h,S)=>{const R=document.createElement("span");return R.setAttribute("contenteditable","false"),R.dataset.slotKey=h,R.dataset.nodeType="nbsp",R.className=M(`${N}-slot-${S}`,`${N}-slot-no-width`),R.innerHTML="&nbsp;",R},ue=(h,S)=>{T.current.set(h,S)},De=h=>T.current.get(h),Ye=(h,S,R)=>{const w=De(h),B=O.get(h);if(Q(te=>({...te,[h]:S})),w&&B){const te=Oe(B,w);ee(Z=>{const de=new Map(Z);return de.set(h,te),de}),le(R)}},Oe=(h,S)=>{if(!h.key)return null;const R=oe()[h.key],w=()=>{var B,te,Z,de,k,me,$e,ye,He;switch(h.type){case"content":return S.innerHTML=R||"",S.setAttribute("data-placeholder",((B=h.props)==null?void 0:B.placeholder)||""),null;case"input":return i.createElement(Cn,{readOnly:c,className:`${N}-slot-input`,placeholder:((te=h.props)==null?void 0:te.placeholder)||"","data-slot-input":h.key,size:"small",variant:"borderless",value:R||"",tabIndex:0,onKeyDown:Te,onChange:pe=>{Ye(h.key,pe.target.value,pe)},spellCheck:!1});case"select":return i.createElement(kt,{disabled:c,menu:{items:(de=(Z=h.props)==null?void 0:Z.options)==null?void 0:de.map(pe=>({label:pe,key:pe})),defaultSelectedKeys:(k=h.props)!=null&&k.defaultValue?[h.props.defaultValue]:[],selectable:!0,onSelect:({key:pe,domEvent:Me})=>{Ye(h.key,pe,Me)}},trigger:["click"]},i.createElement("span",{className:M(`${N}-slot-select`,{placeholder:!R,[`${N}-slot-select-selector-value`]:R})},i.createElement("span",{"data-placeholder":(me=h.props)==null?void 0:me.placeholder,className:`${N}-slot-select-value`},R||""),i.createElement("span",{className:`${N}-slot-select-arrow`},i.createElement(Er,null))));case"tag":return i.createElement("div",{className:`${N}-slot-tag`},(($e=h.props)==null?void 0:$e.label)||((ye=h.props)==null?void 0:ye.value)||"");case"custom":return(He=h.customRender)==null?void 0:He.call(h,R,pe=>{Ye(h.key,pe)},{disabled:a,readOnly:c},h);default:return null}};return Vt.createPortal(w(),S)},at=h=>h.reduce((S,R)=>{if(R.type==="text")return S.push(document.createTextNode(R.value||"")),S;const w=R.key;if(w){let B,te;if(R.type==="content"?(te=Pe(R),B=[Ce(w,"before"),te,Ce(w,"after")]):(te=Se(w),B=[te]),ue(w,te),te){const Z=Oe(R,te);Z&&(ee(de=>{const k=new Map(de);return k.set(w,Z),k}),S.push(...B))}}return S},[]),Le=h=>{if(h.nodeType===Node.TEXT_NODE)return h.textContent||"";if(h.nodeType!==Node.ELEMENT_NODE)return"";const S=h,{dataset:R}=S;if(R.slotKey){if(R.nodeType==="nbsp")return" ";const w=O.get(R.slotKey);if(!w)return"";if(w.type==="content")return S.innerText||"";const B=oe()[R.slotKey]??"";return w.formatResult?w.formatResult(B):B}if(R.skillKey){const w=S.querySelector(`.${N}-skill-wrapper`),B=S.innerText||"";if(!w)return B;const te=w.innerText||"";return B.replace(te,"").replace(/\n/g,"")}return""},Ie=()=>{var w;const h=[],S=[];let R;if((w=I.current)==null||w.childNodes.forEach(B=>{const te=Le(B);if(h.push(te),B.nodeType===Node.TEXT_NODE)S.push({type:"text",value:te});else if(B.nodeType===Node.ELEMENT_NODE){const Z=B,de=Z.getAttribute("data-slot-key"),k=Z.getAttribute("data-node-type");if(Z.getAttribute("data-skill-key")&&E&&(R=E),de&&k!=="nbsp"){const $e=O.get(de);$e&&S.push({...$e,value:te})}}}),!h.length){const B=I.current;B&&(B.innerHTML="")}return R||(D.current=null),{value:h.join(""),slotConfig:S,skill:R}},lt=()=>{var S;const h=I.current;h&&(h.innerHTML="",D.current=null,F.current=null,(S=T==null?void 0:T.current)==null||S.clear())},ct=h=>{var de,k,me;if(h==="start")return{type:"start"};if(h==="end")return{type:"end"};const S=(de=window==null?void 0:window.getSelection)==null?void 0:de.call(window);if(!S)return{type:"end"};const R=S.rangeCount>0?S.getRangeAt(0):null,w=K.current||R;if(!w)return{type:"end"};const B=I.current;if(!B)return{type:"end"};const te=w.endContainer;return(k=te==null?void 0:te.className)!=null&&k.includes(`${N}-skill`)||(me=te==null?void 0:te.className)!=null&&me.includes(`${N}-slot`)?{type:"slot",range:w}:w.endContainer===B||w.endContainer.parentElement===B?{type:"box",range:w}:{type:"end"}},ut=h=>{h.forEach(S=>{var R;(R=I.current)==null||R.appendChild(S)})},dt=(h,S)=>{const R=I.current;R&&(R.querySelectorAll(`[data-slot-key="${h}"]`).forEach(w=>{w.remove()}),T.current.delete(h),Q(w=>{const{[h]:B,...te}=w;return te}),ee(w=>{const B=new Map(w);return B.delete(h),B}),le(S))},Ze=()=>{if(E&&F.current!==E){Je(!1),F.current=E;const h=he(E.value),S=Vt.createPortal(i.createElement(zn,re({removeSkill:Je},E,{prefixCls:N})),h);ae(S);const R=document.createRange(),w=I.current;if(!w)return;R.setStart(w,0),R.insertNode(h),D.current=h,le()}},Je=(h=!0)=>{var R;!I.current||!D.current||((R=D.current)==null||R.remove(),D.current=null,F.current=null,h&&le())},Et=h=>{u!=="enter"||!h||h.querySelectorAll("br").forEach(S=>{S.remove()})},Rt=h=>{const S=I.current;if(!S)return;const w=(()=>{var B,te;if(h){const Z=De(h);return(Z==null?void 0:Z.querySelector("input"))||null}for(const Z of Array.from(S.childNodes)){const de=((B=Z==null?void 0:Z.getAttribute)==null?void 0:B.call(Z,"data-slot-key"))||"",k=((te=Z==null?void 0:Z.getAttribute)==null?void 0:te.call(Z,"data-node-type"))||"",me=O.get(de);if(Z.nodeType===Node.ELEMENT_NODE){if((me==null?void 0:me.type)==="input")return Z.querySelector("input");if((me==null?void 0:me.type)==="content"&&k!=="nbsp")return Z}}return null})();if(w&&w.nodeName==="INPUT"){w.focus();return}w&&(S.focus(),Ot(w,0))},ie=()=>{v&&v.length>0&&I.current&&(lt(),ut(at(v)))},ge=()=>{G.current=!0},Ee=()=>{G.current=!1,V.current=!1},Te=h=>{var me,$e,ye,He,pe,Me,Nt,Wt,gt,jt;const{key:S,target:R,shiftKey:w,ctrlKey:B,altKey:te,metaKey:Z}=h,de=s==null?void 0:s(h);if(V.current||G.current||de===!1){s==null||s(h);return}const k=window.getSelection();if(S==="Backspace"&&R===I.current){if((k==null?void 0:k.focusOffset)===1&&((ye=($e=(me=k.anchorNode)==null?void 0:me.parentNode)==null?void 0:$e.getAttribute)==null?void 0:ye.call($e,"data-slot-key"))&&(He=k.anchorNode)!=null&&He.parentNode){h.preventDefault(),k.anchorNode.parentNode.innerHTML="";return}if((k==null?void 0:k.focusOffset)===0){const Fe=(Nt=(Me=(pe=k.anchorNode)==null?void 0:pe.previousSibling)==null?void 0:Me.getAttribute)==null?void 0:Nt.call(Me,"data-slot-key");if(Fe){h.preventDefault(),dt(Fe,h);return}if((jt=(gt=(Wt=k.anchorNode)==null?void 0:Wt.previousSibling)==null?void 0:gt.getAttribute)==null?void 0:jt.call(gt,"data-skill-key")){h.preventDefault(),Je();return}}}if(S==="Enter"){const Fe=B||te||Z;if(u==="enter"&&!w&&!Fe||u==="shiftEnter"&&w&&!Fe){h.preventDefault(),J.current||(V.current=!0,y==null||y());return}}D.current&&(k!=null&&k.anchorNode)&&D.current.contains(k.anchorNode)&&(D.current.setAttribute("contenteditable","false"),D.current.classList.remove(`${N}-skill-empty`),Kt({cursor:"end"}))},mt=h=>{const S=window.getSelection();if(S){const R=document.createRange();R.selectNodeContents(I.current),R.collapse(!0),S.removeAllRanges(),S.addRange(R)}C==null||C(h)},ft=h=>{var w;V.current&&(V.current=!1);const S=window.getSelection();S&&(K.current=S.rangeCount?(w=S==null?void 0:S.getRangeAt)==null?void 0:w.call(S,0):null);const R=setTimeout(()=>{K.current=null,clearTimeout(R)},200);$==null||$(h)},wt=h=>{Et(I==null?void 0:I.current),le(h)},Fn=h=>{var w,B;h.preventDefault();const S=(w=h.clipboardData)==null?void 0:w.files,R=(B=h.clipboardData)==null?void 0:B.getData("text/plain");if(!R&&(S!=null&&S.length)&&l){l(S);return}R&&Ft([{type:"text",value:R.replace(/\n/g,"")}]),o==null||o(h)},Kn=h=>{h.key==="Enter"&&(V.current=!1),n==null||n(h)},Ot=(h,S)=>{const R=document.createRange();R.setStart(h,S),R.setEnd(h,S);const w=window.getSelection();w&&(w.removeAllRanges(),R.collapse(!1),w.addRange(R))},qn=()=>{const h=I.current,S=window.getSelection();h&&(S==null?void 0:S.focusNode)===h&&S.focusOffset===0&&Ie().skill&&Ot(h,1)},Ft=(h,S="cursor",R)=>{var $e;const w=I.current,B=window.getSelection();if(!w||!B)return;const te=at(h),{type:Z,range:de}=ct(S);let k=document.createRange();if(Q(ye=>({...ye,...h})),x(h),Z==="end"){B.removeAllRanges(),B.addRange(k);const ye=w.childNodes[w.childNodes.length-1];ye.nodeType===Node.TEXT_NODE&&ye.textContent===`
`?k.setStart(w,w.childNodes.length-1):k.setStart(w,w.childNodes.length)}if(Z==="start"&&k.setStart(w,Ie().skill?1:0),Z==="box"&&(k=de),Z==="slot"&&(k=($e=B==null?void 0:B.getRangeAt)==null?void 0:$e.call(B,0),B.focusNode&&k.setStartAfter(B.focusNode)),R!=null&&R.length){const ye=k.startOffset,He=k.startContainer,pe=k.cloneRange();pe.selectNodeContents(w),pe.setEnd(k.endContainer,k.endOffset),pe.setStart(w,0);const Me=pe.toString();Me.length>=R.length&&Me.endsWith(R)&&(k.setStart(He,ye-R.length),k.setEnd(He,ye),k.deleteContents())}B.deleteFromDocument(),te.forEach(ye=>{k.insertNode(ye),k.setStartAfter(ye),k=k.cloneRange()}),w.focus(),k.collapse(!1),B.removeAllRanges(),B.addRange(k);const me=setTimeout(()=>{wt(null),clearTimeout(me)},0)},Kt=h=>{const S=I.current;if(!S||(S.focus({preventScroll:(h==null?void 0:h.preventScroll)||!1}),!(h!=null&&h.cursor)))return;if((h==null?void 0:h.cursor)==="slot")return Rt(h==null?void 0:h.key);const R=window.getSelection();if(!R)return;const w=document.createRange();switch(w.selectNodeContents(S),h.cursor){case"start":w.collapse(!0);break;case"all":break;default:w.collapse(!1);break}R.removeAllRanges(),R.addRange(w)},Wn=()=>{var S;const h=I.current;h&&(h.innerHTML="",F.current=null,D.current=null,O.clear(),Ze(),Q({}),(S=T==null?void 0:T.current)==null||S.clear(),wt(null))};return p.useEffect(()=>{J.current=H??!1},[H]),p.useEffect(()=>{ie(),E?Ze():le()},[v]),p.useEffect(()=>{Ze()},[E]),p.useImperativeHandle(t,()=>({nativeElement:I.current,focus:Kt,blur:()=>{var h;(h=I.current)==null||h.blur()},insert:Ft,clear:Wn,getValue:Ie})),i.createElement(i.Fragment,null,i.createElement("div",re({},q,{role:"textbox",tabIndex:0,style:{..._,...z},className:M(P,`${P}-slot`,A.classNames.input,g.input,{[`${N}-rtl`]:W==="rtl"}),"data-placeholder":b,contentEditable:!c,suppressContentEditableWarning:!0,spellCheck:!1,onKeyDown:Te,onKeyUp:Kn,onPaste:Fn,onCompositionStart:ge,onCompositionEnd:Ee,onFocus:mt,onBlur:ft,onSelect:qn,onInput:wt},j)),i.createElement("div",{style:{display:"none"},id:`${N}-slot-placeholders`},Array.from(ne.values()),Y))});function No(e,t,r){return Rr(e,t)||r}const To=i.forwardRef((e,t)=>{const{value:r,onChange:n,onKeyUp:s,onKeyDown:o,onPaste:l,onPasteFile:a,disabled:c,readOnly:u,submitType:d="enter",prefixCls:m,styles:g={},classNames:f={},autoSize:y,components:b,submitDisabled:C,triggerSend:$,placeholder:v,onFocus:E,onBlur:H,...j}=i.useContext(vt),W=i.useRef(null),U=(_,z="cursor")=>{var Q,x;const X=(x=(Q=W.current)==null?void 0:Q.resizableTextArea)==null?void 0:x.textArea,q=X.value;let O=q.length,oe=q.length;z==="cursor"&&(O=X==null?void 0:X.selectionStart,oe=X==null?void 0:X.selectionEnd),z==="start"&&(O=0,oe=0),X.value=q.substring(0,O)+_+q.substring(oe,q.length),X.selectionStart=O+_.length,X.selectionEnd=O+_.length,X.focus(),n==null||n(X.value)},N=()=>{n==null||n("")},A=()=>({value:r||"",slotConfig:[]});i.useImperativeHandle(t,()=>{var _,z,X,q;return{nativeElement:(z=(_=W.current)==null?void 0:_.resizableTextArea)==null?void 0:z.textArea,focus:(X=W.current)==null?void 0:X.focus,blur:(q=W.current)==null?void 0:q.blur,insert:U,clear:N,getValue:A}});const P=i.useRef(!1),I=()=>{P.current=!0},T=()=>{P.current=!1},G=_=>{const z=o==null?void 0:o(_),{key:X,shiftKey:q,ctrlKey:O,altKey:oe,metaKey:Q}=_;if(!(P.current||X!=="Enter"||z===!1)&&X==="Enter"){const x=O||oe||Q;if(d==="enter"&&!q&&!x||d==="shiftEnter"&&q&&!x){_.preventDefault(),C||$==null||$();return}}},V=_=>{var q,O;const z=(q=_.clipboardData)==null?void 0:q.files;!((O=_.clipboardData)==null?void 0:O.getData("text/plain"))&&(z!=null&&z.length)&&a&&(a(z),_.preventDefault()),l==null||l(_)},K=No(b,["input"],Cn.TextArea),F={...we(j,{attr:!0,aria:!0,data:!0}),ref:W},J=_=>{n==null||n(_.target.value,_)};return i.createElement(K,re({},F,{disabled:c,style:g.input,className:M(`${m}-input`,f.input),autoSize:y,value:r,onChange:J,onKeyUp:s,onCompositionStart:I,onCompositionEnd:T,onKeyDown:G,onPaste:V,variant:"borderless",readOnly:u,placeholder:v,onFocus:E,onBlur:H}))}),yt={SendButton:Bn,ClearButton:co,LoadingButton:Hn,SpeechButton:Ln},Io=i.forwardRef((e,t)=>{const{prefixCls:r,styles:n={},classNames:s={},className:o,rootClassName:l,style:a,defaultValue:c,value:u,slotConfig:d,readOnly:m,submitType:g="enter",onSubmit:f,loading:y,components:b,onCancel:C,onChange:$,suffix:v,onKeyUp:E,onKeyDown:H,disabled:j,allowSpeech:W,prefix:U,footer:N,header:A,onPaste:P,onPasteFile:I,autoSize:T={maxRows:8},placeholder:G,onFocus:V,onBlur:K,skill:D,...F}=e,J=we(F,{attr:!0,aria:!0,data:!0}),_=i.useId(),z=Array.isArray(d)||(D==null?void 0:D.value),{direction:X,getPrefixCls:q}=fe(),O=q("sender",r),oe=i.useRef(null),Q=i.useRef(null);ot(t,()=>{var ie,ge,Ee,Te,mt,ft;return{nativeElement:oe.current,inputElement:(ie=Q.current)==null?void 0:ie.nativeElement,focus:(ge=Q.current)==null?void 0:ge.focus,blur:(Ee=Q.current)==null?void 0:Ee.blur,insert:(Te=Q.current)==null?void 0:Te.insert,clear:(mt=Q.current)==null?void 0:mt.clear,getValue:(ft=Q.current)==null?void 0:ft.getValue}});const x=Ne("sender"),ne=`${O}-input`,[ee,Y]=_n(O),ae=M(O,x.className,o,l,x.classNames.root,s.root,ee,Y,`${O}-main`,{[`${O}-rtl`]:X==="rtl",[`${O}-disabled`]:j}),le=`${O}-actions-btn`,Se=`${O}-actions-list`,[he,Pe]=bn(c||"",{value:u}),Ce=(ie,ge,Ee,Te)=>{Pe(ie),$==null||$(ie,ge,Ee??[],Te)},[ue,De,Ye]=po(ie=>{var ge,Ee;z?(Ee=(ge=Q.current)==null?void 0:ge.insert)==null||Ee.call(ge,[{type:"text",value:ie}]):Ce(`${he} ${ie}`)},W),Oe=()=>{if(Q!=null&&Q.current&&f&&!y){const ie=Q.current.getValue();f(ie.value,ie.slotConfig,ie.skill)}},at=()=>{var ie,ge;Ce(""),z&&((ge=(ie=Q.current)==null?void 0:ie.clear)==null||ge.call(ie))},Le=i.createElement(pn,{className:`${Se}-presets`},W&&i.createElement(Ln,null),y?i.createElement(Hn,null):i.createElement(Bn,null));let Ie=Le;typeof v=="function"?Ie=v(Le,{components:yt}):(v||v===!1)&&(Ie=v);const lt=typeof U=="function"?U(Le,{components:yt}):U||null,ct=typeof A=="function"?A(Le,{components:yt}):A||null,ut=typeof N=="function"?N(Le,{components:yt}):N||null,[dt,Ze]=p.useState(!he),Je={prefixCls:le,onSend:Oe,onSendDisabled:!he,onClear:at,onClearDisabled:!he,onCancel:C,onCancelDisabled:!y,onSpeech:()=>De(!1),onSpeechDisabled:!ue,speechRecording:Ye,disabled:j,setSubmitDisabled:Ze},Et=i.useMemo(()=>({value:he,onChange:Ce,slotConfig:d,onKeyUp:E,onKeyDown:H,onPaste:P,onPasteFile:I,disabled:j,readOnly:m,submitType:g,prefixCls:O,styles:n,classNames:s,autoSize:T,components:b,triggerSend:Oe,placeholder:G,onFocus:V,onBlur:K,skill:D,submitDisabled:dt,...F}),[he,Ce,d,E,H,P,I,j,m,g,O,n,s,T,b,Oe,G,V,K,D,dt,F]),Rt=ie=>{var ge,Ee,Te;!z&&ie.target!==((ge=oe.current)==null?void 0:ge.querySelector(`.${ne}`))&&ie.preventDefault(),ie.target===((Ee=oe.current)==null?void 0:Ee.querySelector(`.${ne}`))&&((Te=Q.current)==null||Te.focus())};return i.createElement("div",re({key:_,ref:oe,className:ae,style:{...x.style,...a,...x.styles.root,...n.root}},J),i.createElement(vt.Provider,{value:Et},i.createElement($t.Provider,{value:Je},ct&&i.createElement(kn.Provider,{value:{prefixCls:O}},ct),i.createElement("div",{className:M(`${O}-content`,s.content),style:n.content,onMouseDown:Rt},lt&&i.createElement("div",{className:M(`${O}-prefix`,x.classNames.prefix,s.prefix),style:{...x.styles.prefix,...n.prefix}},lt),z?i.createElement(wo,{ref:Q}):i.createElement(To,{ref:Q}),Ie&&i.createElement("div",{className:M(Se,x.classNames.suffix,s.suffix),style:{...x.styles.suffix,...n.suffix}},Ie)),ut&&i.createElement("div",{className:M(`${O}-footer`,x.classNames.footer,s.footer),style:{...x.styles.footer,...n.footer}},ut))))}),Xn=Io;Xn.Header=ho;Xn.Switch=xo;class ii{constructor(t){L(this,"_request");L(this,"_getMessagesFn");L(this,"_originalCallbacks");var n;const r=typeof t.request=="function"?t.request():t.request;if(!r.manual)throw new Error("request must be manual");this._request=r,this._originalCallbacks=(n=this._request.options)==null?void 0:n.callbacks}get request(){return this._request}getMessages(){return this==null?void 0:this._getMessagesFn()}injectGetMessages(t){this._getMessagesFn=t}injectRequest({onUpdate:t,onSuccess:r,onError:n}){var a,c,u;const s=(a=this._originalCallbacks)==null?void 0:a.onUpdate,o=(c=this._originalCallbacks)==null?void 0:c.onSuccess,l=(u=this._originalCallbacks)==null?void 0:u.onError;this._request.options.callbacks={onUpdate:(d,m)=>{t(d,m),s&&s(d,m)},onSuccess:(d,m)=>{r(d,m),o&&o(d,m)},onError:(d,m)=>{n(d,m),l&&l(d,m)}}}}const Be={_chatMessagesStores:new Map,get:e=>Be._chatMessagesStores.get(e),set:(e,t)=>{Be._chatMessagesStores.set(e,t)},delete:e=>{Be._chatMessagesStores.delete(e)},getMessages:e=>{const t=Be._chatMessagesStores.get(e);return t==null?void 0:t.getMessages()}};class Mo{constructor(t,r){L(this,"messages",[]);L(this,"listeners",[]);L(this,"conversationKey");L(this,"throttleTimer",null);L(this,"pendingEmit",!1);L(this,"throttleInterval",50);L(this,"setMessagesInternal",(t,r=!0)=>{let n;return typeof t=="function"?n=t(this.messages):n=t,this.messages=[...n],r?this.throttledEmitListeners():this.emitListeners(),!0});L(this,"setMessages",t=>this.setMessagesInternal(t,!0));L(this,"getMessages",()=>this.messages);L(this,"getMessage",t=>this.messages.find(r=>r.id===t));L(this,"addMessage",t=>this.getMessage(t.id)?!1:(this.setMessages([...this.messages,t]),!0));L(this,"setMessage",(t,r)=>{const n=this.getMessage(t);if(n){const s=typeof r=="function"?r(n):r;return Object.assign(n,s),this.setMessages([...this.messages]),!0}return!1});L(this,"removeMessage",t=>{const r=this.messages.findIndex(n=>n.id===t);return r!==-1?(this.messages.splice(r,1),this.setMessages([...this.messages]),!0):!1});L(this,"getSnapshot",()=>this.messages);L(this,"subscribe",t=>(this.listeners.push(t),()=>{this.listeners=this.listeners.filter(r=>r!==t),this.listeners.length===0&&(this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1)}));L(this,"destroy",()=>{this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1,this.listeners=[]});this.setMessagesInternal(t,!1),r&&(this.conversationKey=r,Be.set(this.conversationKey,this))}emitListeners(){this.listeners.forEach(t=>{t()})}throttledEmitListeners(){this.throttleTimer?this.pendingEmit=!0:(this.emitListeners(),this.pendingEmit=!1,this.throttleTimer=setTimeout(()=>{this.throttleTimer=null,this.pendingEmit&&(this.emitListeners(),this.pendingEmit=!1)},this.throttleInterval))}}function Ao(e,t){const r=()=>{if(Be.get(t))return Be.get(t);const l=typeof e=="function"?e():e;return new Mo(l||[],t)},[n,s]=p.useState(r);return p.useEffect(()=>{s(r())},[t]),{messages:p.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getSnapshot),addMessage:n.addMessage,removeMessage:n.removeMessage,setMessage:n.setMessage,getMessage:n.getMessage,setMessages:n.setMessages,getMessages:n.getMessages}}function Po(e){return Array.isArray(e)?e:[e]}const Ke=new Map,Do=()=>Symbol("ConversationKey");function ai(e){const{defaultMessages:t,requestFallback:r,requestPlaceholder:n,parser:s,provider:o,conversationKey:l}=e,a=i.useRef(0),c=i.useRef(void 0),[u,d]=p.useState(!1),[m,g]=p.useState(l||Do());p.useEffect(()=>{l&&g(l)},[l]);const{messages:f,setMessages:y,getMessages:b,setMessage:C}=Ao(()=>(t||[]).map((N,A)=>({id:`default_${A}`,status:"local",...N})),m),$=(N,A,P)=>{const I={id:`msg_${a.current}`,message:N,status:A};return P&&(I.extraInfo=P),a.current+=1,I},v=i.useMemo(()=>{const N=[];return f.forEach(A=>{const P=s?s(A.message):A.message,I=Po(P);I.forEach((T,G)=>{let V=A.id;I.length>1&&(V=`${V}_${G}`),N.push({id:V,message:T,status:A.status})})}),N},[f]),E=N=>N.filter(A=>A.status!=="loading").map(A=>A.message);o==null||o.injectGetMessages(()=>E(b())),c.current=o==null?void 0:o.request;const H=()=>E(b()),j=(N,A)=>{if(!o)return;const{updatingId:P,reload:I}=A||{};let T=null;const G=o.transformLocalMessage(N),V=(Array.isArray(G)?G:[G]).map(F=>$(F,"local",A==null?void 0:A.extraInfo));I?(T=P,y(F=>{const J=[...F];if(n){let _;typeof n=="function"?_=n(N,{messages:E(J)}):_=n,J.forEach(z=>{z.id===P&&(z.status="loading",z.message=_,A!=null&&A.extraInfo&&(z.extraInfo=A==null?void 0:A.extraInfo))})}return J})):y(F=>{let J=[...F,...V];if(n){let _;typeof n=="function"?_=n(N,{messages:E(J)}):_=n;const z=$(_,"loading");T=z.id,J=[...J,z]}return J});let K=null;const D=(F,J,_,z)=>{let X=b().find(q=>q.id===K);if(X)y(q=>q.map(O=>{if(O.id===K){const oe=o.transformMessage({originMessage:O.message,chunk:J,chunks:_,status:F,responseHeaders:z});return{...O,message:oe,status:F}}return O}));else if(I&&P)X=b().find(q=>q.id===P),X&&(X.status=F,X.message=o.transformMessage({chunk:J,status:F,chunks:_,responseHeaders:z}),y(q=>[...q]),K=X.id);else{const q=o.transformMessage({chunk:J,status:F,chunks:_,responseHeaders:z});X=$(q,F),y(O=>[...O.filter(Q=>Q.id!==T),X]),K=X.id}return X};o.injectRequest({onUpdate:(F,J)=>{D("updating",F,[],J)},onSuccess:(F,J)=>{d(!1),m&&Ke.delete(m),D("success",void 0,F,J)},onError:async(F,J)=>{if(d(!1),m&&Ke.delete(m),r){let _;if(typeof r=="function"){const z=H(),X=b().find(q=>q.id===T||q.id===K);_=await r(N,{error:F,errorInfo:J,messageInfo:X,messages:z})}else _=r;y(z=>[...z.filter(X=>X.id!==T&&X.id!==K),$(_,F.name==="AbortError"?"abort":"error")])}else y(_=>_.map(z=>z.id===T||z.id===K?{...z,status:F.name==="AbortError"?"abort":"error"}:z))}}),d(!0),m&&Ke.set(m,!0),o.request.run(o.transformParams(N,o.request.options))},W=st((N,A)=>{if(!o)throw new Error("provider is required");j(N,A)}),U=(N,A,P)=>{if(!o)throw new Error("provider is required");if(!N||!b().find(I=>I.id===N))throw new Error(`message [${N}] is not found`);j(A,{updatingId:N,reload:!0,extraInfo:P==null?void 0:P.extraInfo})};return{onRequest:W,messages:f,parsedMessages:v,setMessages:y,setMessage:C,abort:()=>{var N;if(!o)throw new Error("provider is required");(N=c.current)==null||N.abort()},isRequesting:m?(Ke==null?void 0:Ke.get(m))||!1:u,onReload:U}}const rt={_allConversationStores:new Map,set:(e,t)=>{rt._allConversationStores.set(e,t)},delete:e=>{rt._allConversationStores.delete(e)},getConversation:e=>{for(const t of rt._allConversationStores.values())if(t){const r=t.getConversation(e);if(r)return r}}};class Ho{constructor(t,r){L(this,"conversations",[]);L(this,"listeners",[]);L(this,"storeKey");L(this,"activeConversationKey");L(this,"setActiveConversationKey",t=>(this.activeConversationKey=t,this.emitListeners(),!0));L(this,"setConversations",t=>(this.conversations=[...t],this.emitListeners(),!0));L(this,"getConversation",t=>this.conversations.find(r=>r.key===t));L(this,"addConversation",(t,r)=>this.getConversation(t.key)?!1:(this.setConversations(r==="prepend"?[t,...this.conversations]:[...this.conversations,t]),!0));L(this,"setConversation",(t,r)=>{const n=this.getConversation(t);return n?(Object.assign(n,r),this.setConversations([...this.conversations]),!0):!1});L(this,"removeConversation",t=>{const r=this.conversations.findIndex(n=>n.key===t);return r!==-1?(this.conversations.splice(r,1),this.setConversations([...this.conversations]),!0):!1});L(this,"getMessages",t=>Be.getMessages(t));L(this,"getSnapshot",()=>this.conversations);L(this,"getActiveConversationKey",()=>this.activeConversationKey);L(this,"subscribe",t=>(this.listeners.push(t),()=>{this.listeners=this.listeners.filter(r=>r!==t)}));L(this,"destroy",()=>{rt.delete(this.storeKey)});this.setConversations(t),this.storeKey=Math.random().toString(),rt.set(this.storeKey,this),this.activeConversationKey=r}emitListeners(){this.listeners.forEach(t=>{t()})}}function li(e){const[t]=p.useState(()=>new Ho((e==null?void 0:e.defaultConversations)||[],(e==null?void 0:e.defaultActiveConversationKey)||""));p.useEffect(()=>()=>{t.destroy()},[]);const r=p.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot),n=p.useSyncExternalStore(t.subscribe,t.getActiveConversationKey,t.getActiveConversationKey);return{conversations:r,activeConversationKey:n,setActiveConversationKey:t.setActiveConversationKey,addConversation:t.addConversation,removeConversation:t.removeConversation,setConversation:t.setConversation,getConversation:t.getConversation,setConversations:t.setConversations,getMessages:t.getMessages}}const Bo=`

`,Lo=`
`,an=":",Ht=e=>(e??"").trim()!=="";function ko(){let e="";return new TransformStream({transform(t,r){e+=t;const n=e.split(Bo);n.slice(0,-1).forEach(s=>{Ht(s)&&r.enqueue(s)}),e=n[n.length-1]},flush(t){Ht(e)&&t.enqueue(e)}})}function _o(){return new TransformStream({transform(e,t){const n=e.split(Lo).reduce((s,o)=>{const l=o.indexOf(an);if(l===-1)throw new Error(`The key-value separator "${an}" is not found in the sse line chunk!`);const a=o.slice(0,l);if(!Ht(a))return s;const c=o.slice(l+1);return{...s,[a]:c}},{});Object.keys(n).length!==0&&t.enqueue(n)}})}function ln(e){const{readableStream:t,transformStream:r}=e;if(!(t instanceof ReadableStream))throw new Error("The options.readableStream must be an instance of ReadableStream.");const n=new TextDecoderStream,s=r?t.pipeThrough(n).pipeThrough(r):t.pipeThrough(n).pipeThrough(ko()).pipeThrough(_o());return s[Symbol.asyncIterator]=async function*(){const o=this.getReader();for(;;){const{done:l,value:a}=await o.read();if(l)break;a&&(yield a)}},s}const zo=async(e,t)=>{const{fetch:r=globalThis.fetch,middlewares:n={},...s}=t;if(typeof r!="function")throw new Error("The options.fetch must be a typeof fetch function!");let o=[e,s];typeof n.onRequest=="function"&&(o=await n.onRequest(...o));let l=await r(...o);if(typeof n.onResponse=="function"){const a=await n.onResponse(l);if(!(a instanceof Response))throw new Error("The options.onResponse must return a Response instance!");l=a}if(!l.ok)throw new Error(`Fetch failed with status ${l.status}`);if(!l.body)throw new Error("The response body is empty.");return l},Xo={headers:{"Content-Type":"application/json"}};class Oo{constructor(t,r){L(this,"baseURL");L(this,"options");if(!t||typeof t!="string")throw new Error("The baseURL is not valid!");this.baseURL=t,this.options=r||{}}}class Fo extends Oo{constructor(r,n){super(r,n);L(this,"_asyncHandler");L(this,"timeoutHandler");L(this,"_isTimeout",!1);L(this,"streamTimeoutHandler");L(this,"_isStreamTimeout",!1);L(this,"abortController");L(this,"_isRequesting",!1);L(this,"_manual",!1);L(this,"customResponseHandler",async(r,n,s,o)=>{const l=ln({readableStream:r.body,transformStream:s});await this.processStream(l,r,n,o)});L(this,"sseResponseHandler",async(r,n,s)=>{const o=ln({readableStream:r.body});await this.processStream(o,r,n,s)});L(this,"jsonResponseHandler",async(r,n)=>{var o,l,a;const s=await r.json();if((s==null?void 0:s.success)===!1){const c=new Error(s.message||"System error");c.name=s.name||"SystemError",(o=n==null?void 0:n.onError)==null||o.call(n,c,s)}else(l=n==null?void 0:n.onUpdate)==null||l.call(n,s,r.headers),this.finishRequest(),(a=n==null?void 0:n.onSuccess)==null||a.call(n,[s],r.headers)});this._manual=(n==null?void 0:n.manual)||!1,this.manual||this.init()}get asyncHandler(){return this._asyncHandler}get isTimeout(){return this._isTimeout}set isTimeout(r){this._isTimeout=r}get isStreamTimeout(){return this._isStreamTimeout}set isStreamTimeout(r){this._isStreamTimeout=r}get isRequesting(){return this._isRequesting}get manual(){return this._manual}run(r){this.manual?this.init(r):console.warn("The request is not manual, so it cannot be run!")}abort(){clearTimeout(this.timeoutHandler),clearTimeout(this.streamTimeoutHandler),this.abortController.abort()}init(r){this.abortController=new AbortController;const{callbacks:n,params:s,headers:o={},transformStream:l,fetch:a,timeout:c,streamTimeout:u,middlewares:d,...m}=this.options,g={...m,method:"POST",body:JSON.stringify({...s,...r||{}}),params:{...s,...r},headers:Object.assign({},Xo.headers||{},o),signal:this.abortController.signal,middlewares:d};c&&c>0&&(this.timeoutHandler=window.setTimeout(()=>{var f;this.isTimeout=!0,this.finishRequest(),(f=n==null?void 0:n.onError)==null||f.call(n,new Error("TimeoutError"))},c)),this.startRequest(),this._asyncHandler=zo(this.baseURL,{fetch:a,...g}).then(async f=>{if(clearTimeout(this.timeoutHandler),this.isTimeout)return;if(l){let C=l;typeof l=="function"&&(C=l(this.baseURL,f.headers)),await this.customResponseHandler(f,n,C,u);return}const y=f.headers.get("content-type")||"";switch(y.split(";")[0].trim()){case"text/event-stream":await this.sseResponseHandler(f,n,u);break;case"application/json":await this.jsonResponseHandler(f,n);break;default:throw new Error(`The response content-type: ${y} is not support!`)}}).catch(f=>{var b;clearTimeout(this.timeoutHandler),this.finishRequest();const y=f instanceof Error||f instanceof DOMException?f:new Error("Unknown error!");(b=n==null?void 0:n.onError)==null||b.call(n,y)})}startRequest(){this._isRequesting=!0}finishRequest(){this._isRequesting=!1}async processStream(r,n,s,o){var u,d;const l=[],a=r[Symbol.asyncIterator]();let c;do if(o&&(this.streamTimeoutHandler=window.setTimeout(()=>{var m;this.isStreamTimeout=!0,this.finishRequest(),(m=s==null?void 0:s.onError)==null||m.call(s,new Error("StreamTimeoutError"))},o)),c=await a.next(),l.push(c.value),(u=s==null?void 0:s.onUpdate)==null||u.call(s,c.value,n.headers),clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)break;while(!c.done);if(o&&(clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)){this.finishRequest();return}this.finishRequest(),(d=s==null?void 0:s.onSuccess)==null||d.call(s,l,n.headers)}}function ci(e,t){return new Fo(e,t)}const _e={escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeTest:/[&<>"']/,notSpaceStart:/^\S*/,endingNewline:/\n$/,escapeReplace:/[&<>"']/g,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,completeFencedCode:/^ {0,3}(`{3,}|~{3,})([\s\S]*?)\n {0,3}\1[ \n\t]*$/},Ko={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},cn=e=>Ko[e];function un(e,t){if(t){if(_e.escapeTest.test(e))return e.replace(_e.escapeReplace,cn)}else if(_e.escapeTestNoEncode.test(e))return e.replace(_e.escapeReplaceNoEncode,cn);return e}class qo{constructor(t={}){L(this,"options");L(this,"markdownInstance");const{markedConfig:r={}}=t;this.options=t,this.markdownInstance=new wr,this.configureLinkRenderer(),this.configureParagraphRenderer(),this.configureCodeRenderer(),this.markdownInstance.use(r)}configureLinkRenderer(){if(!this.options.openLinksInNewTab)return;const t={link({href:r,title:n,tokens:s}){const o=this.parser.parseInline(s),l=n?` title="${n}"`:"";return`<a href="${r}"${l} target="_blank" rel="noopener noreferrer">${o}</a>`}};this.markdownInstance.use({renderer:t})}configureParagraphRenderer(){const{paragraphTag:t}=this.options;if(!t)return;const r={paragraph({tokens:n}){return`<${t}>${this.parser.parseInline(n)}</${t}>
`}};this.markdownInstance.use({renderer:r})}configureCodeRenderer(){const t={code({text:r,raw:n,lang:s,escaped:o,codeBlockStyle:l}){var f;const a=(f=(s||"").match(_e.notSpaceStart))==null?void 0:f[0],c=`${r.replace(_e.endingNewline,"")}
`,d=l==="indented"||_e.completeFencedCode.test(n)?"done":"loading",m=o?c:un(c,!0),g=a?` class="language-${un(a)}"`:"";return`<pre><code data-block="true" data-state="${d}"${g}>${m}</code></pre>
`}};this.markdownInstance.use({renderer:t})}parse(t){return this.markdownInstance.parse(t)}}const Wo=i.memo(e=>{const{text:t,animationConfig:r}=e,{fadeDuration:n=200,easing:s="ease-in-out"}=r||{},[o,l]=p.useState([]),a=p.useRef("");p.useEffect(()=>{if(t===a.current)return;if(!(a.current&&t.indexOf(a.current)===0)){l([t]),a.current=t;return}const u=t.slice(a.current.length);u&&(l(d=>[...d,u]),a.current=t)},[t]);const c=p.useMemo(()=>({animation:`x-markdown-fade-in ${n}ms ${s} forwards`}),[n,s]);return i.createElement(i.Fragment,null,o.map((u,d)=>i.createElement("span",{style:c,key:`animation-text-${d}`},u)))}),St=class St{constructor(t){L(this,"options");this.options=t}detectUnclosedTags(t){var l;const r=new Set,n=[],s=/<\/?([a-zA-Z][a-zA-Z0-9-]*)(?:\s[^>]*)?>/g;let o=s.exec(t);for(;o!==null;){const[a,c]=o,u=a.startsWith("</"),d=a.endsWith("/>");if((l=this.options.components)!=null&&l[c.toLowerCase()])if(u){const m=n.lastIndexOf(c.toLowerCase());m!==-1&&n.splice(m,1)}else d||n.push(c.toLowerCase());o=s.exec(t)}return n.forEach(a=>{r.add(a)}),r}configureDOMPurify(){const t=Object.keys(this.options.components||{}),r=this.options.dompurifyConfig||{},n=Array.isArray(r.ADD_TAGS)?r.ADD_TAGS:[],s=Array.isArray(r.ADD_ATTR)?r.ADD_ATTR:[];return{...r,ADD_TAGS:Array.from(new Set([...t,...n])),ADD_ATTR:Array.from(new Set(["target","rel",...s]))}}createReplaceElement(t,r){const{enableAnimation:n,animationConfig:s}=this.options.streaming||{};return o=>{var b,C,$;const l=`x-markdown-component-${r.current++}`,a=o.type==="text"&&o.data&&St.NON_WHITESPACE_REGEX.test(o.data),c=(b=o.parent)==null?void 0:b.name,u=c&&((C=this.options.components)==null?void 0:C[c]);if(n&&a&&!u)return i.createElement(Wo,{text:o.data,key:l,animationConfig:s});if(!("name"in o))return;const{name:m,attribs:g,children:f}=o,y=($=this.options.components)==null?void 0:$[m];if(y){const v=t!=null&&t.has(m)?"loading":"done",E={domNode:o,streamStatus:v,key:l,...g,...g.disabled!==void 0&&{disabled:!0},...g.checked!==void 0&&{checked:!0}},H=[E.className,E.classname,E.class].filter(Boolean).join(" ").trim();if(E.className=H||"",m==="code"){const{"data-block":j="false","data-state":W="done"}=g||{};E.block=j==="true",E.streamStatus=W==="loading"?"loading":"done"}return f&&(E.children=this.processChildren(f,t,r)),i.createElement(y,E)}}}processChildren(t,r,n){return Nr.domToReact(t,{replace:this.createReplaceElement(r,n)})}processHtml(t){const r=this.detectUnclosedTags(t),n={current:0},s=this.configureDOMPurify(),o=Tr.sanitize(t,s);return Ir(o,{replace:this.createReplaceElement(r,n)})}render(t){return this.processHtml(t)}};L(St,"NON_WHITESPACE_REGEX",/[^\r\n\s]+/);let Bt=St,ce=function(e){return e.Text="text",e.Link="link",e.Image="image",e.Html="html",e.Emphasis="emphasis",e.List="list",e.Table="table",e}({});const jo=/^(`{3,}|~{3,})/,tt={image:[/^!\[[^\]\r\n]{0,1000}$/,/^!\[[^\r\n]{0,1000}\]\(*[^)\r\n]{0,1000}$/],link:[/^\[[^\]\r\n]{0,1000}$/,/^\[[^\r\n]{0,1000}\]\(*[^)\r\n]{0,1000}$/],html:[/^<\/$/,/^<\/?[a-zA-Z][a-zA-Z0-9-]{0,100}[^>\r\n]{0,1000}$/],commonEmphasis:[/^(\*{1,3}|_{1,3})(?!\s)(?!.*\1$)[^\r\n]{0,1000}$/],list:[/^[-+*]\s{0,3}$/,/^[-+*]\s{1,3}(\*{1,3}|_{1,3})(?!\s)(?!.*\1$)[^\r\n]{0,1000}$/]},Vo=e=>{if(e.includes(`

`))return!1;const t=e.split(`
`);if(t.length<=1)return!0;const[r,n]=t,s=r.trim();if(!/^\|.*\|$/.test(s))return!1;const l=n.trim().split("|").map(c=>c.trim()).filter(Boolean),a=/^:?-+:?$/;return l.every((c,u)=>u===l.length-1&&c===":"||a.test(c))},On={[ce.Link]:{tokenType:ce.Link,isStartOfToken:e=>e.startsWith("["),isStreamingValid:e=>tt.link.some(t=>t.test(e))},[ce.Image]:{tokenType:ce.Image,isStartOfToken:e=>e.startsWith("!"),isStreamingValid:e=>tt.image.some(t=>t.test(e))},[ce.Html]:{tokenType:ce.Html,isStartOfToken:e=>e.startsWith("<"),isStreamingValid:e=>tt.html.some(t=>t.test(e))},[ce.Emphasis]:{tokenType:ce.Emphasis,isStartOfToken:e=>e.startsWith("*")||e.startsWith("_"),isStreamingValid:e=>tt.commonEmphasis.some(t=>t.test(e))},[ce.List]:{tokenType:ce.List,isStartOfToken:e=>/^[-+*]/.test(e),isStreamingValid:e=>tt.list.some(t=>t.test(e))},[ce.Table]:{tokenType:ce.Table,isStartOfToken:e=>e.startsWith("|"),isStreamingValid:Vo}},Uo=(e,t)=>{const r=On[t];if(!r)return;const{token:n,pending:s}=e;if(n===ce.Text&&r.isStartOfToken(s)){e.token=t;return}n===t&&!r.isStreamingValid(s)&&Lt(e)},dn=Object.values(On).map(e=>({tokenType:e.tokenType,recognize:t=>Uo(t,e.tokenType)})),At=()=>({pending:"",token:ce.Text,processedLength:0,completeMarkdown:""}),Lt=e=>{e.pending&&(e.completeMarkdown+=e.pending,e.pending=""),e.token=ce.Text},Go=e=>{const t=e.split(`
`);let r=!1,n="",s=0;for(const o of t){const a=(o.endsWith("\r")?o.slice(0,-1):o).match(jo);if(a){const c=a[1],u=c[0],d=c.length;r?u===n&&d>=s&&(r=!1,n="",s=0):(r=!0,n=u,s=d)}}return r},Yo=e=>{let t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);n>=55296&&n<=56319?r+1<e.length&&e.charCodeAt(r+1)>=56320&&e.charCodeAt(r+1)<=57343&&(t+=e[r]+e[r+1],r++):(n<56320||n>57343)&&(t+=e[r])}return t},Zo=e=>{try{return encodeURIComponent(e)}catch(t){return t instanceof URIError?encodeURIComponent(Yo(e)):""}},Jo=(e,t)=>{const{streaming:r,components:n={}}=t||{},{hasNextChunk:s=!1,incompleteMarkdownComponentMap:o}=r||{},[l,a]=p.useState(""),c=p.useRef(At()),u=p.useCallback(m=>{const{token:g,pending:f}=m;if(g===ce.Text||g===ce.Image&&f==="!")return;if(g===ce.Table&&f.split(`
`).length>2)return f;const b=(o||{})[g]||`incomplete-${g}`,C=Zo(f);return n!=null&&n[b]?`<${b} data-raw="${C}" />`:void 0},[o,n]),d=p.useCallback(m=>{if(!m){a(""),c.current=At();return}const g=c.current.completeMarkdown+c.current.pending;m.startsWith(g)||(c.current=At());const f=c.current,y=m.slice(f.processedLength);if(!y)return;f.processedLength+=y.length;const b=Go(m);for(const $ of y){if(f.pending+=$,b){Lt(f);continue}if(f.token===ce.Text)for(const v of dn)v.recognize(f);else{const v=dn.find(E=>E.tokenType===f.token);v==null||v.recognize(f)}f.token===ce.Text&&Lt(f)}const C=u(f);a(f.completeMarkdown+(C||""))},[u]);return p.useEffect(()=>{if(typeof e!="string"){console.error(`X-Markdown: input must be string, not ${typeof e}.`),a("");return}s?d(e):a(e)},[e,s,d]),l},ui=i.memo(e=>{const{streaming:t,config:r,components:n,paragraphTag:s,content:o,children:l,rootClassName:a,className:c,style:u,openLinksInNewTab:d,dompurifyConfig:m}=e,g=M("x-markdown",a,c),f=Jo(o||l||"",{streaming:t,components:n}),y=p.useMemo(()=>new qo({markedConfig:r,paragraphTag:s,openLinksInNewTab:d}),[r,s,d]),b=p.useMemo(()=>new Bt({components:n,dompurifyConfig:m,streaming:t}),[n,m,t]),C=p.useMemo(()=>f?y.parse(f):"",[f,y]);return f?i.createElement("div",{className:g,style:u},b.render(C)):null});export{ii as A,no as C,Ge as F,oi as M,Xn as S,ui as X,ai as a,ri as b,ci as c,si as d,li as u};
