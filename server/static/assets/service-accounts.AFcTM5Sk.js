import{u as N,aJ as m,r as u,a as G,j as e,M as Z,i as se,g as te,ao as ae,df as pe,f as F,B as f,s as p,b5 as ye,bk as ze,p as B,T as L,aH as ke,dg as U,dh as ce,Q as we,aP as Ee,da as X,bJ as Y,aV as oe,e as ne,aq as J,aY as ie,aZ as q,a$ as Ce,di as Ie,d as ue,b as me,aX as ve,bI as le,W as xe,dj as Ae,b2 as Fe,a_ as Re,aN as Te,dk as Pe,dl as De,o as Ke,aF as Ne,aW as ee,c as $e,bj as Ue,db as Oe,S as de,d7 as je,dm as O,dn as Le,bc as Me}from"./vendor.B6JBhCAY.js";import{f as K}from"./components.CP7t-rAl.js";import{a as w}from"./index.Bm7X5fEY.js";import{P as W,f as M}from"./base.BXKr0a0H.js";import{b as ge,c as Ve,a as Be}from"./contexts.Ca4oT16l.js";import qe from"./not_found.CB7gwSpw.js";const Se=({serviceAccountID:t,onClose:a,open:_=!1,onSuccess:R,enableMultiOrg:y=!1,organizations:s=[]})=>{const{hasGlobalPermission:v}=ge(),{t:o}=N("authorization"),{t:x}=N("common"),{currentOrgId:j}=Ve(),[l]=m.useForm(),[T,g]=u.useState(!1),[E,C]=u.useState("global"),[V,z]=u.useState(void 0),[n,d]=u.useState(null),{run:I,loading:P}=G(A=>{if(t){const{organization_id:k,...r}=A;return w.authorization.updateServiceAccount({id:t},r)}const S={name:A.name,description:A.description};return E==="organization"&&V&&(S.organization_id=V),w.authorization.createServiceAccount(S)},{onSuccess:()=>{p.success(o("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),a(),R==null||R()},onError:()=>{p.error(o("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return u.useEffect(()=>{const A=async S=>{var k;g(!0);try{const r=await w.authorization.getServiceAccountById({id:S}),b=r.organization_id||"";C(b?"organization":"global"),z(b||void 0),d(b?((k=r.organization)==null?void 0:k.name)??b:null),l.setFieldsValue({name:r.name,description:r.description,organization_id:b||void 0})}catch{p.error(o("serviceAccount.loadError",{defaultValue:"Failed to load service account."}))}finally{g(!1)}};if(_){l.resetFields();const S=j||(s.length>0?s[0].id:""),k=y&&S?"organization":"global";C(k),z(k==="organization"?S:void 0),t?A(t):(d(null),l.setFieldsValue({organization_id:k==="organization"?S:void 0}))}},[t,_,y,s,j]),e.jsx(Z,{title:t?o("serviceAccount.edit",{defaultValue:"Edit Service Account"}):o("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:()=>{l.resetFields(),a()},onCancel:()=>{l.resetFields(),a()},open:_,footer:e.jsxs(F,{children:[e.jsx(f,{onClick:a,children:x("cancel",{defaultValue:"Cancel"})}),e.jsx(f,{type:"primary",onClick:l.submit,loading:P||T,children:x("save",{defaultValue:"Save"})})]}),children:e.jsxs(m,{form:l,layout:"vertical",onFinish:I,children:[y&&!t&&e.jsxs(e.Fragment,{children:[e.jsx(m.Item,{label:o("serviceAccount.scope",{defaultValue:"Scope"}),children:e.jsxs(se.Group,{value:E,onChange:A=>{var r;const S=A.target.value;C(S);const k=S==="organization"?j||((r=s[0])==null?void 0:r.id):void 0;z(k),l.setFieldsValue({organization_id:k})},disabled:!v("authorization:service_account:create"),children:[e.jsx(se,{value:"global",children:o("serviceAccount.global",{defaultValue:"Global"})}),e.jsx(se,{value:"organization",children:o("serviceAccount.organizationScoped",{defaultValue:"Organization"})})]})}),E==="organization"&&e.jsx(m.Item,{name:"organization_id",label:o("serviceAccount.organization",{defaultValue:"Organization"}),rules:[{required:!0,message:o("serviceAccount.organizationRequired",{defaultValue:"Please select an organization."})}],children:e.jsx(te,{placeholder:o("serviceAccount.selectOrganization",{defaultValue:"Select organization"}),options:s.map(A=>({value:A.id,label:A.name})),value:V,onChange:A=>z(A)})})]}),y&&t&&e.jsx(m.Item,{label:o("serviceAccount.organization",{defaultValue:"Organization"}),children:e.jsx("span",{children:n??o("serviceAccount.global",{defaultValue:"Global"})})}),e.jsx(m.Item,{label:o("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:o("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsx(ae,{placeholder:o("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsx(m.Item,{label:o("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsx(pe,{rows:4,placeholder:o("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},Ge=()=>{const{t}=N("authorization"),{t:a}=N("common"),_=ye(),[R]=m.useForm(),{siteConfig:y}=Ve(),{user:s}=Be(),v=(s==null?void 0:s.organizations)||[],o=(y==null?void 0:y.enable_multi_org)??!1,[x,j]=u.useState(!1),[l,T]=u.useState([]),[g,E]=u.useState(0),[C,V]=u.useState(!1),[z,n]=u.useState(null),[d,I]=u.useState({current:W.DEFAULT_CURRENT,page_size:W.DEFAULT_PAGE_SIZE,search:void 0,organization_id:void 0}),P=u.useCallback(async()=>{try{j(!0);const c=await w.authorization.getServiceAccounts(d);T(c.data||[]),E(c.total||0)}catch(c){console.error(t("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),c),p.error(t("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{j(!1)}},[d,t]);u.useEffect(()=>{P()},[P]);const A=c=>{I({...d,current:W.DEFAULT_CURRENT,search:c.search,organization_id:c.organization_id||void 0})},S=()=>{R.resetFields(),I({current:W.DEFAULT_CURRENT,page_size:W.DEFAULT_PAGE_SIZE,search:void 0,organization_id:void 0})},k=(c,h)=>{I($=>({...$,current:c,page_size:h}))},r=()=>{n(null),V(!0)},b=c=>{n(c.id),V(!0)},i=()=>{V(!1)},D=async c=>{try{await w.authorization.deleteServiceAccount({id:c}),p.success(t("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),P()}catch(h){console.error(t("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),h),p.error(t("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},be=async c=>{const h=c.status==="active"?"disabled":"active";try{await w.authorization.updateServiceAccountStatus({id:c.id},{status:h}),p.success(t("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),P()}catch($){console.error(t("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),$),p.error(t("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},_e=[{title:t("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(c,h)=>e.jsx(K,{permission:"authorization:service_account:view",fallback:c,children:e.jsx(ze,{to:`/authorization/service-accounts/${h.id}`,children:c})})},{title:t("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:c=>e.jsx(B,{title:c,children:e.jsx("span",{children:(c==null?void 0:c.length)>30?`${c.substring(0,30)}...`:c})})},...o?[{title:t("serviceAccount.organization",{defaultValue:"Organization"}),key:"organization",render:(c,h)=>{var $;return h.organization_id?e.jsx(L,{icon:e.jsx(ke,{}),color:"blue",children:(($=h.organization)==null?void 0:$.name)||h.organization_id}):e.jsx(L,{color:"default",children:t("serviceAccount.global",{defaultValue:"Global"})})}}]:[],{title:t("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:c=>c==="active"?e.jsx(U,{status:"success",text:t("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(U,{status:"error",text:t("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:t("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(c,h)=>{var $;return e.jsxs(F,{size:[0,4],wrap:!0,children:[($=h.roles)==null?void 0:$.map(re=>e.jsx(L,{color:"blue",children:re.name},re.id)),(!h.roles||h.roles.length===0)&&e.jsx(L,{children:t("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:t("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(c,h)=>h.policy_document&&h.policy_document.Statement&&h.policy_document.Statement.length>0?e.jsx(L,{color:"green",icon:e.jsx(ce,{}),children:t("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsx(L,{color:"default",icon:e.jsx(we,{}),children:t("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:t("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:c=>M(c)},{title:t("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:c=>c?M(c):t("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:a("actions",{defaultValue:"Actions"}),key:"action",render:(c,h)=>e.jsxs(F,{size:"small",children:[e.jsx(K,{permission:"authorization:service_account:view",children:e.jsx(B,{title:t("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsx(f,{type:"text",size:"small",icon:e.jsx(Ee,{}),onClick:()=>_(`/authorization/service-accounts/${h.id}`)})})}),e.jsx(K,{permission:"authorization:service_account:update",children:e.jsx(B,{title:t("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsx(f,{type:"text",size:"small",icon:e.jsx(X,{}),onClick:()=>b(h)})})}),e.jsx(K,{permission:"authorization:service_account:update",children:e.jsx(B,{title:h.status==="active"?a("disable",{defaultValue:"Disable"}):a("enable",{defaultValue:"Enable"}),children:e.jsx(f,{type:"text",size:"small",icon:h.status==="active"?e.jsx(Y,{}):e.jsx(ce,{}),onClick:()=>be(h)})})}),e.jsx(K,{permission:"authorization:service_account:delete",children:e.jsx(B,{title:t("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsx(oe,{title:t("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>D(h.id),okText:a("confirm",{defaultValue:"Confirm"}),cancelText:a("cancel",{defaultValue:"Cancel"}),children:e.jsx(f,{type:"text",size:"small",danger:!0,icon:e.jsx(ne,{})})})})})]})}];return e.jsxs("div",{children:[e.jsx(J,{style:{marginBottom:16},children:e.jsx(m,{form:R,layout:"inline",onFinish:A,initialValues:{search:d.search,organization_id:d.organization_id},style:{marginBottom:0},children:e.jsxs(ie,{gutter:16,style:{width:"100%"},children:[e.jsx(q,{xs:24,sm:12,md:8,lg:6,children:e.jsx(m.Item,{name:"search",children:e.jsx(ae,{placeholder:t("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsx(Ce,{})})})}),o&&e.jsx(q,{xs:24,sm:12,md:8,lg:6,children:e.jsx(m.Item,{name:"organization_id",children:e.jsx(te,{placeholder:t("serviceAccount.filterByOrg",{defaultValue:"All organizations"}),allowClear:!0,style:{minWidth:160},options:[{value:"",label:t("serviceAccount.global",{defaultValue:"Global"})},...v.map(c=>({value:c.id,label:c.name}))]})})}),e.jsx(q,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsx(m.Item,{children:e.jsxs(F,{children:[e.jsx(f,{type:"primary",htmlType:"submit",icon:e.jsx(Ie,{}),children:a("filter",{defaultValue:"Filter"})}),e.jsx(f,{onClick:S,icon:e.jsx(ue,{}),children:a("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxs(J,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(ie,{justify:"space-between",align:"middle",children:[e.jsx(q,{children:e.jsx(f,{type:"primary",onClick:S,icon:e.jsx(ue,{}),children:a("refresh",{defaultValue:"Refresh"})})}),e.jsx(q,{children:e.jsx(K,{permission:"authorization:service_account:create",children:e.jsx(f,{type:"primary",icon:e.jsx(me,{}),onClick:r,children:t("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsx(ve,{rowKey:"id",dataSource:l,columns:_e,loading:x,pagination:{current:d.current,pageSize:d.page_size,total:g,onChange:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:c=>a("totalItems",{defaultValue:`Total ${c} items`,total:c})}})]}),e.jsx(Se,{serviceAccountID:z,onClose:i,open:C,enableMultiOrg:o,organizations:v,onSuccess:()=>{P()}})]})},it=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"})),{Text:H,Paragraph:he}=xe,{TextArea:Je}=ae,We=({serviceAccountID:t})=>{const{t:a}=N("authorization"),{t:_}=N("common"),[R,y]=u.useState([]),[s,v]=u.useState(!1),[o,x]=u.useState(!1),[j]=m.useForm(),[l,T]=u.useState(null),[g,E]=u.useState(null),[C,V]=u.useState(!1),z=async()=>{if(t){v(!0);try{const i=await w.authorization.getServiceAccountAccessKeys({id:t});y(i)}catch(i){console.error("Failed to load access keys:",i),p.error(a("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{v(!1)}}};u.useEffect(()=>{z()},[t]);const n=i=>{navigator.clipboard.writeText(i).then(()=>{p.success(a("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},D=>{console.error("Could not copy text: ",D)})},d=()=>{T(null),j.resetFields(),x(!0)},I=i=>{T(i),j.setFieldsValue({name:i.name,description:i.description,status:i.status==="active",expires_at:i.expires_at?Ke(i.expires_at):void 0}),x(!0)},P=()=>{x(!1),j.resetFields()},{run:A,loading:S}=G(async()=>{const i=await j.validateFields();if(l){const D=await w.authorization.updateServiceAccountAccessKey({id:t,keyId:l.id},{name:i.name,description:i.description,status:i.status?"active":"disabled",expires_at:i.expires_at?i.expires_at.toISOString():void 0});return x(!1),D}else{const D=await w.authorization.createServiceAccountAccessKey({id:t},{name:i.name,description:i.description,expires_at:i.expires_at?i.expires_at.toISOString():void 0});E(D),x(!1),V(!0)}},{manual:!0,onSuccess:()=>{p.success(a("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),z()},onError:()=>{p.error(a("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),k=async i=>{try{await w.authorization.deleteServiceAccountAccessKey({id:t,keyId:i}),p.success(a("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),z()}catch(D){console.error("Failed to delete key:",D),p.error(a("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},r=()=>{V(!1),E(null)},b=[{title:a("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:a("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:i=>e.jsxs(F,{children:[e.jsx(le,{}),e.jsx(H,{copyable:!0,children:i})]})},{title:a("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:a("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:i=>i==="active"?e.jsx(U,{status:"success",text:a("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsx(U,{status:"error",text:a("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:a("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:i=>i?M(i):e.jsx(H,{type:"secondary",children:a("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:a("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:i=>i?M(i):e.jsx(H,{type:"secondary",children:a("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:_("actions",{defaultValue:"Actions"}),key:"action",render:(i,D)=>e.jsxs(F,{size:"small",children:[e.jsx(B,{title:a("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsx(f,{type:"text",icon:e.jsx(X,{}),onClick:()=>I(D)})}),e.jsx(oe,{title:a("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>k(D.id),okText:_("confirm",{defaultValue:"Confirm"}),cancelText:_("cancel",{defaultValue:"Cancel"}),children:e.jsx(f,{type:"text",danger:!0,icon:e.jsx(ne,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:e.jsxs(F,{children:[e.jsx(le,{}),a("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxs(F,{children:[e.jsx(f,{icon:e.jsx(Ae,{}),onClick:z,loading:s,children:_("refresh",{defaultValue:"Refresh"})}),e.jsx(f,{type:"primary",icon:e.jsx(me,{}),onClick:d,children:a("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsx(ve,{columns:b,dataSource:R,rowKey:"id",loading:s,pagination:!1})}),e.jsx(Z,{title:l?a("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):a("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:o,onOk:A,confirmLoading:S,onCancel:P,children:e.jsxs(m,{form:j,layout:"vertical",children:[e.jsx(m.Item,{name:"name",label:a("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:a("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsx(ae,{placeholder:a("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsx(m.Item,{name:"description",label:a("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsx(Je,{rows:3,placeholder:a("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),l&&e.jsx(m.Item,{name:"status",label:a("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsx(Fe,{checkedChildren:a("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:a("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsx(m.Item,{name:"expires_at",label:a("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsx(Re,{showTime:!0,placeholder:a("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxs(Z,{title:e.jsxs(F,{children:[e.jsx(De,{style:{color:"#faad14"}}),a("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:C,footer:[e.jsx(f,{onClick:r,children:_("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsx(Te,{message:a("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(H,{strong:!0,children:[a("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsx(he,{copyable:{text:g.access_key_id},children:g.access_key_id})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(H,{strong:!0,children:[a("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsx(he,{copyable:{text:g.secret_access_key||""},children:g.secret_access_key})]}),e.jsx(f,{type:"primary",icon:e.jsx(Pe,{}),onClick:()=>{const i=`Access Key: ${g.access_key_id}
Secret Key: ${g.secret_access_key}`;n(i)},block:!0,children:a("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:fe}=xe,He=({serviceAccount:t,onRefresh:a,loading:_})=>{const{id:R}=t||{},{t:y}=N("authorization"),{t:s}=N("common"),[v,o]=u.useState([]),[x,j]=u.useState([]);u.useEffect(()=>{j((t==null?void 0:t.roles)||[])},[t]);const[l,T]=u.useState(void 0),g=t==null?void 0:t.organization_id,{loading:E}=G(async()=>w.authorization.listRoles({current:1,page_size:20,search:l,...g?{organization_id:g}:{}}),{onSuccess:n=>{const d=n.data;x.forEach(I=>{d.find(A=>A.id===I.id)||d.push(I)}),o(d)},onError:n=>{console.error("Failed to load roles:",n),p.error(y("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[l,g]}),{run:C,loading:V}=G(async()=>{if(R)return w.authorization.assignServiceAccountRoles({id:R},{role_ids:x.map(n=>n.id)})},{onSuccess:()=>{p.success(y("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),a()},onError:n=>{console.error("Failed to assign roles:",n),p.error(y("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),z=n=>{j(n.map(d=>v.find(I=>I.id===d)||{id:d,name:d,description:d}))};return e.jsx(J,{title:e.jsxs(F,{children:[e.jsx(Y,{}),y("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsx(f,{icon:e.jsx(Ae,{}),onClick:()=>{a()},disabled:_||V,loading:V,children:s("refresh",{defaultValue:"Refresh"})}),children:V?e.jsx(Ne,{active:!0,paragraph:{rows:4}}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(fe,{children:y("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsx("div",{style:{marginTop:8},children:x.length>0?v.filter(n=>x.some(d=>d.id===n.id)).map(n=>e.jsx(L,{color:"blue",children:n.name},n.id)):e.jsx(ee,{image:ee.PRESENTED_IMAGE_SIMPLE,description:y("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(fe,{children:y("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsx(te,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:y("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:x.map(n=>n.id),onSearch:n=>{T(n)},onDropdownVisibleChange:n=>{n&&T(void 0)},onChange:z,loading:_||E,optionFilterProp:"label",options:v.map(n=>({label:n.name,value:n.id,title:n.description}))})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(f,{type:"primary",onClick:C,loading:V,disabled:_,children:y("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:Q}=je,Qe={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},Ze=$e(({css:t})=>({rolePolicy:t`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:t`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:t`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),Xe=()=>{const{styles:t}=Ze(),y=Ue().hash.replace("#","")||"basic",{t:s}=N("authorization"),{t:v}=N("common"),{id:o}=Oe(),x=ye(),{hasPermission:j}=ge(),[l,T]=u.useState(null),[g,E]=u.useState(!1),[C]=m.useForm(),[V,z]=u.useState(!1);if(!o)return e.jsx(qe,{});const{run:n,loading:d}=G(async()=>{if(o)return w.authorization.getServiceAccountById({id:o})},{onSuccess:r=>{T(r||null)}});u.useEffect(()=>{n()},[o]);const I=r=>{x(`#${r}`)},P=async()=>{if(o)try{await w.authorization.deleteServiceAccount({id:o}),p.success(s("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),x("/authorization/service-accounts")}catch(r){console.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),r),p.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:A,loading:S}=G(async()=>{if(l)return w.authorization.updateServiceAccountStatus({id:o},{status:l.status==="active"?"disabled":"active"})},{onSuccess:r=>{T(r||null),p.success(s("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:r=>{console.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),r),p.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),k=async r=>{if(o)try{let b;try{b=JSON.parse(r.policy_document)}catch{p.error(s("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await w.authorization.setServiceAccountPolicy({id:o},{policy_document:b}),p.success(s("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),E(!1),n()}catch(b){console.error(s("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),b),p.error(s("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return d?e.jsx(de,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):l?e.jsxs(J,{title:e.jsxs(F,{children:[e.jsx(Me,{}),l.name,l.status==="active"?e.jsx(U,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(U,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})]}),extra:e.jsxs(F,{children:[e.jsx(K,{permission:"authorization:service_account:update",children:e.jsx(f,{type:"primary",icon:e.jsx(X,{}),onClick:()=>z(!0),disabled:V,children:v("edit",{defaultValue:"Edit"})})}),e.jsx(K,{permission:"authorization:service_account:update",children:e.jsx(f,{icon:l.status==="active"?e.jsx(Y,{}):e.jsx(ce,{}),onClick:A,loading:S,children:l.status==="active"?v("disable",{defaultValue:"Disable"}):v("enable",{defaultValue:"Enable"})})}),e.jsx(K,{permission:"authorization:service_account:delete",children:e.jsx(oe,{title:s("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:P,okText:v("confirm",{defaultValue:"Confirm"}),cancelText:v("cancel",{defaultValue:"Cancel"}),children:e.jsx(f,{danger:!0,icon:e.jsx(ne,{}),children:v("delete",{defaultValue:"Delete"})})})}),e.jsx(f,{icon:e.jsx(Le,{}),onClick:()=>x("/authorization/service-accounts"),children:v("back",{defaultValue:"Back"})})]}),children:[e.jsxs(je,{defaultActiveKey:y,onChange:I,children:[e.jsx(Q,{tab:s("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxs(O,{bordered:!0,column:2,children:[e.jsx(O.Item,{label:s("serviceAccount.name",{defaultValue:"Name"}),span:2,children:l.name}),e.jsx(O.Item,{label:s("serviceAccount.description",{defaultValue:"Description"}),span:2,children:l.description||s("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsx(O.Item,{label:s("serviceAccount.status",{defaultValue:"Status"}),children:l.status==="active"?e.jsx(U,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(U,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsx(O.Item,{label:s("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:l.last_access?M(l.last_access):s("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsx(O.Item,{label:s("serviceAccount.createdAt",{defaultValue:"Created At"}),children:M(l.created_at)}),e.jsx(O.Item,{label:s("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:M(l.updated_at)})]})},"basic"),e.jsx(Q,{tab:e.jsxs("span",{children:[e.jsx(le,{}),s("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!j("authorization:service_account:access_key:list"),children:e.jsx(We,{serviceAccountID:o})},"access-keys"),e.jsx(Q,{tab:e.jsxs("span",{children:[e.jsx(Y,{}),s("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!j("authorization:service_account:role:list"),children:e.jsx(He,{serviceAccount:l,onRefresh:n})},"authorization"),e.jsxs(Q,{tab:s("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(ie,{justify:"end",children:e.jsx(q,{children:e.jsx(K,{permission:"authorization:service_account:update",children:e.jsx(f,{type:"primary",icon:e.jsx(X,{}),onClick:()=>{E(!0),C.setFieldsValue({policy_document:JSON.stringify(l.policy_document,null,2)})},children:s("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsx(de,{spinning:d,children:l.policy_document&&l.policy_document.Statement&&l.policy_document.Statement.length>0?e.jsx(J,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(l.policy_document,null,2)})}):e.jsx(ee,{description:s("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsx(Z,{title:s("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:g,onCancel:()=>{E(!1),C.resetFields()},footer:null,width:700,children:e.jsxs(m,{form:C,layout:"vertical",onFinish:k,children:[e.jsx(m.Item,{name:"policy_document",extra:e.jsx("span",{className:t.rolePolicyExtra,children:e.jsx(te,{style:{width:120},placeholder:s("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:s("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:s("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:s("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:s("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:s("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:s("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:r=>{const b=Qe[r];b&&C.setFieldValue("policy_document",JSON.stringify(b,null,2))}})}),children:e.jsx(pe,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsx(m.Item,{children:e.jsxs(F,{children:[e.jsx(f,{type:"primary",htmlType:"submit",children:v("save",{defaultValue:"Save"})}),e.jsx(f,{onClick:()=>E(!1),children:v("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsx(Se,{serviceAccountID:o,onClose:()=>z(!1),open:V})]}):e.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsx(ee,{description:s("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},lt=Object.freeze(Object.defineProperty({__proto__:null,default:Xe},Symbol.toStringTag,{value:"Module"}));export{it as S,lt as a};
