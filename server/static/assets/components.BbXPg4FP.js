import{j as e,S as ie,u as S,au as U,av as W,c as q,D as Z,o as P,aw as oe,r as x,ax as le,ay as ce,M as E,a as _,az as de,aA as ue,aB as me,aC as he,a0 as Y,aD as pe,aE as xe,aF as fe,aG as ge,aH as j,ai as C,B as v,s as w,R as je,ao as D,aa as ye,aI as ve,aJ as we,aK as Se,aL as K,aM as be,aN as ee,aO as Ie,i as A,aP as Ce,N as ke,aQ as Fe,aR as Le,aS as Ae,aT as $,aU as H,aV as Te,aW as O,aX as J,aY as R,aZ as T,a_ as ze,a$ as Pe,d as Re,b0 as _e,T as Me,b1 as G,b2 as De,b3 as $e}from"./vendor.B4UNC6a-.js";import{a as te,b as se,c as Ee,d as Ne}from"./contexts.B1iwwl_4.js";import{g as Ve,f as Be,c as Ue}from"./base.BitSj1X2.js";import{a as I}from"./index.Cy1JO93W.js";import{b as N,A as He}from"./client.Bx1ZQKAq.js";import{i as qe}from"./lodash.B3dv3_Tr.js";const Oe=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsx(ie,{size:"large"})}),mt=({element:t,requiredPermission:n,requiredPermissions:s})=>{const{t:a}=S(),{user:o,loading:l,error:r}=te(),{hasPermission:u,hasAllPermissions:m}=se();return l?e.jsx(Oe,{}):r?e.jsx(U,{status:"500",title:"500",subTitle:a("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(r==null?void 0:r.message)||r})}):o?n&&!u(n)?e.jsx(W,{to:"/forbidden",replace:!0}):s&&!m(s)?e.jsx(W,{to:"/forbidden",replace:!0}):t:(window.location.href=Ve("/login?redirect="+encodeURIComponent(window.location.href)),null)},We=q(({token:t,css:n})=>({container:n`
      ${n`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),ae=({overlayClassName:t,overlay:n,hidden:s,children:a,...o})=>{if(s)return e.jsx(e.Fragment,{});const{styles:l}=We();return e.jsx(Z,{dropdownRender:n,overlayClassName:P(l.container,t),...o,children:e.jsx("span",{className:l.iconStyle,children:a})})},Ke=()=>e.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),Je=q(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),Ge=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],ht=({transformLangConfig:t=s=>s,className:n})=>{const{i18n:s}=S(),{styles:a}=Je(),o=r=>{s.changeLanguage(r)},l={selectedKeys:[s.language],onClick:r=>{o(r.key)},items:t(Ge).map(r=>({key:r.lang,className:a.menuItemStyle,label:e.jsxs(e.Fragment,{children:[e.jsx("span",{role:"img","aria-label":(r==null?void 0:r.label)||"en-US",className:a.menuItemIconStyle,children:(r==null?void 0:r.icon)||"ðŸŒ"}),(r==null?void 0:r.label)||"en-US"]})}))};return e.jsx(ae,{className:n,menu:l,children:e.jsx(Ke,{})})},Qe=q(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),ne=t=>qe(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?N.endsWith("/")?N+`files/${t}`:N+`/files/${t}`:t,Xe=({src:t,fallback:n,...s})=>e.jsx(oe,{src:ne(t),icon:n,...s}),Ze=({onChange:t,shape:n="square"})=>{const[s,a]=x.useState([]),{styles:o}=Qe(),[l,r]=x.useState(!1),[u,m]=x.useState(!0),[p,h]=x.useState(0),{run:i,loading:c}=_(()=>I.base.listFiles({current:p+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:d})=>{a([...s,...d]),m(d.length===40),h(p+1)}}),y=()=>{m(!0),h(0),a([])};return e.jsx(de,{style:{zIndex:1e3},onOpenChange:d=>{r(d),d?i():y()},open:l,content:e.jsx("div",{style:{width:360,height:200},children:e.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsx(me,{dataLength:s.length,next:()=>{i()},hasMore:u,loader:e.jsx(pe,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsx(Y,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsx(he,{grid:{gutter:16,column:8},dataSource:s,style:{margin:"0 8px"},loading:c,renderItem:({id:d})=>e.jsx("div",{className:o.avatarItem,onClick:f=>{f.stopPropagation(),t==null||t(d),r(!1),y()},children:e.jsx(Xe,{shape:n,src:d})})})})})}),placement:"bottom",trigger:"hover",children:e.jsx(ue,{shape:n,style:{width:112,height:112,placeContent:"center"}})})},Ye=({value:t,onChange:n,shape:s,...a})=>{const[o,l]=x.useState(void 0),[r,u]=x.useState(!1),[m,p]=x.useState(void 0),h=async i=>{u(!0),p(i.url??i.preview)};return x.useEffect(()=>{l(t?{uid:t,name:t,url:ne(t)}:void 0)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(le,{beforeCrop:async i=>{if(i.type==="image/svg+xml"){const c=await I.base.uploadFile({type:"avatar"},i);return c.length>0&&(n==null||n(c[0].id)),!1}return!0},children:e.jsx(ce,{customRequest:async i=>{var y,d;const c=await I.base.uploadFile({type:"avatar",access:"public"},i.file);c.length>0?((y=i.onSuccess)==null||y.call(i,c[0].id),n==null||n(c[0].id)):(d=i.onError)==null||d.call(i,new Error("Upload file failed"))},listType:"picture-card",onPreview:h,maxCount:1,onChange:({file:i})=>{switch(i.status){case"removed":n==null||n(void 0);break;case"done":break;default:l(i);break}},fileList:o?[o]:[],...a,children:o?void 0:e.jsx(Ze,{shape:s,onChange:n})})}),e.jsx(E,{open:r,footer:null,onCancel:()=>u(!1),children:e.jsx("img",{style:{width:"100%"},src:m})})]})},pt=({className:t})=>{const{t:n}=S("common"),{user:s}=te(),{currentOrgId:a,setCurrentOrgId:o}=Ee(),l=(s==null?void 0:s.organizations)||[],r=h=>{o(h),window.location.reload()};if(l.length===0)return null;const u=l.find(h=>h.id===a),m=u?u.name:n("organization.global",{defaultValue:"Global"}),p=[...l.map(h=>({key:h.id,label:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:h.name}),a===h.id&&e.jsx(xe,{})]}),onClick:()=>r(h.id)}))];return e.jsxs(ae,{className:t,menu:{items:p,selectedKeys:a?[a]:[""]},children:[e.jsx(fe,{style:{marginRight:4}}),e.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:m})]})},xt=({onResize:t,minWidth:n=300,maxWidth:s=window.innerWidth*.5})=>{const[a,o]=x.useState(!1),[l,r]=x.useState(!1),u=x.useCallback(h=>{h.preventDefault(),o(!0)},[]),m=x.useCallback(h=>{if(!a)return;const i=window.innerWidth-h.clientX,c=Math.max(n,Math.min(s,i));t(c)},[a,n,s,t]),p=x.useCallback(()=>{o(!1)},[]);return x.useEffect(()=>{if(a)return document.addEventListener("mousemove",m),document.addEventListener("mouseup",p),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",p),document.body.style.cursor="",document.body.style.userSelect=""}},[a,m,p]),e.jsx("div",{onMouseDown:u,onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:a?"none":"background-color 0.2s ease",backgroundColor:a?"#1890ff":l?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:a||l?"#fff":"#999",opacity:a||l?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},et=ge,tt=t=>et[t],ft=({iconName:t})=>{if(!t)return null;const n=tt(t);return n?e.jsx(x.Suspense,{fallback:null,children:e.jsx(n,{})}):null},gt=({className:t,onSuccess:n,token:s})=>{const{t:a}=S("authorization"),{t:o}=S("common"),[l]=j.useForm(),{run:r,loading:u}=_(async m=>I.authorization.changePassword(m,s?{headers:{Authorization:`Bearer ${s}`}}:{}),{manual:!0,onSuccess:()=>{w.success(a("user.passwordChanged")),l.resetFields(),n==null||n()},onError:m=>{if(m instanceof He){const p=m.code??"normal";w.error(a(`user.passwordChangeFailed.${p}`,{error:m.message,defaultValue:"Password change failed: {{error}}"}))}else w.error(a("user.passwordChangeFailed.normal",{error:m.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",m)}});return e.jsxs(j,{form:l,layout:"vertical",onFinish:r,style:{maxWidth:500,margin:"0 auto"},className:P("profile-password",t),children:[e.jsx(j.Item,{name:"old_password",label:a("user.oldPassword"),rules:[{required:!0,message:a("validation.oldPasswordRequired")}],className:P("profile-password-item","profile-password-item-old-password"),children:e.jsx(C.Password,{})}),e.jsx(j.Item,{name:"new_password",label:a("user.newPassword"),rules:[{required:!0,message:a("validation.newPasswordRequired")},{min:8,message:a("validation.passwordMinLength")}],className:P("profile-password-item","profile-password-item-new-password"),children:e.jsx(C.Password,{})}),e.jsx(j.Item,{name:"confirm_password",label:a("user.confirmPassword"),className:P("profile-password-item","profile-password-item-confirm-password"),rules:[{required:!0,message:a("validation.confirmPasswordRequired")},({getFieldValue:m})=>({validator(p,h){return!h||m("new_password")===h?Promise.resolve():Promise.reject(new Error(a("validation.passwordMismatch")))}})],children:e.jsx(C.Password,{})}),e.jsx(j.Item,{className:P("profile-password-item","profile-password-item-submit"),children:e.jsx(v,{type:"primary",htmlType:"submit",loading:u,children:o("save")})})]})},jt=({user:t,onSuccess:n})=>{const{t:s}=S("authorization"),{t:a}=S("common"),[o]=j.useForm(),[l,r]=x.useState(!1);je.useEffect(()=>{t&&o.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,o]);const u=async m=>{try{r(!0),await I.authorization.updateCurrentUser(m),w.success(a("updateSuccess")),n()}catch(p){w.error(a("updateFailed")),console.error("Failed to update user information:",p)}finally{r(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxs("div",{children:[s("user.roles"),": ",t.roles.map(m=>m.name).join(", ")]})]}),e.jsxs(j,{form:o,layout:"vertical",onFinish:u,style:{width:"100%",maxWidth:500},children:[e.jsx(j.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsx(Ye,{})}),e.jsx(j.Item,{name:"username",label:s("user.username"),children:e.jsx(C,{disabled:!0})}),e.jsx(j.Item,{name:"email",label:s("user.email"),rules:[{required:!0,message:s("validation.emailRequired")},{type:"email",message:s("validation.emailInvalid")}],children:e.jsx(C,{})}),e.jsx(j.Item,{name:"full_name",label:s("user.fullName"),rules:[{required:!0,message:s("validation.fullNameRequired")}],children:e.jsx(C,{})}),e.jsx(j.Item,{name:"phone",label:s("user.phone"),children:e.jsx(C,{})}),e.jsx(j.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",loading:l,children:a("save")})})]})]})},yt=({user:t,onSuccess:n})=>{const{t:s}=S("authorization"),{t:a}=S("common"),[o,l]=x.useState(0),[r,u]=x.useState(!1),[m,p]=x.useState(!0),[h,i]=x.useState(""),[c,y]=x.useState("totp"),{run:d,data:f={secret:"",qr_code:"",token:void 0}}=_(()=>I.authorization.enableMfa(c),{manual:!0,onSuccess:()=>{l(1)},onBefore:()=>{u(!0)},onFinally:()=>{u(!1)}}),b=async()=>{if(!h){w.warning(s("mfa.enterVerificationCode"));return}const k={code:h,mfa_type:c};"token"in f&&(k.token=f.token);try{u(!0),await I.authorization.verifyAndActivateMfa(k),w.success(s("mfa.enableSuccess")),l(2),n()}catch(L){w.error(s("mfa.verificationFailed")),console.error("Failed to verify MFA:",L)}finally{u(!1)}},g=async()=>{try{u(!0),await I.authorization.disableMfa(),w.success(s("mfa.disableSuccess")),n()}catch(k){w.error(a("operationFailed")),console.error("Failed to disable MFA:",k)}finally{u(!1)}},F=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsx(U,{status:"success",title:s("mfa.enabled"),subTitle:s("mfa.enabledDescription"),extra:e.jsx(v,{danger:!0,onClick:()=>{E.confirm({title:s("mfa.confirmDisable"),content:s("mfa.disableWarning"),onOk:g,okButtonProps:{danger:!0}})},children:s("mfa.disable")})});const k=()=>{var L;switch(o){case 0:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:e.jsxs("div",{children:[e.jsx("p",{children:s("mfa.setupInfo")}),e.jsx("p",{children:s(c==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsx(v,{type:"primary",onClick:d,loading:r,children:s("mfa.startSetup")})]});case 1:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:s("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:c==="totp"?"block":"none"}}),e.jsx("div",{style:{display:c==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsx(be,{value:f.qr_code??"",size:200})}),e.jsx("div",{style:{marginBottom:16,display:c==="email"?"block":"none"},children:e.jsxs("p",{children:[s("user.email"),": ",e.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsx("div",{style:{marginBottom:16,display:c==="totp"?"block":"none"},children:e.jsxs("p",{children:[s("mfa.secretKey"),": ",e.jsx("strong",{children:m?"*".repeat(((L=f.secret)==null?void 0:L.length)??0):f.secret}),e.jsx(v,{type:"link",onClick:()=>p(!m),icon:m?e.jsx(ee,{}):e.jsx(Ie,{})})]})}),e.jsx("div",{style:{marginBottom:24},children:e.jsx(C,{placeholder:s("mfa.enterCode"),style:{width:200},maxLength:6,value:h,onChange:M=>i(M.target.value)})}),e.jsxs(A,{children:[e.jsx(v,{onClick:()=>l(0),children:a("previous")}),e.jsx(v,{type:"primary",onClick:b,loading:r,children:a("verify")})]})]});case 2:return e.jsx(U,{status:"success",title:s("mfa.setupSuccess"),subTitle:s("mfa.setupSuccessDescription"),extra:e.jsx(v,{type:"primary",onClick:()=>l(0),children:a("done")})});default:return null}};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:o===2?"none":"unset"},children:[e.jsx(ye,{defaultValue:"totp",onChange:L=>{y(L),l(0)},value:c,options:[{value:"totp",icon:e.jsx(ve,{}),label:s("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsx(we,{}),label:s("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsx(Y,{})]}),e.jsx(Se,{current:o,items:[{title:s(c==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:s(c==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:s(c==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:s(c==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:s(c==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:s(c==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),k()]})};return e.jsx(D,{title:s("mfa.title"),children:F()})},{Text:V}=ke,vt=()=>{const{t}=S("authorization"),{t:n}=S("common"),[s,a]=x.useState([]),[o,l]=x.useState(!1),[r,u]=x.useState(null),[m,p]=x.useState(!1),h=async()=>{try{l(!0);const d=await I.authorization.getUserSessions({});a(d)}catch(d){w.error(t("session.getSessionsFailed",{error:d,defaultValue:"Failed to get session list: {{error}}"}))}finally{l(!1)}};x.useEffect(()=>{h()},[]);const i=async d=>{try{u(d),await I.authorization.terminateSession({id:d}),a(s.filter(f=>f.id!==d)),w.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(f){w.error(t("session.terminateFailed",{error:f,defaultValue:"Failed to terminate session: {{error}}"}))}finally{u(null)}},c=async()=>{try{p(!0),await I.authorization.terminateOtherSessions(),a(s.filter(d=>d.is_current)),w.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(d){w.error(t("session.terminateAllFailed",{error:d,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{p(!1)}},y=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(d,f)=>e.jsxs(A,{direction:"vertical",size:0,children:[e.jsxs(A,{children:[e.jsx(Ce,{}),e.jsx(V,{strong:!0,children:d})]}),e.jsxs(A,{children:[e.jsx(Fe,{}),e.jsx(V,{type:"secondary",children:f.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:d=>e.jsxs(A,{children:[e.jsx(Le,{}),e.jsx("span",{children:d})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:d=>e.jsxs(A,{children:[e.jsx(Ae,{}),e.jsx("span",{children:new Date(d).toLocaleString()})]})},{title:t("session.status"),key:"status",render:d=>d.is_current?e.jsx($,{color:"green",children:t("session.current")}):e.jsx($,{color:"blue",children:t("session.active")})},{title:n("actions"),key:"action",render:d=>d.is_current?e.jsx(V,{type:"secondary",children:t("session.currentSession")}):e.jsx(H,{title:t("session.confirmTerminate"),onConfirm:()=>i(d.id),okText:n("confirm"),cancelText:n("cancel"),children:e.jsx(v,{type:"link",danger:!0,loading:r===d.id,children:t("session.terminate")})})}];return e.jsx(D,{title:t("session.title"),extra:s.length>1&&e.jsx(H,{title:t("session.confirmTerminateAll"),onConfirm:c,okText:n("confirm"),cancelText:n("cancel"),children:e.jsx(v,{danger:!0,loading:m,children:t("session.terminateOthers")})}),children:s.length===0?e.jsx(Te,{description:t("session.noSessions")}):e.jsx(O,{columns:y,dataSource:s,rowKey:"id",loading:o,pagination:!1})})},{RangePicker:st}=ze,{Option:z}=T,at=t=>t||"N/A",nt=(t,n)=>t==="success"?e.jsx($,{color:"success",children:n("statuses.success")}):e.jsx($,{color:"error",children:n("statuses.failed")}),wt=({userId:t,request:n=a=>t?I.authorization.getUserLogs({id:t,...a}):I.authorization.getCurrentUserLogs(a),columnsFilter:s=a=>a})=>{const{t:a}=S("authorization"),{t:o}=S("common"),[l,r]=x.useState({current:1,pageSize:10,total:0}),[u,m]=x.useState({}),[p]=j.useForm(),{loading:h,run:i,data:{data:c}={}}=_(async(g=u,F=1,k=10)=>n({...g,current:F??1,page_size:k??10}),{onError(g){w.error(a("auditLog.fetchFailed",{error:g}))},onSuccess({total:g}){r({...l,total:g})}});x.useEffect(()=>{i(u,1,l.pageSize)},[]);const y=g=>{r({...l,current:g.current,pageSize:g.pageSize}),i({},g.current,g.pageSize)},d=g=>{var F,k,L,M;i({...g,start_time:(k=(F=g.dateRange)==null?void 0:F[0])==null?void 0:k.toISOString(),end_time:(M=(L=g.dateRange)==null?void 0:L[1])==null?void 0:M.toISOString()},1,l.pageSize)},f=()=>{p.resetFields(),m({}),r({...l,current:1}),i({},1,l.pageSize)},b=[{title:a("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:g=>Be(g)},{title:a("auditLog.action"),dataIndex:"action",key:"action",render:(g,F)=>g?a(`action.${g.replace(":",".")}`,{defaultValue:F.action_name}):F.action_name??F.action},{title:a("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:a("auditLog.ip"),dataIndex:"ip",key:"ip",render:g=>at(g)},{title:a("auditLog.status"),dataIndex:"status",key:"status",render:g=>nt(g,a)},{title:a("auditLog.details"),dataIndex:"details",key:"details",render:g=>e.jsx(v,{type:"link",icon:e.jsx(ee,{}),onClick:()=>{E.info({title:a("auditLog.details"),content:JSON.stringify(g)})}})}];return e.jsxs("div",{children:[e.jsx(D,{style:{marginBottom:16},children:e.jsxs(j,{form:p,layout:"horizontal",onFinish:d,initialValues:u,children:[e.jsxs(J,{gutter:24,children:[e.jsx(R,{span:6,children:e.jsx(j.Item,{name:"search",label:a("auditLog.search"),children:e.jsx(C,{placeholder:a("auditLog.searchPlaceholder")})})}),e.jsx(R,{span:6,children:e.jsx(j.Item,{name:"action",label:a("auditLog.action"),children:e.jsxs(T,{allowClear:!0,placeholder:a("auditLog.selectAction"),children:[e.jsx(z,{value:"login",children:a("actions.login")}),e.jsx(z,{value:"logout",children:a("actions.logout")}),e.jsx(z,{value:"password_reset",children:a("actions.passwordReset")}),e.jsx(z,{value:"mfa_change",children:a("actions.mfaChange")})]})})}),e.jsx(R,{span:6,children:e.jsx(j.Item,{name:"status",label:a("auditLog.status"),children:e.jsxs(T,{allowClear:!0,placeholder:a("auditLog.selectStatus"),children:[e.jsx(z,{value:"success",children:a("statuses.success")}),e.jsx(z,{value:"failed",children:a("statuses.failed")})]})})}),e.jsx(R,{span:6,children:e.jsx(j.Item,{name:"dateRange",label:a("auditLog.dateRange"),children:e.jsx(st,{style:{width:"100%"}})})})]}),e.jsx(J,{children:e.jsx(R,{span:24,style:{textAlign:"right"},children:e.jsxs(A,{children:[e.jsx(v,{onClick:f,children:o("reset")}),e.jsx(v,{type:"primary",htmlType:"submit",icon:e.jsx(Pe,{}),children:o("search")})]})})})]})}),e.jsxs(D,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(v,{type:"primary",icon:e.jsx(Re,{}),onClick:f,style:{marginRight:8},children:o("refresh")})}),e.jsx(O,{rowKey:"id",columns:s(b),dataSource:c,pagination:{...l,showSizeChanger:!0,showTotal:g=>o("totalItems",{total:g})},loading:h,onChange:y,scroll:{x:"max-content"}})]})]})},re=({permission:t,permissions:n=[],checkAll:s=!1,fallback:a=null,children:o})=>{const{hasPermission:l,hasAnyPermission:r,hasAllPermissions:u,isAdmin:m,loading:p}=se();return p?null:m?e.jsx(e.Fragment,{children:o}):t?l(t)?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:a}):n.length>0?(s?u(n):r(n))?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:a}):e.jsx(e.Fragment,{children:o})},Q=t=>{const[n,s]=x.useState(!1),{permission:a,icon:o,tooltip:l,onClick:r,confirm:u,label:m,...p}=t,h=r?async()=>{s(!0);try{await r()}finally{s(!1)}}:void 0;let i=e.jsx(v,{type:"text",size:"small",loading:n,icon:o,onClick:u?void 0:h,...p,children:m&&e.jsx("span",{style:{position:"inherit",top:"-2px"},children:m})});if(l&&(i=e.jsx(Me,{title:l,children:i})),u){const c=async()=>{u.onConfirm?u.onConfirm():h&&await h()};i=e.jsx(H,{title:u.title,description:u.description,onConfirm:c,okText:u.okText,cancelText:u.cancelText,children:i})}return a&&(i=e.jsx(re,{permission:a,children:i})),i},St=({actions:t,maxVisibleItems:n})=>{const s=t.filter(r=>!r.hidden);if(!n||s.length<=n)return e.jsx(e.Fragment,{children:s.map(({key:r,...u})=>e.jsx(Q,{...u},r))});const a=s.slice(0,n-1),l=s.slice(n-1).map(r=>{const{key:u,label:m,icon:p,permission:h,onClick:i,confirm:c,disabled:y,tooltip:d}=r,b={key:u,label:m,icon:p,disabled:y,onClick:async()=>{c?E.confirm({title:c.title,content:c.description,onOk:c.onConfirm,okText:c.okText,cancelText:c.cancelText}):i&&await i()}};return h?{...b,label:e.jsx(re,{permission:h,children:e.jsx("span",{children:m??d})})}:b});return e.jsxs(e.Fragment,{children:[a.map(({key:r,...u})=>e.jsx(Q,{...u},r)),e.jsx(Z,{menu:{items:l},trigger:["click"],children:e.jsx(v,{type:"text",size:"small",icon:e.jsx(_e,{})})})]})},rt=({request:t,tableRef:n,...s},a)=>{const[o,l]=x.useState({current:1,pageSize:10}),[r,u]=x.useState(0),{data:m,loading:p,refresh:h}=_(async()=>{const i=await t({current:o.current,page_size:o.pageSize});return u(i.total),i.data},{refreshDeps:[o]});return x.useImperativeHandle(a,()=>({reload:()=>{h()}})),e.jsx(O,{rowKey:"id",loading:p,dataSource:m??[],pagination:{...o,total:r,onChange:(i,c)=>{l({current:i,pageSize:c})}},...s,ref:n})},bt=({actionRef:t,...n})=>{const[s,a]=x.useState();return x.useEffect(()=>{a(x.forwardRef(rt))},[]),s?e.jsx(s,{...n,ref:t}):null},{TextArea:X}=C,{Option:B}=T,It=({field:t,selectedType:n,dependentValues:s,formValues:a={}})=>{const{t:o}=S("system"),{t:l}=S("common"),r=x.useMemo(()=>Ue(t.visible_when,a),[t.visible_when,a]),{options:u,loading:m}=Ne(t.data_source,t.options,s),p=x.useMemo(()=>t.data_source&&t.data_source.type!=="static"?u:t.options||[],[t.data_source,t.options,u]),h=p&&p.length>0;if(!r)return null;const i=[{required:t.required,message:o("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],c=()=>o(`settings.toolsets.${n}.${t.name}`,{defaultValue:t.display_name||t.name}),y=()=>o(`settings.toolsets.${n}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${l("enter",{defaultValue:"Enter"})} ${t.name}`}),d=()=>{if(t.description)return o(`settings.toolsets.${n}.${t.name}Tooltip`,{defaultValue:t.description})};if(!r)return null;if(t.type==="select"||t.data_source)return e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(T,{loading:m,allowClear:!0,placeholder:y(),showSearch:!0,filterOption:(f,b)=>{var g;return(g=b==null?void 0:b.children)==null?void 0:g.toLowerCase().includes(f.toLowerCase())},children:p.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name);switch(t.type){case"text":return e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,children:e.jsx(X,{placeholder:y(),rows:4})},t.name);case"string":return h?e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(T,{allowClear:!0,placeholder:y(),children:p.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(C,{placeholder:y()})},t.name);case"password":return e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(C.Password,{placeholder:y(),autoComplete:"new-password"})},t.name);case"number":return h?e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(T,{allowClear:!0,placeholder:y(),children:p.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx($e,{style:{width:"100%"},placeholder:y()})},t.name);case"boolean":return e.jsx(j.Item,{name:["config",t.name],label:c(),valuePropName:"checked",tooltip:d(),children:e.jsx(De,{})},t.name);case"array":return h?e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(G.Group,{style:{width:"100%"},children:e.jsx(A,{direction:"vertical",children:p.map(f=>e.jsx(G,{value:f.value,children:f.label},f.value))})})},t.name):e.jsx(j.Item,{name:["config",t.name],label:c(),rules:i,tooltip:d(),children:e.jsx(T,{mode:"tags",style:{width:"100%"},placeholder:y(),tokenSeparators:[","]})},t.name);case"object":return e.jsx(j.Item,{name:["config",t.name],label:c(),rules:[...i,{validator:(f,b)=>{if(!b)return Promise.resolve();try{return JSON.parse(b),Promise.resolve()}catch{return Promise.reject(new Error(o("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:d(),children:e.jsx(X,{rows:4,placeholder:y()})},t.name);default:return null}};export{Xe as A,ft as D,ae as H,Oe as L,pt as O,mt as P,xt as R,bt as T,wt as U,ht as a,gt as b,jt as c,yt as d,vt as e,re as f,Ge as g,St as h,It as i,Ye as j};
