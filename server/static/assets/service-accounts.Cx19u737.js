import{u as F,F as v,e as $,r as d,j as e,M as X,m as ee,aU as de,E as _,n as r,s as h,ac as he,am as je,a2 as U,aV as R,O as G,aW as te,aX as Ve,y as Se,aN as Y,aK as H,V as ae,aO as le,C as M,Y as se,Z as W,a0 as ge,aY as be,a1 as oe,aP as fe,X as pe,aJ as ce,T as ye,aZ as xe,a_ as _e,$ as ke,x as we,a$ as Ee,b0 as Ce,b1 as ze,h as Ie,W as Q,_ as me,c as Fe,al as Re,b2 as Te,S as ne,aM as ve,b3 as K,b4 as De,af as Ke}from"./vendor.5VlR7AZZ.js";import{f as I}from"./components.Hu8o1XqG.js";import{a as V}from"./index.Cq3ia0Rf.js";import{P as q,f as P}from"./base.BCJy1ny5.js";import Pe from"./not_found.DXHeq3fI.js";import{a as Ne}from"./contexts.B2_ihE-j.js";const Ae=({serviceAccountID:s,onClose:t,open:j=!1,onSuccess:k})=>{const{t:n}=F("authorization"),{t:a}=F("common"),[u]=v.useForm(),{run:y,loading:x}=$(m=>s?V.authorization.updateServiceAccount({id:s},m):V.authorization.createServiceAccount(m),{onSuccess:()=>{h.success(n("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),t(),k==null||k()},onError:()=>{h.error(n("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return d.useEffect(()=>{j&&s?V.authorization.getServiceAccountById({id:s}).then(m=>{u.setFieldsValue({name:m.name,description:m.description})}):u.resetFields()},[s,j]),e.jsx(X,{title:s?n("serviceAccount.edit",{defaultValue:"Edit Service Account"}):n("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:t,open:j,footer:e.jsxs(_,{children:[e.jsx(r,{onClick:t,children:a("cancel",{defaultValue:"Cancel"})}),e.jsx(r,{type:"primary",onClick:u.submit,loading:x,children:a("save",{defaultValue:"Save"})})]}),children:e.jsxs(v,{form:u,layout:"vertical",onFinish:y,children:[e.jsx(v.Item,{label:n("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:n("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsx(ee,{placeholder:n("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsx(v.Item,{label:n("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsx(de,{rows:4,placeholder:n("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},Ue=()=>{const{t:s}=F("authorization"),{t}=F("common"),j=he(),[k]=v.useForm(),[n]=v.useForm(),[a,u]=d.useState(!1),[y,x]=d.useState([]),[m,o]=d.useState(0),[z,S]=d.useState(!1),[w,g]=d.useState(null),[b,i]=d.useState({current:q.DEFAULT_CURRENT,page_size:q.DEFAULT_PAGE_SIZE,search:void 0}),f=d.useCallback(async()=>{try{u(!0);const c=await V.authorization.getServiceAccounts(b);x(c.data||[]),o(c.total||0)}catch(c){console.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),c),h.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{u(!1)}},[b,s]);d.useEffect(()=>{f()},[f]);const E=c=>{i({...b,current:q.DEFAULT_CURRENT,search:c.search})},T=()=>{k.resetFields(),i({current:q.DEFAULT_CURRENT,page_size:q.DEFAULT_PAGE_SIZE,search:void 0})},D=(c,p)=>{i(N=>({...N,current:c,page_size:p}))},L=()=>{g(null),S(!0)},O=c=>{g(c.id),S(!0)},B=()=>{S(!1),n.resetFields()},A=async c=>{try{await V.authorization.deleteServiceAccount({id:c}),h.success(s("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),f()}catch(p){console.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),p),h.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},C=async c=>{const p=c.status==="active"?"disabled":"active";try{await V.authorization.updateServiceAccountStatus({id:c.id},{status:p}),h.success(s("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),f()}catch(N){console.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),N),h.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},l=[{title:s("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(c,p)=>e.jsx(I,{permission:"authorization:service_account:view",fallback:c,children:e.jsx(je,{to:`/authorization/service-accounts/${p.id}`,children:c})})},{title:s("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:c=>e.jsx(U,{title:c,children:e.jsx("span",{children:(c==null?void 0:c.length)>30?`${c.substring(0,30)}...`:c})})},{title:s("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:c=>c==="active"?e.jsx(R,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:s("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(c,p)=>{var N;return e.jsxs(_,{size:[0,4],wrap:!0,children:[(N=p.roles)==null?void 0:N.map(ie=>e.jsx(G,{color:"blue",children:ie.name},ie.id)),(!p.roles||p.roles.length===0)&&e.jsx(G,{children:s("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(c,p)=>p.policy_document&&p.policy_document.Statement&&p.policy_document.Statement.length>0?e.jsx(G,{color:"green",icon:e.jsx(te,{}),children:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsx(G,{color:"default",icon:e.jsx(Ve,{}),children:s("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:s("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:c=>P(c)},{title:s("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:c=>c?P(c):s("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:t("actions",{defaultValue:"Actions"}),key:"action",render:(c,p)=>e.jsxs(_,{size:"small",children:[e.jsx(I,{permission:"authorization:service_account:view",children:e.jsx(U,{title:s("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsx(r,{type:"text",size:"small",icon:e.jsx(Se,{}),onClick:()=>j(`/authorization/service-accounts/${p.id}`)})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(U,{title:s("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsx(r,{type:"text",size:"small",icon:e.jsx(Y,{}),onClick:()=>O(p)})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(U,{title:p.status==="active"?t("disable",{defaultValue:"Disable"}):t("enable",{defaultValue:"Enable"}),children:e.jsx(r,{type:"text",size:"small",icon:p.status==="active"?e.jsx(H,{}):e.jsx(te,{}),onClick:()=>C(p)})})}),e.jsx(I,{permission:"authorization:service_account:delete",children:e.jsx(U,{title:s("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsx(ae,{title:s("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>A(p.id),okText:t("confirm",{defaultValue:"Confirm"}),cancelText:t("cancel",{defaultValue:"Cancel"}),children:e.jsx(r,{type:"text",size:"small",danger:!0,icon:e.jsx(le,{})})})})})]})}];return e.jsxs("div",{children:[e.jsx(M,{style:{marginBottom:16},children:e.jsx(v,{form:k,layout:"horizontal",onFinish:E,initialValues:{search:b.search},style:{marginBottom:0},children:e.jsxs(se,{gutter:16,children:[e.jsx(W,{xs:24,sm:12,md:8,lg:6,children:e.jsx(v.Item,{name:"search",label:t("keyword",{defaultValue:"Keyword"}),children:e.jsx(ee,{placeholder:s("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsx(ge,{})})})}),e.jsx(W,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsx(v.Item,{children:e.jsxs(_,{children:[e.jsx(r,{type:"primary",htmlType:"submit",icon:e.jsx(be,{}),children:t("filter",{defaultValue:"Filter"})}),e.jsx(r,{onClick:T,icon:e.jsx(oe,{}),children:t("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxs(M,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsxs(se,{justify:"space-between",align:"middle",children:[e.jsx(W,{children:e.jsx(r,{type:"primary",onClick:T,icon:e.jsx(oe,{}),children:t("refresh",{defaultValue:"Refresh"})})}),e.jsx(W,{children:e.jsx(I,{permission:"authorization:service_account:create",children:e.jsx(r,{type:"primary",icon:e.jsx(fe,{}),onClick:L,children:s("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsx(pe,{rowKey:"id",dataSource:y,columns:l,loading:a,pagination:{current:b.current,pageSize:b.page_size,total:m,onChange:D,showSizeChanger:!0,showQuickJumper:!0,showTotal:c=>t("totalItems",{defaultValue:`Total ${c} items`,total:c})}})]}),e.jsx(Ae,{serviceAccountID:w,onClose:B,open:z,onSuccess:()=>{f()}})]})},He=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),{Text:J,Paragraph:re}=ye,{TextArea:$e}=ee,Me=({serviceAccountID:s})=>{const{t}=F("authorization"),{t:j}=F("common"),[k,n]=d.useState([]),[a,u]=d.useState(!1),[y,x]=d.useState(!1),[m]=v.useForm(),[o,z]=d.useState(null),[S,w]=d.useState(null),[g,b]=d.useState(!1),i=async()=>{if(s){u(!0);try{const l=await V.authorization.getServiceAccountAccessKeys({id:s});n(l)}catch(l){console.error("Failed to load access keys:",l),h.error(t("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{u(!1)}}};d.useEffect(()=>{i()},[s]);const f=l=>{navigator.clipboard.writeText(l).then(()=>{h.success(t("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},c=>{console.error("Could not copy text: ",c)})},E=()=>{z(null),m.resetFields(),x(!0)},T=l=>{z(l),m.setFieldsValue({name:l.name,description:l.description,status:l.status==="active",expires_at:l.expires_at?ze(l.expires_at):void 0}),x(!0)},D=()=>{x(!1),m.resetFields()},{run:L,loading:O}=$(async()=>{const l=await m.validateFields();if(o){const c=await V.authorization.updateServiceAccountAccessKey({id:s,keyId:o.id},{name:l.name,description:l.description,status:l.status?"active":"disabled",expires_at:l.expires_at?l.expires_at.toISOString():void 0});return x(!1),c}else{const c=await V.authorization.createServiceAccountAccessKey({id:s},{name:l.name,description:l.description,expires_at:l.expires_at?l.expires_at.toISOString():void 0});w(c),x(!1),b(!0)}},{manual:!0,onSuccess:()=>{h.success(t("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),i()},onError:()=>{h.error(t("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),B=async l=>{try{await V.authorization.deleteServiceAccountAccessKey({id:s,keyId:l}),h.success(t("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),i()}catch(c){console.error("Failed to delete key:",c),h.error(t("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},A=()=>{b(!1),w(null)},C=[{title:t("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:l=>e.jsxs(_,{children:[e.jsx(ce,{}),e.jsx(J,{copyable:!0,children:l})]})},{title:t("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:t("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:l=>l==="active"?e.jsx(R,{status:"success",text:t("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:l=>l?P(l):e.jsx(J,{type:"secondary",children:t("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:t("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:l=>l?P(l):e.jsx(J,{type:"secondary",children:t("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:j("actions",{defaultValue:"Actions"}),key:"action",render:(l,c)=>e.jsxs(_,{size:"small",children:[e.jsx(U,{title:t("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsx(r,{type:"text",icon:e.jsx(Y,{}),onClick:()=>T(c)})}),e.jsx(ae,{title:t("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>B(c.id),okText:j("confirm",{defaultValue:"Confirm"}),cancelText:j("cancel",{defaultValue:"Cancel"}),children:e.jsx(r,{type:"text",danger:!0,icon:e.jsx(le,{})})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(M,{title:e.jsxs(_,{children:[e.jsx(ce,{}),t("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxs(_,{children:[e.jsx(r,{icon:e.jsx(xe,{}),onClick:i,loading:a,children:j("refresh",{defaultValue:"Refresh"})}),e.jsx(r,{type:"primary",icon:e.jsx(fe,{}),onClick:E,children:t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsx(pe,{columns:C,dataSource:k,rowKey:"id",loading:a,pagination:!1})}),e.jsx(X,{title:o?t("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:y,onOk:L,confirmLoading:O,onCancel:D,children:e.jsxs(v,{form:m,layout:"vertical",children:[e.jsx(v.Item,{name:"name",label:t("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:t("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsx(ee,{placeholder:t("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsx(v.Item,{name:"description",label:t("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsx($e,{rows:3,placeholder:t("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),o&&e.jsx(v.Item,{name:"status",label:t("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsx(_e,{checkedChildren:t("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsx(v.Item,{name:"expires_at",label:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsx(ke,{showTime:!0,placeholder:t("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxs(X,{title:e.jsxs(_,{children:[e.jsx(Ce,{style:{color:"#faad14"}}),t("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:g,footer:[e.jsx(r,{onClick:A,children:j("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsx(we,{message:t("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),S&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(J,{strong:!0,children:[t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsx(re,{copyable:{text:S.access_key_id},children:S.access_key_id})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs(J,{strong:!0,children:[t("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsx(re,{copyable:{text:S.secret_access_key||""},children:S.secret_access_key})]}),e.jsx(r,{type:"primary",icon:e.jsx(Ee,{}),onClick:()=>{const l=`Access Key: ${S.access_key_id}
Secret Key: ${S.secret_access_key}`;f(l)},block:!0,children:t("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:ue}=ye,Le=({serviceAccount:s,onRefresh:t,loading:j})=>{const{id:k}=s||{},{t:n}=F("authorization"),{t:a}=F("common"),[u,y]=d.useState([]),[x,m]=d.useState([]);d.useEffect(()=>{m((s==null?void 0:s.roles)||[])},[s]);const[o,z]=d.useState(void 0),{loading:S}=$(async()=>V.authorization.listRoles({current:1,page_size:20,search:o}),{onSuccess:i=>{const f=i.data;x.forEach(E=>{f.find(D=>D.id===E.id)||f.push(E)}),y(f)},onError:i=>{console.error("Failed to load roles:",i),h.error(n("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[o]}),{run:w,loading:g}=$(async()=>{if(k)return V.authorization.assignServiceAccountRoles({id:k},{role_ids:x.map(i=>i.id)})},{onSuccess:()=>{h.success(n("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),t()},onError:i=>{console.error("Failed to assign roles:",i),h.error(n("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),b=i=>{m(i.map(f=>u.find(E=>E.id===f)||{id:f,name:f,description:f}))};return e.jsx(M,{title:e.jsxs(_,{children:[e.jsx(H,{}),n("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsx(r,{icon:e.jsx(xe,{}),onClick:()=>{t()},disabled:j||g,loading:g,children:a("refresh",{defaultValue:"Refresh"})}),children:g?e.jsx(Ie,{active:!0,paragraph:{rows:4}}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(ue,{children:n("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsx("div",{style:{marginTop:8},children:x.length>0?u.filter(i=>x.some(f=>f.id===i.id)).map(i=>e.jsx(G,{color:"blue",children:i.name},i.id)):e.jsx(Q,{image:Q.PRESENTED_IMAGE_SIMPLE,description:n("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(ue,{children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsx(me,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:n("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:x.map(i=>i.id),onSearch:i=>{z(i)},onDropdownVisibleChange:i=>{i&&z(void 0)},onChange:b,loading:j||S,optionFilterProp:"label",options:u.map(i=>({label:i.name,value:i.id,title:i.description}))})]}),e.jsx("div",{style:{marginTop:16},children:e.jsx(r,{type:"primary",onClick:w,loading:g,disabled:j,children:n("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:Z}=ve,Oe={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},Be=Fe(({css:s})=>({rolePolicy:s`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:s`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:s`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),qe=()=>{const{styles:s}=Be(),n=Re().hash.replace("#","")||"basic",{t:a}=F("authorization"),{t:u}=F("common"),{id:y}=Te(),x=he(),{hasPermission:m}=Ne(),[o,z]=d.useState(null),[S,w]=d.useState(!1),[g]=v.useForm(),[b,i]=d.useState(!1);if(!y)return e.jsx(Pe,{});const{run:f,loading:E}=$(async()=>{if(y)return V.authorization.getServiceAccountById({id:y})},{onSuccess:A=>{z(A||null)}});d.useEffect(()=>{f()},[y]);const T=A=>{x(`#${A}`)},D=async()=>{if(y)try{await V.authorization.deleteServiceAccount({id:y}),h.success(a("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),x("/authorization/service-accounts")}catch(A){console.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),A),h.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:L,loading:O}=$(async()=>{if(o)return V.authorization.updateServiceAccountStatus({id:y},{status:o.status==="active"?"disabled":"active"})},{onSuccess:A=>{z(A||null),h.success(a("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:A=>{console.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),A),h.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),B=async A=>{if(y)try{let C;try{C=JSON.parse(A.policy_document)}catch{h.error(a("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await V.authorization.setServiceAccountPolicy({id:y},{policy_document:C}),h.success(a("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),w(!1),f()}catch(C){console.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),C),h.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return E?e.jsx(ne,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):o?e.jsxs(M,{title:e.jsxs(_,{children:[e.jsx(Ke,{}),o.name,o.status==="active"?e.jsx(R,{status:"success",text:a("serviceAccount.status.active",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:a("serviceAccount.status.disabled",{defaultValue:"Disabled"})})]}),extra:e.jsxs(_,{children:[e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(r,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>i(!0),disabled:b,children:u("edit",{defaultValue:"Edit"})})}),e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(r,{icon:o.status==="active"?e.jsx(H,{}):e.jsx(te,{}),onClick:L,loading:O,children:o.status==="active"?u("disable",{defaultValue:"Disable"}):u("enable",{defaultValue:"Enable"})})}),e.jsx(I,{permission:"authorization:service_account:delete",children:e.jsx(ae,{title:a("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:D,okText:u("confirm",{defaultValue:"Confirm"}),cancelText:u("cancel",{defaultValue:"Cancel"}),children:e.jsx(r,{danger:!0,icon:e.jsx(le,{}),children:u("delete",{defaultValue:"Delete"})})})}),e.jsx(r,{icon:e.jsx(De,{}),onClick:()=>x("/authorization/service-accounts"),children:u("back",{defaultValue:"Back"})})]}),children:[e.jsxs(ve,{defaultActiveKey:n,onChange:T,children:[e.jsx(Z,{tab:a("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxs(K,{bordered:!0,column:2,children:[e.jsx(K.Item,{label:a("serviceAccount.name",{defaultValue:"Name"}),span:2,children:o.name}),e.jsx(K.Item,{label:a("serviceAccount.description",{defaultValue:"Description"}),span:2,children:o.description||a("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsx(K.Item,{label:a("serviceAccount.status",{defaultValue:"Status"}),children:o.status==="active"?e.jsx(R,{status:"success",text:a("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsx(R,{status:"error",text:a("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsx(K.Item,{label:a("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:o.last_access?P(o.last_access):a("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsx(K.Item,{label:a("serviceAccount.createdAt",{defaultValue:"Created At"}),children:P(o.created_at)}),e.jsx(K.Item,{label:a("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:P(o.updated_at)})]})},"basic"),e.jsx(Z,{tab:e.jsxs("span",{children:[e.jsx(ce,{}),a("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!m("authorization:service_account:access_key:list"),children:e.jsx(Me,{serviceAccountID:y})},"access-keys"),e.jsx(Z,{tab:e.jsxs("span",{children:[e.jsx(H,{}),a("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!m("authorization:service_account:role:list"),children:e.jsx(Le,{serviceAccount:o,onRefresh:f})},"authorization"),e.jsxs(Z,{tab:a("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(se,{justify:"end",children:e.jsx(W,{children:e.jsx(I,{permission:"authorization:service_account:update",children:e.jsx(r,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>{w(!0),g.setFieldsValue({policy_document:JSON.stringify(o.policy_document,null,2)})},children:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsx(ne,{spinning:E,children:o.policy_document&&o.policy_document.Statement&&o.policy_document.Statement.length>0?e.jsx(M,{children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(o.policy_document,null,2)})}):e.jsx(Q,{description:a("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsx(X,{title:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:S,onCancel:()=>{w(!1),g.resetFields()},footer:null,width:700,children:e.jsxs(v,{form:g,layout:"vertical",onFinish:B,children:[e.jsx(v.Item,{name:"policy_document",extra:e.jsx("span",{className:s.rolePolicyExtra,children:e.jsx(me,{style:{width:120},placeholder:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:a("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:a("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:a("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:a("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:a("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:A=>{const C=Oe[A];C&&g.setFieldValue("policy_document",JSON.stringify(C,null,2))}})}),children:e.jsx(de,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsx(v.Item,{children:e.jsxs(_,{children:[e.jsx(r,{type:"primary",htmlType:"submit",children:u("save",{defaultValue:"Save"})}),e.jsx(r,{onClick:()=>w(!1),children:u("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsx(Ae,{serviceAccountID:y,onClose:()=>i(!1),open:b})]}):e.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsx(Q,{description:a("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},Qe=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"}));export{He as S,Qe as a};
