const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ai-chat.D5TCDGLo.js","assets/vendor.l9656Wrs.js","assets/vite.BF1G3H_w.js","assets/highlight.BslI14e2.js","assets/refractor.C2WKeW5s.js","assets/vendor.D-Ncpkvi.css","assets/index.DsxVFOvU.js","assets/ai.Y7KPCIE8.js","assets/client.FSp96cQv.js","assets/base.B1fcI5bV.js","assets/authorization.DhfsTUK-.js","assets/system.Z-GiWthz.js","assets/oauth.C2HKmsn4.js","assets/contexts.DD9SeJHj.js","assets/index.BXr1iKgL.css","assets/ant-design-x.BmShwVbr.js","assets/mermaid.BlG9J9XX.js","assets/ant-design-x.C1GP9Q3x.css"])))=>i.map(i=>d[i]);
import{j as e,S as de,u as S,av as q,aw as W,c as V,D as Y,E as Z,ax as ue,r as h,ay as me,az as he,aA as _,aB as pe,a as P,aC as xe,aD as fe,aE as ge,aF as je,Y as ee,aG as ye,aH as ve,aI as be,T as te,aJ as Se,aK as we,aL as Ie,aM as g,ak as C,B as v,s as b,R as Ce,aq as D,aa as ke,aN as Fe,aO as Le,aP as Ae,aQ as K,aR as ze,aS as se,aT as Te,i as A,aU as Re,J as _e,aV as Pe,aW as Me,aX as De,aY as E,aZ as H,a_ as Ee,a$ as O,b0 as J,b1 as R,b2 as z,b3 as $e,b4 as Ve,d as Be,b5 as Ne,b6 as G,b7 as Ue,b8 as qe}from"./vendor.l9656Wrs.js";import{a as ae,b as ne,c as He,u as $,d as Oe}from"./contexts.DD9SeJHj.js";import{g as We,f as Ke,c as Je}from"./base.B1fcI5bV.js";import{_ as Ge}from"./vite.BF1G3H_w.js";import{a as I,w as re}from"./index.DsxVFOvU.js";import{b as B,A as Qe}from"./client.FSp96cQv.js";const Xe=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsx(de,{size:"large"})}),vt=({element:t,requiredPermission:a,requiredPermissions:s})=>{const{t:n}=S(),{user:o,loading:r,error:u}=ae(),{hasPermission:i,hasAllPermissions:p}=ne();return r?e.jsx(Xe,{}):u?e.jsx(q,{status:"500",title:"500",subTitle:n("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(u==null?void 0:u.message)||u})}):o?a&&!i(a)?e.jsx(W,{to:"/forbidden",replace:!0}):s&&!p(s)?e.jsx(W,{to:"/forbidden",replace:!0}):t:(window.location.href=We("/login?redirect="+encodeURIComponent(window.location.href)),null)},Ye=V(({token:t,css:a})=>({container:a`
      ${a`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),ie=({overlayClassName:t,overlay:a,hidden:s,children:n,...o})=>{if(s)return e.jsx(e.Fragment,{});const{styles:r}=Ye();return e.jsx(Y,{dropdownRender:a,overlayClassName:Z(r.container,t),...o,children:e.jsx("span",{className:r.iconStyle,children:n})})},Ze=()=>e.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),et=V(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),tt=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],bt=({transformLangConfig:t=a=>a})=>{const{i18n:a}=S(),{styles:s}=et(),n=r=>{a.changeLanguage(r)},o={selectedKeys:[a.language],onClick:r=>{n(r.key)},items:t(tt).map(r=>({key:r.lang,className:s.menuItemStyle,label:e.jsxs(e.Fragment,{children:[e.jsx("span",{role:"img","aria-label":(r==null?void 0:r.label)||"en-US",className:s.menuItemIconStyle,children:(r==null?void 0:r.icon)||"ðŸŒ"}),(r==null?void 0:r.label)||"en-US"]})}))};return e.jsx(ie,{menu:o,children:e.jsx(Ze,{})})},st=V(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),oe=t=>pe.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?B.endsWith("/")?B+`files/${t}`:B+`/files/${t}`:t,at=({src:t,fallback:a,...s})=>e.jsx(ue,{src:oe(t),icon:a,...s}),nt=({onChange:t,shape:a="square"})=>{const[s,n]=h.useState([]),{styles:o}=st(),[r,u]=h.useState(!1),[i,p]=h.useState(!0),[m,j]=h.useState(0),{run:l,loading:c}=P(()=>I.base.listFiles({current:m+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:d})=>{n([...s,...d]),p(d.length===40),j(m+1)}}),y=()=>{p(!0),j(0),n([])};return e.jsx(xe,{style:{zIndex:1e3},onOpenChange:d=>{u(d),d?l():y()},open:r,content:e.jsx("div",{style:{width:360,height:200},children:e.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsx(ge,{dataLength:s.length,next:()=>{l()},hasMore:i,loader:e.jsx(ye,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsx(ee,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsx(je,{grid:{gutter:16,column:8},dataSource:s,style:{margin:"0 8px"},loading:c,renderItem:({id:d})=>e.jsx("div",{className:o.avatarItem,onClick:x=>{x.stopPropagation(),t==null||t(d),u(!1),y()},children:e.jsx(at,{shape:a,src:d})})})})})}),placement:"bottom",trigger:"hover",children:e.jsx(fe,{shape:a,style:{width:112,height:112,placeContent:"center"}})})},rt=({value:t,onChange:a,shape:s,...n})=>{const[o,r]=h.useState(void 0),[u,i]=h.useState(!1),[p,m]=h.useState(void 0),j=async l=>{i(!0),m(l.url??l.preview)};return h.useEffect(()=>{r(t?{uid:t,name:t,url:oe(t)}:void 0)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(me,{beforeCrop:async l=>{if(l.type==="image/svg+xml"){const c=await I.base.uploadFile({type:"avatar"},l);return c.length>0&&(a==null||a(c[0].id)),!1}return!0},children:e.jsx(he,{customRequest:async l=>{var y,d;const c=await I.base.uploadFile({type:"avatar",access:"public"},l.file);c.length>0?((y=l.onSuccess)==null||y.call(l,c[0].id),a==null||a(c[0].id)):(d=l.onError)==null||d.call(l,new Error("Upload file failed"))},listType:"picture-card",onPreview:j,maxCount:1,onChange:({file:l})=>{switch(l.status){case"removed":a==null||a(void 0);break;case"done":break;default:r(l);break}},fileList:o?[o]:[],...n,children:o?void 0:e.jsx(nt,{shape:s,onChange:a})})}),e.jsx(_,{open:u,footer:null,onCancel:()=>i(!1),children:e.jsx("img",{style:{width:"100%"},src:p})})]})},St=()=>{const{t}=S("common"),{user:a}=ae(),{currentOrgId:s,setCurrentOrgId:n}=He(),o=(a==null?void 0:a.organizations)||[],r=m=>{n(m),window.location.reload()};if(o.length===0)return null;const u=o.find(m=>m.id===s),i=u?u.name:t("organization.global",{defaultValue:"Global"}),p=[...o.map(m=>({key:m.id,label:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:m.name}),s===m.id&&e.jsx(ve,{})]}),onClick:()=>r(m.id)}))];return e.jsxs(ie,{menu:{items:p,selectedKeys:s?[s]:[""]},children:[e.jsx(be,{style:{marginRight:4}}),e.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:i})]})},it=({onResize:t,minWidth:a=300,maxWidth:s=window.innerWidth*.5})=>{const[n,o]=h.useState(!1),[r,u]=h.useState(!1),i=h.useCallback(j=>{j.preventDefault(),o(!0)},[]),p=h.useCallback(j=>{if(!n)return;const l=window.innerWidth-j.clientX,c=Math.max(a,Math.min(s,l));t(c)},[n,a,s,t]),m=h.useCallback(()=>{o(!1)},[]);return h.useEffect(()=>{if(n)return document.addEventListener("mousemove",p),document.addEventListener("mouseup",m),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",m),document.body.style.cursor="",document.body.style.userSelect=""}},[n,p,m]),e.jsx("div",{onMouseDown:i,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:n?"none":"background-color 0.2s ease",backgroundColor:n?"#1890ff":r?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:n||r?"#fff":"#999",opacity:n||r?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},le=h.lazy(()=>Ge(()=>import("./ai-chat.D5TCDGLo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]))),ot=V(({token:t,css:a})=>({siderLayout:a`
      position: relative;
      height: 100vh;
    `,floatSiderLayout:a`
      position: fixed;
      right: 16px;
      top: 16px;
      height: calc(100vh - 32px);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
      z-index: 1000;
      overflow: hidden;
      backdrop-filter: blur(8px);
      border: 1px solid ${t.colorBorderSecondary};
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      &:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15), 0 6px 12px rgba(0, 0, 0, 0.1);
      }
    `})),wt=()=>{const{visible:t,setVisible:a,setLoaded:s}=$();return h.useEffect(()=>{s(!0)},[s]),e.jsx(_,{width:1200,open:t,closable:!1,onCancel:()=>a(!1),footer:null,children:re(le)})},It=()=>{const{styles:t}=ot(),{layout:a,visible:s}=$(),[n,o]=h.useState(()=>{const i=localStorage.getItem("ai-sidebar-width");return i?parseInt(i,10):400}),{setLoaded:r}=$();h.useEffect(()=>{r(!0)},[r]),h.useEffect(()=>{localStorage.setItem("ai-sidebar-width",n.toString())},[n]);const u=i=>{o(i)};return e.jsx(e.Fragment,{children:e.jsxs("div",{style:{width:`${n}px`,display:s?"flex":"none",overflow:"hidden",flexShrink:0},className:Z("ai-sidebar-layout",a==="float-sidebar"?t.floatSiderLayout:t.siderLayout),children:[e.jsx(it,{onResize:u,minWidth:300,maxWidth:window.innerWidth*.5}),e.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",overflow:"hidden",borderRadius:a==="float-sidebar"?"12px":"0"},children:e.jsx("div",{children:re(le)})})]})})},Ct=()=>{const{setVisible:t,visible:a}=$(),{t:s}=S("ai");return e.jsx(e.Fragment,{children:e.jsx(te,{title:s("chat.openAssistant",{defaultValue:"Open AI Assistant"}),placement:"left",style:{display:a?"none":"block"},children:e.jsx(Se,{icon:e.jsx(we,{}),type:"primary",onClick:()=>t(!0),style:{right:24,bottom:24,display:a?"none":"block"}})})})},lt=Ie,ct=t=>lt[t],kt=({iconName:t})=>{if(!t)return null;const a=ct(t);return a?e.jsx(h.Suspense,{fallback:null,children:e.jsx(a,{})}):null},Ft=({onSuccess:t,token:a})=>{const{t:s}=S("authorization"),{t:n}=S("common"),[o]=g.useForm(),{run:r,loading:u}=P(async i=>I.authorization.changePassword(i,a?{headers:{Authorization:`Bearer ${a}`}}:{}),{manual:!0,onSuccess:()=>{b.success(s("user.passwordChanged")),o.resetFields(),t==null||t()},onError:i=>{if(i instanceof Qe){const p=i.code??"normal";b.error(s(`user.passwordChangeFailed.${p}`,{error:i.message,defaultValue:"Password change failed: {{error}}"}))}else b.error(s("user.passwordChangeFailed.normal",{error:i.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",i)}});return e.jsxs(g,{form:o,layout:"vertical",onFinish:r,style:{maxWidth:500,margin:"0 auto"},children:[e.jsx(g.Item,{name:"old_password",label:s("user.oldPassword"),rules:[{required:!0,message:s("validation.oldPasswordRequired")}],children:e.jsx(C.Password,{})}),e.jsx(g.Item,{name:"new_password",label:s("user.newPassword"),rules:[{required:!0,message:s("validation.newPasswordRequired")},{min:8,message:s("validation.passwordMinLength")}],children:e.jsx(C.Password,{})}),e.jsx(g.Item,{name:"confirm_password",label:s("user.confirmPassword"),rules:[{required:!0,message:s("validation.confirmPasswordRequired")},({getFieldValue:i})=>({validator(p,m){return!m||i("new_password")===m?Promise.resolve():Promise.reject(new Error(s("validation.passwordMismatch")))}})],children:e.jsx(C.Password,{})}),e.jsx(g.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",loading:u,children:n("save")})})]})},Lt=({user:t,onSuccess:a})=>{const{t:s}=S("authorization"),{t:n}=S("common"),[o]=g.useForm(),[r,u]=h.useState(!1);Ce.useEffect(()=>{t&&o.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,o]);const i=async p=>{try{u(!0),await I.authorization.updateCurrentUser(p),b.success(n("updateSuccess")),a()}catch(m){b.error(n("updateFailed")),console.error("Failed to update user information:",m)}finally{u(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxs("div",{children:[s("user.roles"),": ",t.roles.map(p=>p.name).join(", ")]})]}),e.jsxs(g,{form:o,layout:"vertical",onFinish:i,style:{width:"100%",maxWidth:500},children:[e.jsx(g.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsx(rt,{})}),e.jsx(g.Item,{name:"username",label:s("user.username"),children:e.jsx(C,{disabled:!0})}),e.jsx(g.Item,{name:"email",label:s("user.email"),rules:[{required:!0,message:s("validation.emailRequired")},{type:"email",message:s("validation.emailInvalid")}],children:e.jsx(C,{})}),e.jsx(g.Item,{name:"full_name",label:s("user.fullName"),rules:[{required:!0,message:s("validation.fullNameRequired")}],children:e.jsx(C,{})}),e.jsx(g.Item,{name:"phone",label:s("user.phone"),children:e.jsx(C,{})}),e.jsx(g.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",loading:r,children:n("save")})})]})]})},At=({user:t,onSuccess:a})=>{const{t:s}=S("authorization"),{t:n}=S("common"),[o,r]=h.useState(0),[u,i]=h.useState(!1),[p,m]=h.useState(!0),[j,l]=h.useState(""),[c,y]=h.useState("totp"),{run:d,data:x={secret:"",qr_code:"",token:void 0}}=P(()=>I.authorization.enableMfa(c),{manual:!0,onSuccess:()=>{r(1)},onBefore:()=>{i(!0)},onFinally:()=>{i(!1)}}),w=async()=>{if(!j){b.warning(s("mfa.enterVerificationCode"));return}const k={code:j,mfa_type:c};"token"in x&&(k.token=x.token);try{i(!0),await I.authorization.verifyAndActivateMfa(k),b.success(s("mfa.enableSuccess")),r(2),a()}catch(L){b.error(s("mfa.verificationFailed")),console.error("Failed to verify MFA:",L)}finally{i(!1)}},f=async()=>{try{i(!0),await I.authorization.disableMfa(),b.success(s("mfa.disableSuccess")),a()}catch(k){b.error(n("operationFailed")),console.error("Failed to disable MFA:",k)}finally{i(!1)}},F=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsx(q,{status:"success",title:s("mfa.enabled"),subTitle:s("mfa.enabledDescription"),extra:e.jsx(v,{danger:!0,onClick:()=>{_.confirm({title:s("mfa.confirmDisable"),content:s("mfa.disableWarning"),onOk:f,okButtonProps:{danger:!0}})},children:s("mfa.disable")})});const k=()=>{var L;switch(o){case 0:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:e.jsxs("div",{children:[e.jsx("p",{children:s("mfa.setupInfo")}),e.jsx("p",{children:s(c==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsx(v,{type:"primary",onClick:d,loading:u,children:s("mfa.startSetup")})]});case 1:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:s("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:c==="totp"?"block":"none"}}),e.jsx("div",{style:{display:c==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsx(ze,{value:x.qr_code??"",size:200})}),e.jsx("div",{style:{marginBottom:16,display:c==="email"?"block":"none"},children:e.jsxs("p",{children:[s("user.email"),": ",e.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsx("div",{style:{marginBottom:16,display:c==="totp"?"block":"none"},children:e.jsxs("p",{children:[s("mfa.secretKey"),": ",e.jsx("strong",{children:p?"*".repeat(((L=x.secret)==null?void 0:L.length)??0):x.secret}),e.jsx(v,{type:"link",onClick:()=>m(!p),icon:p?e.jsx(se,{}):e.jsx(Te,{})})]})}),e.jsx("div",{style:{marginBottom:24},children:e.jsx(C,{placeholder:s("mfa.enterCode"),style:{width:200},maxLength:6,value:j,onChange:M=>l(M.target.value)})}),e.jsxs(A,{children:[e.jsx(v,{onClick:()=>r(0),children:n("previous")}),e.jsx(v,{type:"primary",onClick:w,loading:u,children:n("verify")})]})]});case 2:return e.jsx(q,{status:"success",title:s("mfa.setupSuccess"),subTitle:s("mfa.setupSuccessDescription"),extra:e.jsx(v,{type:"primary",onClick:()=>r(0),children:n("done")})});default:return null}};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:o===2?"none":"unset"},children:[e.jsx(ke,{defaultValue:"totp",onChange:L=>{y(L),r(0)},value:c,options:[{value:"totp",icon:e.jsx(Fe,{}),label:s("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsx(Le,{}),label:s("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsx(ee,{})]}),e.jsx(Ae,{current:o,items:[{title:s(c==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:s(c==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:s(c==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:s(c==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:s(c==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:s(c==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),k()]})};return e.jsx(D,{title:s("mfa.title"),children:F()})},{Text:N}=_e,zt=()=>{const{t}=S("authorization"),{t:a}=S("common"),[s,n]=h.useState([]),[o,r]=h.useState(!1),[u,i]=h.useState(null),[p,m]=h.useState(!1),j=async()=>{try{r(!0);const d=await I.authorization.getUserSessions({});n(d)}catch(d){b.error(t("session.getSessionsFailed",{error:d,defaultValue:"Failed to get session list: {{error}}"}))}finally{r(!1)}};h.useEffect(()=>{j()},[]);const l=async d=>{try{i(d),await I.authorization.terminateSession({id:d}),n(s.filter(x=>x.id!==d)),b.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(x){b.error(t("session.terminateFailed",{error:x,defaultValue:"Failed to terminate session: {{error}}"}))}finally{i(null)}},c=async()=>{try{m(!0),await I.authorization.terminateOtherSessions(),n(s.filter(d=>d.is_current)),b.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(d){b.error(t("session.terminateAllFailed",{error:d,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{m(!1)}},y=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(d,x)=>e.jsxs(A,{direction:"vertical",size:0,children:[e.jsxs(A,{children:[e.jsx(Re,{}),e.jsx(N,{strong:!0,children:d})]}),e.jsxs(A,{children:[e.jsx(Pe,{}),e.jsx(N,{type:"secondary",children:x.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:d=>e.jsxs(A,{children:[e.jsx(Me,{}),e.jsx("span",{children:d})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:d=>e.jsxs(A,{children:[e.jsx(De,{}),e.jsx("span",{children:new Date(d).toLocaleString()})]})},{title:t("session.status"),key:"status",render:d=>d.is_current?e.jsx(E,{color:"green",children:t("session.current")}):e.jsx(E,{color:"blue",children:t("session.active")})},{title:a("actions"),key:"action",render:d=>d.is_current?e.jsx(N,{type:"secondary",children:t("session.currentSession")}):e.jsx(H,{title:t("session.confirmTerminate"),onConfirm:()=>l(d.id),okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{type:"link",danger:!0,loading:u===d.id,children:t("session.terminate")})})}];return e.jsx(D,{title:t("session.title"),extra:s.length>1&&e.jsx(H,{title:t("session.confirmTerminateAll"),onConfirm:c,okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{danger:!0,loading:p,children:t("session.terminateOthers")})}),children:s.length===0?e.jsx(Ee,{description:t("session.noSessions")}):e.jsx(O,{columns:y,dataSource:s,rowKey:"id",loading:o,pagination:!1})})},{RangePicker:dt}=$e,{Option:T}=z,ut=t=>t||"N/A",mt=(t,a)=>t==="success"?e.jsx(E,{color:"success",children:a("statuses.success")}):e.jsx(E,{color:"error",children:a("statuses.failed")}),Tt=({userId:t,request:a=n=>t?I.authorization.getUserLogs({id:t,...n}):I.authorization.getCurrentUserLogs(n),columnsFilter:s=n=>n})=>{const{t:n}=S("authorization"),{t:o}=S("common"),[r,u]=h.useState({current:1,pageSize:10,total:0}),[i,p]=h.useState({}),[m]=g.useForm(),{loading:j,run:l,data:{data:c}={}}=P(async(f=i,F=1,k=10)=>a({...f,current:F??1,page_size:k??10}),{onError(f){b.error(n("auditLog.fetchFailed",{error:f}))},onSuccess({total:f}){u({...r,total:f})}});h.useEffect(()=>{l(i,1,r.pageSize)},[]);const y=f=>{u({...r,current:f.current,pageSize:f.pageSize}),l({},f.current,f.pageSize)},d=f=>{var F,k,L,M;l({...f,start_time:(k=(F=f.dateRange)==null?void 0:F[0])==null?void 0:k.toISOString(),end_time:(M=(L=f.dateRange)==null?void 0:L[1])==null?void 0:M.toISOString()},1,r.pageSize)},x=()=>{m.resetFields(),p({}),u({...r,current:1}),l({},1,r.pageSize)},w=[{title:n("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:f=>Ke(f)},{title:n("auditLog.action"),dataIndex:"action",key:"action",render:(f,F)=>f?n(`action.${f.replace(":",".")}`,{defaultValue:F.action_name}):F.action_name??F.action},{title:n("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:n("auditLog.ip"),dataIndex:"ip",key:"ip",render:f=>ut(f)},{title:n("auditLog.status"),dataIndex:"status",key:"status",render:f=>mt(f,n)},{title:n("auditLog.details"),dataIndex:"details",key:"details",render:f=>e.jsx(v,{type:"link",icon:e.jsx(se,{}),onClick:()=>{_.info({title:n("auditLog.details"),content:JSON.stringify(f)})}})}];return e.jsxs("div",{children:[e.jsx(D,{style:{marginBottom:16},children:e.jsxs(g,{form:m,layout:"horizontal",onFinish:d,initialValues:i,children:[e.jsxs(J,{gutter:24,children:[e.jsx(R,{span:6,children:e.jsx(g.Item,{name:"search",label:n("auditLog.search"),children:e.jsx(C,{placeholder:n("auditLog.searchPlaceholder")})})}),e.jsx(R,{span:6,children:e.jsx(g.Item,{name:"action",label:n("auditLog.action"),children:e.jsxs(z,{allowClear:!0,placeholder:n("auditLog.selectAction"),children:[e.jsx(T,{value:"login",children:n("actions.login")}),e.jsx(T,{value:"logout",children:n("actions.logout")}),e.jsx(T,{value:"password_reset",children:n("actions.passwordReset")}),e.jsx(T,{value:"mfa_change",children:n("actions.mfaChange")})]})})}),e.jsx(R,{span:6,children:e.jsx(g.Item,{name:"status",label:n("auditLog.status"),children:e.jsxs(z,{allowClear:!0,placeholder:n("auditLog.selectStatus"),children:[e.jsx(T,{value:"success",children:n("statuses.success")}),e.jsx(T,{value:"failed",children:n("statuses.failed")})]})})}),e.jsx(R,{span:6,children:e.jsx(g.Item,{name:"dateRange",label:n("auditLog.dateRange"),children:e.jsx(dt,{style:{width:"100%"}})})})]}),e.jsx(J,{children:e.jsx(R,{span:24,style:{textAlign:"right"},children:e.jsxs(A,{children:[e.jsx(v,{onClick:x,children:o("reset")}),e.jsx(v,{type:"primary",htmlType:"submit",icon:e.jsx(Ve,{}),children:o("search")})]})})})]})}),e.jsxs(D,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(v,{type:"primary",icon:e.jsx(Be,{}),onClick:x,style:{marginRight:8},children:o("refresh")})}),e.jsx(O,{rowKey:"id",columns:s(w),dataSource:c,pagination:{...r,showSizeChanger:!0,showTotal:f=>o("totalItems",{total:f})},loading:j,onChange:y,scroll:{x:"max-content"}})]})]})},ce=({permission:t,permissions:a=[],checkAll:s=!1,fallback:n=null,children:o})=>{const{hasPermission:r,hasAnyPermission:u,hasAllPermissions:i,isAdmin:p,loading:m}=ne();return m?null:p?e.jsx(e.Fragment,{children:o}):t?r(t)?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:n}):a.length>0?(s?i(a):u(a))?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:n}):e.jsx(e.Fragment,{children:o})},Q=t=>{const[a,s]=h.useState(!1),{permission:n,icon:o,tooltip:r,onClick:u,confirm:i,label:p,...m}=t,j=u?async()=>{s(!0);try{await u()}finally{s(!1)}}:void 0;let l=e.jsx(v,{type:"text",size:"small",loading:a,icon:o,onClick:i?void 0:j,...m,children:p&&e.jsx("span",{style:{position:"inherit",top:"-2px"},children:p})});if(r&&(l=e.jsx(te,{title:r,children:l})),i){const c=async()=>{i.onConfirm?i.onConfirm():j&&await j()};l=e.jsx(H,{title:i.title,description:i.description,onConfirm:c,okText:i.okText,cancelText:i.cancelText,children:l})}return n&&(l=e.jsx(ce,{permission:n,children:l})),l},Rt=({actions:t,maxVisibleItems:a})=>{const s=t.filter(u=>!u.hidden);if(!a||s.length<=a)return e.jsx(e.Fragment,{children:s.map(({key:u,...i})=>e.jsx(Q,{...i},u))});const n=s.slice(0,a-1),r=s.slice(a-1).map(u=>{const{key:i,label:p,icon:m,permission:j,onClick:l,confirm:c,disabled:y,tooltip:d}=u,w={key:i,label:p,icon:m,disabled:y,onClick:async()=>{c?_.confirm({title:c.title,content:c.description,onOk:c.onConfirm,okText:c.okText,cancelText:c.cancelText}):l&&await l()}};return j?{...w,label:e.jsx(ce,{permission:j,children:e.jsx("span",{children:p??d})})}:w});return e.jsxs(e.Fragment,{children:[n.map(({key:u,...i})=>e.jsx(Q,{...i},u)),e.jsx(Y,{menu:{items:r},trigger:["click"],children:e.jsx(v,{type:"text",size:"small",icon:e.jsx(Ne,{})})})]})},ht=({request:t,tableRef:a,...s},n)=>{const[o,r]=h.useState({current:1,pageSize:10}),[u,i]=h.useState(0),{data:p,loading:m,refresh:j}=P(async()=>{const l=await t({current:o.current,page_size:o.pageSize});return i(l.total),l.data},{refreshDeps:[o]});return h.useImperativeHandle(n,()=>({reload:()=>{j()}})),e.jsx(O,{rowKey:"id",loading:m,dataSource:p??[],pagination:{...o,total:u,onChange:(l,c)=>{r({current:l,pageSize:c})}},...s,ref:a})},_t=({actionRef:t,...a})=>{const[s,n]=h.useState();return h.useEffect(()=>{n(h.forwardRef(ht))},[]),s?e.jsx(s,{...a,ref:t}):null},{TextArea:X}=C,{Option:U}=z,Pt=({field:t,selectedType:a,dependentValues:s,formValues:n={}})=>{const{t:o}=S("system"),{t:r}=S("common"),u=h.useMemo(()=>Je(t.visible_when,n),[t.visible_when,n]),{options:i,loading:p}=Oe(t.data_source,t.options,s),m=h.useMemo(()=>t.data_source&&t.data_source.type!=="static"?i:t.options||[],[t.data_source,t.options,i]),j=m&&m.length>0;if(!u)return null;const l=[{required:t.required,message:o("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],c=()=>o(`settings.toolsets.${a}.${t.name}`,{defaultValue:t.display_name||t.name}),y=()=>o(`settings.toolsets.${a}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${r("enter",{defaultValue:"Enter"})} ${t.name}`}),d=()=>{if(t.description)return o(`settings.toolsets.${a}.${t.name}Tooltip`,{defaultValue:t.description})};if(!u)return null;if(t.type==="select"||t.data_source)return e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(z,{loading:p,allowClear:!0,placeholder:y(),showSearch:!0,filterOption:(x,w)=>{var f;return(f=w==null?void 0:w.children)==null?void 0:f.toLowerCase().includes(x.toLowerCase())},children:m.map(x=>e.jsx(U,{value:x.value,children:x.label},x.value))})},t.name);switch(t.type){case"text":return e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,children:e.jsx(X,{placeholder:y(),rows:4})},t.name);case"string":return j?e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(z,{allowClear:!0,placeholder:y(),children:m.map(x=>e.jsx(U,{value:x.value,children:x.label},x.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(C,{placeholder:y()})},t.name);case"password":return e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(C.Password,{placeholder:y(),autoComplete:"new-password"})},t.name);case"number":return j?e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(z,{allowClear:!0,placeholder:y(),children:m.map(x=>e.jsx(U,{value:x.value,children:x.label},x.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(qe,{style:{width:"100%"},placeholder:y()})},t.name);case"boolean":return e.jsx(g.Item,{name:["config",t.name],label:c(),valuePropName:"checked",tooltip:d(),children:e.jsx(Ue,{})},t.name);case"array":return j?e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(G.Group,{style:{width:"100%"},children:e.jsx(A,{direction:"vertical",children:m.map(x=>e.jsx(G,{value:x.value,children:x.label},x.value))})})},t.name):e.jsx(g.Item,{name:["config",t.name],label:c(),rules:l,tooltip:d(),children:e.jsx(z,{mode:"tags",style:{width:"100%"},placeholder:y(),tokenSeparators:[","]})},t.name);case"object":return e.jsx(g.Item,{name:["config",t.name],label:c(),rules:[...l,{validator:(x,w)=>{if(!w)return Promise.resolve();try{return JSON.parse(w),Promise.resolve()}catch{return Promise.reject(new Error(o("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:d(),children:e.jsx(X,{rows:4,placeholder:y()})},t.name);default:return null}};export{at as A,kt as D,ie as H,Xe as L,St as O,vt as P,_t as T,Tt as U,bt as a,Ct as b,wt as c,It as d,Ft as e,Lt as f,At as g,zt as h,ce as i,tt as j,Rt as k,Pt as l,rt as m};
