import{j as e,S as oe,u as S,aw as H,ax as W,c as q,D as Y,h as R,ay as le,r as p,az as ce,aA as de,M as $,a as z,aB as ue,aC as me,aD as he,aE as pe,a6 as ee,aF as xe,aG as ge,aH as fe,aI as je,aJ as g,ao as C,B as v,s as w,R as ye,aq as D,ag as ve,aK as we,aL as Se,aM as be,aN as K,aO as Ie,aP as te,aQ as Ce,f as A,aR as ke,W as Fe,aS as Le,aT as Ae,aU as Te,T as E,aV as U,aW as ze,aX as O,aY as J,aZ as M,g as T,a_ as Pe,a$ as Re,d as Me,b0 as _e,p as De,b1 as X,b2 as Ee,b3 as $e}from"./vendor.B6JBhCAY.js";import{a as se,b as ne,c as Ve,d as Ne}from"./contexts.Ca4oT16l.js";import{g as Be,f as He,c as Ue}from"./base.BXKr0a0H.js";import{a as I}from"./index.Bm7X5fEY.js";import{b as V,A as qe}from"./client.C_z0mq-g.js";import{a as Oe}from"./lodash.BDtH7uFP.js";import{X as We,M as Ke,d as Je}from"./ant-design-x.BIkQt4u4.js";const G=()=>e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsx(oe,{size:"large"})}),ft=({element:t,requiredPermission:a,requiredPermissions:s})=>{const{t:n}=S(),{user:o,loading:c,error:i}=se(),{hasPermission:d,hasAllPermissions:u}=ne();return c?e.jsx(G,{}):i?i.code==="E4011"?e.jsx(G,{}):e.jsx(H,{status:"500",title:"500",subTitle:n("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(i==null?void 0:i.message)||i})}):o?a&&!d(a)?e.jsx(W,{to:"/forbidden",replace:!0}):s&&!u(s)?e.jsx(W,{to:"/forbidden",replace:!0}):t:(window.location.href=Be("/login?redirect="+encodeURIComponent(window.location.href)),null)},Xe=q(({token:t,css:a})=>({container:a`
      ${a`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),ae=({overlayClassName:t,overlay:a,hidden:s,children:n,...o})=>{if(s)return e.jsx(e.Fragment,{});const{styles:c}=Xe();return e.jsx(Y,{dropdownRender:a,overlayClassName:R(c.container,t),...o,children:e.jsx("span",{className:c.iconStyle,children:n})})},Ge=()=>e.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),Qe=q(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),Ze=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],jt=({transformLangConfig:t=s=>s,className:a})=>{const{i18n:s}=S(),{styles:n}=Qe(),o=i=>{s.changeLanguage(i)},c={selectedKeys:[s.language],onClick:i=>{o(i.key)},items:t(Ze).map(i=>({key:i.lang,className:n.menuItemStyle,label:e.jsxs(e.Fragment,{children:[e.jsx("span",{role:"img","aria-label":(i==null?void 0:i.label)||"en-US",className:n.menuItemIconStyle,children:(i==null?void 0:i.icon)||"ðŸŒ"}),(i==null?void 0:i.label)||"en-US"]})}))};return e.jsx(ae,{className:a,menu:c,children:e.jsx(Ge,{})})},Ye=q(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),re=t=>Oe(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?V.endsWith("/")?V+`files/${t}`:V+`/files/${t}`:t,et=({src:t,fallback:a,...s})=>e.jsx(le,{src:re(t),icon:a,...s}),tt=({onChange:t,shape:a="square"})=>{const[s,n]=p.useState([]),{styles:o}=Ye(),[c,i]=p.useState(!1),[d,u]=p.useState(!0),[h,m]=p.useState(0),{run:l,loading:r}=z(()=>I.base.listFiles({current:h+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:j})=>{n([...s,...j]),u(j.length===40),m(h+1)}}),y=()=>{u(!0),m(0),n([])};return e.jsx(ue,{style:{zIndex:1e3},onOpenChange:j=>{i(j),j?l():y()},open:c,content:e.jsx("div",{style:{width:360,height:200},children:e.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsx(he,{dataLength:s.length,next:()=>{l()},hasMore:d,loader:e.jsx(xe,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsx(ee,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsx(pe,{grid:{gutter:16,column:8},dataSource:s,style:{margin:"0 8px"},loading:r,renderItem:({id:j})=>e.jsx("div",{className:o.avatarItem,onClick:f=>{f.stopPropagation(),t==null||t(j),i(!1),y()},children:e.jsx(et,{shape:a,src:j})})})})})}),placement:"bottom",trigger:"hover",children:e.jsx(me,{shape:a,style:{width:112,height:112,placeContent:"center"}})})},st=({value:t,onChange:a,shape:s,...n})=>{const[o,c]=p.useState(void 0),[i,d]=p.useState(!1),[u,h]=p.useState(void 0),m=async l=>{d(!0),h(l.url??l.preview)};return p.useEffect(()=>{c(t?{uid:t,name:t,url:re(t)}:void 0)},[t]),e.jsxs(e.Fragment,{children:[e.jsx(ce,{beforeCrop:async l=>{if(l.type==="image/svg+xml"){const r=await I.base.uploadFile({type:"avatar"},l);return r.length>0&&(a==null||a(r[0].id)),!1}return!0},children:e.jsx(de,{customRequest:async l=>{var y,j;const r=await I.base.uploadFile({type:"avatar",access:"public"},l.file);r.length>0?((y=l.onSuccess)==null||y.call(l,r[0].id),a==null||a(r[0].id)):(j=l.onError)==null||j.call(l,new Error("Upload file failed"))},listType:"picture-card",onPreview:m,maxCount:1,onChange:({file:l})=>{switch(l.status){case"removed":a==null||a(void 0);break;case"done":break;default:c(l);break}},fileList:o?[o]:[],...n,children:o?void 0:e.jsx(tt,{shape:s,onChange:a})})}),e.jsx($,{open:i,footer:null,onCancel:()=>d(!1),children:e.jsx("img",{style:{width:"100%"},src:u})})]})},yt=({className:t})=>{const{t:a}=S("common"),{user:s}=se(),{currentOrgId:n,setCurrentOrgId:o}=Ve(),c=(s==null?void 0:s.organizations)||[],i=m=>{o(m),window.location.reload()};if(c.length===0)return null;const d=c.find(m=>m.id===n),u=d?d.name:a("organization.global",{defaultValue:"Global"}),h=[...c.map(m=>({key:m.id,label:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:m.name}),n===m.id&&e.jsx(ge,{})]}),onClick:()=>i(m.id)}))];return e.jsxs(ae,{className:t,menu:{items:h,selectedKeys:n?[n]:[""]},children:[e.jsx(fe,{style:{marginRight:4}}),e.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:u})]})},vt=({onResize:t,minWidth:a=300,maxWidth:s=window.innerWidth*.5})=>{const[n,o]=p.useState(!1),[c,i]=p.useState(!1),d=p.useCallback(m=>{m.preventDefault(),o(!0)},[]),u=p.useCallback(m=>{if(!n)return;const l=window.innerWidth-m.clientX,r=Math.max(a,Math.min(s,l));t(r)},[n,a,s,t]),h=p.useCallback(()=>{o(!1)},[]);return p.useEffect(()=>{if(n)return document.addEventListener("mousemove",u),document.addEventListener("mouseup",h),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",h),document.body.style.cursor="",document.body.style.userSelect=""}},[n,u,h]),e.jsx("div",{onMouseDown:d,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:n?"none":"background-color 0.2s ease",backgroundColor:n?"#1890ff":c?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:n||c?"#fff":"#999",opacity:n||c?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},nt=je,at=t=>nt[t],wt=({iconName:t})=>{if(!t)return null;const a=at(t);return a?e.jsx(p.Suspense,{fallback:null,children:e.jsx(a,{})}):null},St=({className:t,onSuccess:a,token:s})=>{const{t:n}=S("authorization"),{t:o}=S("common"),[c]=g.useForm(),{run:i,loading:d}=z(async u=>I.authorization.changePassword(u,s?{headers:{Authorization:`Bearer ${s}`}}:{}),{manual:!0,onSuccess:()=>{w.success(n("user.passwordChanged")),c.resetFields(),a==null||a()},onError:u=>{if(u instanceof qe){const h=u.code??"normal";w.error(n(`user.passwordChangeFailed.${h}`,{error:u.message,defaultValue:"Password change failed: {{error}}"}))}else w.error(n("user.passwordChangeFailed.normal",{error:u.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",u)}});return e.jsxs(g,{form:c,layout:"vertical",onFinish:i,style:{maxWidth:500,margin:"0 auto"},className:R("profile-password",t),children:[e.jsx(g.Item,{name:"old_password",label:n("user.oldPassword"),rules:[{required:!0,message:n("validation.oldPasswordRequired")}],className:R("profile-password-item","profile-password-item-old-password"),children:e.jsx(C.Password,{})}),e.jsx(g.Item,{name:"new_password",label:n("user.newPassword"),rules:[{required:!0,message:n("validation.newPasswordRequired")},{min:8,message:n("validation.passwordMinLength")}],className:R("profile-password-item","profile-password-item-new-password"),children:e.jsx(C.Password,{})}),e.jsx(g.Item,{name:"confirm_password",label:n("user.confirmPassword"),className:R("profile-password-item","profile-password-item-confirm-password"),rules:[{required:!0,message:n("validation.confirmPasswordRequired")},({getFieldValue:u})=>({validator(h,m){return!m||u("new_password")===m?Promise.resolve():Promise.reject(new Error(n("validation.passwordMismatch")))}})],children:e.jsx(C.Password,{})}),e.jsx(g.Item,{className:R("profile-password-item","profile-password-item-submit"),children:e.jsx(v,{type:"primary",htmlType:"submit",loading:d,children:o("save")})})]})},bt=({user:t,onSuccess:a})=>{const{t:s}=S("authorization"),{t:n}=S("common"),[o]=g.useForm(),[c,i]=p.useState(!1);ye.useEffect(()=>{t&&o.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,o]);const d=async u=>{try{i(!0),await I.authorization.updateCurrentUser(u),w.success(n("updateSuccess")),a()}catch(h){w.error(n("updateFailed")),console.error("Failed to update user information:",h)}finally{i(!1)}};return e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxs("div",{children:[s("user.roles"),": ",t.roles.map(u=>u.name).join(", ")]})]}),e.jsxs(g,{form:o,layout:"vertical",onFinish:d,style:{width:"100%",maxWidth:500},children:[e.jsx(g.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsx(st,{})}),e.jsx(g.Item,{name:"username",label:s("user.username"),children:e.jsx(C,{disabled:!0})}),e.jsx(g.Item,{name:"email",label:s("user.email"),rules:[{required:!0,message:s("validation.emailRequired")},{type:"email",message:s("validation.emailInvalid")}],children:e.jsx(C,{})}),e.jsx(g.Item,{name:"full_name",label:s("user.fullName"),rules:[{required:!0,message:s("validation.fullNameRequired")}],children:e.jsx(C,{})}),e.jsx(g.Item,{name:"phone",label:s("user.phone"),children:e.jsx(C,{})}),e.jsx(g.Item,{children:e.jsx(v,{type:"primary",htmlType:"submit",loading:c,children:n("save")})})]})]})},It=({user:t,onSuccess:a})=>{const{t:s}=S("authorization"),{t:n}=S("common"),[o,c]=p.useState(0),[i,d]=p.useState(!1),[u,h]=p.useState(!0),[m,l]=p.useState(""),[r,y]=p.useState("totp"),{run:j,data:f={secret:"",qr_code:"",token:void 0}}=z(()=>I.authorization.enableMfa(r),{manual:!0,onSuccess:()=>{c(1)},onBefore:()=>{d(!0)},onFinally:()=>{d(!1)}}),b=async()=>{if(!m){w.warning(s("mfa.enterVerificationCode"));return}const k={code:m,mfa_type:r};"token"in f&&(k.token=f.token);try{d(!0),await I.authorization.verifyAndActivateMfa(k),w.success(s("mfa.enableSuccess")),c(2),a()}catch(L){w.error(s("mfa.verificationFailed")),console.error("Failed to verify MFA:",L)}finally{d(!1)}},x=async()=>{try{d(!0),await I.authorization.disableMfa(),w.success(s("mfa.disableSuccess")),a()}catch(k){w.error(n("operationFailed")),console.error("Failed to disable MFA:",k)}finally{d(!1)}},F=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsx(H,{status:"success",title:s("mfa.enabled"),subTitle:s("mfa.enabledDescription"),extra:e.jsx(v,{danger:!0,onClick:()=>{$.confirm({title:s("mfa.confirmDisable"),content:s("mfa.disableWarning"),onOk:x,okButtonProps:{danger:!0}})},children:s("mfa.disable")})});const k=()=>{var L;switch(o){case 0:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:e.jsxs("div",{children:[e.jsx("p",{children:s("mfa.setupInfo")}),e.jsx("p",{children:s(r==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsx(v,{type:"primary",onClick:j,loading:i,children:s("mfa.startSetup")})]});case 1:return e.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsx(K,{message:s("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:r==="totp"?"block":"none"}}),e.jsx("div",{style:{display:r==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsx(Ie,{value:f.qr_code??"",size:200})}),e.jsx("div",{style:{marginBottom:16,display:r==="email"?"block":"none"},children:e.jsxs("p",{children:[s("user.email"),": ",e.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsx("div",{style:{marginBottom:16,display:r==="totp"?"block":"none"},children:e.jsxs("p",{children:[s("mfa.secretKey"),": ",e.jsx("strong",{children:u?"*".repeat(((L=f.secret)==null?void 0:L.length)??0):f.secret}),e.jsx(v,{type:"link",onClick:()=>h(!u),icon:u?e.jsx(te,{}):e.jsx(Ce,{})})]})}),e.jsx("div",{style:{marginBottom:24},children:e.jsx(C,{placeholder:s("mfa.enterCode"),style:{width:200},maxLength:6,value:m,onChange:_=>l(_.target.value)})}),e.jsxs(A,{children:[e.jsx(v,{onClick:()=>c(0),children:n("previous")}),e.jsx(v,{type:"primary",onClick:b,loading:i,children:n("verify")})]})]});case 2:return e.jsx(H,{status:"success",title:s("mfa.setupSuccess"),subTitle:s("mfa.setupSuccessDescription"),extra:e.jsx(v,{type:"primary",onClick:()=>c(0),children:n("done")})});default:return null}};return e.jsxs("div",{children:[e.jsxs("div",{style:{display:o===2?"none":"unset"},children:[e.jsx(ve,{defaultValue:"totp",onChange:L=>{y(L),c(0)},value:r,options:[{value:"totp",icon:e.jsx(we,{}),label:s("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsx(Se,{}),label:s("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsx(ee,{})]}),e.jsx(be,{current:o,items:[{title:s(r==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:s(r==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:s(r==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:s(r==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:s(r==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:s(r==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),k()]})};return e.jsx(D,{title:s("mfa.title"),children:F()})},{Text:N}=Fe,Ct=()=>{const{t}=S("authorization"),{t:a}=S("common"),[s,n]=p.useState(null),[o,c]=p.useState(!1),{data:i=[],loading:d,run:u}=z(()=>I.authorization.getUserSessions({}),{onError:r=>{w.error(t("session.getSessionsFailed",{error:r,defaultValue:"Failed to get session list: {{error}}"}))}}),{run:h}=z(r=>I.authorization.terminateSession({id:r}),{onSuccess:()=>{w.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"})),u()},onError:r=>{w.error(t("session.terminateFailed",{error:r,defaultValue:"Failed to terminate session: {{error}}"}))},onFinally:()=>{n(null)},onBefore:([r])=>{n(r)},manual:!0}),{run:m}=z(()=>I.authorization.terminateOtherSessions(),{onSuccess:()=>{w.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"})),u()},onError:r=>{w.error(t("session.terminateAllFailed",{error:r,defaultValue:"Failed to terminate all other sessions: {{error}}"}))},onFinally:()=>{c(!1)},onBefore:()=>{c(!0)},manual:!0}),l=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(r,y)=>e.jsxs(A,{direction:"vertical",size:0,children:[e.jsxs(A,{children:[e.jsx(ke,{}),e.jsx(N,{strong:!0,children:r})]}),e.jsxs(A,{children:[e.jsx(Le,{}),e.jsx(N,{type:"secondary",children:y.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:r=>e.jsxs(A,{children:[e.jsx(Ae,{}),e.jsx("span",{children:r})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:r=>e.jsxs(A,{children:[e.jsx(Te,{}),e.jsx("span",{children:new Date(r).toLocaleString()})]})},{title:t("session.status"),key:"status",render:r=>r.is_current?e.jsx(E,{color:"green",children:t("session.current")}):e.jsx(E,{color:"blue",children:t("session.active")})},{title:a("actions"),key:"action",render:r=>r.is_current?e.jsx(N,{type:"secondary",children:t("session.currentSession")}):e.jsx(U,{title:t("session.confirmTerminate"),onConfirm:()=>h(r.id),okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{type:"link",danger:!0,loading:s===r.id,children:t("session.terminate")})})}];return e.jsx(D,{title:t("session.title"),loading:d,extra:e.jsxs(A,{children:[i.length>1&&e.jsx(U,{title:t("session.confirmTerminateAll"),onConfirm:m,okText:a("confirm"),cancelText:a("cancel"),children:e.jsx(v,{danger:!0,loading:o,children:t("session.terminateOthers")})}),e.jsx(v,{onClick:()=>u(),loading:d,children:a("refresh")})]}),children:!d&&i.length===0?e.jsx(ze,{description:t("session.noSessions")}):e.jsx(O,{columns:l,dataSource:i,rowKey:"id",loading:d,pagination:!1})})},{RangePicker:rt}=Pe,{Option:P}=T,it=t=>t||"N/A",ot=(t,a)=>t==="success"?e.jsx(E,{color:"success",children:a("statuses.success")}):e.jsx(E,{color:"error",children:a("statuses.failed")}),kt=({userId:t,request:a=n=>t?I.authorization.getUserLogs({id:t,...n}):I.authorization.getCurrentUserLogs(n),columnsFilter:s=n=>n})=>{const{t:n}=S("authorization"),{t:o}=S("common"),[c,i]=p.useState({current:1,pageSize:10,total:0}),[d,u]=p.useState({}),[h]=g.useForm(),{loading:m,run:l,data:{data:r}={}}=z(async(x=d,F=1,k=10)=>a({...x,current:F??1,page_size:k??10}),{onError(x){w.error(n("auditLog.fetchFailed",{error:x}))},onSuccess({total:x}){i({...c,total:x})}});p.useEffect(()=>{l(d,1,c.pageSize)},[]);const y=x=>{i({...c,current:x.current,pageSize:x.pageSize}),l({},x.current,x.pageSize)},j=x=>{var F,k,L,_;l({...x,start_time:(k=(F=x.dateRange)==null?void 0:F[0])==null?void 0:k.toISOString(),end_time:(_=(L=x.dateRange)==null?void 0:L[1])==null?void 0:_.toISOString()},1,c.pageSize)},f=()=>{h.resetFields(),u({}),i({...c,current:1}),l({},1,c.pageSize)},b=[{title:n("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:x=>He(x)},{title:n("auditLog.action"),dataIndex:"action",key:"action",render:(x,F)=>x?n(`action.${x.replace(":",".")}`,{defaultValue:F.action_name}):F.action_name??F.action},{title:n("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:n("auditLog.ip"),dataIndex:"ip",key:"ip",render:x=>it(x)},{title:n("auditLog.status"),dataIndex:"status",key:"status",render:x=>ot(x,n)},{title:n("auditLog.details"),dataIndex:"details",key:"details",render:x=>e.jsx(v,{type:"link",icon:e.jsx(te,{}),onClick:()=>{$.info({title:n("auditLog.details"),content:JSON.stringify(x)})}})}];return e.jsxs("div",{children:[e.jsx(D,{style:{marginBottom:16},children:e.jsxs(g,{form:h,layout:"horizontal",onFinish:j,initialValues:d,children:[e.jsxs(J,{gutter:24,children:[e.jsx(M,{span:6,children:e.jsx(g.Item,{name:"search",label:n("auditLog.search"),children:e.jsx(C,{placeholder:n("auditLog.searchPlaceholder")})})}),e.jsx(M,{span:6,children:e.jsx(g.Item,{name:"action",label:n("auditLog.action"),children:e.jsxs(T,{allowClear:!0,placeholder:n("auditLog.selectAction"),children:[e.jsx(P,{value:"login",children:n("actions.login")}),e.jsx(P,{value:"logout",children:n("actions.logout")}),e.jsx(P,{value:"password_reset",children:n("actions.passwordReset")}),e.jsx(P,{value:"mfa_change",children:n("actions.mfaChange")})]})})}),e.jsx(M,{span:6,children:e.jsx(g.Item,{name:"status",label:n("auditLog.status"),children:e.jsxs(T,{allowClear:!0,placeholder:n("auditLog.selectStatus"),children:[e.jsx(P,{value:"success",children:n("statuses.success")}),e.jsx(P,{value:"failed",children:n("statuses.failed")})]})})}),e.jsx(M,{span:6,children:e.jsx(g.Item,{name:"dateRange",label:n("auditLog.dateRange"),children:e.jsx(rt,{style:{width:"100%"}})})})]}),e.jsx(J,{children:e.jsx(M,{span:24,style:{textAlign:"right"},children:e.jsxs(A,{children:[e.jsx(v,{onClick:f,children:o("reset")}),e.jsx(v,{type:"primary",htmlType:"submit",icon:e.jsx(Re,{}),children:o("search")})]})})})]})}),e.jsxs(D,{children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(v,{type:"primary",icon:e.jsx(Me,{}),onClick:f,style:{marginRight:8},children:o("refresh")})}),e.jsx(O,{rowKey:"id",columns:s(b),dataSource:r,pagination:{...c,showSizeChanger:!0,showTotal:x=>o("totalItems",{total:x})},loading:m,onChange:y,scroll:{x:"max-content"}})]})]})},ie=({permission:t,permissions:a=[],checkAll:s=!1,fallback:n=null,children:o})=>{const{hasPermission:c,hasAnyPermission:i,hasAllPermissions:d,isAdmin:u,loading:h}=ne();return h?null:u?e.jsx(e.Fragment,{children:o}):t?c(t)?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:n}):a.length>0?(s?d(a):i(a))?e.jsx(e.Fragment,{children:o}):e.jsx(e.Fragment,{children:n}):e.jsx(e.Fragment,{children:o})},Q=t=>{const[a,s]=p.useState(!1),{permission:n,icon:o,tooltip:c,onClick:i,confirm:d,label:u,...h}=t,m=i?async()=>{s(!0);try{await i()}finally{s(!1)}}:void 0;let l=e.jsx(v,{type:"text",size:"small",loading:a,icon:o,onClick:d?void 0:m,...h,children:u&&e.jsx("span",{style:{position:"inherit",top:"-2px"},children:u})});if(c&&(l=e.jsx(De,{title:c,children:l})),d){const r=async()=>{d.onConfirm?d.onConfirm():m&&await m()};l=e.jsx(U,{title:d.title,description:d.description,onConfirm:r,okText:d.okText,cancelText:d.cancelText,children:l})}return n&&(l=e.jsx(ie,{permission:n,children:l})),l},Ft=({actions:t,maxVisibleItems:a})=>{const s=t.filter(i=>!i.hidden);if(!a||s.length<=a)return e.jsx(e.Fragment,{children:s.map(({key:i,...d})=>e.jsx(Q,{...d},i))});const n=s.slice(0,a-1),c=s.slice(a-1).map(i=>{const{key:d,label:u,icon:h,permission:m,onClick:l,confirm:r,disabled:y,tooltip:j}=i,b={key:d,label:u,icon:h,disabled:y,onClick:async()=>{r?$.confirm({title:r.title,content:r.description,onOk:r.onConfirm,okText:r.okText,cancelText:r.cancelText}):l&&await l()}};return m?{...b,label:e.jsx(ie,{permission:m,children:e.jsx("span",{children:u??j})})}:b});return e.jsxs(e.Fragment,{children:[n.map(({key:i,...d})=>e.jsx(Q,{...d},i)),e.jsx(Y,{menu:{items:c},trigger:["click"],children:e.jsx(v,{type:"text",size:"small",icon:e.jsx(_e,{})})})]})},lt=({request:t,tableRef:a,...s},n)=>{const[o,c]=p.useState({current:1,pageSize:10}),[i,d]=p.useState(0),{data:u,loading:h,refresh:m}=z(async()=>{const l=await t({current:o.current,page_size:o.pageSize});return d(l.total),l.data},{refreshDeps:[o]});return p.useImperativeHandle(n,()=>({reload:()=>{m()}})),e.jsx(O,{rowKey:"id",loading:h,dataSource:u??[],pagination:{...o,total:i,onChange:(l,r)=>{c({current:l,pageSize:r})}},...s,ref:a})},Lt=({actionRef:t,...a})=>{const[s,n]=p.useState();return p.useEffect(()=>{n(p.forwardRef(lt))},[]),s?e.jsx(s,{...a,ref:t}):null},{TextArea:Z}=C,{Option:B}=T,At=({field:t,selectedType:a,dependentValues:s,formValues:n={}})=>{const{t:o}=S("system"),{t:c}=S("common"),i=p.useMemo(()=>Ue(t.visible_when,n),[t.visible_when,n]),{options:d,loading:u}=Ne(t.data_source,t.options,s),h=p.useMemo(()=>t.data_source&&t.data_source.type!=="static"?d:t.options||[],[t.data_source,t.options,d]),m=h&&h.length>0;if(!i)return null;const l=[{required:t.required,message:o("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],r=()=>o(`settings.toolsets.${a}.${t.name}`,{defaultValue:t.display_name||t.name}),y=()=>o(`settings.toolsets.${a}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${c("enter",{defaultValue:"Enter"})} ${t.name}`}),j=()=>{if(t.description)return o(`settings.toolsets.${a}.${t.name}Tooltip`,{defaultValue:t.description})};if(!i)return null;if(t.type==="select"||t.data_source)return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(T,{loading:u,allowClear:!0,placeholder:y(),showSearch:!0,filterOption:(f,b)=>{var x;return(x=b==null?void 0:b.children)==null?void 0:x.toLowerCase().includes(f.toLowerCase())},children:h.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name);switch(t.type){case"text":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,children:e.jsx(Z,{placeholder:y(),rows:4})},t.name);case"string":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(T,{allowClear:!0,placeholder:y(),children:h.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(C,{placeholder:y()})},t.name);case"password":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(C.Password,{placeholder:y(),autoComplete:"new-password"})},t.name);case"number":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(T,{allowClear:!0,placeholder:y(),children:h.map(f=>e.jsx(B,{value:f.value,children:f.label},f.value))})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx($e,{style:{width:"100%"},placeholder:y()})},t.name);case"boolean":return e.jsx(g.Item,{name:["config",t.name],label:r(),valuePropName:"checked",tooltip:j(),children:e.jsx(Ee,{})},t.name);case"array":return m?e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(X.Group,{style:{width:"100%"},children:e.jsx(A,{direction:"vertical",children:h.map(f=>e.jsx(X,{value:f.value,children:f.label},f.value))})})},t.name):e.jsx(g.Item,{name:["config",t.name],label:r(),rules:l,tooltip:j(),children:e.jsx(T,{mode:"tags",style:{width:"100%"},placeholder:y(),tokenSeparators:[","]})},t.name);case"object":return e.jsx(g.Item,{name:["config",t.name],label:r(),rules:[...l,{validator:(f,b)=>{if(!b)return Promise.resolve();try{return JSON.parse(b),Promise.resolve()}catch{return Promise.reject(new Error(o("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:j(),children:e.jsx(Z,{rows:4,placeholder:y()})},t.name);default:return null}},ct=t=>{var o;const{className:a,children:s}=t,n=((o=a==null?void 0:a.match(/language-(\w+)/))==null?void 0:o[1])||"";return typeof s!="string"?null:n==="mermaid"?e.jsx(Ke,{children:s}):e.jsx(Je,{lang:n,children:s})},Tt=({content:t,className:a,style:s,paragraphTag:n="div",rootClassName:o,components:c={code:ct}})=>e.jsx(We,{content:t,className:a,style:s,components:c,paragraphTag:n,rootClassName:o});export{et as A,wt as D,ae as H,G as L,Tt as M,yt as O,ft as P,vt as R,Lt as T,kt as U,jt as a,St as b,bt as c,It as d,Ct as e,ie as f,Ze as g,Ft as h,At as i,st as j};
