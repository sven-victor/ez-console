import{dd as b,aI as I,u as m,a as T,R as C,j as t,aq as u,S as _,B as i,f,dp as r,T as R,aK as S,af as D,dF as F,dG as v,e as A,dz as $,s as l}from"./vendor.CyaXoMFn.js";import{a as c}from"./index.Dwpr26wG.js";import{f as d,i as L}from"./components.BXKFJ6ns.js";import"./vite.BF1G3H_w.js";import"./lodash.BDtH7uFP.js";import"./highlight.BslI14e2.js";import"./ai.BrMpU1e1.js";import"./client.CicVKWRR.js";import"./base.CIILqgsu.js";import"./authorization.BwAKdzUH.js";import"./system.D28L4Wa8.js";import"./oauth.Bmu-E-Gy.js";import"./tasks.D7biEi4l.js";import"./user_tasks.DwX1J3U_.js";import"./contexts.DcBdfNkE.js";import"./ai-chat-layout.DgTSLs6W.js";import"./ant-design-x.DtIK71LU.js";import"./highlighter.D7vD0g9D.js";import"./refractor.CNsL8aOR.js";import"./mermaid.DgR_v9UM.js";const P={pending:"default",running:"processing",success:"success",failed:"error",cancelled:"default"},se=()=>{const{id:s}=b(),o=I(),{t:a}=m("task"),{t:h}=m("common"),{data:e,loading:x,refresh:n}=T(()=>s?c.tasks.getTask({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s});C.useEffect(()=>{if(!s||!e||e.status!=="running"&&e.status!=="pending")return;const p=setInterval(n,2e3);return()=>clearInterval(p)},[s,e==null?void 0:e.status,n]);const j=async()=>{if(s)try{await c.tasks.cancelTask({id:s}),l.success(a("cancelSuccess",{defaultValue:"Task cancelled."})),n()}catch{l.error(a("cancelFailed",{defaultValue:"Failed to cancel task."}))}},k=async()=>{if(s)try{await c.tasks.retryTask({id:s}),l.success(a("retrySuccess",{defaultValue:"Task retry requested."})),n()}catch{l.error(a("retryFailed",{defaultValue:"Failed to retry task."}))}},y=async()=>{if(s)try{await c.tasks.deleteTask({id:s}),l.success(a("deleteSuccess",{defaultValue:"Task deleted."})),o("/tasks")}catch{l.error(a("deleteFailed",{defaultValue:"Failed to delete task."}))}},g=()=>{if(!(e!=null&&e.artifact_file_key))return;window.open(`/api/files/${e.artifact_file_key}`,"_blank")};if(x&&!e)return t.jsx(u,{children:t.jsx(_,{spinning:!0})});if(!e)return t.jsxs(u,{children:[t.jsx("p",{children:a("notFound",{defaultValue:"Task not found."})}),t.jsx(i,{type:"primary",onClick:()=>o("/tasks"),children:a("backToList",{defaultValue:"Back to list"})})]});const V=e.status==="running"||e.status==="pending",w=e.status==="failed"||e.status==="cancelled";return t.jsx(u,{title:a("detailTitle",{defaultValue:"Task Detail"}),extra:t.jsx(i,{type:"text",icon:t.jsx($,{}),onClick:()=>o("/tasks"),children:h("back",{defaultValue:"Back"})}),children:t.jsxs(f,{direction:"vertical",style:{width:"100%"},size:"middle",children:[t.jsxs(r,{bordered:!0,column:1,size:"small",children:[t.jsx(r.Item,{label:a("typeLabel",{defaultValue:"Type"}),children:a(`type.${e.type}`,{defaultValue:e.type})}),t.jsx(r.Item,{label:a("statusLabel",{defaultValue:"Status"}),children:t.jsx(R,{color:P[e.status]||"default",children:a(`status.${e.status}`,{defaultValue:e.status})})}),t.jsxs(r.Item,{label:a("progress",{defaultValue:"Progress"}),children:[(e.status==="running"||e.status==="pending")&&t.jsx(S,{percent:e.progress??0,size:"small",style:{maxWidth:200}}),e.status!=="running"&&e.status!=="pending"&&"-"]}),t.jsx(r.Item,{label:a("creatorId",{defaultValue:"Creator"}),children:e.creator_id}),t.jsx(r.Item,{label:a("createdAt",{defaultValue:"Created At"}),children:e.created_at?new Date(e.created_at).toLocaleString():"-"}),t.jsx(r.Item,{label:a("startedAt",{defaultValue:"Started At"}),children:e.started_at?new Date(e.started_at).toLocaleString():"-"}),t.jsx(r.Item,{label:a("finishedAt",{defaultValue:"Finished At"}),children:e.finished_at?new Date(e.finished_at).toLocaleString():"-"}),e.error&&t.jsx(r.Item,{label:a("error",{defaultValue:"Error"}),children:t.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",color:"var(--ant-color-error)"},children:e.error})}),e.result&&t.jsx(r.Item,{label:a("result",{defaultValue:"Result"}),children:t.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",maxHeight:200,overflow:"auto"},children:e.result})})]}),e.artifact_file_key&&t.jsx(f,{children:t.jsx(d,{permission:"task:view",children:t.jsx(i,{type:"primary",icon:t.jsx(D,{}),onClick:g,children:a("downloadArtifact",{defaultValue:"Download artifact"})})})}),t.jsxs(f,{wrap:!0,children:[V&&t.jsx(d,{permission:"task:cancel",children:t.jsx(i,{icon:t.jsx(F,{}),onClick:j,children:a("cancel",{defaultValue:"Cancel"})})}),w&&t.jsx(d,{permission:"task:retry",children:t.jsx(i,{icon:t.jsx(v,{}),onClick:k,children:a("retry",{defaultValue:"Retry"})})}),t.jsx(d,{permission:"task:delete",children:t.jsx(L,{actions:[{key:"delete",label:a("delete",{defaultValue:"Delete"}),icon:t.jsx(A,{}),danger:!0,confirm:{title:a("deleteConfirm",{defaultValue:"Delete this task?"}),onConfirm:y}}]})})]})]})})};export{se as default};
