var u=Object.defineProperty;var l=(t,e,r)=>e in t?u(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var c=(t,e,r)=>l(t,typeof e!="symbol"?e+"":e,r);import{g as d}from"./base.zBL7EeCi.js";import{b as p}from"./vendor.2aaXemON.js";const m="/api",s=p.create({baseURL:m,timeout:3e4,headers:{"Content-Type":"application/json"}});class i extends Error{constructor(r,n){super(n);c(this,"code");this.code=r}}s.interceptors.request.use(t=>{if(!t.withoutAuth){const r=localStorage.getItem("token");r&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${r}`)}const e=localStorage.getItem("i18nextLng");return e&&(t.headers["Accept-Language"]=e),t},t=>Promise.reject(t));s.interceptors.response.use(t=>{const e=t.data;return e&&e.code!==void 0?e.code==="0"?e.total!==void 0&&e.current!==void 0&&e.page_size!==void 0?{data:e.data,total:e.total,current:e.current,page_size:e.page_size}:e.data:Promise.reject(e||"Unknown error"):t.data},t=>{var n,o,a;((n=t.response)==null?void 0:n.status)===401&&window.location.pathname!==d("/login")&&(localStorage.removeItem("token"),delete s.defaults.headers.common.Authorization,window.location.href=d("/login?redirect="+encodeURIComponent(window.location.href)));const e=(o=t.response)==null?void 0:o.data;let r=new i(((a=t.response)==null?void 0:a.status.toString())||"500",t.message);return console.log("errorResponse",e),e&&(e.err?r=new i(e.code,e.err):e.error&&(r=new i(e.code,e.error))),Promise.reject(r)});async function f(t,e){const{signal:r,...n}=e||{},o=await fetch(t,{method:n.method||"GET",headers:n.headers,body:n.body,signal:r});if(console.log(o),!o.ok||!o.body){if(o.body)try{const a=await o.json();throw new Error(`SSE connection failed: ${a.message}`)}catch{throw new Error(`SSE connection failed: ${o.statusText}`)}throw new Error(`SSE connection failed: ${o.statusText}`)}if(o.status!==200){const a=await o.json();throw new Error(`SSE connection failed: ${a.message}`)}return o.body}function h(t){if(t)return typeof t.toJSON=="function"?t.toJSON():Object.fromEntries(Object.entries(t).map(([e,r])=>[e,String(r)]))}async function y(t,e){const{requestType:r,signal:n,...o}=e||{};return r==="sse"?f(t,{headers:{Accept:"text/event-stream","Content-Type":"application/json","Accept-Language":localStorage.getItem("i18nextLng")||"en-US",Authorization:`Bearer ${localStorage.getItem("token")}`,...h(o.headers)},method:o.method,body:JSON.stringify(o.data),signal:n}):r==="form"?s.request({url:t,baseURL:"",...o,headers:{...e==null?void 0:e.headers,"Content-Type":"multipart/form-data"}}):s.request({url:t,baseURL:"",...o})}export{i as A,m as b,s as c,y as r};
