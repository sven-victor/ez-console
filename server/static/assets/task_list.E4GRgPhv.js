import{u as p,r as m,j as a,T as _,f as u,dF as R,p as h,B as c,dG as S,af as b,e as F,aq as $,ao as A,b2 as x,d as D,s as i}from"./vendor.CyaXoMFn.js";import{a as n}from"./index.Dwpr26wG.js";import{f as o,i as k,g as E}from"./components.BXKFJ6ns.js";import{P as y}from"./base.CIILqgsu.js";import"./vite.BF1G3H_w.js";import"./lodash.BDtH7uFP.js";import"./highlight.BslI14e2.js";import"./ai.BrMpU1e1.js";import"./client.CicVKWRR.js";import"./authorization.BwAKdzUH.js";import"./system.D28L4Wa8.js";import"./oauth.Bmu-E-Gy.js";import"./tasks.D7biEi4l.js";import"./user_tasks.DwX1J3U_.js";import"./contexts.DcBdfNkE.js";import"./ai-chat-layout.DgTSLs6W.js";import"./ant-design-x.DtIK71LU.js";import"./highlighter.D7vD0g9D.js";import"./refractor.CNsL8aOR.js";import"./mermaid.DgR_v9UM.js";const L={pending:"default",running:"processing",success:"success",failed:"error",cancelled:"default"},ae=()=>{const{t:s}=p("task"),{t:d}=p("common"),r=m.useRef(null),[f,j]=m.useState(""),g=async t=>{var e,l;try{await n.tasks.cancelTask({id:t}),i.success(s("cancelSuccess",{defaultValue:"Task cancelled."})),(l=(e=r.current)==null?void 0:e.reload)==null||l.call(e)}catch{i.error(s("cancelFailed",{defaultValue:"Failed to cancel task."}))}},w=async t=>{var e,l;try{await n.tasks.retryTask({id:t}),i.success(s("retrySuccess",{defaultValue:"Task retry requested."})),(l=(e=r.current)==null?void 0:e.reload)==null||l.call(e)}catch{i.error(s("retryFailed",{defaultValue:"Failed to retry task."}))}},V=async t=>{var e,l;try{await n.tasks.deleteTask({id:t}),i.success(s("deleteSuccess",{defaultValue:"Task deleted."})),(l=(e=r.current)==null?void 0:e.reload)==null||l.call(e)}catch{i.error(s("deleteFailed",{defaultValue:"Failed to delete task."}))}},T=async t=>{const e=await n.base.downloadFile({fileKey:t},{params:{method:"sign"}}),l=`/api/files/${t}?signature=${e.signature}&expires=${e.expires}`;window.open(l,"_blank")},C=[{title:s("typeLabel",{defaultValue:"Type"}),dataIndex:"type",key:"type",width:120},{title:s("statusLabel",{defaultValue:"Status"}),dataIndex:"status",key:"status",width:100,render:t=>a.jsx(_,{color:L[t]||"default",children:s(`status.${t}`,{defaultValue:t})})},{title:s("progress",{defaultValue:"Progress"}),dataIndex:"progress",key:"progress",width:100,render:(t,e)=>e.status==="running"||e.status==="pending"?`${t}%`:"-"},{title:s("creatorId",{defaultValue:"Creator"}),dataIndex:"creator_id",key:"creator_id",width:120,ellipsis:!0},{title:s("createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",width:170,render:t=>t?new Date(t).toLocaleString():"-"},{title:d("actions",{defaultValue:"Actions"}),key:"action",width:220,fixed:"right",render:(t,e)=>a.jsxs(u,{size:"small",children:[(e.status==="running"||e.status==="pending")&&a.jsx(o,{permission:"task:cancel",children:a.jsx(k,{actions:[{key:"cancel",label:s("cancel",{defaultValue:"Cancel"}),icon:a.jsx(R,{}),confirm:{title:s("cancelConfirm",{defaultValue:"Cancel this task?"}),onConfirm:()=>g(e.id)}}]})}),(e.status==="failed"||e.status==="cancelled")&&a.jsx(o,{permission:"task:retry",children:a.jsx(h,{title:s("retry",{defaultValue:"Retry"}),children:a.jsx(c,{type:"text",size:"small",icon:a.jsx(S,{}),onClick:()=>w(e.id)})})}),e.artifact_file_key&&a.jsx(o,{permission:"task:view",children:a.jsx(h,{title:s("download",{defaultValue:"Download"}),children:a.jsx(c,{type:"text",size:"small",icon:a.jsx(b,{}),onClick:()=>T(e.artifact_file_key)})})}),a.jsx(o,{permission:"task:delete",children:a.jsx(k,{actions:[{key:"delete",label:s("delete",{defaultValue:"Delete"}),icon:a.jsx(F,{}),danger:!0,confirm:{title:s("deleteConfirm",{defaultValue:"Delete this task?"}),onConfirm:()=>V(e.id)}}]})})]})}],I=t=>n.tasks.listTasks({current:t.current??y.DEFAULT_CURRENT,page_size:t.page_size??y.DEFAULT_PAGE_SIZE,search:f||void 0});return a.jsx($,{title:s("listTitle",{defaultValue:"Task List"}),children:a.jsxs(u,{direction:"vertical",style:{width:"100%"},size:"middle",children:[a.jsxs(u,{wrap:!0,children:[a.jsx(A,{placeholder:s("searchPlaceholder",{defaultValue:"Search by type or ID"}),prefix:a.jsx(x,{}),value:f,onChange:t=>j(t.target.value),onPressEnter:()=>{var t,e;return(e=(t=r.current)==null?void 0:t.reload)==null?void 0:e.call(t)},style:{width:220},allowClear:!0}),a.jsx(c,{icon:a.jsx(x,{}),onClick:()=>{var t,e;return(e=(t=r.current)==null?void 0:t.reload)==null?void 0:e.call(t)},children:d("search",{defaultValue:"Search"})}),a.jsx(c,{icon:a.jsx(D,{}),onClick:()=>{var t,e;return(e=(t=r.current)==null?void 0:t.reload)==null?void 0:e.call(t)},children:d("refresh",{defaultValue:"Refresh"})})]}),a.jsx(E,{ref:r,request:I,columns:C,rowKey:"id",scroll:{x:900}})]})})};export{ae as default};
