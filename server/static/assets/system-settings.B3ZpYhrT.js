import{u as $,n as l,r as S,e as C,j as e,S as X,b9 as N,a1 as q,o as i,g as de,z as Ee,H as O,p as _,bf as ue,a4 as ae,s as h,bg as K,M as Y,h as Pe,bd as Z,y as Re,bh as qe,bi as Le,X as ee,_ as ce,bj as oe,bk as ie,a_ as be,T as H,bl as Me,b5 as Ve,bm as $e,aa as je,Y as ye,ab as _e,C as J,$ as re,a0 as Q,a8 as Se,aw as Ue,bn as he,aq as Ne,az as Oe,aW as De,t as ze,bo as fe}from"./vendor.2aaXemON.js";import{a as w}from"./index.BlXGBnBm.js";import{g as ge}from"./base.zBL7EeCi.js";import{g as le,h as Be,L as Ke}from"./components.BmqVvmt5.js";const W=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,He={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},Ge=({initialData:t,onRefresh:o})=>{const{t:a}=$("system"),{t:v}=$("common"),[c]=l.useForm(),[m,x]=S.useState((t==null?void 0:t.provider)||"custom"),[j,b]=S.useState((t==null?void 0:t.provider)==="custom"||(t==null?void 0:t.provider)==="autoDiscover"),[n,p]=S.useState((t==null?void 0:t.enabled)||!1),[u,T]=S.useState((t==null?void 0:t.auto_create_user)||!1),{loading:r,data:k,refresh:g}=C(w.system.getOauthSettings,{manual:!!t,onSuccess:f=>{c.setFieldsValue(f),x(f.provider),b(f.provider==="custom"||f.provider==="autoDiscover"),p(f.enabled),T(f.auto_create_user)},onError:f=>{h.error(a("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",f)}});S.useEffect(()=>{t&&(c.setFieldsValue(t),x(t.provider),b(t.provider==="custom"||t.provider==="autoDiscover"),p(t.enabled),T(t.auto_create_user))},[t,c]);const E=f=>{x(f),b(f==="custom"||f==="autoDiscover");const R=He[f];R&&c.setFieldsValue({auth_endpoint:R.endpoints.auth_endpoint,token_endpoint:R.endpoints.token_endpoint,userinfo_endpoint:R.endpoints.userinfo_endpoint,scope:R.scope,email_field:R.email_field,username_field:R.username_field,full_name_field:R.full_name_field,avatar_field:R.avatar_field,role_field:R.role_field,icon_url:R.icon_url,display_name:R.display_name})},M=f=>{p(f)},F=f=>{T(f)},{loading:V,run:z}=C(w.system.updateOauthSettings,{manual:!0,onSuccess:()=>{h.success(a("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),o?o():g()},onError:f=>{h.error(a("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",f)}}),P=f=>{z(f)},D=()=>{o?o():g()},{loading:te,run:se}=C(async({redirect_uri:f,...R})=>{let B;return f?B=new URL(f):B=new URL(window.location.origin),B.pathname=ge("/system/settings/oauth/test-callback"),B.searchParams.set("provider",m),w.system.testOauthConnection({redirect_uri:B.toString(),...R})},{manual:!0,onSuccess:({url:f})=>{window.open(f,"_blank")},onError:f=>{h.error(a("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:f.message})),console.error("Failed to test OAuth connection",f)}}),G=()=>m==="custom";return e.jsx(X,{spinning:r,children:e.jsxs(l,{form:c,layout:"vertical",onFinish:P,initialValues:t||k,children:[e.jsx(l.Item,{name:"enabled",label:a("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:a("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsx(N,{onChange:M})}),e.jsx(l.Item,{name:"provider",label:a("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:a("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:n,message:a("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxs(q,{onChange:E,disabled:!n,children:[e.jsx(q.Option,{value:"github",children:a("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsx(q.Option,{value:"google",children:a("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsx(q.Option,{value:"dingtalk",children:a("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsx(q.Option,{value:"wechat",children:a("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsx(q.Option,{value:"autoDiscover",children:a("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsx(q.Option,{value:"custom",children:a("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsx(l.Item,{name:"display_name",label:a("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:a("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsx(i,{disabled:!n,placeholder:m!=="custom"?a(`settings.oauth.provider.options.${m}`,{defaultValue:m}):""})}),e.jsx(l.Item,{name:"icon_url",label:a("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:a("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:W,message:a("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!n,placeholder:"https://example.com/icon.png"})}),e.jsx(l.Item,{name:"client_id",label:a("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:a("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:n,message:a("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(l.Item,{name:"client_secret",label:a("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:a("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:n,message:a("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsx(i.Password,{disabled:!n,autoComplete:"off",visibilityToggle:!1,placeholder:a("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),G()&&e.jsx(l.Item,{name:"auth_endpoint",label:a("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:a("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:a("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:W,message:a("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(l.Item,{name:"wellknown_endpoint",hidden:m!=="autoDiscover",label:a("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:a("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:W,message:a("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:n&&m==="autoDiscover",message:a("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsx(i,{disabled:!n})}),G()&&e.jsx(l.Item,{name:"token_endpoint",label:a("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:a("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:a("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:W,message:a("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!n})}),G()&&e.jsx(l.Item,{name:"userinfo_endpoint",label:a("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:a("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:a("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:W,message:a("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(l.Item,{name:"scope",label:a("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:a("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:n,message:a("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsx(i,{disabled:!n})}),e.jsx(l.Item,{name:"redirect_uri",label:a("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:a("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[f=>f.getFieldValue("redirect_uri")!==""?{pattern:W,message:a("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsx(i,{disabled:!n,placeholder:`http://${window.location.host}${ge(`/login?provider=settings.${m}`)}`})}),e.jsx(l.Item,{name:"auto_create_user",label:a("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:a("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsx(N,{onChange:F,disabled:!n})}),e.jsx(l.Item,{name:"default_role",label:a("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:a("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:n&&u,message:a("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsx(i,{disabled:!n||!u})}),e.jsx(l.Item,{name:"mfa_enabled",label:a("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:a("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsx(N,{disabled:!n})}),e.jsx(de,{children:a("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsx(Ee,{style:{marginBottom:16},type:"info",showIcon:!0,message:a("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:j?"":a("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsx(l.Item,{name:"email_field",label:a("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:a("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsx(i,{placeholder:"email",disabled:!n||!j})}),e.jsx(l.Item,{name:"username_field",label:a("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:a("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsx(i,{placeholder:"login",autoComplete:"off",disabled:!n||!j})}),e.jsx(l.Item,{name:"full_name_field",label:a("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:a("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsx(i,{placeholder:"name",disabled:!n||!j})}),e.jsx(l.Item,{name:"avatar_field",label:a("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:a("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsx(i,{placeholder:"avatar_url",disabled:!n||!j})}),e.jsx(l.Item,{name:"role_field",label:a("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:a("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsx(i,{placeholder:"role",disabled:!n||!j})}),e.jsx(l.Item,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:V,icon:e.jsx(ue,{}),children:v("save",{defaultValue:"Save"})}),e.jsx(_,{loading:te,onClick:async()=>{const f=c.getFieldsValue();se(f)},children:a("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsx(_,{onClick:D,icon:e.jsx(ae,{}),children:v("refresh",{defaultValue:"Refresh"})})]})})]})})},Je=()=>{const{t}=$("system"),{t:o}=$("common"),[a]=l.useForm(),{loading:v,data:c,refresh:m}=C(w.system.getSecuritySettings,{onSuccess:n=>{a.setFieldsValue(n)},onError:n=>{h.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",n)}}),{loading:x,run:j}=C(w.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{h.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),m()},onError:n=>{h.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",n)}}),b=n=>{j(n)};return e.jsx(X,{spinning:v,children:e.jsxs(l,{form:a,layout:"vertical",onFinish:b,initialValues:c,children:[e.jsx(l.Item,{name:"mfa_enforced",label:t("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:t("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsx(N,{})}),e.jsx(l.Item,{name:"password_complexity",label:t("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:t("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxs(q,{children:[e.jsx(q.Option,{value:"low",children:t("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsx(q.Option,{value:"medium",children:t("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsx(q.Option,{value:"high",children:t("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsx(q.Option,{value:"very_high",children:t("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsx(l.Item,{name:"password_min_length",label:t("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:t("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsx(K,{min:6,max:32,style:{width:"100%"}})}),e.jsx(l.Item,{name:"password_expiry_days",label:t("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:t("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsx(K,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsx(l.Item,{name:"login_failure_lock",label:t("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:t("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsx(N,{})}),e.jsx(l.Item,{noStyle:!0,shouldUpdate:(n,p)=>n.login_failure_lock!==p.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsx(l.Item,{name:"login_failure_attempts",label:t("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:t("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsx(K,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsx(l.Item,{noStyle:!0,shouldUpdate:(n,p)=>n.login_failure_lock!==p.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsx(l.Item,{name:"login_failure_lockout_minutes",label:t("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:t("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsx(K,{min:1,max:10,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsx(l.Item,{name:"history_password_check",label:t("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:t("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsx(N,{})}),e.jsx(l.Item,{noStyle:!0,shouldUpdate:(n,p)=>n.history_password_check!==p.history_password_check,children:({getFieldValue:n})=>n("history_password_check")?e.jsx(l.Item,{name:"history_password_count",label:t("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:t("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsx(K,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsx(l.Item,{name:"inactive_account_lock_days",label:t("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:t("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsx(K,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsx(l.Item,{name:"session_timeout_minutes",label:t("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:t("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsx(K,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsx(l.Item,{name:"session_idle_timeout_minutes",label:t("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:t("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsx(K,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsx(l.Item,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:x,icon:e.jsx(ue,{}),children:o("save",{defaultValue:"Save"})}),e.jsx(_,{onClick:()=>m(),icon:e.jsx(ae,{}),children:o("refresh",{defaultValue:"Refresh"})})]})})]})})},Ze=({fetchItems:t,importItems:o,columns:a,...v})=>{const{t:c}=$("system"),[m,x]=S.useState([]),[j,b]=S.useState([]),{run:n,loading:p}=C(t,{onError:r=>{h.error(c("settings.ldap.importError",{error:`${r.message}`}))},onSuccess:r=>{x(r)},manual:!0}),{run:u,loading:T}=C(async()=>{for(const r of j.filter(k=>{const g=m.find(E=>E.ldap_dn===k);return!(!g||g.status==="imported")})){const k=await o([r]);x(g=>[...g].map(M=>{for(const F of k)if(M.ldap_dn===F.ldap_dn)return{...F,status:"imported"};return M}))}},{manual:!0});return S.useEffect(()=>{v.visible&&(x([]),n(),b([]))},[v.visible]),e.jsx(Y,{title:c("settings.ldap.importTitle"),...v,onOk:()=>{u()},width:900,confirmLoading:T,loading:p,children:e.jsx(ce,{rowKey:"ldap_dn",rowSelection:{onChange:r=>{b(r)},getCheckboxProps:r=>({disabled:r.status==="imported"})},columns:a.map(({render:r,...k})=>r?{...k,render:(g,E,M)=>{const F=j.includes(E.ldap_dn)&&T&&E.status!=="imported";return r(g,E,M,F)}}:k),dataSource:m,pagination:!1,scroll:{y:400,x:"max-content"}})})},We=()=>{var E,M,F;const{t}=$("system"),[o]=l.useForm(),[a,v]=S.useState(!1),[c,m]=S.useState(null),[x,j]=S.useState(!1),[b,n]=S.useState(!1),[p]=l.useForm(),[u,T]=S.useState(!1);C(w.system.getLdapSettings,{onSuccess:V=>{o.setFieldsValue(V),T(V.enabled)},onError:V=>{h.error(t("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${V.message}`}))}}),S.useEffect(()=>{m(null)},[x]);const r=async V=>{v(!0);try{await w.system.updateLdapSettings(V),h.success(t("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{h.error(t("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{v(!1)}},{run:k,loading:g}=C(async V=>{const z=await o.validateFields();return await w.system.testLdapConnection({...V,...z})},{onSuccess:V=>{m(V)},onError:V=>{h.error(t("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${V.message}`}))},manual:!0});return e.jsxs(e.Fragment,{children:[e.jsxs(l,{form:o,layout:"vertical",onFinish:r,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsx(l.Item,{label:t("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsx(N,{onChange:V=>T(V)})}),e.jsx(l.Item,{label:t("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:u,message:t("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsx(i,{disabled:!u,placeholder:"ldap://ldap.example.com:389"})}),e.jsx(l.Item,{label:t("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:u,message:t("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsx(i,{disabled:!u,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsx(l.Item,{label:t("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:u,message:t("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsx(i.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsx(l.Item,{label:t("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:u,message:t("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsx(i,{disabled:!u,placeholder:"dc=example,dc=com"})}),e.jsx(l.Item,{label:t("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsx(i,{disabled:!u,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsx(l.Item,{label:t("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:u,message:t("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsx(i,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:u,message:t("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsx(i,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:u,message:t("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsx(i,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:u,message:t("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsx(i,{disabled:!u})}),e.jsx(l.Item,{name:"timeout",label:t("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:t("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsx(i,{type:"number",defaultValue:15,disabled:!u})}),e.jsx(de,{children:t("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsx(l.Item,{label:t("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsx(N,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsx(N,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsx(i.TextArea,{placeholder:t("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!u})}),e.jsxs(l.Item,{children:[e.jsx(le,{permissions:["system:settings:update"],children:e.jsx(_,{type:"primary",htmlType:"submit",loading:a,children:t("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsx(le,{permissions:["system:settings:update"],children:e.jsx(_,{disabled:!u,style:{marginLeft:8},onClick:()=>j(!0),children:t("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsx(le,{permissions:["authorization:user:create"],children:e.jsx(_,{disabled:!u,style:{marginLeft:8},onClick:()=>{n(!0)},children:t("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxs(Y,{title:t("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:x,onCancel:()=>j(!1),footer:null,children:[e.jsxs(l,{form:p,layout:"vertical",onFinish:k,children:[e.jsx(l.Item,{label:t("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:t("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsx(i,{disabled:!u})}),e.jsx(l.Item,{label:t("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:t("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsx(i.Password,{disabled:!u})}),e.jsxs(l.Item,{children:[e.jsx(le,{permissions:["system:settings:update"],children:e.jsx(_,{disabled:!u,type:"primary",htmlType:"submit",children:t("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsx(_,{style:{marginLeft:8},onClick:()=>j(!1),children:t("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsx(X,{spinning:g,children:e.jsx(Pe,{active:g,loading:g,children:c&&(c.user?e.jsxs(Z,{bordered:!0,children:[e.jsx(Z.Item,{label:"Username",span:3,children:c.user.username}),e.jsx(Z.Item,{label:"Email",span:3,children:c.user.email}),e.jsx(Z.Item,{label:"FullName",span:3,children:c.user.full_name}),e.jsx(Z.Item,{label:"CreatedAt",span:3,children:c.user.created_at}),e.jsx(Z.Item,{label:"UpdatedAt",span:3,children:c.user.updated_at})]}):e.jsx(Re,{direction:"vertical",current:(E=c.message)==null?void 0:E.findIndex(V=>!V.success),status:(M=c.message)!=null&&M.find(V=>!V.success)?"error":"finish",items:(F=c.message)==null?void 0:F.map(V=>({status:V.success?"finish":"error",title:V.message}))}))})})]}),e.jsx(Ze,{visible:b,onCancel:()=>n(!1),fetchItems:()=>w.system.importLdapUsers({}),importItems:V=>w.system.importLdapUsers({user_dn:V}),columns:[{title:t("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:t("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:t("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:t("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(V,z,P,D)=>D?e.jsx(X,{indicator:e.jsx(qe,{spin:!0})}):V?e.jsx(Le,{twoToneColor:"#52c41a"}):z.id?e.jsx(ee,{color:"blue",children:t("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsx(ee,{color:"green",children:t("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},Qe=()=>{const{t}=$("system"),{t:o}=$("common"),[a]=l.useForm(),[v,c]=S.useState(null),[m,x]=S.useState(!1),[j]=l.useForm(),[b,n]=S.useState(!1),{loading:p}=C(w.system.getSmtpSettings,{onSuccess:g=>{a.setFieldsValue(g),n(g.enabled)},onError:g=>{h.error(t("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${g.message}`}))}});S.useEffect(()=>{c(null)},[m]);const{run:u,loading:T}=C(({port:g,...E})=>w.system.updateSmtpSettings({...E,port:Number(g)}),{manual:!0,onSuccess:()=>{h.success(t("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:g=>{h.error(t("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${g.message}`}))}}),{run:r,loading:k}=C(async g=>{const{port:E,...M}=await a.validateFields();return await w.system.testSmtpConnection({...g,...M,port:Number(E)})},{onSuccess:g=>{c(g)},onError:g=>{h.error(t("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${g.message}`}))},manual:!0});return e.jsxs(e.Fragment,{children:[e.jsx(X,{spinning:p,children:e.jsxs(l,{form:a,layout:"vertical",onFinish:u,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsx(l.Item,{label:t("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsx(N,{onChange:g=>n(g)})}),e.jsx(l.Item,{label:t("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:b,message:t("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsx(i,{disabled:!b,placeholder:"smtp.example.com"})}),e.jsx(l.Item,{label:t("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:b,message:t("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsx(i,{type:"number",disabled:!b,placeholder:"587"})}),e.jsx(l.Item,{label:t("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:b,message:t("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsx(i,{disabled:!b,placeholder:"user@example.com"})}),e.jsx(l.Item,{label:t("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsx(i.Password,{disabled:!b,autoComplete:"new-password"})}),e.jsx(l.Item,{label:t("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:b,message:t("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxs(oe.Group,{disabled:!b,children:[e.jsx(oe.Button,{value:"None",children:t("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsx(oe.Button,{value:"SSL/TLS",children:t("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsx(oe.Button,{value:"STARTTLS",children:t("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsx(l.Item,{label:t("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:b,message:t("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:t("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsx(i,{disabled:!b,placeholder:"noreply@example.com"})}),e.jsx(l.Item,{label:t("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsx(i,{disabled:!b,placeholder:t("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsx(de,{children:t("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsx(l.Item,{label:t("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsx(ie,{theme:"snow"})}),e.jsx(l.Item,{label:t("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsx(ie,{theme:"snow"})}),e.jsx(l.Item,{label:t("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsx(ie,{theme:"snow"})}),e.jsxs(l.Item,{children:[e.jsx(le,{permission:"system:setting:update",children:e.jsx(_,{type:"primary",htmlType:"submit",loading:T,style:{marginRight:8},children:o("save",{defaultValue:"Save"})})}),e.jsx(_,{onClick:()=>x(!0),disabled:!b||k,loading:k,children:t("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsx(Y,{title:t("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:m,onCancel:()=>x(!1),footer:[e.jsx(_,{onClick:()=>x(!1),children:o("cancel",{defaultValue:"Cancel"})},"back"),e.jsx(_,{type:"primary",loading:k,onClick:()=>j.submit(),children:t("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxs(l,{form:j,layout:"vertical",onFinish:g=>r(g),children:[e.jsx(l.Item,{label:t("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:t("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:t("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsx(i,{placeholder:"test@example.com"})}),v&&e.jsx(l.Item,{label:t("settings.smtp.testResult",{defaultValue:"Test Result"}),children:v.success?e.jsx("span",{style:{color:"green"},children:t("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsx("span",{style:{color:"red"},children:t("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:v.message})})})]})})]})},Xe=()=>{const{t,i18n:o}=$("system"),{t:a}=$("common"),[v]=l.useForm(),{loading:c,data:m,refresh:x}=C(w.system.getSystemBaseSettings,{onSuccess:p=>{v.setFieldsValue(p)},onError:p=>{h.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",p)}}),{loading:j,run:b}=C(w.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{h.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),x()},onError:p=>{h.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",p)}}),n=p=>{b(p)};return e.jsx(X,{spinning:c,children:e.jsxs(l,{form:v,layout:"vertical",onFinish:n,initialValues:m,children:[e.jsx(l.Item,{label:t("settings.base.name",{defaultValue:"Name"}),children:e.jsx(be,{items:[{key:"default",label:a("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{name:"name",children:e.jsx(i,{})})})},...Be.map(p=>({key:p.lang,label:o.language!==p.lang?a(`language.${p.lang}`,{defaultValue:p.label,lang:p.label}):p.label,forceRender:!0,children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{name:["name_i18n",p.lang],children:e.jsx(i,{})})})}))]})}),e.jsx(l.Item,{label:t("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsx(i,{})}),e.jsx(l.Item,{label:t("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsx(i,{})}),e.jsx(l.Item,{label:t("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:t("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsx(N,{})}),e.jsx(l.Item,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:j,icon:e.jsx(ue,{}),children:a("save",{defaultValue:"Save"})}),e.jsx(_,{onClick:()=>x(),icon:e.jsx(ae,{}),children:a("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:Ye}=i,{Option:et}=q,tt=()=>{const{t}=$("ai"),{t:o}=$("common"),[a]=l.useForm(),[v,c]=S.useState(!1),[m,x]=S.useState(null),[j,b]=S.useState(""),[n,p]=S.useState(""),{loading:u,data:T,refresh:r}=C(()=>w.ai.listAiModels({current:1,page_size:100,search:j}),{refreshDeps:[j],onError:d=>{h.error(t("models.fetchFailed",{defaultValue:"Failed to fetch AI models"})),console.error("Failed to fetch AI models:",d)}}),{loading:k,run:g}=C(d=>w.ai.createAiModel(d),{manual:!0,onSuccess:()=>{h.success(t("models.createSuccess",{defaultValue:"AI model created successfully"})),c(!1),a.resetFields(),r()},onError:d=>{h.error(t("models.createFailed",{defaultValue:"Failed to create AI model"})),console.error("Failed to create AI model:",d)}}),{loading:E,run:M}=C(({id:d,data:L})=>w.ai.updateAiModel({id:d},L),{manual:!0,onSuccess:()=>{h.success(t("models.updateSuccess",{defaultValue:"AI model updated successfully"})),c(!1),a.resetFields(),x(null),r()},onError:d=>{h.error(t("models.updateFailed",{defaultValue:"Failed to update AI model"})),console.error("Failed to update AI model:",d)}}),{run:F}=C(d=>w.ai.deleteAiModel({id:d}),{manual:!0,onSuccess:()=>{h.success(t("models.deleteSuccess",{defaultValue:"AI model deleted successfully"})),r()},onError:d=>{h.error(t("models.deleteFailed",{defaultValue:"Failed to delete AI model"})),console.error("Failed to delete AI model:",d)}}),{loading:V,run:z}=C(d=>w.ai.testAiModel({id:d}),{manual:!0,onSuccess:()=>{h.success(t("models.testSuccess",{defaultValue:"AI model connection test successful"}))},onError:d=>{h.error(t("models.testFailed",{defaultValue:"AI model connection test failed"})),console.error("Failed to test AI model:",d)}}),{run:P}=C(d=>w.ai.setDefaultAiModel({id:d}),{manual:!0,onSuccess:()=>{h.success(t("models.setDefaultSuccess",{defaultValue:"Default AI model set successfully"})),r()},onError:d=>{h.error(t("models.setDefaultFailed",{defaultValue:"Failed to set default AI model"})),console.error("Failed to set default AI model:",d)}}),D=()=>{x(null),a.resetFields(),c(!0)},te=d=>{x(d),a.setFieldsValue({...d,api_key:""}),c(!0)},se=d=>{m?M({id:m.id,data:d}):g(d)},G=d=>{F(d)},f=d=>{p(d),z(d)},R=d=>{P(d)},B=[{title:t("models.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(d,L)=>e.jsxs(O,{children:[e.jsx("span",{children:d}),L.is_default&&e.jsx(H,{title:t("models.defaultModel",{defaultValue:"Default Model"}),children:e.jsx(Me,{style:{color:"#faad14"}})})]})},{title:t("models.provider",{defaultValue:"Provider"}),dataIndex:"provider",key:"provider",render:d=>e.jsx(ee,{color:"blue",children:d.toUpperCase()})},{title:t("models.modelId",{defaultValue:"Model ID"}),dataIndex:"model_id",key:"model_id"},{title:t("models.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:d=>e.jsx(ee,{color:d==="enabled"?"green":"red",children:d==="enabled"?t("common.enabled",{defaultValue:"Enabled"}):t("common.disabled",{defaultValue:"Disabled"})})},{title:o("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(d,L)=>e.jsxs(O,{children:[e.jsx(H,{title:t("models.test",{defaultValue:"Test Connection"}),children:e.jsx(_,{type:"text",icon:e.jsx(Ve,{}),loading:V&&L.id===n,onClick:()=>f(L.id)})}),!L.is_default&&e.jsx(H,{title:t("models.setDefault",{defaultValue:"Set as Default"}),children:e.jsx(_,{type:"text",icon:e.jsx($e,{}),onClick:()=>R(L.id)})}),e.jsx(H,{title:o("edit",{defaultValue:"Edit"}),children:e.jsx(_,{type:"text",icon:e.jsx(je,{}),onClick:()=>te(L)})}),e.jsx(ye,{title:t("models.deleteConfirm",{defaultValue:"Are you sure you want to delete this AI model?"}),onConfirm:()=>G(L.id),okText:o("yes",{defaultValue:"Yes"}),cancelText:o("no",{defaultValue:"No"}),children:e.jsx(H,{title:o("delete",{defaultValue:"Delete"}),children:e.jsx(_,{type:"text",danger:!0,icon:e.jsx(_e,{})})})})]})}];return e.jsxs("div",{children:[e.jsx(J,{style:{marginBottom:16},children:e.jsxs(re,{justify:"space-between",align:"middle",children:[e.jsx(Q,{children:e.jsx(i.Search,{placeholder:t("models.searchPlaceholder",{defaultValue:"Search AI models..."}),style:{width:300},value:j,onChange:d=>b(d.target.value),allowClear:!0})}),e.jsx(Q,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",icon:e.jsx(ae,{}),onClick:r,loading:u,children:o("refresh",{defaultValue:"Refresh"})}),e.jsx(_,{type:"primary",icon:e.jsx(Se,{}),onClick:D,children:t("models.create",{defaultValue:"Create AI Model"})})]})})]})}),e.jsx(J,{children:e.jsx(ce,{columns:B,dataSource:(T==null?void 0:T.data)||[],loading:u,rowKey:"id",pagination:{total:(T==null?void 0:T.total)||0,current:(T==null?void 0:T.current)||1,pageSize:(T==null?void 0:T.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(d,L)=>t("common.pagination.total",{defaultValue:`${L[0]}-${L[1]} of ${d} items`,start:L[0],end:L[1],total:d})}})}),e.jsx(Y,{title:m?t("models.edit",{defaultValue:"Edit AI Model"}):t("models.create",{defaultValue:"Create AI Model"}),open:v,onCancel:()=>{c(!1),a.resetFields(),x(null)},footer:null,width:600,children:e.jsxs(l,{form:a,layout:"vertical",onFinish:se,children:[e.jsx(l.Item,{name:"name",label:t("models.name",{defaultValue:"Name"}),rules:[{required:!0,message:t("models.nameRequired",{defaultValue:"Please enter model name"})}],children:e.jsx(i,{placeholder:t("models.namePlaceholder",{defaultValue:"Enter model name"})})}),e.jsx(l.Item,{name:"description",label:t("models.description",{defaultValue:"Description"}),children:e.jsx(Ye,{rows:3,placeholder:t("models.descriptionPlaceholder",{defaultValue:"Enter model description"})})}),e.jsxs(re,{gutter:16,children:[e.jsx(Q,{span:12,children:e.jsx(l.Item,{name:"provider",label:t("models.provider",{defaultValue:"Provider"}),rules:[{required:!0,message:t("models.providerRequired",{defaultValue:"Please select provider"})}],children:e.jsx(q,{placeholder:t("models.providerPlaceholder",{defaultValue:"Select provider"}),children:e.jsx(et,{value:"openai",children:"OpenAI"})})})}),e.jsx(Q,{span:12,children:e.jsx(l.Item,{name:"model_id",label:t("models.modelId",{defaultValue:"Model ID"}),rules:[{required:!0,message:t("models.modelIdRequired",{defaultValue:"Please enter model ID"})}],children:e.jsx(i,{placeholder:"gpt-4, gpt-3.5-turbo, etc."})})})]}),e.jsx(l.Item,{name:"api_key",label:t("models.apiKey",{defaultValue:"API Key"}),rules:m?[]:[{required:!0,message:t("models.apiKeyRequired",{defaultValue:"Please enter API key"})}],children:e.jsx(i.Password,{placeholder:m?t("models.apiKeyPlaceholderEdit",{defaultValue:"Leave empty to keep current API key"}):t("models.apiKeyPlaceholder",{defaultValue:"Enter API key"})})}),e.jsx(l.Item,{name:"base_url",label:t("models.baseUrl",{defaultValue:"Base URL"}),children:e.jsx(i,{placeholder:t("models.baseUrlPlaceholder",{defaultValue:"Optional: Custom API endpoint"})})}),e.jsxs(l.Item,{name:"is_default",valuePropName:"checked",children:[e.jsx(N,{})," ",e.jsx("span",{style:{marginLeft:8},children:t("models.setAsDefault",{defaultValue:"Set as default model"})})]}),e.jsx(l.Item,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:k||E,children:m?o("update",{defaultValue:"Update"}):o("create",{defaultValue:"Create"})}),e.jsx(_,{onClick:()=>{c(!1),a.resetFields(),x(null)},children:o("cancel",{defaultValue:"Cancel"})})]})})]})})]})},{TextArea:xe}=i,{Option:st}=q,lt=()=>{var me;const{t}=$("system"),{t:o}=$("common"),[a]=l.useForm(),[v,c]=S.useState(!1),[m,x]=S.useState(null),[j,b]=S.useState(""),[n,p]=S.useState(!1),[u,T]=S.useState(null),[r,k]=S.useState(""),[g,E]=S.useState(""),{loading:M,data:F,refresh:V}=C(()=>w.toolsets.listToolSets({current:1,page_size:100,search:j}),{refreshDeps:[j],onError:s=>{h.error(t("settings.toolsets.fetchFailed",{defaultValue:"Failed to fetch toolsets"})),console.error("Failed to fetch toolsets:",s)}}),{loading:z,data:P}=C(()=>w.toolsets.getToolSetTypeDefinitions(),{refreshDeps:[],onError:s=>{h.error(t("settings.toolsets.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch toolset type definitions"})),console.error("Failed to fetch toolset type definitions:",s)}}),D=S.useMemo(()=>P==null?void 0:P.find(s=>s.tool_set_type===r),[P,r]),{loading:te,run:se}=C(s=>w.toolsets.createToolSet({...s,type:s.type}),{manual:!0,onSuccess:()=>{h.success(t("settings.toolsets.createSuccess",{defaultValue:"toolset created successfully"})),c(!1),a.resetFields(),V()},onError:s=>{h.error(t("settings.toolsets.createFailed",{defaultValue:"Failed to create toolset"})),console.error("Failed to create toolset:",s)}}),{loading:G,run:f}=C(({id:s,data:y})=>w.toolsets.updateToolSet({id:s},{...y,type:y.type}),{manual:!0,onSuccess:()=>{h.success(t("settings.toolsets.updateSuccess",{defaultValue:"toolset updated successfully"})),c(!1),a.resetFields(),x(null),V()},onError:s=>{h.error(t("settings.toolsets.updateFailed",{defaultValue:"Failed to update toolset"})),console.error("Failed to update toolset:",s)}}),{run:R}=C(s=>w.toolsets.deleteToolSet({id:s}),{manual:!0,onSuccess:()=>{h.success(t("settings.toolsets.deleteSuccess",{defaultValue:"toolset deleted successfully"})),V()},onError:s=>{h.error(t("settings.toolsets.deleteFailed",{defaultValue:"Failed to delete toolset"})),console.error("Failed to delete toolset:",s)}}),{loading:B,run:d}=C(s=>w.toolsets.testToolSet({id:s}),{manual:!0,onSuccess:()=>{h.success(t("settings.toolsets.testSuccess",{defaultValue:"toolset connection test successful"}))},onError:s=>{h.error(t("settings.toolsets.testFailed",{defaultValue:"toolset connection test failed"})),console.error("Failed to test toolset:",s)}}),L=()=>{x(null),a.resetFields(),k(""),c(!0)},Ie=s=>{x(s),k(s.type);const y={...s};if(y.config){const A=P==null?void 0:P.find(I=>I.tool_set_type===s.type);if(A){const I={};A.config_fields.forEach(U=>{var ne,pe;U.type==="object"&&((ne=y.config)!=null&&ne[U.name])?I[U.name]=JSON.stringify(y.config[U.name],null,2):((pe=y.config)==null?void 0:pe[U.name])!==void 0&&(I[U.name]=y.config[U.name])}),y.config=I}}a.setFieldsValue(y),c(!0)};console.log(r,P);const ve=s=>{k(s);const y=P==null?void 0:P.find(A=>A.tool_set_type===s);if(y){const A={};y.config_fields.forEach(I=>{if(I.default)switch(I.type){case"number":A[I.name]=Number(I.default);break;case"boolean":A[I.name]=I.default==="true";break;case"array":A[I.name]=I.default.split(",");break;default:A[I.name]=I.default}}),a.setFieldValue("config",A)}else a.setFieldValue("config",void 0)},we=s=>{if(s.config&&D){const y={};D.config_fields.forEach(A=>{var U;const I=(U=s.config)==null?void 0:U[A.name];if(I!==void 0)if(A.type==="object")try{y[A.name]=typeof I=="string"?JSON.parse(I):I}catch{y[A.name]=I}else y[A.name]=I}),s.config=y}m?f({id:m.id,data:s}):se(s)},Ce=s=>{R(s)},Te=s=>{E(s),d(s)},Fe=s=>{T(s),p(!0)},Ae=s=>{const y=s.options&&s.options.length>0,A=[{required:s.required,message:t("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${s.name}`,field:s.name})}];if(!y)switch(s.type){case"string":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(i,{placeholder:t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.placeholder||`${t("common.enter",{defaultValue:"Enter"})} ${s.name}`})})},s.name);case"number":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(K,{style:{width:"100%"},placeholder:t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.placeholder||`${t("common.enter",{defaultValue:"Enter"})} ${s.name}`})})},s.name);case"boolean":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),valuePropName:"checked",tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(N,{})},s.name);case"array":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(q,{mode:"tags",style:{width:"100%"},placeholder:t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.placeholder||`${t("common.enter",{defaultValue:"Enter"})} ${s.name}`}),tokenSeparators:[","]})},s.name);case"object":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:[...A,{validator:(I,U)=>{if(!U)return Promise.resolve();try{return JSON.parse(U),Promise.resolve()}catch{return Promise.reject(new Error(t("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltips`,{defaultValue:s.description}):void 0,children:e.jsx(xe,{rows:4,placeholder:t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.placeholder||`${t("common.enter",{defaultValue:"Enter"})} ${s.name} (JSON format)`})})},s.name);case"password":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(i.Password,{placeholder:t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.placeholder||`${t("common.enter",{defaultValue:"Enter"})} ${s.name}`}),autoComplete:"new-password"})},s.name);default:return null}switch(s.type){case"string":case"number":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(q,{allowClear:!0,placeholder:s.placeholder?t(`settings.toolsets.${r}.${s.name}Placeholder`,{defaultValue:s.description}):`${t("common.select",{defaultValue:"Select"})} ${s.name}`,children:s.options.map(I=>e.jsx(st,{value:I.value,children:I.label},I.value))})},s.name);case"array":return e.jsx(l.Item,{name:["config",s.name],label:t(`settings.toolsets.${r}.${s.name}`,{defaultValue:s.display_name||s.name}),rules:A,tooltip:s.description?t(`settings.toolsets.${r}.${s.name}Tooltip`,{defaultValue:s.description}):void 0,children:e.jsx(he.Group,{style:{width:"100%"},children:e.jsx(O,{direction:"vertical",children:s.options.map(I=>e.jsx(he,{value:I.value,children:I.label},I.value))})})},s.name);default:return null}},ke=[{title:t("settings.toolsets.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:t("settings.toolsets.type",{defaultValue:"Type"}),dataIndex:"type",key:"type",render:s=>e.jsx(ee,{color:"blue",children:s.toUpperCase()})},{title:t("settings.toolsets.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:s=>e.jsx(ee,{color:s==="enabled"?"green":"red",children:s==="enabled"?t("common.enabled",{defaultValue:"Enabled"}):t("common.disabled",{defaultValue:"Disabled"})})},{title:o("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(s,y)=>e.jsxs(O,{children:[e.jsx(H,{title:t("settings.toolsets.test",{defaultValue:"Test Connection"}),children:e.jsx(_,{type:"text",icon:e.jsx(Ve,{}),loading:B&&y.id===g,onClick:()=>Te(y.id)})}),y.config&&Object.keys(y.config).length>0&&e.jsx(H,{title:t("settings.toolsets.viewConfig",{defaultValue:"View Configuration"}),children:e.jsx(_,{type:"text",icon:e.jsx(Ue,{}),onClick:()=>Fe(y.config)})}),e.jsx(H,{title:o("edit",{defaultValue:"Edit"}),children:e.jsx(_,{type:"text",icon:e.jsx(je,{}),onClick:()=>Ie(y)})}),e.jsx(ye,{title:t("settings.toolsets.deleteConfirm",{defaultValue:"Are you sure you want to delete this toolset?"}),onConfirm:()=>Ce(y.id),okText:o("yes",{defaultValue:"Yes"}),cancelText:o("no",{defaultValue:"No"}),children:e.jsx(H,{title:o("delete",{defaultValue:"Delete"}),children:e.jsx(_,{type:"text",danger:!0,icon:e.jsx(_e,{})})})})]})}];return e.jsxs("div",{children:[e.jsx(J,{style:{marginBottom:16},children:e.jsxs(re,{justify:"space-between",align:"middle",children:[e.jsx(Q,{children:e.jsx(i.Search,{placeholder:t("settings.toolsets.searchPlaceholder",{defaultValue:"Search toolsets..."}),style:{width:300},value:j,onChange:s=>b(s.target.value),allowClear:!0})}),e.jsx(Q,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",icon:e.jsx(ae,{}),onClick:V,loading:M,children:o("refresh",{defaultValue:"Refresh"})}),e.jsx(_,{type:"primary",icon:e.jsx(Se,{}),onClick:L,children:t("settings.toolsets.create",{defaultValue:"Create Toolset"})})]})})]})}),e.jsx(J,{children:e.jsx(ce,{columns:ke,dataSource:(F==null?void 0:F.data)||[],loading:M,rowKey:"id",pagination:{total:(F==null?void 0:F.total)||0,current:(F==null?void 0:F.current)||1,pageSize:(F==null?void 0:F.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,y)=>t("common.pagination.total",{defaultValue:`${y[0]}-${y[1]} of ${s} items`,start:y[0],end:y[1],total:s})}})}),e.jsx(Y,{title:m?t("settings.toolsets.edit",{defaultValue:"Edit Toolset"}):t("settings.toolsets.create",{defaultValue:"Create Toolset"}),open:v,onCancel:()=>{c(!1),a.resetFields(),x(null),k("")},footer:null,width:600,children:e.jsxs(l,{form:a,layout:"vertical",onFinish:we,children:[e.jsx(l.Item,{name:"name",label:t("settings.toolsets.name",{defaultValue:"Name"}),rules:[{required:!0,message:t("settings.toolsets.nameRequired",{defaultValue:"Please enter toolset name"})}],children:e.jsx(i,{placeholder:t("settings.toolsets.namePlaceholder",{defaultValue:"Enter toolset name"})})}),e.jsx(l.Item,{name:"description",label:t("settings.toolsets.description",{defaultValue:"Description"}),children:e.jsx(xe,{rows:3,placeholder:t("settings.toolsets.descriptionPlaceholder",{defaultValue:"Enter toolset description"})})}),e.jsx(l.Item,{name:"type",label:t("settings.toolsets.type",{defaultValue:"Type"}),rules:[{required:!0,message:t("settings.toolsets.typeRequired",{defaultValue:"Please select type"})}],children:e.jsx(q,{loading:z,placeholder:t("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),onChange:ve,value:r,options:P==null?void 0:P.map(s=>({label:s.name,value:s.tool_set_type}))})}),(me=D==null?void 0:D.config_fields)==null?void 0:me.map(s=>Ae(s)),e.jsx(l.Item,{children:e.jsxs(O,{children:[e.jsx(_,{type:"primary",htmlType:"submit",loading:te||G,children:m?o("update",{defaultValue:"Update"}):o("create",{defaultValue:"Create"})}),e.jsx(_,{onClick:()=>{c(!1),a.resetFields(),x(null),k("")},children:o("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsx(Y,{title:t("settings.toolsets.configuration",{defaultValue:"Configuration"}),open:n,onCancel:()=>p(!1),footer:[e.jsx(_,{onClick:()=>p(!1),children:o("close",{defaultValue:"Close"})},"close")],width:600,children:e.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto"},children:JSON.stringify(u,null,2)})})]})},at=({transformItems:t=o=>o})=>{const{t:o}=$("system"),a=Ne(),v=Oe(),x=v.hash.replace("#","")||"base",j=[{key:"base",label:o("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsx(Xe,{})},{key:"security",label:o("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsx(Je,{})},{key:"oauth",label:o("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsx(Ge,{})},{key:"ldap",label:o("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsx(We,{})},{key:"smtp",label:o("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsx(Qe,{})},{key:"ai-models",label:o("settings.tabs.aiModels",{defaultValue:"AI Models"}),children:e.jsx(tt,{})},{key:"ai-toolsets",label:o("settings.tabs.toolSets",{defaultValue:"Tool Sets"}),children:e.jsx(lt,{})}];return e.jsx(J,{title:o("settings.title",{defaultValue:"System Settings"}),children:e.jsx(be,{defaultActiveKey:x,onChange:b=>{a(`${v.pathname}#${b}`)},items:t(j)})})},ut=Object.freeze(Object.defineProperty({__proto__:null,default:at},Symbol.toStringTag,{value:"Module"})),nt=()=>{const{t}=$("system"),[o]=De(),a=o.get("provider"),v=o.get("code"),c=o.get("state"),[m,x]=S.useState(null),[j,b]=S.useState(null),[n,p]=S.useState(null);return C(async()=>{if(!v||!c||!a)throw new Error(t("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const u=await w.system.testOauthCallback({code:v,state:c,provider:a});if(!u.user_info)throw new Error(t("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!u.user)throw new Error(t("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));x(u.user),b(u.user_info)},{onSuccess:()=>{p({status:"success",message:t("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:u=>{p({status:"error",message:t("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:u.message})}}),n?e.jsx("div",{children:e.jsx(ze,{status:n.status,title:n.message,subTitle:n.error,extra:e.jsxs(O,{style:{display:!j||!m?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsx(J,{title:t("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsx(fe,{src:j||{}})}),e.jsx(J,{title:t("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsx(fe,{src:m||{}})})]})})}):e.jsx(Ke,{})},ct=Object.freeze(Object.defineProperty({__proto__:null,default:nt},Symbol.toStringTag,{value:"Module"}));export{ct as O,ut as i};
