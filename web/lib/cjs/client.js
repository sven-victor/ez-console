"use strict";var p=Object.defineProperty;var g=(t,e,r)=>e in t?p(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>g(t,typeof e!="symbol"?e+"":e,r);const u=require("./base.js"),h=require("axios"),l="/api",s=h.create({baseURL:l,timeout:3e4,headers:{"Content-Type":"application/json"}});class i extends Error{constructor(r,a){super(a);d(this,"code");this.code=r}}s.interceptors.request.use(t=>{if(!t.withoutAuth){const r=localStorage.getItem("token");r&&(t.headers=t.headers||{},t.headers.Authorization=`Bearer ${r}`)}const e=localStorage.getItem("i18nextLng");if(e&&(t.headers["Accept-Language"]=e),!t.headers["X-Scope-OrgID"]){const r=localStorage.getItem("orgID");r&&(t.headers["X-Scope-OrgID"]=r)}return t},t=>Promise.reject(t));s.interceptors.response.use(t=>{const e=t.data;return e&&e.code!==void 0?e.code==="0"?e.total!==void 0&&e.current!==void 0&&e.page_size!==void 0?{data:e.data,total:e.total,current:e.current,page_size:e.page_size}:e.data:Promise.reject(e||"Unknown error"):t.data},t=>{var a,o,n;((a=t.response)==null?void 0:a.status)===401&&window.location.pathname!==u.getURL("/login")&&(localStorage.removeItem("token"),delete s.defaults.headers.common.Authorization,window.location.href=u.getURL("/login?redirect="+encodeURIComponent(window.location.href)));const e=(o=t.response)==null?void 0:o.data;let r=new i(((n=t.response)==null?void 0:n.status.toString())||"500",t.message);return console.log("errorResponse",e),e&&(e.err?r=new i(e.code,e.err):e.error&&(r=new i(e.code,e.error))),Promise.reject(r)});const m=async(t,e)=>s.get(t,e),f=async(t,e,r)=>s.post(t,e,r),S=async(t,e,r)=>s.put(t,e,r),y=async(t,e)=>s.delete(t,e);async function w(t,e){const{signal:r,...a}=e||{},o=await fetch(t,{method:a.method||"GET",headers:a.headers,body:a.body,signal:r});if(console.log(o),!o.ok||!o.body){let n=o.statusText;if(o.body)try{const c=await o.json();n=`SSE connection failed: ${c.message||c.err}`}catch{n=`SSE connection failed: ${o.statusText}`}throw new Error(n)}if(o.status!==200){const n=await o.json();throw new Error(`SSE connection failed: ${n.message}`)}return o.body}function I(t){if(t)return typeof t.toJSON=="function"?t.toJSON():Object.fromEntries(Object.entries(t).map(([e,r])=>[e,String(r)]))}async function b(t,e){const{requestType:r,signal:a,...o}=e||{};if(r==="sse"){const n=localStorage.getItem("orgID");return w(t,{headers:{Accept:"text/event-stream","Content-Type":"application/json","Accept-Language":localStorage.getItem("i18nextLng")||"en-US",Authorization:`Bearer ${localStorage.getItem("token")}`,...n?{"X-Scope-OrgID":n}:{},...I(o.headers)},method:o.method,body:JSON.stringify(o.data),signal:a})}return r==="form"?s.request({url:t,baseURL:"",...o,headers:{...e==null?void 0:e.headers,"Content-Type":"multipart/form-data"}}):s.request({url:t,baseURL:"",...o})}exports.ApiError=i;exports.apiDelete=y;exports.apiGet=m;exports.apiPost=f;exports.apiPut=S;exports.baseURL=l;exports.client=s;exports.request=b;
