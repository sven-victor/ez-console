"use strict";const e=require("./vendor.js"),C=require("react-query"),c=require("react-router-dom"),h=require("antd"),U=require("react-i18next"),s=require("react"),R=require("./components.js"),m=require("@ant-design/icons"),D=require("./contexts.js"),B=require("./authorization.js"),k=require("./base.js"),H=require("./system.js"),T=require("./oauth.js"),Z=require("lodash");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const ee=s.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),te=s.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),ne=s.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),N=s.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),se=s.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),ie=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserList)),re=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserDetail)),F=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserForm)),ae=s.lazy(()=>Promise.resolve().then(()=>require("./roles.js"))),oe=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(a=>a.index)),le=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(a=>a.OAuthTestCallback)),ue=s.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),ce=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(a=>a.ServiceAccountList)),me=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(a=>a.ServiceAccountDetail));function l(a,x){return e.jsxRuntimeExports.jsx(s.Suspense,{fallback:e.jsxRuntimeExports.jsx(R.Loading,{}),children:e.jsxRuntimeExports.jsx(a,{...x})})}const he=({transformSettingTabs:a,transformLangConfig:x,extraPrivateRoutes:v=[],extraPublicRoutes:y=[]})=>{const d=[{path:"/login",element:l(te,{transformLangConfig:x}),index:!0},{path:"/404",element:l(N),index:!0},{path:"/403",element:l(se),index:!0},{path:"/system/settings/oauth/test-callback",element:l(le),index:!0},...y],j=[{path:"/",is_private:!0,children:[{path:"/",element:l(ee),name:"dashboard",icon:e.jsxRuntimeExports.jsx(m.DashboardOutlined,{}),index:!0},{path:"/profile",element:l(ne),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(m.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:l(ae),permissions:["authorization:role:view"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:l(ie),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:l(F),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:l(re),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:l(F),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:l(ce),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:l(me),permissions:["authorization:service_account:view"],index:!0}]}]},...v,{name:"system",icon:e.jsxRuntimeExports.jsx(m.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(m.SafetyOutlined,{}),index:!0,name:"settings",permissions:["system:settings:view","system:settings:update"],element:l(oe,{transformItems:a})},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(m.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:l(ue)}]},{path:"*",element:l(N),index:!0}]}];return[...d,...j]},V={authorization:B.authorizationapi,base:k.baseapi,system:H.systemapi,oauth:T.oauthapi},{Header:pe,Content:xe,Footer:de,Sider:je}=h.Layout,{SubMenu:fe}=h.Menu,K=({element:a,routes:x,transformLangConfig:v,menuStyle:y="dark"})=>{const{t:d,i18n:j}=U.useTranslation(),{t:u}=U.useTranslation("common"),[z,_]=s.useState(!1),f=c.useLocation(),{hasPermission:L}=D.usePermission(),q=c.useNavigate(),{logout:w,user:i}=D.useAuth(),[r,S]=s.useState([]),[b,A]=s.useState(null),[$,Q]=s.useState("Loading..."),[g,W]=s.useState(null);f.pathname!=="/profile"&&(i&&i.mfa_enforced&&!i.mfa_enabled?q("/profile#mfa"):i&&i.status==="password_expired"&&q("/profile#password"));const Y=()=>{w(),window.location.href=k.getURL("/login?redirect="+encodeURIComponent(window.location.href))},G=[{key:"profile",label:e.jsxRuntimeExports.jsx(c.Link,{to:"/profile",children:u("profile")})},{key:"logout",label:u("logout"),onClick:Y}];s.useEffect(()=>{V.system.getSiteConfig().then(n=>{var t;const o=n.navigation.filter(p=>p.path!==n.home_page),E=[...n.home_page?[{name:"home",path:n.home_page}]:[],...o];E.length>1?S(E):S([]),A(n.logo),W(n),(t=document.getElementById("site-icon"))==null||t.setAttribute("href",n.logo)})},[]),s.useEffect(()=>{j.language&&Q((g==null?void 0:g.name_i18n[j.language])||(g==null?void 0:g.name)||"")},[g,j.language]);const O=()=>{const n=c.matchRoutes(x,f.pathname),o=[];if(n){for(const[E,t]of n.entries())if(t.route.path==="/"&&!t.route.name)o.push({href:t.route.path,title:u("home"),key:"home"});else if(t.route.name){const p=n.slice(0,E+1).map(P=>P.route.name).filter(Boolean).join(".");o.push({path:t.route.path,title:t.route.name?d(`breadcrumbs.${p}`):void 0,key:t.route.path})}}return o},J=n=>n.some(o=>L(o)),X=Z.flatMapDeep(x,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),M=(n,o=[])=>{const E=t=>t&&t.replace(/_/g," ").split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!J(t.permissions))return null;const p=E(t.name);if(!t.name)return null;if("children"in t&&t.children){const P=M(t.children,[...o,t.name]);return P.length==0&&t.path?e.jsxRuntimeExports.jsx(h.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:d(`menu.${[...o,t.name].join(".")}`,{defaultValue:p})})},t.path):e.jsxRuntimeExports.jsx(fe,{icon:t.icon,title:d(`menu.${[...o,t.name,t.name].join(".")}`,{defaultValue:p}),children:P},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(h.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:d(`menu.${[...o,t.name].join(".")}`,{defaultValue:p})})},t.path):null}).filter(Boolean)};return s.useEffect(()=>{const n=O().filter(o=>o.path!=="/").map(o=>o.title).join(" - ");n?document.title=`${$} | ${n}`:document.title=$},[O,f.pathname]),e.jsxRuntimeExports.jsxs(h.Layout,{style:{minHeight:"100vh"},children:[e.jsxRuntimeExports.jsxs(je,{collapsible:!0,collapsed:z,onCollapse:_,theme:y,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:b?e.jsxRuntimeExports.jsx("img",{src:b,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(h.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(h.Menu,{theme:y,defaultOpenKeys:X,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[f.pathname],children:M(x)})]}),e.jsxRuntimeExports.jsxs(h.Layout,{className:"site-layout",children:[e.jsxRuntimeExports.jsxs(pe,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(h.Button,{type:"text",icon:z?e.jsxRuntimeExports.jsx(m.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(m.MenuFoldOutlined,{}),onClick:()=>_(!z),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsxs("div",{style:{marginRight:"20px"},children:[e.jsxRuntimeExports.jsx(R.HeaderDropdown,{hidden:r.length<=1,menu:{items:r.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:d(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(m.SwapOutlined,{})}),e.jsxRuntimeExports.jsxs(R.HeaderDropdown,{menu:{items:G},children:[i!=null&&i.avatar?e.jsxRuntimeExports.jsx(R.Avatar,{src:i.avatar}):e.jsxRuntimeExports.jsx(R.Avatar,{icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em"},children:(i==null?void 0:i.full_name)||(i==null?void 0:i.username)})]}),e.jsxRuntimeExports.jsx(R.LanguageSwitch,{transformLangConfig:v})]})]}),e.jsxRuntimeExports.jsxs(xe,{style:{margin:"0 16px"},children:[e.jsxRuntimeExports.jsx(h.Breadcrumb,{style:{margin:"16px 0"},itemRender:n=>{const o=n.href||n.path;return o?e.jsxRuntimeExports.jsx(c.Link,{to:o,children:n.title}):e.jsxRuntimeExports.jsx("span",{children:n.title})},items:O()}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:360},children:a??e.jsxRuntimeExports.jsx(c.Outlet,{})})]}),e.jsxRuntimeExports.jsxs(de,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",$]})]})]})},ge=new C.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),I={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function Re({transformRouter:a=u=>u,transformSettingTabs:x=u=>u,transformLangConfig:v=u=>u,extraPrivateRoutes:y=[],extraPublicRoutes:d=[],menuStyle:j="dark"}){const{i18n:u}=U.useTranslation(),[z,_]=s.useState(I[u.language]||e.default_1$5);s.useEffect(()=>{_(I[u.language]||e.default_1$5)},[u.language]);const f=w=>w.map(i=>i.children===void 0?i:{...i,children:f(i.children)}),L=a(f(he({transformSettingTabs:x,transformLangConfig:v,extraPrivateRoutes:y,extraPublicRoutes:d}))),q=(w,i)=>w.flatMap(r=>r.is_private?[r]:"children"in r&&r.children?r.children:[r]).map((r,S)=>{const b=r.is_private?e.jsxRuntimeExports.jsx(R.PrivateRoute,{element:e.jsxRuntimeExports.jsx(K,{routes:L,element:r.element,transformLangConfig:v,menuStyle:j})}):r.element;if("children"in r&&r.children&&r.children.length>0)return e.jsxRuntimeExports.jsx(c.Route,{path:r.path,element:b,children:q(r.children,r)},r.path??r.name??S);const{path:A}=r;return e.jsxRuntimeExports.jsx(c.Route,{path:A,index:r.index,element:b},A??r.name??`${(i==null?void 0:i.path)??""}.${S}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(C.QueryClientProvider,{client:ge,children:e.jsxRuntimeExports.jsx(h.ConfigProvider,{locale:z,children:e.jsxRuntimeExports.jsx(D.AuthProvider,{children:e.jsxRuntimeExports.jsx(c.BrowserRouter,{basename:k.getURL(),children:e.jsxRuntimeExports.jsx(c.Routes,{children:q(L)})})})})})}const ve={...B.authorizationapi,...k.baseapi,...T.oauthapi,...H.systemapi};exports.App=Re;exports.AppLayout=K;exports.api=V;exports.api$1=ve;exports.withSuspense=l;
