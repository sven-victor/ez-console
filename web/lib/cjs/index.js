"use strict";const fe=require("./ai.js"),ie=require("./authorization.js"),I=require("./base.js"),F=require("./system.js"),se=require("./oauth.js"),e=require("./vendor.js"),ae=require("react-query"),p=require("react-router-dom"),f=require("antd"),T=require("react-i18next"),r=require("react"),E=require("./components.js"),m=require("@ant-design/icons"),b=require("./contexts.js"),ye=require("lodash-es"),U=require("./ai-chat-layout.js"),V=require("antd-style"),h=require("classnames");require("./ai-chat.js");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const Re=r.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),ve=r.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),Ee=r.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),Z=r.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),ze=r.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),we=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserList)),be=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserDetail)),ee=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserForm)),Se=r.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(i=>i.RoleList)),te=r.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(i=>i.RoleForm)),qe=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.index)),Le=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.OrganizationDetail)),_e=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.OAuthTestCallback)),Ne=r.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),Pe=r.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(i=>i.ServiceAccountList)),Ae=r.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(i=>i.ServiceAccountDetail));function u(i,o){return e.jsxRuntimeExports.jsx(r.Suspense,{fallback:e.jsxRuntimeExports.jsx(E.Loading,{}),children:e.jsxRuntimeExports.jsx(i,{...o})})}const Oe=({transformSettingTabs:i,transformLangConfig:o,extraPrivateRoutes:y=[],extraPublicRoutes:_=[]})=>{const S=[{path:"/login",element:u(ve,{transformLangConfig:o}),index:!0},{path:"/404",element:u(Z),index:!0},{path:"/403",element:u(ze),index:!0},{path:"/system/settings/oauth/test-callback",element:u(_e),index:!0},..._],N=[{path:"/",is_private:!0,children:[{path:"/",element:u(Re),name:"dashboard",icon:e.jsxRuntimeExports.jsx(m.DashboardOutlined,{}),index:!0},{path:"/profile",element:u(Ee),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete","authorization:role:view"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(m.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:u(Se),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:u(te),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:u(te),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:u(we),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:u(ee),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:u(be),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:u(ee),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:u(Pe),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:u(Ae),permissions:["authorization:service_account:view"],index:!0}]}]},...y,{name:"system",icon:e.jsxRuntimeExports.jsx(m.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(m.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",index:!0,element:u(qe,{transformItems:i})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:u(Le),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(m.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:u(Ne)}]},{path:"*",element:u(Z),index:!0}]}];return[...S,...N]},ke={ai:fe.ai,authorization:ie.authorizationapi,base:I.baseapi,system:F.aiapi,oauth:se.oauthapi},{Header:Me,Content:$e,Footer:Ie,Sider:Ce}=f.Layout,{SubMenu:De}=f.Menu,Be=V.createStyles(({token:i,css:o})=>({layout:o`
      min-height: 100vh;
      display: flex;
      flex-direction: row;
    `,header:o`
      padding: 0;
      display: flex;
      justify-content: space-between;
      background-color: ${i.colorBgContainer};
      border-block-end: 1px solid ${i.colorBorderSecondary};
    `,footer:o`
      text-align: center;
      padding: 15px 50px;
    `,contentContainer:o`
      padding: 24px;
      background-color: ${i.colorBgContainer};
    `,content:o`
      margin: 0 16px;
      height: calc(100vh - 120px);
      overflow: auto;
    `,mainLayout:o`
      flex: 1;
      min-width: 0;
      background-color: ${i.colorBgContainer};
    `,breadcrumb:o`
      margin-left: 8px;
    `,headerItems:o`
      margin-right: 20px;
    `,userName:o`
      height: 1em;
      line-height: 1em;
      margin-left: 5px;
    `,themeSwitch:o`
      display: inline-flex;
    `,menuSider:o`
      .ant-layout-sider-children{
        display: flex;
        flex-direction: column;
      }
    `,menuToggleButton:o`
      &&{
        font-size: 16px;
        width: 64px;
        height: 64px;
      }
    `,layoutLogo:o`
      margin: 8px;
      display: flex;
    `,layoutLogoContainer:o`
      width: 100%;
      height: 100%;
      text-align: center;
    `,layoutLogoImage:o`
      height: 32px;
      width: 32px;
    `,menu:o`
      flex: 1 1 0%;
    `})),re=({element:i,siderWidth:o=250,routes:y,transformLangConfig:_,menuStyle:S="dark",transformHeaderItems:N=q=>q,renderLayout:C})=>{const{themeMode:q,setThemeMode:x,isDarkMode:k}=V.useThemeMode(),{styles:c}=Be(),{layout:L,visible:P,loaded:A}=b.useAI(),{t:R,i18n:j}=T.useTranslation(),{t:s}=T.useTranslation("common"),v=p.useLocation(),{hasPermission:M}=b.usePermission(),O=p.useNavigate(),{logout:oe,user:d}=b.useAuth(),{siteConfig:a,clearCurrentOrgId:le}=b.useSite(),[K,H]=r.useState([]),[ue,ce]=r.useState(null),[D,me]=r.useState("Loading...");v.pathname!=="/profile"&&(d&&d.mfa_enforced&&!d.mfa_enabled?O("/profile#mfa"):d&&d.status==="password_expired"&&O("/profile#password"));const de=()=>{oe(),le(),window.location.href=I.getURL("/login?redirect="+encodeURIComponent(window.location.href))},he=[{key:"profile",label:e.jsxRuntimeExports.jsx(p.Link,{to:"/profile",children:s("profile")})},{key:"logout",label:s("logout"),onClick:de}];r.useEffect(()=>{var n,l;if(a){const w=((n=a.navigation)==null?void 0:n.filter(g=>g.path!==a.home_page))??[],t=[...a.home_page?[{name:"home",path:a.home_page}]:[],...w];t.length>1?H(t):H([]),ce(a.logo),(l=document.getElementById("site-icon"))==null||l.setAttribute("href",a.logo)}},[a]),r.useEffect(()=>{j.language&&me((a==null?void 0:a.name_i18n[j.language])||(a==null?void 0:a.name)||"")},[a,j.language]);const B=()=>{const n=p.matchRoutes(y,v.pathname),l=[];if(n){for(const[w,t]of n.entries())if(t.route.path==="/"&&!t.route.name)l.push({href:t.route.path,title:s("home"),key:"home"});else if(t.route.name){const g=n.slice(0,w+1).map(z=>z.route.name).filter(Boolean).join(".");l.push({path:t.route.path,title:t.route.name?R(`breadcrumbs.${g}`):void 0,key:t.route.path})}}return l},xe=n=>n.some(l=>M(l)),pe=ye.flatMapDeep(y,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),Q=(n,l=[])=>{const w=t=>t&&t.replace(/_/g," ").split(" ").map(g=>g.charAt(0).toUpperCase()+g.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!xe(t.permissions))return null;const g=w(t.name);if(!t.name)return null;if("children"in t&&t.children){const z=Q(t.children,[...l,t.name]);return z.length==0&&t.path?e.jsxRuntimeExports.jsx(f.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(p.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:g})})},t.path):e.jsxRuntimeExports.jsx(De,{icon:t.icon,title:R(`menu.${[...l,t.name,t.name].join(".")}`,{defaultValue:g}),children:z},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(f.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(p.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:g})})},t.path):null}).filter(Boolean)};r.useEffect(()=>{const n=B().filter(l=>l.path!=="/").map(l=>l.title).join(" - ");n?document.title=`${D} | ${n}`:document.title=D},[B,v.pathname]);const je=r.useMemo(()=>{const n=p.matchRoutes(y,v.pathname);if(n){for(const l of n.reverse())if(l.route.path&&l.route.name)return l.route.path}return v.pathname},[v.pathname]),ge=[e.jsxRuntimeExports.jsx(E.HeaderDropdown,{className:"header-item navigation-dropdown",hidden:K.length<=1,menu:{items:K.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:R(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(m.SwapOutlined,{})},"navigation-dropdown"),...a!=null&&a.enable_multi_org?[e.jsxRuntimeExports.jsx(E.OrganizationSwitcher,{className:"header-item org-switcher"},"org-switcher")]:[],e.jsxRuntimeExports.jsxs(E.HeaderDropdown,{className:"header-item user-dropdown",menu:{items:he},children:[d!=null&&d.avatar?e.jsxRuntimeExports.jsx(E.Avatar,{src:d.avatar}):e.jsxRuntimeExports.jsx(E.Avatar,{icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{className:h("header-user-name",c.userName),children:(d==null?void 0:d.full_name)||(d==null?void 0:d.username)})]},"user-dropdown"),e.jsxRuntimeExports.jsx(E.LanguageSwitch,{className:"header-item language-switch",transformLangConfig:_},"language-switch"),e.jsxRuntimeExports.jsx(E.HeaderDropdown,{className:"header-item theme-switch",menu:{items:[{key:"light",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(m.SunOutlined,{})," ",s("light",{defaultValue:"Light Mode"})]})},{key:"dark",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(m.MoonOutlined,{})," ",s("dark",{defaultValue:"Dark Mode"})]})}],onClick:({key:n})=>{x(n)},selectedKeys:[q]},children:q==="light"?e.jsxRuntimeExports.jsx(m.SunOutlined,{}):e.jsxRuntimeExports.jsx(m.MoonOutlined,{})},"theme-switch")];return(C??((n,l,w,t,g)=>{var Y,G,J;const[z,W]=r.useState(!1);return e.jsxRuntimeExports.jsxs(f.Layout,{className:h("main-layout",c.layout),children:[e.jsxRuntimeExports.jsxs(Ce,{width:o,collapsible:!0,collapsed:z,onCollapse:W,className:h(c.menuSider,"layout-menu-sider"),theme:k?"light":S,children:[e.jsxRuntimeExports.jsx("div",{className:h("logo",c.layoutLogo),children:e.jsxRuntimeExports.jsx("div",{className:h("layout-logo-container",c.layoutLogoContainer),children:n?e.jsxRuntimeExports.jsx("img",{src:n,alt:"logo",className:c.layoutLogoImage}):e.jsxRuntimeExports.jsx(f.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(f.Menu,{className:h("layout-menu",c.menu),theme:k?"light":S,defaultOpenKeys:pe,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[je],children:l})]}),e.jsxRuntimeExports.jsxs(f.Layout,{className:h("site-layout","main-layout",c.mainLayout),children:[e.jsxRuntimeExports.jsxs(Me,{className:h("site-header",c.header),children:[e.jsxRuntimeExports.jsxs(f.Space,{children:[e.jsxRuntimeExports.jsx(f.Button,{type:"text",icon:z?e.jsxRuntimeExports.jsx(m.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(m.MenuFoldOutlined,{}),onClick:()=>W(!z),className:h("layout-menu-toggle",c.menuToggleButton)}),e.jsxRuntimeExports.jsx(f.Breadcrumb,{className:h("site-breadcrumb",c.breadcrumb),itemRender:$=>{const X=$.href||$.path;return X?e.jsxRuntimeExports.jsx(p.Link,{to:X,children:$.title}):e.jsxRuntimeExports.jsx("span",{children:$.title})},items:t})]}),e.jsxRuntimeExports.jsx("div",{className:h("header-items",c.headerItems),children:w})]}),e.jsxRuntimeExports.jsxs($e,{className:h("site-content",c.content),children:[e.jsxRuntimeExports.jsx("div",{className:h("site-content-container",c.contentContainer),children:g}),((Y=a==null?void 0:a.attrs)==null?void 0:Y.ai_enabled)&&e.jsxRuntimeExports.jsx(U.AIChatButton,{}),((G=a==null?void 0:a.attrs)==null?void 0:G.ai_enabled)&&L==="classic"&&(P||A)&&e.jsxRuntimeExports.jsx(U.AIChatModal,{})]}),e.jsxRuntimeExports.jsxs(Ie,{className:h("site-footer",c.footer),children:[" Â©",new Date().getFullYear()," ",D]})]}),((J=a==null?void 0:a.attrs)==null?void 0:J.ai_enabled)&&(L==="sidebar"||L==="float-sidebar")&&(P||A)&&e.jsxRuntimeExports.jsx(U.AIChatSider,{})]})}))(ue,Q(y),N(ge),B(),i??e.jsxRuntimeExports.jsx(p.Outlet,{}))},Ue=new ae.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),ne={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function Fe({transformRouter:i=x=>x,transformSettingTabs:o=x=>x,transformLangConfig:y=x=>x,extraPrivateRoutes:_=[],extraPublicRoutes:S=[],menuStyle:N="dark",transformHeaderItems:C=x=>x,renderLayout:q}){const{i18n:x}=T.useTranslation(),[k,c]=r.useState(ne[x.language]||e.default_1$5);r.useEffect(()=>{c(ne[x.language]||e.default_1$5)},[x.language]);const L=R=>R.map(j=>j.children===void 0?j:{...j,children:L(j.children)}),P=i(L(Oe({transformSettingTabs:o,transformLangConfig:y,extraPrivateRoutes:_,extraPublicRoutes:S}))),A=(R,j)=>R.flatMap(s=>s.is_private?[s]:"children"in s&&s.children?s.children:[s]).map((s,v)=>{const M=s.is_private?e.jsxRuntimeExports.jsx(E.PrivateRoute,{element:e.jsxRuntimeExports.jsx(re,{routes:P,element:s.element,transformLangConfig:y,menuStyle:N,transformHeaderItems:C,renderLayout:q})}):s.element;if("children"in s&&s.children&&s.children.length>0)return e.jsxRuntimeExports.jsx(p.Route,{path:s.path,element:M,children:A(s.children,s)},s.path??s.name??v);const{path:O}=s;return e.jsxRuntimeExports.jsx(p.Route,{path:O,index:s.index,element:M},O??s.name??`${(j==null?void 0:j.path)??""}.${v}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(ae.QueryClientProvider,{client:Ue,children:e.jsxRuntimeExports.jsx(V.ThemeProvider,{children:e.jsxRuntimeExports.jsx(f.ConfigProvider,{locale:k,children:e.jsxRuntimeExports.jsx(b.AuthProvider,{children:e.jsxRuntimeExports.jsx(b.SiteProvider,{children:e.jsxRuntimeExports.jsx(b.AIProvider,{children:e.jsxRuntimeExports.jsx(p.BrowserRouter,{basename:I.getURL(),children:e.jsxRuntimeExports.jsx(p.Routes,{children:A(P)})})})})})})})})}const Te={...ie.authorizationapi,...I.baseapi,...se.oauthapi,...F.aiapi,...F.aiapi};exports.App=Fe;exports.AppLayout=re;exports.api=ke;exports.api$1=Te;exports.withSuspense=u;
