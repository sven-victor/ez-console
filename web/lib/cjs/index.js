"use strict";const re=require("./ai.js"),Q=require("./authorization.js"),$=require("./base.js"),U=require("./system.js"),W=require("./oauth.js"),e=require("./vendor.js"),Y=require("react-query"),c=require("react-router-dom"),x=require("antd"),M=require("react-i18next"),r=require("react"),h=require("./components.js"),m=require("@ant-design/icons"),R=require("./contexts.js"),ae=require("lodash");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const oe=r.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),le=r.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),ue=r.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),H=r.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),ce=r.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),me=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserList)),he=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserDetail)),T=r.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserForm)),xe=r.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(n=>n.RoleList)),V=r.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(n=>n.RoleForm)),pe=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.index)),de=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.OrganizationDetail)),je=r.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.OAuthTestCallback)),fe=r.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),ge=r.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(n=>n.ServiceAccountList)),ve=r.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(n=>n.ServiceAccountDetail));function o(n,d){return e.jsxRuntimeExports.jsx(r.Suspense,{fallback:e.jsxRuntimeExports.jsx(h.Loading,{}),children:e.jsxRuntimeExports.jsx(n,{...d})})}const Re=({transformSettingTabs:n,transformLangConfig:d,extraPrivateRoutes:y=[],extraPublicRoutes:E=[]})=>{const z=[{path:"/login",element:o(le,{transformLangConfig:d}),index:!0},{path:"/404",element:o(H),index:!0},{path:"/403",element:o(ce),index:!0},{path:"/system/settings/oauth/test-callback",element:o(je),index:!0},...E],w=[{path:"/",is_private:!0,children:[{path:"/",element:o(oe),name:"dashboard",icon:e.jsxRuntimeExports.jsx(m.DashboardOutlined,{}),index:!0},{path:"/profile",element:o(ue),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete","authorization:role:view"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(m.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:o(xe),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:o(V),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:o(V),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:o(me),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:o(T),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:o(he),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:o(T),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:o(ge),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:o(ve),permissions:["authorization:service_account:view"],index:!0}]}]},...y,{name:"system",icon:e.jsxRuntimeExports.jsx(m.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(m.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",index:!0,element:o(pe,{transformItems:n})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:o(de),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(m.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:o(fe)}]},{path:"*",element:o(H),index:!0}]}];return[...z,...w]},ye={ai:re.ai,authorization:Q.authorizationapi,base:$.baseapi,system:U.aiapi,oauth:W.oauthapi},{Header:Ee,Content:ze,Footer:we,Sider:qe}=x.Layout,{SubMenu:be}=x.Menu,G=({element:n,routes:d,transformLangConfig:y,menuStyle:E="dark",transformHeaderItems:z=g=>g,renderLayout:w})=>{const{layout:g,visible:I}=R.useAI(),{t:u,i18n:q}=M.useTranslation(),{t:b}=M.useTranslation("common"),v=c.useLocation(),{hasPermission:P}=R.usePermission(),S=c.useNavigate(),{logout:_,user:a}=R.useAuth(),{siteConfig:i,clearCurrentOrgId:O}=R.useSite(),[L,A]=r.useState([]),[J,X]=r.useState(null),[C,Z]=r.useState("Loading...");v.pathname!=="/profile"&&(a&&a.mfa_enforced&&!a.mfa_enabled?S("/profile#mfa"):a&&a.status==="password_expired"&&S("/profile#password"));const ee=()=>{_(),O(),window.location.href=$.getURL("/login?redirect="+encodeURIComponent(window.location.href))},te=[{key:"profile",label:e.jsxRuntimeExports.jsx(c.Link,{to:"/profile",children:b("profile")})},{key:"logout",label:b("logout"),onClick:ee}];r.useEffect(()=>{var s;if(i){const l=i.navigation.filter(t=>t.path!==i.home_page),j=[...i.home_page?[{name:"home",path:i.home_page}]:[],...l];j.length>1?A(j):A([]),X(i.logo),(s=document.getElementById("site-icon"))==null||s.setAttribute("href",i.logo)}},[i]),r.useEffect(()=>{q.language&&Z((i==null?void 0:i.name_i18n[q.language])||(i==null?void 0:i.name)||"")},[i,q.language]);const D=()=>{const s=c.matchRoutes(d,v.pathname),l=[];if(s){for(const[j,t]of s.entries())if(t.route.path==="/"&&!t.route.name)l.push({href:t.route.path,title:b("home"),key:"home"});else if(t.route.name){const p=s.slice(0,j+1).map(f=>f.route.name).filter(Boolean).join(".");l.push({path:t.route.path,title:t.route.name?u(`breadcrumbs.${p}`):void 0,key:t.route.path})}}return l},ie=s=>s.some(l=>P(l)),se=ae.flatMapDeep(d,s=>s.children).map(s=>s==null?void 0:s.name).filter(s=>s!==void 0),F=(s,l=[])=>{const j=t=>t&&t.replace(/_/g," ").split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ");return s.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!ie(t.permissions))return null;const p=j(t.name);if(!t.name)return null;if("children"in t&&t.children){const f=F(t.children,[...l,t.name]);return f.length==0&&t.path?e.jsxRuntimeExports.jsx(x.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:u(`menu.${[...l,t.name].join(".")}`,{defaultValue:p})})},t.path):e.jsxRuntimeExports.jsx(be,{icon:t.icon,title:u(`menu.${[...l,t.name,t.name].join(".")}`,{defaultValue:p}),children:f},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(x.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:u(`menu.${[...l,t.name].join(".")}`,{defaultValue:p})})},t.path):null}).filter(Boolean)};r.useEffect(()=>{const s=D().filter(l=>l.path!=="/").map(l=>l.title).join(" - ");s?document.title=`${C} | ${s}`:document.title=C},[D,v.pathname]);const ne=[e.jsxRuntimeExports.jsx(h.HeaderDropdown,{hidden:L.length<=1,menu:{items:L.map(s=>({key:s.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:s.path,children:u(`menu.${s.name}`,{defaultValue:s.name})})}))},children:e.jsxRuntimeExports.jsx(m.SwapOutlined,{})}),...i!=null&&i.enable_multi_org?[e.jsxRuntimeExports.jsx(h.OrganizationSwitcher,{},"org-switcher")]:[],e.jsxRuntimeExports.jsxs(h.HeaderDropdown,{menu:{items:te},children:[a!=null&&a.avatar?e.jsxRuntimeExports.jsx(h.Avatar,{src:a.avatar}):e.jsxRuntimeExports.jsx(h.Avatar,{icon:e.jsxRuntimeExports.jsx(m.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:(a==null?void 0:a.full_name)||(a==null?void 0:a.username)})]}),e.jsxRuntimeExports.jsx(h.LanguageSwitch,{transformLangConfig:y})];return(w??((s,l,j,t,p)=>{const[f,N]=r.useState(!1);return e.jsxRuntimeExports.jsxs(x.Layout,{style:{minHeight:"100vh",display:"flex",flexDirection:"row"},children:[e.jsxRuntimeExports.jsxs(qe,{collapsible:!0,collapsed:f,onCollapse:N,theme:E,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:s?e.jsxRuntimeExports.jsx("img",{src:s,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(x.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(x.Menu,{theme:E,defaultOpenKeys:se,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[v.pathname],children:l})]}),e.jsxRuntimeExports.jsxs(x.Layout,{className:"site-layout main-layout",style:{flex:1,minWidth:0},children:[e.jsxRuntimeExports.jsxs(Ee,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(x.Button,{type:"text",icon:f?e.jsxRuntimeExports.jsx(m.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(m.MenuFoldOutlined,{}),onClick:()=>N(!f),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsx("div",{style:{marginRight:"20px"},children:j})]}),e.jsxRuntimeExports.jsxs(ze,{style:{margin:"0 16px",height:"calc(100vh - 170px)",overflow:"auto"},children:[e.jsxRuntimeExports.jsx(x.Breadcrumb,{style:{margin:"16px 0"},itemRender:k=>{const B=k.href||k.path;return B?e.jsxRuntimeExports.jsx(c.Link,{to:B,children:k.title}):e.jsxRuntimeExports.jsx("span",{children:k.title})},items:t}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:"calc(100vh - 190px)"},children:p}),e.jsxRuntimeExports.jsx(h.AIChatButton,{}),g==="classic"&&e.jsxRuntimeExports.jsx(h.AIChatModal,{})]}),e.jsxRuntimeExports.jsxs(we,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",C]})]}),(g==="sidebar"||g==="float-sidebar")&&I&&e.jsxRuntimeExports.jsx(h.AIChatSider,{})]})}))(J,F(d),z(ne),D(),n??e.jsxRuntimeExports.jsx(c.Outlet,{}))},Se=new Y.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),K={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function _e({transformRouter:n=u=>u,transformSettingTabs:d=u=>u,transformLangConfig:y=u=>u,extraPrivateRoutes:E=[],extraPublicRoutes:z=[],menuStyle:w="dark",transformHeaderItems:g=u=>u,renderLayout:I}){const{i18n:u}=M.useTranslation(),[q,b]=r.useState(K[u.language]||e.default_1$5);r.useEffect(()=>{b(K[u.language]||e.default_1$5)},[u.language]);const v=_=>_.map(a=>a.children===void 0?a:{...a,children:v(a.children)}),P=n(v(Re({transformSettingTabs:d,transformLangConfig:y,extraPrivateRoutes:E,extraPublicRoutes:z}))),S=(_,a)=>_.flatMap(i=>i.is_private?[i]:"children"in i&&i.children?i.children:[i]).map((i,O)=>{const L=i.is_private?e.jsxRuntimeExports.jsx(h.PrivateRoute,{element:e.jsxRuntimeExports.jsx(G,{routes:P,element:i.element,transformLangConfig:y,menuStyle:w,transformHeaderItems:g,renderLayout:I})}):i.element;if("children"in i&&i.children&&i.children.length>0)return e.jsxRuntimeExports.jsx(c.Route,{path:i.path,element:L,children:S(i.children,i)},i.path??i.name??O);const{path:A}=i;return e.jsxRuntimeExports.jsx(c.Route,{path:A,index:i.index,element:L},A??i.name??`${(a==null?void 0:a.path)??""}.${O}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(Y.QueryClientProvider,{client:Se,children:e.jsxRuntimeExports.jsx(x.ConfigProvider,{locale:q,children:e.jsxRuntimeExports.jsx(R.AuthProvider,{children:e.jsxRuntimeExports.jsx(R.SiteProvider,{children:e.jsxRuntimeExports.jsx(R.AIProvider,{children:e.jsxRuntimeExports.jsx(c.BrowserRouter,{basename:$.getURL(),children:e.jsxRuntimeExports.jsx(c.Routes,{children:S(P)})})})})})})})}const Le={...Q.authorizationapi,...$.baseapi,...W.oauthapi,...U.aiapi,...U.aiapi};exports.App=_e;exports.AppLayout=G;exports.api=ye;exports.api$1=Le;exports.withSuspense=o;
