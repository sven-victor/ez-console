"use strict";const ye=require("./ai.js"),ie=require("./authorization.js"),I=require("./base.js"),U=require("./system.js"),ne=require("./oauth.js"),fe=require("./tasks.js"),Re=require("./user_tasks.js"),e=require("./vendor.js"),re=require("react-query"),p=require("react-router-dom"),y=require("antd"),F=require("react-i18next"),n=require("react"),f=require("./components.js"),c=require("@ant-design/icons"),k=require("./contexts.js"),ve=require("lodash-es"),B=require("./ai-chat-layout.js"),V=require("antd-style"),h=require("classnames");require("./ai-chat.js");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const Ee=n.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),we=n.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),ze=n.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),Z=n.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),ke=n.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),be=n.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(s=>s.UserList)),qe=n.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(s=>s.UserDetail)),ee=n.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(s=>s.UserForm)),Se=n.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(s=>s.RoleList)),te=n.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(s=>s.RoleForm)),Le=n.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(s=>s.index)),Pe=n.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(s=>s.OrganizationDetail)),_e=n.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(s=>s.SkillEditor)),Ne=n.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(s=>s.SkillPreview)),Ae=n.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(s=>s.OAuthTestCallback)),Oe=n.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),Me=n.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(s=>s.ServiceAccountList)),$e=n.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(s=>s.ServiceAccountDetail)),Ie=n.lazy(()=>Promise.resolve().then(()=>require("./task_list.js"))),De=n.lazy(()=>Promise.resolve().then(()=>require("./task_detail.js")));function l(s,o){return e.jsxRuntimeExports.jsx(n.Suspense,{fallback:e.jsxRuntimeExports.jsx(f.Loading,{}),children:e.jsxRuntimeExports.jsx(s,{...o})})}const Ce=({transformSettingTabs:s,transformLangConfig:o,extraPrivateRoutes:R=[],extraPublicRoutes:L=[]})=>{const b=[{path:"/login",element:l(we,{transformLangConfig:o}),index:!0},{path:"/404",element:l(Z),index:!0},{path:"/403",element:l(ke),index:!0},{path:"/system/settings/oauth/test-callback",element:l(Ae),index:!0},...L],P=[{path:"/",is_private:!0,children:[{path:"/",element:l(Ee),name:"dashboard",icon:e.jsxRuntimeExports.jsx(c.DashboardOutlined,{}),index:!0},{path:"/profile",element:l(ze),name:void 0,index:!0},...R,{path:"/tasks",permissions:["task:list"],children:[{path:"/tasks",element:l(Ie),permissions:["task:list"],index:!0},{path:"/tasks/:id",element:l(De),permissions:["task:view"],index:!0}]},{name:"authorization",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:user:list","authorization:service_account:list","authorization:role:list"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(c.SolutionOutlined,{}),permissions:["authorization:role:list"],children:[{element:l(Se),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:l(te),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:l(te),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:user:list"],children:[{element:l(be),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:l(ee),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:l(qe),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:l(ee),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:service_account:list"],children:[{element:l(Me),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:l($e),permissions:["authorization:service_account:view"],index:!0}]}]},{name:"system",icon:e.jsxRuntimeExports.jsx(c.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view","system:skills:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(c.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view","system:skills:view"],children:[{path:"/system/settings",index:!0,element:l(Le,{transformItems:s})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:l(Pe),index:!0},{path:"/system/settings/skills/:id/edit",permissions:["system:skills:edit_files"],element:l(_e),index:!0},{path:"/system/settings/skills/:id/preview",permissions:["system:skills:view"],element:l(Ne),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(c.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:l(Oe)}]},{path:"*",element:l(Z),index:!0}]}];return[...b,...P]},Te={ai:ye.ai,authorization:ie.authorizationapi,base:I.baseapi,system:U.aiapi,oauth:ne.oauthapi,tasks:fe.tasks,userTasks:Re.userTasks},{Header:Be,Content:Ue,Footer:Fe,Sider:Ve}=y.Layout,{SubMenu:Ke}=y.Menu,He=V.createStyles(({token:s,css:o})=>({layout:o`
      min-height: 100vh;
      display: flex;
      flex-direction: row;
    `,header:o`
      padding: 0;
      display: flex;
      justify-content: space-between;
      background-color: ${s.colorBgContainer};
      border-block-end: 1px solid ${s.colorBorderSecondary};
    `,footer:o`
      text-align: center;
      padding: 15px 50px;
    `,contentContainer:o`
      padding: 24px;
      background-color: ${s.colorBgContainer};
    `,content:o`
      margin: 0 16px;
      height: calc(100vh - 120px);
      overflow: auto;
    `,mainLayout:o`
      flex: 1;
      min-width: 0;
      background-color: ${s.colorBgContainer};
    `,breadcrumb:o`
      margin-left: 8px;
    `,headerItems:o`
      margin-right: 20px;
    `,userName:o`
      height: 1em;
      line-height: 1em;
      margin-left: 5px;
    `,themeSwitch:o`
      display: inline-flex;
    `,menuSider:o`
      .ant-layout-sider-children{
        display: flex;
        flex-direction: column;
      }
    `,menuToggleButton:o`
      &&{
        font-size: 16px;
        width: 64px;
        height: 64px;
      }
    `,layoutLogo:o`
      margin: 8px;
      display: flex;
    `,layoutLogoContainer:o`
      width: 100%;
      height: 100%;
      text-align: center;
    `,layoutLogoImage:o`
      height: 32px;
      width: 32px;
    `,menu:o`
      flex: 1 1 0%;
    `})),ae=({element:s,siderWidth:o=250,routes:R,transformLangConfig:L,menuStyle:b="dark",transformHeaderItems:P=q=>q,renderLayout:D})=>{const{themeMode:q,setThemeMode:x,isDarkMode:M}=V.useThemeMode(),{styles:m}=He(),{layout:S,visible:_,loaded:N}=k.useAI(),{t:v,i18n:j}=F.useTranslation(),{t:r}=F.useTranslation("common"),E=p.useLocation(),{hasPermission:A}=k.usePermission(),O=p.useNavigate(),{logout:oe,user:d}=k.useAuth(),{siteConfig:a,clearCurrentOrgId:le}=k.useSite(),[K,H]=n.useState([]),[ue,me]=n.useState(null),[C,ce]=n.useState("Loading...");E.pathname!=="/profile"&&(d&&d.mfa_enforced&&!d.mfa_enabled?O("/profile#mfa"):d&&d.status==="password_expired"&&O("/profile#password"));const de=()=>{oe(),le(),window.location.href=I.getURL("/login?redirect="+encodeURIComponent(window.location.href))},he=[{key:"profile",label:e.jsxRuntimeExports.jsx(p.Link,{to:"/profile",children:r("profile")})},{key:"logout",label:r("logout"),onClick:de}];n.useEffect(()=>{var i,u;if(a){const z=((i=a.navigation)==null?void 0:i.filter(g=>g.path!==a.home_page))??[],t=[...a.home_page?[{name:"home",path:a.home_page}]:[],...z];t.length>1?H(t):H([]),me(a.logo),(u=document.getElementById("site-icon"))==null||u.setAttribute("href",a.logo)}},[a]),n.useEffect(()=>{j.language&&ce((a==null?void 0:a.name_i18n[j.language])||(a==null?void 0:a.name)||"")},[a,j.language]);const T=()=>{const i=p.matchRoutes(R,E.pathname),u=[];if(i){for(const[z,t]of i.entries())if(t.route.path==="/"&&!t.route.name)u.push({href:t.route.path,title:r("home"),key:"home"});else if(t.route.name){const g=i.slice(0,z+1).map(w=>w.route.name).filter(Boolean).join(".");u.push({path:t.route.path,title:t.route.name?v(`breadcrumbs.${g}`):void 0,key:t.route.path})}}return u},xe=i=>i.some(u=>A(u)),pe=ve.flatMapDeep(R,i=>i.children).map(i=>i==null?void 0:i.name).filter(i=>i!==void 0),Q=(i,u=[])=>{const z=t=>t&&t.replace(/_/g," ").split(" ").map(g=>g.charAt(0).toUpperCase()+g.slice(1)).join(" ");return i.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!xe(t.permissions))return null;const g=z(t.name);if(!t.name)return null;if("children"in t&&t.children){const w=Q(t.children,[...u,t.name]);return w.length==0&&t.path?e.jsxRuntimeExports.jsx(y.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(p.Link,{to:t.path,children:v(`menu.${[...u,t.name].join(".")}`,{defaultValue:g})})},t.path):e.jsxRuntimeExports.jsx(Ke,{icon:t.icon,title:v(`menu.${[...u,t.name,t.name].join(".")}`,{defaultValue:g}),children:w},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(y.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(p.Link,{to:t.path,children:v(`menu.${[...u,t.name].join(".")}`,{defaultValue:g})})},t.path):null}).filter(Boolean)};n.useEffect(()=>{const i=T().filter(u=>u.path!=="/").map(u=>u.title).join(" - ");i?document.title=`${C} | ${i}`:document.title=C},[T,E.pathname]);const je=n.useMemo(()=>{const i=p.matchRoutes(R,E.pathname);if(i){for(const u of i.reverse())if(u.route.path&&u.route.name)return u.route.path}return E.pathname},[E.pathname]),ge=[e.jsxRuntimeExports.jsx(f.HeaderDropdown,{className:"header-item navigation-dropdown",hidden:K.length<=1,menu:{items:K.map(i=>({key:i.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:i.path,children:v(`menu.${i.name}`,{defaultValue:i.name})})}))},children:e.jsxRuntimeExports.jsx(c.SwapOutlined,{})},"navigation-dropdown"),...a!=null&&a.enable_multi_org?[e.jsxRuntimeExports.jsx(f.OrganizationSwitcher,{className:"header-item org-switcher"},"org-switcher")]:[],...A("task:list")?[e.jsxRuntimeExports.jsx(f.TaskListDropdown,{className:"header-item task-dropdown"},"task-dropdown")]:[],e.jsxRuntimeExports.jsxs(f.HeaderDropdown,{className:"header-item user-dropdown",menu:{items:he},children:[d!=null&&d.avatar?e.jsxRuntimeExports.jsx(f.Avatar,{src:d.avatar}):e.jsxRuntimeExports.jsx(f.Avatar,{icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{className:h("header-user-name",m.userName),children:(d==null?void 0:d.full_name)||(d==null?void 0:d.username)})]},"user-dropdown"),e.jsxRuntimeExports.jsx(f.LanguageSwitch,{className:"header-item language-switch",transformLangConfig:L},"language-switch"),e.jsxRuntimeExports.jsx(f.HeaderDropdown,{className:"header-item theme-switch",menu:{items:[{key:"light",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(c.SunOutlined,{})," ",r("light",{defaultValue:"Light Mode"})]})},{key:"dark",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(c.MoonOutlined,{})," ",r("dark",{defaultValue:"Dark Mode"})]})}],onClick:({key:i})=>{x(i)},selectedKeys:[q]},children:q==="light"?e.jsxRuntimeExports.jsx(c.SunOutlined,{}):e.jsxRuntimeExports.jsx(c.MoonOutlined,{})},"theme-switch")];return(D??((i,u,z,t,g)=>{var Y,G,J;const[w,W]=n.useState(!1);return e.jsxRuntimeExports.jsxs(y.Layout,{className:h("main-layout",m.layout),children:[e.jsxRuntimeExports.jsxs(Ve,{width:o,collapsible:!0,collapsed:w,onCollapse:W,className:h(m.menuSider,"layout-menu-sider"),theme:M?"light":b,children:[e.jsxRuntimeExports.jsx("div",{className:h("logo",m.layoutLogo),children:e.jsxRuntimeExports.jsx("div",{className:h("layout-logo-container",m.layoutLogoContainer),children:i?e.jsxRuntimeExports.jsx("img",{src:i,alt:"logo",className:m.layoutLogoImage}):e.jsxRuntimeExports.jsx(y.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(y.Menu,{className:h("layout-menu",m.menu),theme:M?"light":b,defaultOpenKeys:pe,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[je],children:u})]}),e.jsxRuntimeExports.jsxs(y.Layout,{className:h("site-layout","main-layout",m.mainLayout),children:[e.jsxRuntimeExports.jsxs(Be,{className:h("site-header",m.header),children:[e.jsxRuntimeExports.jsxs(y.Space,{children:[e.jsxRuntimeExports.jsx(y.Button,{type:"text",icon:w?e.jsxRuntimeExports.jsx(c.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(c.MenuFoldOutlined,{}),onClick:()=>W(!w),className:h("layout-menu-toggle",m.menuToggleButton)}),e.jsxRuntimeExports.jsx(y.Breadcrumb,{className:h("site-breadcrumb",m.breadcrumb),itemRender:$=>{const X=$.href||$.path;return X?e.jsxRuntimeExports.jsx(p.Link,{to:X,children:$.title}):e.jsxRuntimeExports.jsx("span",{children:$.title})},items:t})]}),e.jsxRuntimeExports.jsx("div",{className:h("header-items",m.headerItems),children:z})]}),e.jsxRuntimeExports.jsxs(Ue,{className:h("site-content",m.content),children:[e.jsxRuntimeExports.jsx("div",{className:h("site-content-container",m.contentContainer),children:g}),((Y=a==null?void 0:a.attrs)==null?void 0:Y.ai_enabled)&&e.jsxRuntimeExports.jsx(B.AIChatButton,{}),((G=a==null?void 0:a.attrs)==null?void 0:G.ai_enabled)&&S==="classic"&&(_||N)&&e.jsxRuntimeExports.jsx(B.AIChatModal,{})]}),e.jsxRuntimeExports.jsxs(Fe,{className:h("site-footer",m.footer),children:[" Â©",new Date().getFullYear()," ",C]})]}),((J=a==null?void 0:a.attrs)==null?void 0:J.ai_enabled)&&(S==="sidebar"||S==="float-sidebar")&&(_||N)&&e.jsxRuntimeExports.jsx(B.AIChatSider,{})]})}))(ue,Q(R),P(ge),T(),s??e.jsxRuntimeExports.jsx(p.Outlet,{}))},Qe=new re.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),se={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function We({transformRouter:s=x=>x,transformSettingTabs:o=x=>x,transformLangConfig:R=x=>x,extraPrivateRoutes:L=[],extraPublicRoutes:b=[],menuStyle:P="dark",transformHeaderItems:D=x=>x,renderLayout:q}){const{i18n:x}=F.useTranslation(),[M,m]=n.useState(se[x.language]||e.default_1$5);n.useEffect(()=>{m(se[x.language]||e.default_1$5)},[x.language]);const S=v=>v.map(j=>j.children===void 0?j:{...j,children:S(j.children)}),_=s(S(Ce({transformSettingTabs:o,transformLangConfig:R,extraPrivateRoutes:L,extraPublicRoutes:b}))),N=(v,j)=>v.flatMap(r=>r.is_private?[r]:"children"in r&&r.children?r.children:[r]).map((r,E)=>{const A=r.is_private?e.jsxRuntimeExports.jsx(f.PrivateRoute,{element:e.jsxRuntimeExports.jsx(ae,{routes:_,element:r.element,transformLangConfig:R,menuStyle:P,transformHeaderItems:D,renderLayout:q})}):r.element;if("children"in r&&r.children&&r.children.length>0)return e.jsxRuntimeExports.jsx(p.Route,{path:r.path,element:A,children:N(r.children,r)},r.path??r.name??E);const{path:O}=r;return e.jsxRuntimeExports.jsx(p.Route,{path:O,index:r.index,element:A},O??r.name??`${(j==null?void 0:j.path)??""}.${E}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(re.QueryClientProvider,{client:Qe,children:e.jsxRuntimeExports.jsx(V.ThemeProvider,{children:e.jsxRuntimeExports.jsx(y.ConfigProvider,{locale:M,children:e.jsxRuntimeExports.jsx(k.AuthProvider,{children:e.jsxRuntimeExports.jsx(k.SiteProvider,{children:e.jsxRuntimeExports.jsx(k.AIProvider,{children:e.jsxRuntimeExports.jsx(p.BrowserRouter,{basename:I.getURL(),children:e.jsxRuntimeExports.jsx(p.Routes,{children:N(_)})})})})})})})})}const Ye={...ie.authorizationapi,...I.baseapi,...ne.oauthapi,...U.aiapi,...U.aiapi};exports.App=We;exports.AppLayout=ae;exports.api=Te;exports.api$1=Ye;exports.withSuspense=l;
