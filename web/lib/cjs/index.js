"use strict";const oe=require("./ai.js"),Y=require("./authorization.js"),I=require("./base.js"),F=require("./system.js"),G=require("./oauth.js"),e=require("./vendor.js"),J=require("react-query"),c=require("react-router-dom"),m=require("antd"),N=require("react-i18next"),a=require("react"),f=require("./components.js"),h=require("@ant-design/icons"),E=require("./contexts.js"),le=require("lodash-es"),M=require("./ai-chat-layout.js");require("./ai-chat.js");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const ue=a.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),ce=a.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),he=a.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),V=a.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),me=a.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),de=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserList)),pe=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserDetail)),K=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserForm)),xe=a.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(r=>r.RoleList)),Q=a.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(r=>r.RoleForm)),je=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(r=>r.index)),ve=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(r=>r.OrganizationDetail)),fe=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(r=>r.OAuthTestCallback)),ge=a.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),Re=a.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(r=>r.ServiceAccountList)),ye=a.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(r=>r.ServiceAccountDetail));function o(r,x){return e.jsxRuntimeExports.jsx(a.Suspense,{fallback:e.jsxRuntimeExports.jsx(f.Loading,{}),children:e.jsxRuntimeExports.jsx(r,{...x})})}const Ee=({transformSettingTabs:r,transformLangConfig:x,extraPrivateRoutes:z=[],extraPublicRoutes:w=[]})=>{const S=[{path:"/login",element:o(ce,{transformLangConfig:x}),index:!0},{path:"/404",element:o(V),index:!0},{path:"/403",element:o(me),index:!0},{path:"/system/settings/oauth/test-callback",element:o(fe),index:!0},...w],_=[{path:"/",is_private:!0,children:[{path:"/",element:o(ue),name:"dashboard",icon:e.jsxRuntimeExports.jsx(h.DashboardOutlined,{}),index:!0},{path:"/profile",element:o(he),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete","authorization:role:view"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(h.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:o(xe),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:o(Q),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:o(Q),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:o(de),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:o(K),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:o(pe),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:o(K),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:o(Re),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:o(ye),permissions:["authorization:service_account:view"],index:!0}]}]},...z,{name:"system",icon:e.jsxRuntimeExports.jsx(h.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(h.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",index:!0,element:o(je,{transformItems:r})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:o(ve),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(h.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:o(ge)}]},{path:"*",element:o(V),index:!0}]}];return[...S,..._]},ze={ai:oe.ai,authorization:Y.authorizationapi,base:I.baseapi,system:F.aiapi,oauth:G.oauthapi},{Header:we,Content:qe,Footer:be,Sider:Se}=m.Layout,{SubMenu:_e}=m.Menu,X=({element:r,routes:x,transformLangConfig:z,menuStyle:w="dark",transformHeaderItems:S=g=>g,renderLayout:_})=>{const{layout:g,visible:P,loaded:u}=E.useAI(),{t:R,i18n:L}=N.useTranslation(),{t:q}=N.useTranslation("common"),y=c.useLocation(),{hasPermission:O}=E.usePermission(),b=c.useNavigate(),{logout:d,user:i}=E.useAuth(),{siteConfig:s,clearCurrentOrgId:k}=E.useSite(),[A,C]=a.useState([]),[Z,ee]=a.useState(null),[D,te]=a.useState("Loading...");y.pathname!=="/profile"&&(i&&i.mfa_enforced&&!i.mfa_enabled?b("/profile#mfa"):i&&i.status==="password_expired"&&b("/profile#password"));const ie=()=>{d(),k(),window.location.href=I.getURL("/login?redirect="+encodeURIComponent(window.location.href))},se=[{key:"profile",label:e.jsxRuntimeExports.jsx(c.Link,{to:"/profile",children:q("profile")})},{key:"logout",label:q("logout"),onClick:ie}];a.useEffect(()=>{var n;if(s){const l=s.navigation.filter(t=>t.path!==s.home_page),j=[...s.home_page?[{name:"home",path:s.home_page}]:[],...l];j.length>1?C(j):C([]),ee(s.logo),(n=document.getElementById("site-icon"))==null||n.setAttribute("href",s.logo)}},[s]),a.useEffect(()=>{L.language&&te((s==null?void 0:s.name_i18n[L.language])||(s==null?void 0:s.name)||"")},[s,L.language]);const U=()=>{const n=c.matchRoutes(x,y.pathname),l=[];if(n){for(const[j,t]of n.entries())if(t.route.path==="/"&&!t.route.name)l.push({href:t.route.path,title:q("home"),key:"home"});else if(t.route.name){const p=n.slice(0,j+1).map(v=>v.route.name).filter(Boolean).join(".");l.push({path:t.route.path,title:t.route.name?R(`breadcrumbs.${p}`):void 0,key:t.route.path})}}return l},ne=n=>n.some(l=>O(l)),re=le.flatMapDeep(x,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),B=(n,l=[])=>{const j=t=>t&&t.replace(/_/g," ").split(" ").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!ne(t.permissions))return null;const p=j(t.name);if(!t.name)return null;if("children"in t&&t.children){const v=B(t.children,[...l,t.name]);return v.length==0&&t.path?e.jsxRuntimeExports.jsx(m.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:p})})},t.path):e.jsxRuntimeExports.jsx(_e,{icon:t.icon,title:R(`menu.${[...l,t.name,t.name].join(".")}`,{defaultValue:p}),children:v},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(m.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(c.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:p})})},t.path):null}).filter(Boolean)};a.useEffect(()=>{const n=U().filter(l=>l.path!=="/").map(l=>l.title).join(" - ");n?document.title=`${D} | ${n}`:document.title=D},[U,y.pathname]);const ae=[e.jsxRuntimeExports.jsx(f.HeaderDropdown,{hidden:A.length<=1,menu:{items:A.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:R(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(h.SwapOutlined,{})},"navigation-dropdown"),...s!=null&&s.enable_multi_org?[e.jsxRuntimeExports.jsx(f.OrganizationSwitcher,{},"org-switcher")]:[],e.jsxRuntimeExports.jsxs(f.HeaderDropdown,{menu:{items:se},children:[i!=null&&i.avatar?e.jsxRuntimeExports.jsx(f.Avatar,{src:i.avatar}):e.jsxRuntimeExports.jsx(f.Avatar,{icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:(i==null?void 0:i.full_name)||(i==null?void 0:i.username)})]},"user-dropdown"),e.jsxRuntimeExports.jsx(f.LanguageSwitch,{transformLangConfig:z},"language-switch")];return(_??((n,l,j,t,p)=>{const[v,H]=a.useState(!1);return e.jsxRuntimeExports.jsxs(m.Layout,{style:{minHeight:"100vh",display:"flex",flexDirection:"row"},children:[e.jsxRuntimeExports.jsxs(Se,{collapsible:!0,collapsed:v,onCollapse:H,theme:w,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:n?e.jsxRuntimeExports.jsx("img",{src:n,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(m.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(m.Menu,{theme:w,defaultOpenKeys:re,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[y.pathname],children:l})]}),e.jsxRuntimeExports.jsxs(m.Layout,{className:"site-layout main-layout",style:{flex:1,minWidth:0},children:[e.jsxRuntimeExports.jsxs(we,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(m.Button,{type:"text",icon:v?e.jsxRuntimeExports.jsx(h.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(h.MenuFoldOutlined,{}),onClick:()=>H(!v),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsx("div",{style:{marginRight:"20px"},children:j})]}),e.jsxRuntimeExports.jsxs(qe,{style:{margin:"0 16px",height:"calc(100vh - 170px)",overflow:"auto"},children:[e.jsxRuntimeExports.jsx(m.Breadcrumb,{style:{margin:"16px 0"},itemRender:$=>{const T=$.href||$.path;return T?e.jsxRuntimeExports.jsx(c.Link,{to:T,children:$.title}):e.jsxRuntimeExports.jsx("span",{children:$.title})},items:t}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:"calc(100vh - 190px)"},children:p}),(s==null?void 0:s.attrs.ai_enabled)&&e.jsxRuntimeExports.jsx(M.AIChatButton,{}),(s==null?void 0:s.attrs.ai_enabled)&&g==="classic"&&(P||u)&&e.jsxRuntimeExports.jsx(M.AIChatModal,{})]}),e.jsxRuntimeExports.jsxs(be,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",D]})]}),(s==null?void 0:s.attrs.ai_enabled)&&(g==="sidebar"||g==="float-sidebar")&&(P||u)&&e.jsxRuntimeExports.jsx(M.AIChatSider,{})]})}))(Z,B(x),S(ae),U(),r??e.jsxRuntimeExports.jsx(c.Outlet,{}))},Le=new J.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),W={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function Ae({transformRouter:r=u=>u,transformSettingTabs:x=u=>u,transformLangConfig:z=u=>u,extraPrivateRoutes:w=[],extraPublicRoutes:S=[],menuStyle:_="dark",transformHeaderItems:g=u=>u,renderLayout:P}){const{i18n:u}=N.useTranslation(),[R,L]=a.useState(W[u.language]||e.default_1$5);a.useEffect(()=>{L(W[u.language]||e.default_1$5)},[u.language]);const q=b=>b.map(d=>d.children===void 0?d:{...d,children:q(d.children)}),y=r(q(Ee({transformSettingTabs:x,transformLangConfig:z,extraPrivateRoutes:w,extraPublicRoutes:S}))),O=(b,d)=>b.flatMap(i=>i.is_private?[i]:"children"in i&&i.children?i.children:[i]).map((i,s)=>{const k=i.is_private?e.jsxRuntimeExports.jsx(f.PrivateRoute,{element:e.jsxRuntimeExports.jsx(X,{routes:y,element:i.element,transformLangConfig:z,menuStyle:_,transformHeaderItems:g,renderLayout:P})}):i.element;if("children"in i&&i.children&&i.children.length>0)return e.jsxRuntimeExports.jsx(c.Route,{path:i.path,element:k,children:O(i.children,i)},i.path??i.name??s);const{path:A}=i;return e.jsxRuntimeExports.jsx(c.Route,{path:A,index:i.index,element:k},A??i.name??`${(d==null?void 0:d.path)??""}.${s}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(J.QueryClientProvider,{client:Le,children:e.jsxRuntimeExports.jsx(m.ConfigProvider,{locale:R,children:e.jsxRuntimeExports.jsx(E.AuthProvider,{children:e.jsxRuntimeExports.jsx(E.SiteProvider,{children:e.jsxRuntimeExports.jsx(E.AIProvider,{children:e.jsxRuntimeExports.jsx(c.BrowserRouter,{basename:I.getURL(),children:e.jsxRuntimeExports.jsx(c.Routes,{children:O(y)})})})})})})})}const Pe={...Y.authorizationapi,...I.baseapi,...G.oauthapi,...F.aiapi,...F.aiapi};exports.App=Ae;exports.AppLayout=X;exports.api=ze;exports.api$1=Pe;exports.withSuspense=o;
