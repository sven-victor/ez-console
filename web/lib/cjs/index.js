"use strict";const e=require("./vendor.js"),T=require("react-query"),m=require("react-router-dom"),p=require("antd"),M=require("react-i18next"),s=require("react"),y=require("./components.js"),h=require("@ant-design/icons"),N=require("./contexts.js"),V=require("./authorization.js"),O=require("./base.js"),K=require("./system.js"),Q=require("./oauth.js"),se=require("lodash");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const ie=s.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),re=s.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),ae=s.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),C=s.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),oe=s.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),ue=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserList)),le=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserDetail)),B=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(a=>a.UserForm)),ce=s.lazy(()=>Promise.resolve().then(()=>require("./roles.js"))),me=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(a=>a.index)),he=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(a=>a.OAuthTestCallback)),pe=s.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),de=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(a=>a.ServiceAccountList)),xe=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(a=>a.ServiceAccountDetail));function u(a,d){return e.jsxRuntimeExports.jsx(s.Suspense,{fallback:e.jsxRuntimeExports.jsx(y.Loading,{}),children:e.jsxRuntimeExports.jsx(a,{...d})})}const je=({transformSettingTabs:a,transformLangConfig:d,extraPrivateRoutes:v=[],extraPublicRoutes:E=[]})=>{const z=[{path:"/login",element:u(re,{transformLangConfig:d}),index:!0},{path:"/404",element:u(C),index:!0},{path:"/403",element:u(oe),index:!0},{path:"/system/settings/oauth/test-callback",element:u(he),index:!0},...E],q=[{path:"/",is_private:!0,children:[{path:"/",element:u(ie),name:"dashboard",icon:e.jsxRuntimeExports.jsx(h.DashboardOutlined,{}),index:!0},{path:"/profile",element:u(ae),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(h.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:u(ce),permissions:["authorization:role:view"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:u(ue),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:u(B),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:u(le),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:u(B),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:u(de),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:u(xe),permissions:["authorization:service_account:view"],index:!0}]}]},...v,{name:"system",icon:e.jsxRuntimeExports.jsx(h.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(h.SafetyOutlined,{}),index:!0,name:"settings",permissions:["system:settings:view","system:settings:update"],element:u(me,{transformItems:a})},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(h.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:u(pe)}]},{path:"*",element:u(C),index:!0}]}];return[...z,...q]},W={authorization:V.authorizationapi,base:O.baseapi,system:K.systemapi,oauth:Q.oauthapi},{Header:fe,Content:ge,Footer:Re,Sider:ye}=p.Layout,{SubMenu:ve}=p.Menu,Y=({element:a,routes:d,transformLangConfig:v,menuStyle:E="dark",transformHeaderItems:z=x=>x,renderLayout:q})=>{const{t:x,i18n:w}=M.useTranslation(),{t:l}=M.useTranslation("common"),[S,A]=s.useState(!1),g=m.useLocation(),{hasPermission:P}=N.usePermission(),b=m.useNavigate(),{logout:L,user:i}=N.useAuth(),[r,_]=s.useState([]),[k,$]=s.useState(null),[U,G]=s.useState("Loading..."),[R,J]=s.useState(null);g.pathname!=="/profile"&&(i&&i.mfa_enforced&&!i.mfa_enabled?b("/profile#mfa"):i&&i.status==="password_expired"&&b("/profile#password"));const X=()=>{L(),window.location.href=O.getURL("/login?redirect="+encodeURIComponent(window.location.href))},Z=[{key:"profile",label:e.jsxRuntimeExports.jsx(m.Link,{to:"/profile",children:l("profile")})},{key:"logout",label:l("logout"),onClick:X}];s.useEffect(()=>{W.system.getSiteConfig().then(n=>{var t;const o=n.navigation.filter(c=>c.path!==n.home_page),f=[...n.home_page?[{name:"home",path:n.home_page}]:[],...o];f.length>1?_(f):_([]),$(n.logo),J(n),(t=document.getElementById("site-icon"))==null||t.setAttribute("href",n.logo)})},[]),s.useEffect(()=>{w.language&&G((R==null?void 0:R.name_i18n[w.language])||(R==null?void 0:R.name)||"")},[R,w.language]);const D=()=>{const n=m.matchRoutes(d,g.pathname),o=[];if(n){for(const[f,t]of n.entries())if(t.route.path==="/"&&!t.route.name)o.push({href:t.route.path,title:l("home"),key:"home"});else if(t.route.name){const c=n.slice(0,f+1).map(j=>j.route.name).filter(Boolean).join(".");o.push({path:t.route.path,title:t.route.name?x(`breadcrumbs.${c}`):void 0,key:t.route.path})}}return o},ee=n=>n.some(o=>P(o)),te=se.flatMapDeep(d,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),F=(n,o=[])=>{const f=t=>t&&t.replace(/_/g," ").split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!ee(t.permissions))return null;const c=f(t.name);if(!t.name)return null;if("children"in t&&t.children){const j=F(t.children,[...o,t.name]);return j.length==0&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(m.Link,{to:t.path,children:x(`menu.${[...o,t.name].join(".")}`,{defaultValue:c})})},t.path):e.jsxRuntimeExports.jsx(ve,{icon:t.icon,title:x(`menu.${[...o,t.name,t.name].join(".")}`,{defaultValue:c}),children:j},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(m.Link,{to:t.path,children:x(`menu.${[...o,t.name].join(".")}`,{defaultValue:c})})},t.path):null}).filter(Boolean)};s.useEffect(()=>{const n=D().filter(o=>o.path!=="/").map(o=>o.title).join(" - ");n?document.title=`${U} | ${n}`:document.title=U},[D,g.pathname]);const ne=[e.jsxRuntimeExports.jsx(y.HeaderDropdown,{hidden:r.length<=1,menu:{items:r.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:x(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(h.SwapOutlined,{})}),e.jsxRuntimeExports.jsxs(y.HeaderDropdown,{menu:{items:Z},children:[i!=null&&i.avatar?e.jsxRuntimeExports.jsx(y.Avatar,{src:i.avatar}):e.jsxRuntimeExports.jsx(y.Avatar,{icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:(i==null?void 0:i.full_name)||(i==null?void 0:i.username)})]}),e.jsxRuntimeExports.jsx(y.LanguageSwitch,{transformLangConfig:v})];return(q??((n,o,f,t,c)=>e.jsxRuntimeExports.jsxs(p.Layout,{style:{minHeight:"100vh"},children:[e.jsxRuntimeExports.jsxs(ye,{collapsible:!0,collapsed:S,onCollapse:A,theme:E,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:n?e.jsxRuntimeExports.jsx("img",{src:n,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(p.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(p.Menu,{theme:E,defaultOpenKeys:te,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[g.pathname],children:o})]}),e.jsxRuntimeExports.jsxs(p.Layout,{className:"site-layout",children:[e.jsxRuntimeExports.jsxs(fe,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(p.Button,{type:"text",icon:S?e.jsxRuntimeExports.jsx(h.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(h.MenuFoldOutlined,{}),onClick:()=>A(!S),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsx("div",{style:{marginRight:"20px"},children:f})]}),e.jsxRuntimeExports.jsxs(ge,{style:{margin:"0 16px"},children:[e.jsxRuntimeExports.jsx(p.Breadcrumb,{style:{margin:"16px 0"},itemRender:j=>{const I=j.href||j.path;return I?e.jsxRuntimeExports.jsx(m.Link,{to:I,children:j.title}):e.jsxRuntimeExports.jsx("span",{children:j.title})},items:t}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:360},children:c})]}),e.jsxRuntimeExports.jsxs(Re,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",U]})]})]})))(k,F(d),z(ne),D(),a??e.jsxRuntimeExports.jsx(m.Outlet,{}))},Ee=new T.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),H={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function ze({transformRouter:a=l=>l,transformSettingTabs:d=l=>l,transformLangConfig:v=l=>l,extraPrivateRoutes:E=[],extraPublicRoutes:z=[],menuStyle:q="dark",transformHeaderItems:x=l=>l,renderLayout:w}){const{i18n:l}=M.useTranslation(),[S,A]=s.useState(H[l.language]||e.default_1$5);s.useEffect(()=>{A(H[l.language]||e.default_1$5)},[l.language]);const g=L=>L.map(i=>i.children===void 0?i:{...i,children:g(i.children)}),P=a(g(je({transformSettingTabs:d,transformLangConfig:v,extraPrivateRoutes:E,extraPublicRoutes:z}))),b=(L,i)=>L.flatMap(r=>r.is_private?[r]:"children"in r&&r.children?r.children:[r]).map((r,_)=>{const k=r.is_private?e.jsxRuntimeExports.jsx(y.PrivateRoute,{element:e.jsxRuntimeExports.jsx(Y,{routes:P,element:r.element,transformLangConfig:v,menuStyle:q,transformHeaderItems:x,renderLayout:w})}):r.element;if("children"in r&&r.children&&r.children.length>0)return e.jsxRuntimeExports.jsx(m.Route,{path:r.path,element:k,children:b(r.children,r)},r.path??r.name??_);const{path:$}=r;return e.jsxRuntimeExports.jsx(m.Route,{path:$,index:r.index,element:k},$??r.name??`${(i==null?void 0:i.path)??""}.${_}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(T.QueryClientProvider,{client:Ee,children:e.jsxRuntimeExports.jsx(p.ConfigProvider,{locale:S,children:e.jsxRuntimeExports.jsx(N.AuthProvider,{children:e.jsxRuntimeExports.jsx(m.BrowserRouter,{basename:O.getURL(),children:e.jsxRuntimeExports.jsx(m.Routes,{children:b(P)})})})})})}const qe={...V.authorizationapi,...O.baseapi,...Q.oauthapi,...K.systemapi};exports.App=ze;exports.AppLayout=Y;exports.api=W;exports.api$1=qe;exports.withSuspense=u;
