"use strict";const e=require("./vendor.js"),u=require("react-router-dom"),s=require("react"),j=require("./components.js"),_=require("./contexts.js"),k=require("./authorization.js"),D=require("./base.js"),N=require("./system.js"),C=require("./oauth.js");require("./forbidden.js");require("./not_found.js");require("./client.js");const W=s.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),Y=s.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),G=s.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),M=s.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),J=s.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),X=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserList)),Z=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserDetail)),A=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(r=>r.UserForm)),ee=s.lazy(()=>Promise.resolve().then(()=>require("./roles.js"))),te=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(r=>r.index)),ne=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(r=>r.OAuthTestCallback)),se=s.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),ie=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(r=>r.ServiceAccountList)),re=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(r=>r.ServiceAccountDetail)),l=r=>e.jsxRuntimeExports.jsx(s.Suspense,{fallback:e.jsxRuntimeExports.jsx(j.Loading,{}),children:e.jsxRuntimeExports.jsx(r,{})}),ae=[{path:"/login",element:l(Y),index:!0},{path:"/404",element:l(M),index:!0},{path:"/403",element:l(J),index:!0},{path:"/system/settings/oauth/test-callback",element:l(ne),index:!0}],oe=[{path:"/",is_private:!0,children:[{path:"/",element:l(W),name:"dashboard",icon:e.jsxRuntimeExports.jsx(e.RefIcon$12,{}),index:!0},{path:"/profile",element:l(G),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(e.RefIcon$14,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(e.RefIcon$13,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:l(ee),permissions:["authorization:role:view"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(e.RefIcon$14,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:l(X),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:l(A),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:l(Z),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:l(A),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(e.RefIcon$14,{}),permissions:["authorization:service_account:view"],children:[{element:l(ie),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:l(re),permissions:["authorization:service_account:view"],index:!0}]}]},{name:"system",icon:e.jsxRuntimeExports.jsx(e.RefIcon$17,{}),permissions:["system:settings:view","system:settings:update","system:audit:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(e.RefIcon$15,{}),index:!0,name:"settings",permissions:["system:settings:view","system:settings:update"],element:l(te)},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(e.RefIcon$16,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:l(se)}]},{path:"*",element:l(M),index:!0}]}],P=[...ae,...oe],U={authorization:k.authorizationapi,base:D.baseapi,system:N.systemapi,oauth:C.oauthapi},{Header:le,Content:ue,Footer:ce,Sider:me}=e.Layout,{SubMenu:he}=e.Menu,B=({element:r,routes:f})=>{const{t:c,i18n:g}=e.useTranslation(),{t:v}=e.useTranslation("common"),[x,y]=s.useState(!1),p=u.useLocation(),{hasPermission:m}=_.usePermission(),i=u.useNavigate(),{logout:z,user:o}=_.useAuth(),[E,q]=s.useState([]),[S,F]=s.useState(null),[$,H]=s.useState("Loading..."),[d,O]=s.useState(null);p.pathname!=="/profile"&&(o&&o.mfa_enforced&&!o.mfa_enabled?i("/profile#mfa"):o&&o.status==="password_expired"&&i("/profile#password"));const T=()=>{z(),window.location.href="/console/login?redirect="+encodeURIComponent(window.location.href)},V=[{key:"profile",label:e.jsxRuntimeExports.jsx(u.Link,{to:"/profile",children:v("profile")})},{key:"logout",label:v("logout"),onClick:T}];s.useEffect(()=>{U.system.getSiteConfig().then(n=>{var t;const a=n.navigation.filter(h=>h.path!==n.home_page),R=[...n.home_page?[{name:"home",path:n.home_page}]:[],...a];R.length>1?q(R):q([]),F(n.logo),O(n),(t=document.getElementById("site-icon"))==null||t.setAttribute("href",n.logo)})},[]),s.useEffect(()=>{g.language&&H((d==null?void 0:d.name_i18n[g.language])||(d==null?void 0:d.name)||"")},[d,g.language]);const b=()=>{const n=u.matchRoutes(f,p.pathname),a=[];if(n){for(const[R,t]of n.entries())if(t.route.path==="/"&&!t.route.name)a.push({href:t.route.path,title:v("home"),key:"home"});else if(t.route.name){const h=n.slice(0,R+1).map(w=>w.route.name).filter(Boolean).join(".");a.push({path:t.route.path,title:t.route.name?c(`breadcrumbs.${h}`):void 0,key:t.route.path})}}return a},K=n=>n.some(a=>m(a)),Q=e._.flatMapDeep(f,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),L=(n,a=[])=>{const R=t=>t&&t.replace(/_/g," ").split(" ").map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!K(t.permissions))return null;const h=R(t.name);if(!t.name)return null;if("children"in t&&t.children){const w=L(t.children,[...a,t.name]);return w.length==0&&t.path?e.jsxRuntimeExports.jsx(e.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(u.Link,{to:t.path,children:c(`menu.${[...a,t.name].join(".")}`,{defaultValue:h})})},t.path):e.jsxRuntimeExports.jsx(he,{icon:t.icon,title:c(`menu.${[...a,t.name,t.name].join(".")}`,{defaultValue:h}),children:w},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(e.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(u.Link,{to:t.path,children:c(`menu.${[...a,t.name].join(".")}`,{defaultValue:h})})},t.path):null}).filter(Boolean)};return s.useEffect(()=>{const n=b().filter(a=>a.path!=="/").map(a=>a.title).join(" - ");n?document.title=`${$} | ${n}`:document.title=$},[b,p.pathname]),e.jsxRuntimeExports.jsxs(e.Layout,{style:{minHeight:"100vh"},children:[e.jsxRuntimeExports.jsxs(me,{collapsible:!0,collapsed:x,onCollapse:y,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:S?e.jsxRuntimeExports.jsx("img",{src:S,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(e.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(e.Menu,{theme:"dark",defaultOpenKeys:Q,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[p.pathname],children:L(f)})]}),e.jsxRuntimeExports.jsxs(e.Layout,{className:"site-layout",children:[e.jsxRuntimeExports.jsxs(le,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(e.Button,{type:"text",icon:x?e.jsxRuntimeExports.jsx(e.RefIcon$18,{}):e.jsxRuntimeExports.jsx(e.RefIcon$19,{}),onClick:()=>y(!x),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsxs("div",{style:{marginRight:"20px"},children:[e.jsxRuntimeExports.jsx(j.HeaderDropdown,{hidden:E.length<=1,menu:{items:E.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:c(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(e.RefIcon$20,{})}),e.jsxRuntimeExports.jsxs(j.HeaderDropdown,{menu:{items:V},children:[o!=null&&o.avatar?e.jsxRuntimeExports.jsx(j.Avatar,{src:o.avatar}):e.jsxRuntimeExports.jsx(j.Avatar,{icon:e.jsxRuntimeExports.jsx(e.RefIcon$14,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em"},children:(o==null?void 0:o.full_name)||(o==null?void 0:o.username)})]}),e.jsxRuntimeExports.jsx(j.LanguageSwitch,{})]})]}),e.jsxRuntimeExports.jsxs(ue,{style:{margin:"0 16px"},children:[e.jsxRuntimeExports.jsx(e.Breadcrumb,{style:{margin:"16px 0"},itemRender:n=>{const a=n.href||n.path;return a?e.jsxRuntimeExports.jsx(u.Link,{to:a,children:n.title}):e.jsxRuntimeExports.jsx("span",{children:n.title})},items:b()}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:360},children:r??e.jsxRuntimeExports.jsx(u.Outlet,{})})]}),e.jsxRuntimeExports.jsxs(ce,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",$]})]})]})},pe=new e.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),I={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function xe({basePath:r="/console/",onRouteRender:f=c=>c}){const{i18n:c}=e.useTranslation(),[g,v]=s.useState(I[c.language]||e.default_1$5);s.useEffect(()=>{v(I[c.language]||e.default_1$5)},[c.language]);const x=p=>p.map(m=>m.children===void 0?m:{...m,children:x(m.children)}),y=(p,m)=>p.flatMap(i=>i.is_private?[i]:"children"in i&&i.children?i.children:[i]).map((i,z)=>{const o=i.is_private?e.jsxRuntimeExports.jsx(j.PrivateRoute,{element:e.jsxRuntimeExports.jsx(B,{routes:f(x(P)),element:i.element})}):i.element;if("children"in i&&i.children&&i.children.length>0)return e.jsxRuntimeExports.jsx(u.Route,{path:i.path,element:o,children:y(i.children,i)},i.path??i.name??z);const{path:E}=i;return e.jsxRuntimeExports.jsx(u.Route,{path:E,index:i.index,element:o},E??i.name??`${(m==null?void 0:m.path)??""}.${z}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(e.QueryClientProvider,{client:pe,children:e.jsxRuntimeExports.jsx(e.ConfigProvider,{locale:g,children:e.jsxRuntimeExports.jsx(_.AuthProvider,{children:e.jsxRuntimeExports.jsx(u.BrowserRouter,{basename:r,children:e.jsxRuntimeExports.jsx(u.Routes,{children:y(f(x(P)))})})})})})}const de={...k.authorizationapi,...D.baseapi,...C.oauthapi,...N.systemapi};exports.App=xe;exports.AppLayout=B;exports.api=U;exports.api$1=de;exports.withSuspense=l;
