"use strict";const ne=require("./ai.js"),K=require("./authorization.js"),$=require("./base.js"),Q=require("./system.js"),W=require("./oauth.js"),e=require("./vendor.js"),Y=require("react-query"),m=require("react-router-dom"),p=require("antd"),F=require("react-i18next"),s=require("react"),g=require("./components.js"),h=require("@ant-design/icons"),L=require("./contexts.js"),se=require("lodash");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const re=s.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),ae=s.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),oe=s.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),B=s.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),le=s.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),ue=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserList)),ce=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserDetail)),H=s.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(n=>n.UserForm)),me=s.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(n=>n.RoleList)),T=s.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(n=>n.RoleForm)),he=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.index)),pe=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.OrganizationDetail)),de=s.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(n=>n.OAuthTestCallback)),xe=s.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),je=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(n=>n.ServiceAccountList)),fe=s.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(n=>n.ServiceAccountDetail));function o(n,j){return e.jsxRuntimeExports.jsx(s.Suspense,{fallback:e.jsxRuntimeExports.jsx(g.Loading,{}),children:e.jsxRuntimeExports.jsx(n,{...j})})}const ge=({transformSettingTabs:n,transformLangConfig:j,extraPrivateRoutes:y=[],extraPublicRoutes:z=[]})=>{const w=[{path:"/login",element:o(ae,{transformLangConfig:j}),index:!0},{path:"/404",element:o(B),index:!0},{path:"/403",element:o(le),index:!0},{path:"/system/settings/oauth/test-callback",element:o(de),index:!0},...z],q=[{path:"/",is_private:!0,children:[{path:"/",element:o(re),name:"dashboard",icon:e.jsxRuntimeExports.jsx(h.DashboardOutlined,{}),index:!0},{path:"/profile",element:o(oe),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete","authorization:role:view"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(h.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:o(me),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:o(T),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:o(T),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:o(ue),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:o(H),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:o(ce),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:o(H),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:o(je),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:o(fe),permissions:["authorization:service_account:view"],index:!0}]}]},...y,{name:"system",icon:e.jsxRuntimeExports.jsx(h.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(h.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",index:!0,element:o(he,{transformItems:n})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:o(pe),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(h.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:o(xe)}]},{path:"*",element:o(B),index:!0}]}];return[...w,...q]},ve={ai:ne.ai,authorization:K.authorizationapi,base:$.baseapi,system:Q.systemapi,oauth:W.oauthapi},{Header:Re,Content:ye,Footer:ze,Sider:Ee}=p.Layout,{SubMenu:we}=p.Menu,G=({element:n,routes:j,transformLangConfig:y,menuStyle:z="dark",transformHeaderItems:w=f=>f,renderLayout:q})=>{const{t:f,i18n:S}=F.useTranslation(),{t:c}=F.useTranslation("common"),E=m.useLocation(),{hasPermission:U}=L.usePermission(),b=m.useNavigate(),{logout:P,user:l}=L.useAuth(),{siteConfig:a,clearCurrentOrgId:d}=L.useSite(),[r,_]=s.useState([]),[A,O]=s.useState(null),[D,J]=s.useState("Loading...");E.pathname!=="/profile"&&(l&&l.mfa_enforced&&!l.mfa_enabled?b("/profile#mfa"):l&&l.status==="password_expired"&&b("/profile#password"));const X=()=>{P(),d(),window.location.href=$.getURL("/login?redirect="+encodeURIComponent(window.location.href))},Z=[{key:"profile",label:e.jsxRuntimeExports.jsx(m.Link,{to:"/profile",children:c("profile")})},{key:"logout",label:c("logout"),onClick:X}];s.useEffect(()=>{var i;if(a){const u=a.navigation.filter(t=>t.path!==a.home_page),v=[...a.home_page?[{name:"home",path:a.home_page}]:[],...u];v.length>1?_(v):_([]),O(a.logo),(i=document.getElementById("site-icon"))==null||i.setAttribute("href",a.logo)}},[a]),s.useEffect(()=>{S.language&&J((a==null?void 0:a.name_i18n[S.language])||(a==null?void 0:a.name)||"")},[a,S.language]);const C=()=>{const i=m.matchRoutes(j,E.pathname),u=[];if(i){for(const[v,t]of i.entries())if(t.route.path==="/"&&!t.route.name)u.push({href:t.route.path,title:c("home"),key:"home"});else if(t.route.name){const x=i.slice(0,v+1).map(R=>R.route.name).filter(Boolean).join(".");u.push({path:t.route.path,title:t.route.name?f(`breadcrumbs.${x}`):void 0,key:t.route.path})}}return u},ee=i=>i.some(u=>U(u)),te=se.flatMapDeep(j,i=>i.children).map(i=>i==null?void 0:i.name).filter(i=>i!==void 0),I=(i,u=[])=>{const v=t=>t&&t.replace(/_/g," ").split(" ").map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(" ");return i.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!ee(t.permissions))return null;const x=v(t.name);if(!t.name)return null;if("children"in t&&t.children){const R=I(t.children,[...u,t.name]);return R.length==0&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(m.Link,{to:t.path,children:f(`menu.${[...u,t.name].join(".")}`,{defaultValue:x})})},t.path):e.jsxRuntimeExports.jsx(we,{icon:t.icon,title:f(`menu.${[...u,t.name,t.name].join(".")}`,{defaultValue:x}),children:R},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(m.Link,{to:t.path,children:f(`menu.${[...u,t.name].join(".")}`,{defaultValue:x})})},t.path):null}).filter(Boolean)};s.useEffect(()=>{const i=C().filter(u=>u.path!=="/").map(u=>u.title).join(" - ");i?document.title=`${D} | ${i}`:document.title=D},[C,E.pathname]);const ie=[e.jsxRuntimeExports.jsx(g.HeaderDropdown,{hidden:r.length<=1,menu:{items:r.map(i=>({key:i.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:i.path,children:f(`menu.${i.name}`,{defaultValue:i.name})})}))},children:e.jsxRuntimeExports.jsx(h.SwapOutlined,{})}),...a!=null&&a.enable_multi_org?[e.jsxRuntimeExports.jsx(g.OrganizationSwitcher,{},"org-switcher")]:[],e.jsxRuntimeExports.jsxs(g.HeaderDropdown,{menu:{items:Z},children:[l!=null&&l.avatar?e.jsxRuntimeExports.jsx(g.Avatar,{src:l.avatar}):e.jsxRuntimeExports.jsx(g.Avatar,{icon:e.jsxRuntimeExports.jsx(h.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:(l==null?void 0:l.full_name)||(l==null?void 0:l.username)})]}),e.jsxRuntimeExports.jsx(g.LanguageSwitch,{transformLangConfig:y})];return(q??((i,u,v,t,x)=>{const[R,M]=s.useState(!1);return e.jsxRuntimeExports.jsxs(p.Layout,{style:{minHeight:"100vh"},children:[e.jsxRuntimeExports.jsxs(Ee,{collapsible:!0,collapsed:R,onCollapse:M,theme:z,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:i?e.jsxRuntimeExports.jsx("img",{src:i,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(p.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(p.Menu,{theme:z,defaultOpenKeys:te,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[E.pathname],children:u})]}),e.jsxRuntimeExports.jsxs(p.Layout,{className:"site-layout",children:[e.jsxRuntimeExports.jsxs(Re,{className:"site-layout-background",style:{padding:0,display:"flex",justifyContent:"space-between"},children:[e.jsxRuntimeExports.jsx(p.Button,{type:"text",icon:R?e.jsxRuntimeExports.jsx(h.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(h.MenuFoldOutlined,{}),onClick:()=>M(!R),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsx("div",{style:{marginRight:"20px"},children:v})]}),e.jsxRuntimeExports.jsxs(ye,{style:{margin:"0 16px"},children:[e.jsxRuntimeExports.jsx(p.Breadcrumb,{style:{margin:"16px 0"},itemRender:k=>{const N=k.href||k.path;return N?e.jsxRuntimeExports.jsx(m.Link,{to:N,children:k.title}):e.jsxRuntimeExports.jsx("span",{children:k.title})},items:t}),e.jsxRuntimeExports.jsx("div",{className:"site-layout-background",style:{padding:24,minHeight:360},children:x}),e.jsxRuntimeExports.jsx(g.AIChatButton,{})]}),e.jsxRuntimeExports.jsxs(ze,{style:{textAlign:"center"},children:[" Â©",new Date().getFullYear()," ",D]})]})]})}))(A,I(j),w(ie),C(),n??e.jsxRuntimeExports.jsx(m.Outlet,{}))},qe=new Y.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),V={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function Se({transformRouter:n=c=>c,transformSettingTabs:j=c=>c,transformLangConfig:y=c=>c,extraPrivateRoutes:z=[],extraPublicRoutes:w=[],menuStyle:q="dark",transformHeaderItems:f=c=>c,renderLayout:S}){const{i18n:c}=F.useTranslation(),[E,U]=s.useState(V[c.language]||e.default_1$5);s.useEffect(()=>{U(V[c.language]||e.default_1$5)},[c.language]);const b=a=>a.map(d=>d.children===void 0?d:{...d,children:b(d.children)}),P=n(b(ge({transformSettingTabs:j,transformLangConfig:y,extraPrivateRoutes:z,extraPublicRoutes:w}))),l=(a,d)=>a.flatMap(r=>r.is_private?[r]:"children"in r&&r.children?r.children:[r]).map((r,_)=>{const A=r.is_private?e.jsxRuntimeExports.jsx(g.PrivateRoute,{element:e.jsxRuntimeExports.jsx(G,{routes:P,element:r.element,transformLangConfig:y,menuStyle:q,transformHeaderItems:f,renderLayout:S})}):r.element;if("children"in r&&r.children&&r.children.length>0)return e.jsxRuntimeExports.jsx(m.Route,{path:r.path,element:A,children:l(r.children,r)},r.path??r.name??_);const{path:O}=r;return e.jsxRuntimeExports.jsx(m.Route,{path:O,index:r.index,element:A},O??r.name??`${(d==null?void 0:d.path)??""}.${_}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(Y.QueryClientProvider,{client:qe,children:e.jsxRuntimeExports.jsx(p.ConfigProvider,{locale:E,children:e.jsxRuntimeExports.jsx(L.AuthProvider,{children:e.jsxRuntimeExports.jsx(L.SiteProvider,{children:e.jsxRuntimeExports.jsx(m.BrowserRouter,{basename:$.getURL(),children:e.jsxRuntimeExports.jsx(m.Routes,{children:l(P)})})})})})})}const be={...K.authorizationapi,...$.baseapi,...W.oauthapi,...Q.systemapi};exports.App=Se;exports.AppLayout=G;exports.api=ve;exports.api$1=be;exports.withSuspense=o;
