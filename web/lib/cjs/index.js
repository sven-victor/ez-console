"use strict";const je=require("./ai.js"),ne=require("./authorization.js"),I=require("./base.js"),F=require("./system.js"),se=require("./oauth.js"),e=require("./vendor.js"),re=require("react-query"),j=require("react-router-dom"),p=require("antd"),T=require("react-i18next"),a=require("react"),g=require("./components.js"),c=require("@ant-design/icons"),z=require("./contexts.js"),ge=require("lodash-es"),C=require("./ai-chat-layout.js"),V=require("antd-style"),D=require("classnames");require("./ai-chat.js");require("./forbidden.js");require("./not_found.js");require("./client.js");require("i18next");const fe=a.lazy(()=>Promise.resolve().then(()=>require("./dashboard.js"))),Re=a.lazy(()=>Promise.resolve().then(()=>require("./login.js"))),ve=a.lazy(()=>Promise.resolve().then(()=>require("./profile.js"))),Z=a.lazy(()=>Promise.resolve().then(()=>require("./not_found.js"))),ye=a.lazy(()=>Promise.resolve().then(()=>require("./forbidden.js"))),Ee=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserList)),ze=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserDetail)),ee=a.lazy(()=>Promise.resolve().then(()=>require("./users.js")).then(i=>i.UserForm)),we=a.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(i=>i.RoleList)),te=a.lazy(()=>Promise.resolve().then(()=>require("./roles.js")).then(i=>i.RoleForm)),be=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.index)),Se=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.OrganizationDetail)),qe=a.lazy(()=>Promise.resolve().then(()=>require("./system-settings.js")).then(i=>i.OAuthTestCallback)),Le=a.lazy(()=>Promise.resolve().then(()=>require("./audit.js"))),_e=a.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(i=>i.ServiceAccountList)),Ae=a.lazy(()=>Promise.resolve().then(()=>require("./service-accounts.js")).then(i=>i.ServiceAccountDetail));function o(i,u){return e.jsxRuntimeExports.jsx(a.Suspense,{fallback:e.jsxRuntimeExports.jsx(g.Loading,{}),children:e.jsxRuntimeExports.jsx(i,{...u})})}const Pe=({transformSettingTabs:i,transformLangConfig:u,extraPrivateRoutes:w=[],extraPublicRoutes:b=[]})=>{const q=[{path:"/login",element:o(Re,{transformLangConfig:u}),index:!0},{path:"/404",element:o(Z),index:!0},{path:"/403",element:o(ye),index:!0},{path:"/system/settings/oauth/test-callback",element:o(qe),index:!0},...b],L=[{path:"/",is_private:!0,children:[{path:"/",element:o(fe),name:"dashboard",icon:e.jsxRuntimeExports.jsx(c.DashboardOutlined,{}),index:!0},{path:"/profile",element:o(ve),name:void 0,index:!0},{name:"authorization",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:create","authorization:user:update","authorization:user:delete","authorization:service_account:view","authorization:service_account:create","authorization:service_account:update","authorization:service_account:delete","authorization:role:view"],children:[{path:"/authorization/roles",name:"roles",icon:e.jsxRuntimeExports.jsx(c.SolutionOutlined,{}),permissions:["authorization:role:view","authorization:role:create","authorization:role:update","authorization:role:delete"],children:[{element:o(we),permissions:["authorization:role:view"],index:!0},{path:"/authorization/roles/create",element:o(te),permissions:["authorization:role:create"],index:!0},{path:"/authorization/roles/:id/edit",element:o(te),permissions:["authorization:role:update"],index:!0}]},{path:"/authorization/users",name:"users",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:user:view","authorization:user:list","authorization:user:create","authorization:user:update","authorization:user:delete"],children:[{element:o(Ee),permissions:["authorization:user:list"],index:!0},{path:"/authorization/users/create",element:o(ee),permissions:["authorization:user:create"],index:!0},{path:"/authorization/users/:id",element:o(ze),permissions:["authorization:user:view"],index:!0},{path:"/authorization/users/:id/edit",element:o(ee),permissions:["authorization:user:update"],index:!0}]},{path:"/authorization/service-accounts",name:"serviceAccounts",icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{}),permissions:["authorization:service_account:view"],children:[{element:o(_e),permissions:["authorization:service_account:view"],index:!0},{path:"/authorization/service-accounts/:id",element:o(Ae),permissions:["authorization:service_account:view"],index:!0}]}]},...w,{name:"system",icon:e.jsxRuntimeExports.jsx(c.SettingOutlined,{}),permissions:["system:settings:view","system:settings:update","system:audit:view","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",icon:e.jsxRuntimeExports.jsx(c.SafetyOutlined,{}),name:"settings",permissions:["system:settings:view","system:settings:update","system:organization:view","ai:models:view","ai:toolsets:view"],children:[{path:"/system/settings",index:!0,element:o(be,{transformItems:i})},{path:"/system/settings/organizations/:id",permissions:["system:organization:view"],element:o(Se),index:!0}]},{path:"/system/audit",icon:e.jsxRuntimeExports.jsx(c.FileSearchOutlined,{}),name:"audit",permissions:["system:audit:view"],index:!0,element:o(Le)}]},{path:"*",element:o(Z),index:!0}]}];return[...q,...L]},Oe={ai:je.ai,authorization:ne.authorizationapi,base:I.baseapi,system:F.aiapi,oauth:se.oauthapi},{Header:ke,Content:$e,Footer:Me,Sider:De}=p.Layout,{SubMenu:Ie}=p.Menu,Ne=V.createStyles(({token:i,css:u})=>({header:u`
      padding: 0;
      display: flex;
      justify-content: space-between;
      background-color: ${i.colorBgContainer};
      border-block-end: 1px solid ${i.colorBorderSecondary};
    `,content:u`
      padding: 24px;
      min-height: calc(100vh - 190px);
      background-color: ${i.colorBgContainer};
    `,mainLayout:u`
      flex: 1;
      min-width: 0;
      background-color: ${i.colorBgContainer};
    `,breadcrumb:u`
      margin-left: 8px;
    `,themeSwitch:u`
      display: inline-flex;
    `,menuSider:u`
      .ant-layout-sider-children{
        display: flex;
        flex-direction: column;
      }
    `,menu:u`
      flex: 1 1 0%;
    `})),ae=({element:i,routes:u,transformLangConfig:w,menuStyle:b="dark",transformHeaderItems:q=S=>S,renderLayout:L})=>{const{themeMode:S,setThemeMode:N,isDarkMode:m}=V.useThemeMode(),{styles:f}=Ne(),{layout:_,visible:A,loaded:P}=z.useAI(),{t:R,i18n:y}=T.useTranslation(),{t:h}=T.useTranslation("common"),r=j.useLocation(),{hasPermission:k}=z.usePermission(),O=j.useNavigate(),{logout:$,user:d}=z.useAuth(),{siteConfig:s,clearCurrentOrgId:oe}=z.useSite(),[H,K]=a.useState([]),[le,ue]=a.useState(null),[U,ce]=a.useState("Loading...");r.pathname!=="/profile"&&(d&&d.mfa_enforced&&!d.mfa_enabled?O("/profile#mfa"):d&&d.status==="password_expired"&&O("/profile#password"));const de=()=>{$(),oe(),window.location.href=I.getURL("/login?redirect="+encodeURIComponent(window.location.href))},me=[{key:"profile",label:e.jsxRuntimeExports.jsx(j.Link,{to:"/profile",children:h("profile")})},{key:"logout",label:h("logout"),onClick:de}];a.useEffect(()=>{var n,l;if(s){const E=((n=s.navigation)==null?void 0:n.filter(x=>x.path!==s.home_page))??[],t=[...s.home_page?[{name:"home",path:s.home_page}]:[],...E];t.length>1?K(t):K([]),ue(s.logo),(l=document.getElementById("site-icon"))==null||l.setAttribute("href",s.logo)}},[s]),a.useEffect(()=>{y.language&&ce((s==null?void 0:s.name_i18n[y.language])||(s==null?void 0:s.name)||"")},[s,y.language]);const B=()=>{const n=j.matchRoutes(u,r.pathname),l=[];if(n){for(const[E,t]of n.entries())if(t.route.path==="/"&&!t.route.name)l.push({href:t.route.path,title:h("home"),key:"home"});else if(t.route.name){const x=n.slice(0,E+1).map(v=>v.route.name).filter(Boolean).join(".");l.push({path:t.route.path,title:t.route.name?R(`breadcrumbs.${x}`):void 0,key:t.route.path})}}return l},he=n=>n.some(l=>k(l)),xe=ge.flatMapDeep(u,n=>n.children).map(n=>n==null?void 0:n.name).filter(n=>n!==void 0),Q=(n,l=[])=>{const E=t=>t&&t.replace(/_/g," ").split(" ").map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join(" ");return n.flatMap(t=>"children"in t&&t.children&&!t.name?t.children:[t]).map(t=>{if(t.permissions&&!he(t.permissions))return null;const x=E(t.name);if(!t.name)return null;if("children"in t&&t.children){const v=Q(t.children,[...l,t.name]);return v.length==0&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(j.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:x})})},t.path):e.jsxRuntimeExports.jsx(Ie,{icon:t.icon,title:R(`menu.${[...l,t.name,t.name].join(".")}`,{defaultValue:x}),children:v},t.path??t.name)}return t.name&&t.path?e.jsxRuntimeExports.jsx(p.Menu.Item,{icon:t.icon,children:e.jsxRuntimeExports.jsx(j.Link,{to:t.path,children:R(`menu.${[...l,t.name].join(".")}`,{defaultValue:x})})},t.path):null}).filter(Boolean)};a.useEffect(()=>{const n=B().filter(l=>l.path!=="/").map(l=>l.title).join(" - ");n?document.title=`${U} | ${n}`:document.title=U},[B,r.pathname]);const pe=[e.jsxRuntimeExports.jsx(g.HeaderDropdown,{hidden:H.length<=1,menu:{items:H.map(n=>({key:n.path,style:{paddingRight:"20px"},label:e.jsxRuntimeExports.jsx("a",{href:n.path,children:R(`menu.${n.name}`,{defaultValue:n.name})})}))},children:e.jsxRuntimeExports.jsx(c.SwapOutlined,{})},"navigation-dropdown"),...s!=null&&s.enable_multi_org?[e.jsxRuntimeExports.jsx(g.OrganizationSwitcher,{},"org-switcher")]:[],e.jsxRuntimeExports.jsxs(g.HeaderDropdown,{menu:{items:me},children:[d!=null&&d.avatar?e.jsxRuntimeExports.jsx(g.Avatar,{src:d.avatar}):e.jsxRuntimeExports.jsx(g.Avatar,{icon:e.jsxRuntimeExports.jsx(c.UserOutlined,{})}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:(d==null?void 0:d.full_name)||(d==null?void 0:d.username)})]},"user-dropdown"),e.jsxRuntimeExports.jsx(g.LanguageSwitch,{transformLangConfig:w},"language-switch"),e.jsxRuntimeExports.jsx(g.HeaderDropdown,{menu:{items:[{key:"light",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(c.SunOutlined,{})," ",h("light",{defaultValue:"Light Mode"})]})},{key:"dark",label:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(c.MoonOutlined,{})," ",h("dark",{defaultValue:"Dark Mode"})]})}],onClick:({key:n})=>{N(n)},selectedKeys:[S]},children:S==="light"?e.jsxRuntimeExports.jsx(c.SunOutlined,{}):e.jsxRuntimeExports.jsx(c.MoonOutlined,{})},"theme-switch")];return(L??((n,l,E,t,x)=>{var Y,G,J;const[v,W]=a.useState(!1);return e.jsxRuntimeExports.jsxs(p.Layout,{style:{minHeight:"100vh",display:"flex",flexDirection:"row"},children:[e.jsxRuntimeExports.jsxs(De,{collapsible:!0,collapsed:v,onCollapse:W,className:f.menuSider,theme:m?"light":b,children:[e.jsxRuntimeExports.jsx("div",{className:"logo",style:{margin:"8px",display:"flex"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",textAlign:"center"},children:n?e.jsxRuntimeExports.jsx("img",{src:n,alt:"logo",style:{height:"32px",width:"32px"}}):e.jsxRuntimeExports.jsx(p.Spin,{size:"large",tip:"Loading..."})})}),e.jsxRuntimeExports.jsx(p.Menu,{className:f.menu,theme:m?"light":b,defaultOpenKeys:xe,defaultSelectedKeys:["1"],mode:"inline",selectedKeys:[r.pathname],children:l})]}),e.jsxRuntimeExports.jsxs(p.Layout,{className:D("site-layout","main-layout",f.mainLayout),children:[e.jsxRuntimeExports.jsxs(ke,{className:D("site-header",f.header),children:[e.jsxRuntimeExports.jsxs(p.Space,{children:[e.jsxRuntimeExports.jsx(p.Button,{type:"text",icon:v?e.jsxRuntimeExports.jsx(c.MenuUnfoldOutlined,{}):e.jsxRuntimeExports.jsx(c.MenuFoldOutlined,{}),onClick:()=>W(!v),style:{fontSize:"16px",width:64,height:64}}),e.jsxRuntimeExports.jsx(p.Breadcrumb,{className:D("site-breadcrumb",f.breadcrumb),itemRender:M=>{const X=M.href||M.path;return X?e.jsxRuntimeExports.jsx(j.Link,{to:X,children:M.title}):e.jsxRuntimeExports.jsx("span",{children:M.title})},items:t})]}),e.jsxRuntimeExports.jsx("div",{style:{marginRight:"20px"},children:E})]}),e.jsxRuntimeExports.jsxs($e,{style:{margin:"0 16px",height:"calc(100vh - 120px)",overflow:"auto"},children:[e.jsxRuntimeExports.jsx("div",{className:D("site-content",f.content),children:x}),((Y=s==null?void 0:s.attrs)==null?void 0:Y.ai_enabled)&&e.jsxRuntimeExports.jsx(C.AIChatButton,{}),((G=s==null?void 0:s.attrs)==null?void 0:G.ai_enabled)&&_==="classic"&&(A||P)&&e.jsxRuntimeExports.jsx(C.AIChatModal,{})]}),e.jsxRuntimeExports.jsxs(Me,{style:{textAlign:"center",padding:"15px 50px"},children:[" Â©",new Date().getFullYear()," ",U]})]}),((J=s==null?void 0:s.attrs)==null?void 0:J.ai_enabled)&&(_==="sidebar"||_==="float-sidebar")&&(A||P)&&e.jsxRuntimeExports.jsx(C.AIChatSider,{})]})}))(le,Q(u),q(pe),B(),i??e.jsxRuntimeExports.jsx(j.Outlet,{}))},Ue=new re.QueryClient({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}}),ie={"zh-CN":e.default_1$6,"en-US":e.default_1$5,"de-DE":e.default_1$4,"es-ES":e.default_1$3,"fr-FR":e.default_1$2,"ar-AE":e.default_1$1,"sv-SE":e.default_1};function Be({transformRouter:i=m=>m,transformSettingTabs:u=m=>m,transformLangConfig:w=m=>m,extraPrivateRoutes:b=[],extraPublicRoutes:q=[],menuStyle:L="dark",transformHeaderItems:S=m=>m,renderLayout:N}){const{i18n:m}=T.useTranslation(),[f,_]=a.useState(ie[m.language]||e.default_1$5);a.useEffect(()=>{_(ie[m.language]||e.default_1$5)},[m.language]);const A=y=>y.map(h=>h.children===void 0?h:{...h,children:A(h.children)}),P=i(A(Pe({transformSettingTabs:u,transformLangConfig:w,extraPrivateRoutes:b,extraPublicRoutes:q}))),R=(y,h)=>y.flatMap(r=>r.is_private?[r]:"children"in r&&r.children?r.children:[r]).map((r,k)=>{const O=r.is_private?e.jsxRuntimeExports.jsx(g.PrivateRoute,{element:e.jsxRuntimeExports.jsx(ae,{routes:P,element:r.element,transformLangConfig:w,menuStyle:L,transformHeaderItems:S,renderLayout:N})}):r.element;if("children"in r&&r.children&&r.children.length>0)return e.jsxRuntimeExports.jsx(j.Route,{path:r.path,element:O,children:R(r.children,r)},r.path??r.name??k);const{path:$}=r;return e.jsxRuntimeExports.jsx(j.Route,{path:$,index:r.index,element:O},$??r.name??`${(h==null?void 0:h.path)??""}.${k}`)}).filter(Boolean);return e.jsxRuntimeExports.jsx(re.QueryClientProvider,{client:Ue,children:e.jsxRuntimeExports.jsx(V.ThemeProvider,{children:e.jsxRuntimeExports.jsx(p.ConfigProvider,{locale:f,children:e.jsxRuntimeExports.jsx(z.AuthProvider,{children:e.jsxRuntimeExports.jsx(z.SiteProvider,{children:e.jsxRuntimeExports.jsx(z.AIProvider,{children:e.jsxRuntimeExports.jsx(j.BrowserRouter,{basename:I.getURL(),children:e.jsxRuntimeExports.jsx(j.Routes,{children:R(P)})})})})})})})})}const Ce={...ne.authorizationapi,...I.baseapi,...se.oauthapi,...F.aiapi,...F.aiapi};exports.App=Be;exports.AppLayout=ae;exports.api=Oe;exports.api$1=Ce;exports.withSuspense=o;
