"use strict";const e=require("./vendor.js"),u=require("react"),P=require("react-router-dom"),w=require("./components.js"),y=require("./index.js"),V=require("./base.js"),U=require("./not_found.js"),q=require("./contexts.js"),$=({serviceAccountID:s,onClose:t,open:f=!1,onSuccess:A})=>{const{t:r}=e.useTranslation("authorization"),{t:o}=e.useTranslation("common"),[l]=e.Form.useForm(),{run:p,loading:m}=e.useRequest(j=>s?y.api.authorization.updateServiceAccount({id:s},j):y.api.authorization.createServiceAccount(j),{onSuccess:()=>{e.staticMethods.success(r("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),t(),A==null||A()},onError:()=>{e.staticMethods.error(r("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return u.useEffect(()=>{f&&s?y.api.authorization.getServiceAccountById({id:s}).then(j=>{l.setFieldsValue({name:j.name,description:j.description})}):l.resetFields()},[s,f]),e.jsxRuntimeExports.jsx(e.Modal,{title:s?r("serviceAccount.edit",{defaultValue:"Edit Service Account"}):r("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:t,open:f,footer:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{onClick:t,children:o("cancel",{defaultValue:"Cancel"})}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:l.submit,loading:m,children:o("save",{defaultValue:"Save"})})]}),children:e.jsxRuntimeExports.jsxs(e.Form,{form:l,layout:"vertical",onFinish:p,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:r("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:r("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:r("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:r("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:4,placeholder:r("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},L=()=>{const{t:s}=e.useTranslation("authorization"),{t}=e.useTranslation("common"),f=P.useNavigate(),[A]=e.Form.useForm(),[r]=e.Form.useForm(),[o,l]=u.useState(!1),[p,m]=u.useState([]),[j,n]=u.useState(0),[_,E]=u.useState(!1),[S,R]=u.useState(null),[v,a]=u.useState({current:V.PAGINATION.DEFAULT_CURRENT,page_size:V.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0}),d=u.useCallback(async()=>{try{l(!0);const c=await y.api.authorization.getServiceAccounts(v);m(c.data||[]),n(c.total||0)}catch(c){console.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),c),e.staticMethods.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{l(!1)}},[v,s]);u.useEffect(()=>{d()},[d]);const g=c=>{a({...v,current:V.PAGINATION.DEFAULT_CURRENT,search:c.search})},C=()=>{A.resetFields(),a({current:V.PAGINATION.DEFAULT_CURRENT,page_size:V.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0})},k=(c,x)=>{a(I=>({...I,current:c,page_size:x}))},T=()=>{R(null),E(!0)},F=c=>{R(c.id),E(!0)},z=()=>{E(!1),r.resetFields()},h=async c=>{try{await y.api.authorization.deleteServiceAccount({id:c}),e.staticMethods.success(s("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),d()}catch(x){console.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),x),e.staticMethods.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},b=async c=>{const x=c.status==="active"?"disabled":"active";try{await y.api.authorization.updateServiceAccountStatus({id:c.id},{status:x}),e.staticMethods.success(s("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),d()}catch(I){console.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),I),e.staticMethods.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},i=[{title:s("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(c,x)=>e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:view",fallback:c,children:e.jsxRuntimeExports.jsx(P.Link,{to:`/authorization/service-accounts/${x.id}`,children:c})})},{title:s("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:c=>e.jsxRuntimeExports.jsx(e.Tooltip,{title:c,children:e.jsxRuntimeExports.jsx("span",{children:(c==null?void 0:c.length)>30?`${c.substring(0,30)}...`:c})})},{title:s("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:c=>c==="active"?e.jsxRuntimeExports.jsx(e.Badge,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(e.Badge,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:s("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(c,x)=>{var I;return e.jsxRuntimeExports.jsxs(e.Space,{size:[0,4],wrap:!0,children:[(I=x.roles)==null?void 0:I.map(M=>e.jsxRuntimeExports.jsx(e.Tag,{color:"blue",children:M.name},M.id)),(!x.roles||x.roles.length===0)&&e.jsxRuntimeExports.jsx(e.Tag,{children:s("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(c,x)=>x.policy_document&&x.policy_document.Statement&&x.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(e.Tag,{color:"green",icon:e.jsxRuntimeExports.jsx(e.RefIcon$28,{}),children:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsxRuntimeExports.jsx(e.Tag,{color:"default",icon:e.jsxRuntimeExports.jsx(e.RefIcon$29,{}),children:s("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:s("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:c=>V.formatDate(c)},{title:s("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:c=>c?V.formatDate(c):s("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:t("actions",{defaultValue:"Actions"}),key:"action",render:(c,x)=>e.jsxRuntimeExports.jsxs(e.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:view",children:e.jsxRuntimeExports.jsx(e.Tooltip,{title:s("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(e.RefIcon$4,{}),onClick:()=>f(`/authorization/service-accounts/${x.id}`)})})}),e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(e.Tooltip,{title:s("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(e.RefIcon$24,{}),onClick:()=>F(x)})})}),e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(e.Tooltip,{title:x.status==="active"?t("disable",{defaultValue:"Disable"}):t("enable",{defaultValue:"Enable"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",size:"small",icon:x.status==="active"?e.jsxRuntimeExports.jsx(e.RefIcon$22,{}):e.jsxRuntimeExports.jsx(e.RefIcon$28,{}),onClick:()=>b(x)})})}),e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(e.Tooltip,{title:s("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsxRuntimeExports.jsx(e.Popconfirm,{title:s("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>h(x.id),okText:t("confirm",{defaultValue:"Confirm"}),cancelText:t("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",size:"small",danger:!0,icon:e.jsxRuntimeExports.jsx(e.RefIcon$25,{})})})})})]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(e.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(e.Form,{form:A,layout:"horizontal",onFinish:g,initialValues:{search:v.search},style:{marginBottom:0},children:e.jsxRuntimeExports.jsxs(e.Row,{gutter:16,children:[e.jsxRuntimeExports.jsx(e.Col,{xs:24,sm:12,md:8,lg:6,children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"search",label:t("keyword",{defaultValue:"Keyword"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:s("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsxRuntimeExports.jsx(e.RefIcon$10,{})})})}),e.jsxRuntimeExports.jsx(e.Col,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(e.RefIcon$30,{}),children:t("filter",{defaultValue:"Filter"})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:C,icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),children:t("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxRuntimeExports.jsxs(e.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(e.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(e.Col,{children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:C,icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),children:t("refresh",{defaultValue:"Refresh"})})}),e.jsxRuntimeExports.jsx(e.Col,{children:e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:create",children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$1,{}),onClick:T,children:s("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsxRuntimeExports.jsx(e.ForwardTable,{rowKey:"id",dataSource:p,columns:i,loading:o,pagination:{current:v.current,pageSize:v.page_size,total:j,onChange:k,showSizeChanger:!0,showQuickJumper:!0,showTotal:c=>t("totalItems",{defaultValue:`Total ${c} items`,total:c})}})]}),e.jsxRuntimeExports.jsx($,{serviceAccountID:S,onClose:z,open:_,onSuccess:()=>{d()}})]})},G=Object.freeze(Object.defineProperty({__proto__:null,default:L},Symbol.toStringTag,{value:"Module"})),{Text:D,Paragraph:B}=e.Typography,{TextArea:O}=e.Input,J=({serviceAccountID:s})=>{const{t}=e.useTranslation("authorization"),{t:f}=e.useTranslation("common"),[A,r]=u.useState([]),[o,l]=u.useState(!1),[p,m]=u.useState(!1),[j]=e.Form.useForm(),[n,_]=u.useState(null),[E,S]=u.useState(null),[R,v]=u.useState(!1),a=async()=>{if(s){l(!0);try{const i=await y.api.authorization.getServiceAccountAccessKeys({id:s});r(i)}catch(i){console.error("Failed to load access keys:",i),e.staticMethods.error(t("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{l(!1)}}};u.useEffect(()=>{a()},[s]);const d=i=>{navigator.clipboard.writeText(i).then(()=>{e.staticMethods.success(t("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},c=>{console.error("Could not copy text: ",c)})},g=()=>{_(null),j.resetFields(),m(!0)},C=i=>{_(i),j.setFieldsValue({name:i.name,description:i.description,status:i.status==="active",expires_at:i.expires_at?e.dayjs(i.expires_at):void 0}),m(!0)},k=()=>{m(!1),j.resetFields()},{run:T,loading:F}=e.useRequest(async()=>{const i=await j.validateFields();if(n){const c=await y.api.authorization.updateServiceAccountAccessKey({id:s,keyId:n.id},{name:i.name,description:i.description,status:i.status?"active":"disabled",expires_at:i.expires_at?i.expires_at.toISOString():void 0});return m(!1),c}else{const c=await y.api.authorization.createServiceAccountAccessKey({id:s},{name:i.name,description:i.description,expires_at:i.expires_at?i.expires_at.toISOString():void 0});S(c),m(!1),v(!0)}},{manual:!0,onSuccess:()=>{e.staticMethods.success(t("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),a()},onError:()=>{e.staticMethods.error(t("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),z=async i=>{try{await y.api.authorization.deleteServiceAccountAccessKey({id:s,keyId:i}),e.staticMethods.success(t("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),a()}catch(c){console.error("Failed to delete key:",c),e.staticMethods.error(t("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},h=()=>{v(!1),S(null)},b=[{title:t("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:i=>e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$21,{}),e.jsxRuntimeExports.jsx(D,{copyable:!0,children:i})]})},{title:t("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:t("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:i=>i==="active"?e.jsxRuntimeExports.jsx(e.Badge,{status:"success",text:t("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(e.Badge,{status:"error",text:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:i=>i?V.formatDate(i):e.jsxRuntimeExports.jsx(D,{type:"secondary",children:t("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:t("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:i=>i?V.formatDate(i):e.jsxRuntimeExports.jsx(D,{type:"secondary",children:t("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:f("actions",{defaultValue:"Actions"}),key:"action",render:(i,c)=>e.jsxRuntimeExports.jsxs(e.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(e.Tooltip,{title:t("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(e.RefIcon$24,{}),onClick:()=>C(c)})}),e.jsxRuntimeExports.jsx(e.Popconfirm,{title:t("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>z(c.id),okText:f("confirm",{defaultValue:"Confirm"}),cancelText:f("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(e.Button,{type:"text",danger:!0,icon:e.jsxRuntimeExports.jsx(e.RefIcon$25,{})})})]})}];return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(e.Card,{title:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$21,{}),t("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{icon:e.jsxRuntimeExports.jsx(e.RefIcon$31,{}),onClick:a,loading:o,children:f("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$1,{}),onClick:g,children:t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsxRuntimeExports.jsx(e.ForwardTable,{columns:b,dataSource:A,rowKey:"id",loading:o,pagination:!1})}),e.jsxRuntimeExports.jsx(e.Modal,{title:n?t("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):t("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:p,onOk:T,confirmLoading:F,onCancel:k,children:e.jsxRuntimeExports.jsxs(e.Form,{form:j,layout:"vertical",children:[e.jsxRuntimeExports.jsx(e.Form.Item,{name:"name",label:t("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:t("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:t("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"description",label:t("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(O,{rows:3,placeholder:t("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),n&&e.jsxRuntimeExports.jsx(e.Form.Item,{name:"status",label:t("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsxRuntimeExports.jsx(e.Switch,{checkedChildren:t("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:t("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"expires_at",label:t("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsxRuntimeExports.jsx(e.DatePicker,{showTime:!0,placeholder:t("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxRuntimeExports.jsxs(e.Modal,{title:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$33,{style:{color:"#faad14"}}),t("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:R,footer:[e.jsxRuntimeExports.jsx(e.Button,{onClick:h,children:f("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsxRuntimeExports.jsx(e.Alert,{message:t("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),E&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(D,{strong:!0,children:[t("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsxRuntimeExports.jsx(B,{copyable:{text:E.access_key_id},children:E.access_key_id})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(D,{strong:!0,children:[t("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsxRuntimeExports.jsx(B,{copyable:{text:E.secret_access_key||""},children:E.secret_access_key})]}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$32,{}),onClick:()=>{const i=`Access Key: ${E.access_key_id}
Secret Key: ${E.secret_access_key}`;d(i)},block:!0,children:t("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:N}=e.Typography,W=({serviceAccount:s,onRefresh:t,loading:f})=>{const{id:A}=s||{},{t:r}=e.useTranslation("authorization"),{t:o}=e.useTranslation("common"),[l,p]=u.useState([]),[m,j]=u.useState([]);u.useEffect(()=>{j((s==null?void 0:s.roles)||[])},[s]);const[n,_]=u.useState(void 0),{loading:E}=e.useRequest(async()=>y.api.authorization.listRoles({current:1,page_size:20,search:n}),{onSuccess:a=>{const d=a.data;m.forEach(g=>{d.find(k=>k.id===g.id)||d.push(g)}),p(d)},onError:a=>{console.error("Failed to load roles:",a),e.staticMethods.error(r("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[n]}),{run:S,loading:R}=e.useRequest(async()=>{if(A)return y.api.authorization.assignServiceAccountRoles({id:A},{role_ids:m.map(a=>a.id)})},{onSuccess:()=>{e.staticMethods.success(r("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),t()},onError:a=>{console.error("Failed to assign roles:",a),e.staticMethods.error(r("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),v=a=>{j(a.map(d=>l.find(g=>g.id===d)||{id:d,name:d,description:d}))};return e.jsxRuntimeExports.jsx(e.Card,{title:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$22,{}),r("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsxRuntimeExports.jsx(e.Button,{icon:e.jsxRuntimeExports.jsx(e.RefIcon$31,{}),onClick:()=>{t()},disabled:f||R,loading:R,children:o("refresh",{defaultValue:"Refresh"})}),children:R?e.jsxRuntimeExports.jsx(e.Skeleton,{active:!0,paragraph:{rows:4}}):e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx(N,{children:r("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:m.length>0?l.filter(a=>m.some(d=>d.id===a.id)).map(a=>e.jsxRuntimeExports.jsx(e.Tag,{color:"blue",children:a.name},a.id)):e.jsxRuntimeExports.jsx(e.Empty,{image:e.Empty.PRESENTED_IMAGE_SIMPLE,description:r("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx(N,{children:r("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsxRuntimeExports.jsx(e.Select,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:r("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:m.map(a=>a.id),onSearch:a=>{_(a)},onDropdownVisibleChange:a=>{a&&_(void 0)},onChange:v,loading:f||E,optionFilterProp:"label",options:l.map(a=>({label:a.name,value:a.id,title:a.description}))})]}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:S,loading:R,disabled:f,children:r("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:K}=e.Tabs,H={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},Q=e.createStyles(({css:s})=>({rolePolicy:s`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:s`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:s`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),Z=()=>{const{styles:s}=Q(),r=P.useLocation().hash.replace("#","")||"basic",{t:o}=e.useTranslation("authorization"),{t:l}=e.useTranslation("common"),{id:p}=P.useParams(),m=P.useNavigate(),{hasPermission:j}=q.usePermission(),[n,_]=u.useState(null),[E,S]=u.useState(!1),[R]=e.Form.useForm(),[v,a]=u.useState(!1);if(!p)return e.jsxRuntimeExports.jsx(U.default,{});const{run:d,loading:g}=e.useRequest(async()=>{if(p)return y.api.authorization.getServiceAccountById({id:p})},{onSuccess:h=>{_(h||null)}});u.useEffect(()=>{d()},[p]);const C=h=>{m(`#${h}`)},k=async()=>{if(p)try{await y.api.authorization.deleteServiceAccount({id:p}),e.staticMethods.success(o("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),m("/authorization/service-accounts")}catch(h){console.error(o("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),h),e.staticMethods.error(o("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:T,loading:F}=e.useRequest(async()=>{if(n)return y.api.authorization.updateServiceAccountStatus({id:p},{status:n.status==="active"?"disabled":"active"})},{onSuccess:h=>{_(h||null),e.staticMethods.success(o("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:h=>{console.error(o("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),h),e.staticMethods.error(o("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),z=async h=>{if(p)try{let b;try{b=JSON.parse(h.policy_document)}catch{e.staticMethods.error(o("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await y.api.authorization.setServiceAccountPolicy({id:p},{policy_document:b}),e.staticMethods.success(o("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),S(!1),d()}catch(b){console.error(o("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),b),e.staticMethods.error(o("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return g?e.jsxRuntimeExports.jsx(e.Spin,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):n?e.jsxRuntimeExports.jsxs(e.Card,{title:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$14,{}),n.name,n.status==="active"?e.jsxRuntimeExports.jsx(e.Badge,{status:"success",text:o("serviceAccount.status.active",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(e.Badge,{status:"error",text:o("serviceAccount.status.disabled",{defaultValue:"Disabled"})})]}),extra:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$24,{}),onClick:()=>a(!0),disabled:v,children:l("edit",{defaultValue:"Edit"})})}),e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(e.Button,{icon:n.status==="active"?e.jsxRuntimeExports.jsx(e.RefIcon$22,{}):e.jsxRuntimeExports.jsx(e.RefIcon$28,{}),onClick:T,loading:F,children:n.status==="active"?l("disable",{defaultValue:"Disable"}):l("enable",{defaultValue:"Enable"})})}),e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(e.Popconfirm,{title:o("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:k,okText:l("confirm",{defaultValue:"Confirm"}),cancelText:l("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(e.Button,{danger:!0,icon:e.jsxRuntimeExports.jsx(e.RefIcon$25,{}),children:l("delete",{defaultValue:"Delete"})})})}),e.jsxRuntimeExports.jsx(e.Button,{icon:e.jsxRuntimeExports.jsx(e.RefIcon$34,{}),onClick:()=>m("/authorization/service-accounts"),children:l("back",{defaultValue:"Back"})})]}),children:[e.jsxRuntimeExports.jsxs(e.Tabs,{defaultActiveKey:r,onChange:C,children:[e.jsxRuntimeExports.jsx(K,{tab:o("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxRuntimeExports.jsxs(e.Descriptions,{bordered:!0,column:2,children:[e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.name",{defaultValue:"Name"}),span:2,children:n.name}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.description",{defaultValue:"Description"}),span:2,children:n.description||o("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.status",{defaultValue:"Status"}),children:n.status==="active"?e.jsxRuntimeExports.jsx(e.Badge,{status:"success",text:o("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(e.Badge,{status:"error",text:o("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:n.last_access?V.formatDate(n.last_access):o("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.createdAt",{defaultValue:"Created At"}),children:V.formatDate(n.created_at)}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:o("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:V.formatDate(n.updated_at)})]})},"basic"),e.jsxRuntimeExports.jsx(K,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(e.RefIcon$21,{}),o("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!j("authorization:service_account:access_key:list"),children:e.jsxRuntimeExports.jsx(J,{serviceAccountID:p})},"access-keys"),e.jsxRuntimeExports.jsx(K,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(e.RefIcon$22,{}),o("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!j("authorization:service_account:role:list"),children:e.jsxRuntimeExports.jsx(W,{serviceAccount:n,onRefresh:d})},"authorization"),e.jsxRuntimeExports.jsxs(K,{tab:o("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(e.Row,{justify:"end",children:e.jsxRuntimeExports.jsx(e.Col,{children:e.jsxRuntimeExports.jsx(w.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$24,{}),onClick:()=>{S(!0),R.setFieldsValue({policy_document:JSON.stringify(n.policy_document,null,2)})},children:o("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsxRuntimeExports.jsx(e.Spin,{spinning:g,children:n.policy_document&&n.policy_document.Statement&&n.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(e.Card,{children:e.jsxRuntimeExports.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(n.policy_document,null,2)})}):e.jsxRuntimeExports.jsx(e.Empty,{description:o("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsxRuntimeExports.jsx(e.Modal,{title:o("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:E,onCancel:()=>{S(!1),R.resetFields()},footer:null,width:700,children:e.jsxRuntimeExports.jsxs(e.Form,{form:R,layout:"vertical",onFinish:z,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{name:"policy_document",extra:e.jsxRuntimeExports.jsx("span",{className:s.rolePolicyExtra,children:e.jsxRuntimeExports.jsx(e.Select,{style:{width:120},placeholder:o("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:o("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:o("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:o("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:o("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:o("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:o("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:h=>{const b=H[h];b&&R.setFieldValue("policy_document",JSON.stringify(b,null,2))}})}),children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",children:l("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>S(!1),children:l("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx($,{serviceAccountID:p,onClose:()=>a(!1),open:v})]}):e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsxRuntimeExports.jsx(e.Empty,{description:o("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},X=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));exports.ServiceAccountDetail=X;exports.ServiceAccountList=G;
