"use strict";const e=require("./vendor.js"),x=require("react"),t=require("antd"),l=require("@ant-design/icons"),B=require("react-router-dom"),k=require("./components.js"),A=require("./index.js"),b=require("./base.js"),w=require("react-i18next"),G=require("./not_found.js"),z=require("ahooks"),$=require("dayjs"),J=require("./contexts.js"),W=require("antd-style"),M=({serviceAccountID:c,onClose:i,open:E=!1,onSuccess:S})=>{const{t:u}=w.useTranslation("authorization"),{t:o}=w.useTranslation("common"),[d]=t.Form.useForm(),[m,p]=x.useState(!1),{run:R,loading:r}=z.useRequest(y=>c?A.api.authorization.updateServiceAccount({id:c},y):A.api.authorization.createServiceAccount(y),{onSuccess:()=>{t.message.success(u("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),i(),S==null||S()},onError:()=>{t.message.error(u("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return x.useEffect(()=>{const y=async g=>{p(!0);try{const v=await A.api.authorization.getServiceAccountById({id:g});d.setFieldsValue({name:v.name,description:v.description})}catch{t.message.error(u("serviceAccount.loadError",{defaultValue:"Failed to load service account."}))}finally{p(!1)}};E&&(d.resetFields(),c&&y(c))},[c,E]),e.jsxRuntimeExports.jsx(t.Modal,{title:c?u("serviceAccount.edit",{defaultValue:"Edit Service Account"}):u("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:()=>{d.resetFields(),i()},onCancel:()=>{d.resetFields(),i()},open:E,footer:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{onClick:i,children:o("cancel",{defaultValue:"Cancel"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:d.submit,loading:r||m,children:o("save",{defaultValue:"Save"})})]}),children:e.jsxRuntimeExports.jsxs(t.Form,{form:d,layout:"vertical",onFinish:R,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:u("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:u("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:u("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:u("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:4,placeholder:u("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},H=()=>{const{t:c}=w.useTranslation("authorization"),{t:i}=w.useTranslation("common"),E=B.useNavigate(),[S]=t.Form.useForm(),[u,o]=x.useState(!1),[d,m]=x.useState([]),[p,R]=x.useState(0),[r,y]=x.useState(!1),[g,v]=x.useState(null),[j,_]=x.useState({current:b.PAGINATION.DEFAULT_CURRENT,page_size:b.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0}),a=x.useCallback(async()=>{try{o(!0);const s=await A.api.authorization.getServiceAccounts(j);m(s.data||[]),R(s.total||0)}catch(s){console.error(c("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),s),t.message.error(c("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{o(!1)}},[j,c]);x.useEffect(()=>{a()},[a]);const h=s=>{_({...j,current:b.PAGINATION.DEFAULT_CURRENT,search:s.search})},V=()=>{S.resetFields(),_({current:b.PAGINATION.DEFAULT_CURRENT,page_size:b.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0})},F=(s,n)=>{_(D=>({...D,current:s,page_size:n}))},T=()=>{v(null),y(!0)},P=s=>{v(s.id),y(!0)},I=()=>{y(!1)},K=async s=>{try{await A.api.authorization.deleteServiceAccount({id:s}),t.message.success(c("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),a()}catch(n){console.error(c("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),n),t.message.error(c("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},f=async s=>{const n=s.status==="active"?"disabled":"active";try{await A.api.authorization.updateServiceAccountStatus({id:s.id},{status:n}),t.message.success(c("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),a()}catch(D){console.error(c("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),D),t.message.error(c("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},C=[{title:c("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(s,n)=>e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:view",fallback:s,children:e.jsxRuntimeExports.jsx(B.Link,{to:`/authorization/service-accounts/${n.id}`,children:s})})},{title:c("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:s=>e.jsxRuntimeExports.jsx(t.Tooltip,{title:s,children:e.jsxRuntimeExports.jsx("span",{children:(s==null?void 0:s.length)>30?`${s.substring(0,30)}...`:s})})},{title:c("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:s=>s==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:c("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:c("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:c("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(s,n)=>{var D;return e.jsxRuntimeExports.jsxs(t.Space,{size:[0,4],wrap:!0,children:[(D=n.roles)==null?void 0:D.map(q=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:q.name},q.id)),(!n.roles||n.roles.length===0)&&e.jsxRuntimeExports.jsx(t.Tag,{children:c("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:c("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(s,n)=>n.policy_document&&n.policy_document.Statement&&n.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(t.Tag,{color:"green",icon:e.jsxRuntimeExports.jsx(l.CheckCircleOutlined,{}),children:c("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"default",icon:e.jsxRuntimeExports.jsx(l.CloseCircleOutlined,{}),children:c("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:c("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:s=>b.formatDate(s)},{title:c("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:s=>s?b.formatDate(s):c("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:i("actions",{defaultValue:"Actions"}),key:"action",render:(s,n)=>e.jsxRuntimeExports.jsxs(t.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:view",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:c("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(l.EyeOutlined,{}),onClick:()=>E(`/authorization/service-accounts/${n.id}`)})})}),e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:c("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(l.EditOutlined,{}),onClick:()=>P(n)})})}),e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:n.status==="active"?i("disable",{defaultValue:"Disable"}):i("enable",{defaultValue:"Enable"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:n.status==="active"?e.jsxRuntimeExports.jsx(l.LockOutlined,{}):e.jsxRuntimeExports.jsx(l.CheckCircleOutlined,{}),onClick:()=>f(n)})})}),e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:c("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsxRuntimeExports.jsx(t.Popconfirm,{title:c("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>K(n.id),okText:i("confirm",{defaultValue:"Confirm"}),cancelText:i("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",danger:!0,icon:e.jsxRuntimeExports.jsx(l.DeleteOutlined,{})})})})})]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(t.Form,{form:S,layout:"horizontal",onFinish:h,initialValues:{search:j.search},style:{marginBottom:0},children:e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,children:[e.jsxRuntimeExports.jsx(t.Col,{xs:24,sm:12,md:8,lg:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"search",label:i("keyword",{defaultValue:"Keyword"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:c("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsxRuntimeExports.jsx(l.SearchOutlined,{})})})}),e.jsxRuntimeExports.jsx(t.Col,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(l.FilterOutlined,{}),children:i("filter",{defaultValue:"Filter"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:V,icon:e.jsxRuntimeExports.jsx(l.ReloadOutlined,{}),children:i("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxRuntimeExports.jsxs(t.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:V,icon:e.jsxRuntimeExports.jsx(l.ReloadOutlined,{}),children:i("refresh",{defaultValue:"Refresh"})})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(l.PlusOutlined,{}),onClick:T,children:c("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",dataSource:d,columns:C,loading:u,pagination:{current:j.current,pageSize:j.page_size,total:p,onChange:F,showSizeChanger:!0,showQuickJumper:!0,showTotal:s=>i("totalItems",{defaultValue:`Total ${s} items`,total:s})}})]}),e.jsxRuntimeExports.jsx(M,{serviceAccountID:g,onClose:I,open:r,onSuccess:()=>{a()}})]})},Q=Object.freeze(Object.defineProperty({__proto__:null,default:H},Symbol.toStringTag,{value:"Module"})),{Text:O,Paragraph:U}=t.Typography,{TextArea:Z}=t.Input,X=({serviceAccountID:c})=>{const{t:i}=w.useTranslation("authorization"),{t:E}=w.useTranslation("common"),[S,u]=x.useState([]),[o,d]=x.useState(!1),[m,p]=x.useState(!1),[R]=t.Form.useForm(),[r,y]=x.useState(null),[g,v]=x.useState(null),[j,_]=x.useState(!1),a=async()=>{if(c){d(!0);try{const s=await A.api.authorization.getServiceAccountAccessKeys({id:c});u(s)}catch(s){console.error("Failed to load access keys:",s),t.message.error(i("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{d(!1)}}};x.useEffect(()=>{a()},[c]);const h=s=>{navigator.clipboard.writeText(s).then(()=>{t.message.success(i("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},n=>{console.error("Could not copy text: ",n)})},V=()=>{y(null),R.resetFields(),p(!0)},F=s=>{y(s),R.setFieldsValue({name:s.name,description:s.description,status:s.status==="active",expires_at:s.expires_at?$(s.expires_at):void 0}),p(!0)},T=()=>{p(!1),R.resetFields()},{run:P,loading:I}=z.useRequest(async()=>{const s=await R.validateFields();if(r){const n=await A.api.authorization.updateServiceAccountAccessKey({id:c,keyId:r.id},{name:s.name,description:s.description,status:s.status?"active":"disabled",expires_at:s.expires_at?s.expires_at.toISOString():void 0});return p(!1),n}else{const n=await A.api.authorization.createServiceAccountAccessKey({id:c},{name:s.name,description:s.description,expires_at:s.expires_at?s.expires_at.toISOString():void 0});v(n),p(!1),_(!0)}},{manual:!0,onSuccess:()=>{t.message.success(i("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),a()},onError:()=>{t.message.error(i("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),K=async s=>{try{await A.api.authorization.deleteServiceAccountAccessKey({id:c,keyId:s}),t.message.success(i("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),a()}catch(n){console.error("Failed to delete key:",n),t.message.error(i("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},f=()=>{_(!1),v(null)},C=[{title:i("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:i("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:s=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(l.KeyOutlined,{}),e.jsxRuntimeExports.jsx(O,{copyable:!0,children:s})]})},{title:i("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:i("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:s=>s==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:i("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:i("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:i("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:s=>s?b.formatDate(s):e.jsxRuntimeExports.jsx(O,{type:"secondary",children:i("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:i("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:s=>s?b.formatDate(s):e.jsxRuntimeExports.jsx(O,{type:"secondary",children:i("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:E("actions",{defaultValue:"Actions"}),key:"action",render:(s,n)=>e.jsxRuntimeExports.jsxs(t.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(t.Tooltip,{title:i("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(l.EditOutlined,{}),onClick:()=>F(n)})}),e.jsxRuntimeExports.jsx(t.Popconfirm,{title:i("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>K(n.id),okText:E("confirm",{defaultValue:"Confirm"}),cancelText:E("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",danger:!0,icon:e.jsxRuntimeExports.jsx(l.DeleteOutlined,{})})})]})}];return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(l.KeyOutlined,{}),i("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(l.SyncOutlined,{}),onClick:a,loading:o,children:E("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(l.PlusOutlined,{}),onClick:V,children:i("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsxRuntimeExports.jsx(t.Table,{columns:C,dataSource:S,rowKey:"id",loading:o,pagination:!1})}),e.jsxRuntimeExports.jsx(t.Modal,{title:r?i("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):i("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:m,onOk:P,confirmLoading:I,onCancel:T,children:e.jsxRuntimeExports.jsxs(t.Form,{form:R,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:i("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:i("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:i("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:i("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Z,{rows:3,placeholder:i("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),r&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:i("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{checkedChildren:i("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:i("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"expires_at",label:i("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsxRuntimeExports.jsx(t.DatePicker,{showTime:!0,placeholder:i("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxRuntimeExports.jsxs(t.Modal,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(l.ExclamationCircleOutlined,{style:{color:"#faad14"}}),i("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:j,footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:f,children:E("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsxRuntimeExports.jsx(t.Alert,{message:i("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),g&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(O,{strong:!0,children:[i("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsxRuntimeExports.jsx(U,{copyable:{text:g.access_key_id},children:g.access_key_id})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(O,{strong:!0,children:[i("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsxRuntimeExports.jsx(U,{copyable:{text:g.secret_access_key||""},children:g.secret_access_key})]}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(l.CopyOutlined,{}),onClick:()=>{const s=`Access Key: ${g.access_key_id}
Secret Key: ${g.secret_access_key}`;h(s)},block:!0,children:i("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:L}=t.Typography,Y=({serviceAccount:c,onRefresh:i,loading:E})=>{const{id:S}=c||{},{t:u}=w.useTranslation("authorization"),{t:o}=w.useTranslation("common"),[d,m]=x.useState([]),[p,R]=x.useState([]);x.useEffect(()=>{R((c==null?void 0:c.roles)||[])},[c]);const[r,y]=x.useState(void 0),{loading:g}=z.useRequest(async()=>A.api.authorization.listRoles({current:1,page_size:20,search:r}),{onSuccess:a=>{const h=a.data;p.forEach(V=>{h.find(T=>T.id===V.id)||h.push(V)}),m(h)},onError:a=>{console.error("Failed to load roles:",a),t.message.error(u("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[r]}),{run:v,loading:j}=z.useRequest(async()=>{if(S)return A.api.authorization.assignServiceAccountRoles({id:S},{role_ids:p.map(a=>a.id)})},{onSuccess:()=>{t.message.success(u("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),i()},onError:a=>{console.error("Failed to assign roles:",a),t.message.error(u("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),_=a=>{R(a.map(h=>d.find(V=>V.id===h)||{id:h,name:h,description:h}))};return e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(l.LockOutlined,{}),u("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(l.SyncOutlined,{}),onClick:()=>{i()},disabled:E||j,loading:j,children:o("refresh",{defaultValue:"Refresh"})}),children:j?e.jsxRuntimeExports.jsx(t.Skeleton,{active:!0,paragraph:{rows:4}}):e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx(L,{children:u("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:p.length>0?d.filter(a=>p.some(h=>h.id===a.id)).map(a=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:a.name},a.id)):e.jsxRuntimeExports.jsx(t.Empty,{image:t.Empty.PRESENTED_IMAGE_SIMPLE,description:u("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx(L,{children:u("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:u("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:p.map(a=>a.id),onSearch:a=>{y(a)},onDropdownVisibleChange:a=>{a&&y(void 0)},onChange:_,loading:E||g,optionFilterProp:"label",options:d.map(a=>({label:a.name,value:a.id,title:a.description}))})]}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:v,loading:j,disabled:E,children:u("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:N}=t.Tabs,ee={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},te=W.createStyles(({css:c})=>({rolePolicy:c`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:c`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:c`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),se=()=>{const{styles:c}=te(),u=B.useLocation().hash.replace("#","")||"basic",{t:o}=w.useTranslation("authorization"),{t:d}=w.useTranslation("common"),{id:m}=B.useParams(),p=B.useNavigate(),{hasPermission:R}=J.usePermission(),[r,y]=x.useState(null),[g,v]=x.useState(!1),[j]=t.Form.useForm(),[_,a]=x.useState(!1);if(!m)return e.jsxRuntimeExports.jsx(G.default,{});const{run:h,loading:V}=z.useRequest(async()=>{if(m)return A.api.authorization.getServiceAccountById({id:m})},{onSuccess:f=>{y(f||null)}});x.useEffect(()=>{h()},[m]);const F=f=>{p(`#${f}`)},T=async()=>{if(m)try{await A.api.authorization.deleteServiceAccount({id:m}),t.message.success(o("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),p("/authorization/service-accounts")}catch(f){console.error(o("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),f),t.message.error(o("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:P,loading:I}=z.useRequest(async()=>{if(r)return A.api.authorization.updateServiceAccountStatus({id:m},{status:r.status==="active"?"disabled":"active"})},{onSuccess:f=>{y(f||null),t.message.success(o("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:f=>{console.error(o("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),f),t.message.error(o("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),K=async f=>{if(m)try{let C;try{C=JSON.parse(f.policy_document)}catch{t.message.error(o("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await A.api.authorization.setServiceAccountPolicy({id:m},{policy_document:C}),t.message.success(o("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),v(!1),h()}catch(C){console.error(o("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),C),t.message.error(o("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return V?e.jsxRuntimeExports.jsx(t.Spin,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):r?e.jsxRuntimeExports.jsxs(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(l.UserOutlined,{}),r.name,r.status==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:o("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:o("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})]}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(l.EditOutlined,{}),onClick:()=>a(!0),disabled:_,children:d("edit",{defaultValue:"Edit"})})}),e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{icon:r.status==="active"?e.jsxRuntimeExports.jsx(l.LockOutlined,{}):e.jsxRuntimeExports.jsx(l.CheckCircleOutlined,{}),onClick:P,loading:I,children:r.status==="active"?d("disable",{defaultValue:"Disable"}):d("enable",{defaultValue:"Enable"})})}),e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(t.Popconfirm,{title:o("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:T,okText:d("confirm",{defaultValue:"Confirm"}),cancelText:d("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{danger:!0,icon:e.jsxRuntimeExports.jsx(l.DeleteOutlined,{}),children:d("delete",{defaultValue:"Delete"})})})}),e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(l.RollbackOutlined,{}),onClick:()=>p("/authorization/service-accounts"),children:d("back",{defaultValue:"Back"})})]}),children:[e.jsxRuntimeExports.jsxs(t.Tabs,{defaultActiveKey:u,onChange:F,children:[e.jsxRuntimeExports.jsx(N,{tab:o("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,column:2,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.name",{defaultValue:"Name"}),span:2,children:r.name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.description",{defaultValue:"Description"}),span:2,children:r.description||o("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.status",{defaultValue:"Status"}),children:r.status==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:o("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:o("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:r.last_access?b.formatDate(r.last_access):o("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.createdAt",{defaultValue:"Created At"}),children:b.formatDate(r.created_at)}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:o("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:b.formatDate(r.updated_at)})]})},"basic"),e.jsxRuntimeExports.jsx(N,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(l.KeyOutlined,{}),o("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!R("authorization:service_account:access_key:list"),children:e.jsxRuntimeExports.jsx(X,{serviceAccountID:m})},"access-keys"),e.jsxRuntimeExports.jsx(N,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(l.LockOutlined,{}),o("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!R("authorization:service_account:role:list"),children:e.jsxRuntimeExports.jsx(Y,{serviceAccount:r,onRefresh:h})},"authorization"),e.jsxRuntimeExports.jsxs(N,{tab:o("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(t.Row,{justify:"end",children:e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(k.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(l.EditOutlined,{}),onClick:()=>{v(!0),j.setFieldsValue({policy_document:JSON.stringify(r.policy_document,null,2)})},children:o("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:V,children:r.policy_document&&r.policy_document.Statement&&r.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(r.policy_document,null,2)})}):e.jsxRuntimeExports.jsx(t.Empty,{description:o("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsxRuntimeExports.jsx(t.Modal,{title:o("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:g,onCancel:()=>{v(!1),j.resetFields()},footer:null,width:700,children:e.jsxRuntimeExports.jsxs(t.Form,{form:j,layout:"vertical",onFinish:K,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"policy_document",extra:e.jsxRuntimeExports.jsx("span",{className:c.rolePolicyExtra,children:e.jsxRuntimeExports.jsx(t.Select,{style:{width:120},placeholder:o("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:o("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:o("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:o("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:o("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:o("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:o("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:f=>{const C=ee[f];C&&j.setFieldValue("policy_document",JSON.stringify(C,null,2))}})}),children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",children:d("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>v(!1),children:d("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(M,{serviceAccountID:m,onClose:()=>a(!1),open:_})]}):e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsxRuntimeExports.jsx(t.Empty,{description:o("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},ie=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));exports.ServiceAccountDetail=ie;exports.ServiceAccountList=Q;
