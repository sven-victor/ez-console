"use strict";const e=require("./vendor.js"),x=require("react"),t=require("antd"),u=require("@ant-design/icons"),q=require("react-router-dom"),D=require("./components.js"),_=require("./index.js"),P=require("./base.js"),O=require("react-i18next"),U=require("./contexts.js"),Q=require("./not_found.js"),B=require("ahooks"),Z=require("dayjs"),X=require("antd-style"),J=({serviceAccountID:s,onClose:i,open:S=!1,onSuccess:w,enableMultiOrg:j=!1,organizations:a=[]})=>{const{hasGlobalPermission:h}=U.usePermission(),{t:r}=O.useTranslation("authorization"),{t:f}=O.useTranslation("common"),{currentOrgId:E}=U.useSite(),[c]=t.Form.useForm(),[T,v]=x.useState(!1),[C,z]=x.useState("global"),[R,V]=x.useState(void 0),[l,p]=x.useState(null),{run:k,loading:F}=B.useRequest(y=>{if(s){const{organization_id:b,...d}=y;return _.api.authorization.updateServiceAccount({id:s},d)}const A={name:y.name,description:y.description};return C==="organization"&&R&&(A.organization_id=R),_.api.authorization.createServiceAccount(A)},{onSuccess:()=>{t.message.success(r("serviceAccount.saveSuccess",{defaultValue:"Service account saved successfully."})),i(),w==null||w()},onError:()=>{t.message.error(r("serviceAccount.saveError",{defaultValue:"Failed to save service account."}))},manual:!0});return x.useEffect(()=>{const y=async A=>{var b;v(!0);try{const d=await _.api.authorization.getServiceAccountById({id:A}),g=d.organization_id||"";z(g?"organization":"global"),V(g||void 0),p(g?((b=d.organization)==null?void 0:b.name)??g:null),c.setFieldsValue({name:d.name,description:d.description,organization_id:g||void 0})}catch{t.message.error(r("serviceAccount.loadError",{defaultValue:"Failed to load service account."}))}finally{v(!1)}};if(S){c.resetFields();const A=E||(a.length>0?a[0].id:""),b=j&&A?"organization":"global";z(b),V(b==="organization"?A:void 0),s?y(s):(p(null),c.setFieldsValue({organization_id:b==="organization"?A:void 0}))}},[s,S,j,a,E]),e.jsxRuntimeExports.jsx(t.Modal,{title:s?r("serviceAccount.edit",{defaultValue:"Edit Service Account"}):r("serviceAccount.create",{defaultValue:"Create Service Account"}),width:500,onClose:()=>{c.resetFields(),i()},onCancel:()=>{c.resetFields(),i()},open:S,footer:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{onClick:i,children:f("cancel",{defaultValue:"Cancel"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:c.submit,loading:F||T,children:f("save",{defaultValue:"Save"})})]}),children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",onFinish:k,children:[j&&!s&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:r("serviceAccount.scope",{defaultValue:"Scope"}),children:e.jsxRuntimeExports.jsxs(t.Radio.Group,{value:C,onChange:y=>{var d;const A=y.target.value;z(A);const b=A==="organization"?E||((d=a[0])==null?void 0:d.id):void 0;V(b),c.setFieldsValue({organization_id:b})},disabled:!h("authorization:service_account:create"),children:[e.jsxRuntimeExports.jsx(t.Radio,{value:"global",children:r("serviceAccount.global",{defaultValue:"Global"})}),e.jsxRuntimeExports.jsx(t.Radio,{value:"organization",children:r("serviceAccount.organizationScoped",{defaultValue:"Organization"})})]})}),C==="organization"&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"organization_id",label:r("serviceAccount.organization",{defaultValue:"Organization"}),rules:[{required:!0,message:r("serviceAccount.organizationRequired",{defaultValue:"Please select an organization."})}],children:e.jsxRuntimeExports.jsx(t.Select,{placeholder:r("serviceAccount.selectOrganization",{defaultValue:"Select organization"}),options:a.map(y=>({value:y.id,label:y.name})),value:R,onChange:y=>V(y)})})]}),j&&s&&e.jsxRuntimeExports.jsx(t.Form.Item,{label:r("serviceAccount.organization",{defaultValue:"Organization"}),children:e.jsxRuntimeExports.jsx("span",{children:l??r("serviceAccount.global",{defaultValue:"Global"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:r("serviceAccount.name",{defaultValue:"Name"}),name:"name",rules:[{required:!0,message:r("serviceAccount.nameRequired",{defaultValue:"Please enter a name for the service account."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:r("serviceAccount.namePlaceholder",{defaultValue:"Enter service account name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:r("serviceAccount.description",{defaultValue:"Description"}),name:"description",children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:4,placeholder:r("serviceAccount.descriptionPlaceholder",{defaultValue:"Enter service account description (optional)"})})})]})})},Y=()=>{const{t:s}=O.useTranslation("authorization"),{t:i}=O.useTranslation("common"),S=q.useNavigate(),[w]=t.Form.useForm(),{siteConfig:j}=U.useSite(),{user:a}=U.useAuth(),h=(a==null?void 0:a.organizations)||[],r=(j==null?void 0:j.enable_multi_org)??!1,[f,E]=x.useState(!1),[c,T]=x.useState([]),[v,C]=x.useState(0),[z,R]=x.useState(!1),[V,l]=x.useState(null),[p,k]=x.useState({current:P.PAGINATION.DEFAULT_CURRENT,page_size:P.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0,organization_id:void 0}),F=x.useCallback(async()=>{try{E(!0);const o=await _.api.authorization.getServiceAccounts(p);T(o.data||[]),C(o.total||0)}catch(o){console.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}),o),t.message.error(s("serviceAccount.loadError",{defaultValue:"Failed to load service accounts"}))}finally{E(!1)}},[p,s]);x.useEffect(()=>{F()},[F]);const y=o=>{k({...p,current:P.PAGINATION.DEFAULT_CURRENT,search:o.search,organization_id:o.organization_id||void 0})},A=()=>{w.resetFields(),k({current:P.PAGINATION.DEFAULT_CURRENT,page_size:P.PAGINATION.DEFAULT_PAGE_SIZE,search:void 0,organization_id:void 0})},b=(o,m)=>{k(K=>({...K,current:o,page_size:m}))},d=()=>{l(null),R(!0)},g=o=>{l(o.id),R(!0)},n=()=>{R(!1)},I=async o=>{try{await _.api.authorization.deleteServiceAccount({id:o}),t.message.success(s("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully"})),F()}catch(m){console.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}),m),t.message.error(s("serviceAccount.deleteError",{defaultValue:"Failed to delete service account"}))}},W=async o=>{const m=o.status==="active"?"disabled":"active";try{await _.api.authorization.updateServiceAccountStatus({id:o.id},{status:m}),t.message.success(s("serviceAccount.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),F()}catch(K){console.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}),K),t.message.error(s("serviceAccount.statusUpdateError",{defaultValue:"Failed to update status"}))}},H=[{title:s("serviceAccount.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(o,m)=>e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:view",fallback:o,children:e.jsxRuntimeExports.jsx(q.Link,{to:`/authorization/service-accounts/${m.id}`,children:o})})},{title:s("serviceAccount.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",render:o=>e.jsxRuntimeExports.jsx(t.Tooltip,{title:o,children:e.jsxRuntimeExports.jsx("span",{children:(o==null?void 0:o.length)>30?`${o.substring(0,30)}...`:o})})},...r?[{title:s("serviceAccount.organization",{defaultValue:"Organization"}),key:"organization",render:(o,m)=>{var K;return m.organization_id?e.jsxRuntimeExports.jsx(t.Tag,{icon:e.jsxRuntimeExports.jsx(u.TeamOutlined,{}),color:"blue",children:((K=m.organization)==null?void 0:K.name)||m.organization_id}):e.jsxRuntimeExports.jsx(t.Tag,{color:"default",children:s("serviceAccount.global",{defaultValue:"Global"})})}}]:[],{title:s("serviceAccount.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:o=>o==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:s("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:s("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})},{title:s("serviceAccount.roles",{defaultValue:"Roles"}),key:"roles",render:(o,m)=>{var K;return e.jsxRuntimeExports.jsxs(t.Space,{size:[0,4],wrap:!0,children:[(K=m.roles)==null?void 0:K.map(G=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:G.name},G.id)),(!m.roles||m.roles.length===0)&&e.jsxRuntimeExports.jsx(t.Tag,{children:s("serviceAccount.noRoles",{defaultValue:"No Roles"})})]})}},{title:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"}),key:"policy",render:(o,m)=>m.policy_document&&m.policy_document.Statement&&m.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(t.Tag,{color:"green",icon:e.jsxRuntimeExports.jsx(u.CheckCircleOutlined,{}),children:s("serviceAccount.hasPolicy",{defaultValue:"Has Policy"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"default",icon:e.jsxRuntimeExports.jsx(u.CloseCircleOutlined,{}),children:s("serviceAccount.noPolicy",{defaultValue:"No Policy"})})},{title:s("serviceAccount.createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",render:o=>P.formatDate(o)},{title:s("serviceAccount.lastAccess",{defaultValue:"Last Access"}),dataIndex:"last_access",key:"last_access",render:o=>o?P.formatDate(o):s("serviceAccount.neverAccessed",{defaultValue:"Never Accessed"})},{title:i("actions",{defaultValue:"Actions"}),key:"action",render:(o,m)=>e.jsxRuntimeExports.jsxs(t.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:view",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("serviceAccount.viewDetail",{defaultValue:"View Detail"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(u.EyeOutlined,{}),onClick:()=>S(`/authorization/service-accounts/${m.id}`)})})}),e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("serviceAccount.edit",{defaultValue:"Edit"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(u.EditOutlined,{}),onClick:()=>g(m)})})}),e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:m.status==="active"?i("disable",{defaultValue:"Disable"}):i("enable",{defaultValue:"Enable"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",icon:m.status==="active"?e.jsxRuntimeExports.jsx(u.LockOutlined,{}):e.jsxRuntimeExports.jsx(u.CheckCircleOutlined,{}),onClick:()=>W(m)})})}),e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("serviceAccount.delete",{defaultValue:"Delete"}),children:e.jsxRuntimeExports.jsx(t.Popconfirm,{title:s("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:()=>I(m.id),okText:i("confirm",{defaultValue:"Confirm"}),cancelText:i("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",size:"small",danger:!0,icon:e.jsxRuntimeExports.jsx(u.DeleteOutlined,{})})})})})]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(t.Form,{form:w,layout:"inline",onFinish:y,initialValues:{search:p.search,organization_id:p.organization_id},style:{marginBottom:0},children:e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,style:{width:"100%"},children:[e.jsxRuntimeExports.jsx(t.Col,{xs:24,sm:12,md:8,lg:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"search",children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("serviceAccount.searchPlaceholder",{defaultValue:"Search by name or description"}),allowClear:!0,prefix:e.jsxRuntimeExports.jsx(u.SearchOutlined,{})})})}),r&&e.jsxRuntimeExports.jsx(t.Col,{xs:24,sm:12,md:8,lg:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"organization_id",children:e.jsxRuntimeExports.jsx(t.Select,{placeholder:s("serviceAccount.filterByOrg",{defaultValue:"All organizations"}),allowClear:!0,style:{minWidth:160},options:[{value:"",label:s("serviceAccount.global",{defaultValue:"Global"})},...h.map(o=>({value:o.id,label:o.name}))]})})}),e.jsxRuntimeExports.jsx(t.Col,{xs:24,sm:12,md:8,lg:6,style:{display:"flex",alignItems:"flex-end"},children:e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(u.FilterOutlined,{}),children:i("filter",{defaultValue:"Filter"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:A,icon:e.jsxRuntimeExports.jsx(u.ReloadOutlined,{}),children:i("reset",{defaultValue:"Reset"})})]})})})]})})}),e.jsxRuntimeExports.jsxs(t.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:A,icon:e.jsxRuntimeExports.jsx(u.ReloadOutlined,{}),children:i("refresh",{defaultValue:"Refresh"})})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(u.PlusOutlined,{}),onClick:d,children:s("serviceAccount.create",{defaultValue:"Create Service Account"})})})})]})}),e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",dataSource:c,columns:H,loading:f,pagination:{current:p.current,pageSize:p.page_size,total:v,onChange:b,showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>i("totalItems",{defaultValue:`Total ${o} items`,total:o})}})]}),e.jsxRuntimeExports.jsx(J,{serviceAccountID:V,onClose:n,open:z,enableMultiOrg:r,organizations:h,onSuccess:()=>{F()}})]})},ee=Object.freeze(Object.defineProperty({__proto__:null,default:Y},Symbol.toStringTag,{value:"Module"})),{Text:N,Paragraph:M}=t.Typography,{TextArea:te}=t.Input,se=({serviceAccountID:s})=>{const{t:i}=O.useTranslation("authorization"),{t:S}=O.useTranslation("common"),[w,j]=x.useState([]),[a,h]=x.useState(!1),[r,f]=x.useState(!1),[E]=t.Form.useForm(),[c,T]=x.useState(null),[v,C]=x.useState(null),[z,R]=x.useState(!1),V=async()=>{if(s){h(!0);try{const n=await _.api.authorization.getServiceAccountAccessKeys({id:s});j(n)}catch(n){console.error("Failed to load access keys:",n),t.message.error(i("serviceAccount.loadKeysError",{defaultValue:"Failed to load access keys."}))}finally{h(!1)}}};x.useEffect(()=>{V()},[s]);const l=n=>{navigator.clipboard.writeText(n).then(()=>{t.message.success(i("serviceAccount.copyKeySuccess",{defaultValue:"Copied to clipboard!"}))},I=>{console.error("Could not copy text: ",I)})},p=()=>{T(null),E.resetFields(),f(!0)},k=n=>{T(n),E.setFieldsValue({name:n.name,description:n.description,status:n.status==="active",expires_at:n.expires_at?Z(n.expires_at):void 0}),f(!0)},F=()=>{f(!1),E.resetFields()},{run:y,loading:A}=B.useRequest(async()=>{const n=await E.validateFields();if(c){const I=await _.api.authorization.updateServiceAccountAccessKey({id:s,keyId:c.id},{name:n.name,description:n.description,status:n.status?"active":"disabled",expires_at:n.expires_at?n.expires_at.toISOString():void 0});return f(!1),I}else{const I=await _.api.authorization.createServiceAccountAccessKey({id:s},{name:n.name,description:n.description,expires_at:n.expires_at?n.expires_at.toISOString():void 0});C(I),f(!1),R(!0)}},{manual:!0,onSuccess:()=>{t.message.success(i("serviceAccount.updateKeySuccess",{defaultValue:"Access key updated successfully."})),V()},onError:()=>{t.message.error(i("serviceAccount.updateKeyError",{defaultValue:"Failed to update access key."}))}}),b=async n=>{try{await _.api.authorization.deleteServiceAccountAccessKey({id:s,keyId:n}),t.message.success(i("serviceAccount.deleteKeySuccess",{defaultValue:"Access key deleted successfully."})),V()}catch(I){console.error("Failed to delete key:",I),t.message.error(i("serviceAccount.deleteKeyError",{defaultValue:"Failed to delete access key."}))}},d=()=>{R(!1),C(null)},g=[{title:i("serviceAccount.keyName",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:i("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),dataIndex:"access_key_id",key:"access_key_id",render:n=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(u.KeyOutlined,{}),e.jsxRuntimeExports.jsx(N,{copyable:!0,children:n})]})},{title:i("serviceAccount.keyDescription",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:i("serviceAccount.keyStatus",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:n=>n==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:i("serviceAccount.keyActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:i("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})},{title:i("serviceAccount.keyExpires",{defaultValue:"Expires At"}),dataIndex:"expires_at",key:"expires_at",render:n=>n?P.formatDate(n):e.jsxRuntimeExports.jsx(N,{type:"secondary",children:i("serviceAccount.neverExpires",{defaultValue:"Never"})})},{title:i("serviceAccount.keyLastUsed",{defaultValue:"Last Used"}),dataIndex:"last_used",key:"last_used",render:n=>n?P.formatDate(n):e.jsxRuntimeExports.jsx(N,{type:"secondary",children:i("serviceAccount.keyNeverUsed",{defaultValue:"Never"})})},{title:S("actions",{defaultValue:"Actions"}),key:"action",render:(n,I)=>e.jsxRuntimeExports.jsxs(t.Space,{size:"small",children:[e.jsxRuntimeExports.jsx(t.Tooltip,{title:i("serviceAccount.updateKey",{defaultValue:"Update Key"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(u.EditOutlined,{}),onClick:()=>k(I)})}),e.jsxRuntimeExports.jsx(t.Popconfirm,{title:i("serviceAccount.deleteKeyConfirm",{defaultValue:"Are you sure you want to delete this access key?"}),onConfirm:()=>b(I.id),okText:S("confirm",{defaultValue:"Confirm"}),cancelText:S("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",danger:!0,icon:e.jsxRuntimeExports.jsx(u.DeleteOutlined,{})})})]})}];return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(u.KeyOutlined,{}),i("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(u.SyncOutlined,{}),onClick:V,loading:a,children:S("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(u.PlusOutlined,{}),onClick:p,children:i("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"})})]}),children:e.jsxRuntimeExports.jsx(t.Table,{columns:g,dataSource:w,rowKey:"id",loading:a,pagination:!1})}),e.jsxRuntimeExports.jsx(t.Modal,{title:c?i("serviceAccount.updateKey",{defaultValue:"Update Access Key"}):i("serviceAccount.createAccessKey",{defaultValue:"Create Access Key"}),open:r,onOk:y,confirmLoading:A,onCancel:F,children:e.jsxRuntimeExports.jsxs(t.Form,{form:E,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:i("serviceAccount.keyName",{defaultValue:"Key Name"}),rules:[{required:!0,message:i("serviceAccount.keyNameRequired",{defaultValue:"Please enter a name for the access key."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:i("serviceAccount.keyNamePlaceholder",{defaultValue:"Enter key name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:i("serviceAccount.keyDescription",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(te,{rows:3,placeholder:i("serviceAccount.keyDescriptionPlaceholder",{defaultValue:"Enter key description (optional)"})})}),c&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:i("serviceAccount.keyStatus",{defaultValue:"Status"}),valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{checkedChildren:i("serviceAccount.keyActive",{defaultValue:"Active"}),unCheckedChildren:i("serviceAccount.keyDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"expires_at",label:i("serviceAccount.keyExpires",{defaultValue:"Expires At"}),children:e.jsxRuntimeExports.jsx(t.DatePicker,{showTime:!0,placeholder:i("serviceAccount.selectExpireDate",{defaultValue:"Select expiry date (optional)"}),style:{width:"100%"}})})]})}),e.jsxRuntimeExports.jsxs(t.Modal,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(u.ExclamationCircleOutlined,{style:{color:"#faad14"}}),i("serviceAccount.secretNoticeTitle",{defaultValue:"Access Key Created - Important!"})]}),open:z,footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:d,children:S("confirm",{defaultValue:"I have copied the secret key. Close"})},"close")],closable:!1,children:[e.jsxRuntimeExports.jsx(t.Alert,{message:i("serviceAccount.secretNoticeMessage",{defaultValue:"Your new Secret Access Key is displayed below. This is the only time you will be able to see this secret. Please copy it and store it securely."}),type:"warning",showIcon:!0,style:{marginBottom:16}}),v&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(N,{strong:!0,children:[i("serviceAccount.accessKey",{defaultValue:"Access Key ID"}),":"]}),e.jsxRuntimeExports.jsx(M,{copyable:{text:v.access_key_id},children:v.access_key_id})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsxs(N,{strong:!0,children:[i("serviceAccount.secretKey",{defaultValue:"Secret Access Key"}),":"]}),e.jsxRuntimeExports.jsx(M,{copyable:{text:v.secret_access_key||""},children:v.secret_access_key})]}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(u.CopyOutlined,{}),onClick:()=>{const n=`Access Key: ${v.access_key_id}
Secret Key: ${v.secret_access_key}`;l(n)},block:!0,children:i("serviceAccount.copyToClipboard",{defaultValue:"Copy Keys to Clipboard"})})]})]})]})},{Text:$}=t.Typography,ie=({serviceAccount:s,onRefresh:i,loading:S})=>{const{id:w}=s||{},{t:j}=O.useTranslation("authorization"),{t:a}=O.useTranslation("common"),[h,r]=x.useState([]),[f,E]=x.useState([]);x.useEffect(()=>{E((s==null?void 0:s.roles)||[])},[s]);const[c,T]=x.useState(void 0),v=s==null?void 0:s.organization_id,{loading:C}=B.useRequest(async()=>_.api.authorization.listRoles({current:1,page_size:20,search:c,...v?{organization_id:v}:{}}),{onSuccess:l=>{const p=l.data;f.forEach(k=>{p.find(y=>y.id===k.id)||p.push(k)}),r(p)},onError:l=>{console.error("Failed to load roles:",l),t.message.error(j("serviceAccount.loadRolesError",{defaultValue:"Failed to load roles."}))},debounceWait:300,refreshDeps:[c,v]}),{run:z,loading:R}=B.useRequest(async()=>{if(w)return _.api.authorization.assignServiceAccountRoles({id:w},{role_ids:f.map(l=>l.id)})},{onSuccess:()=>{t.message.success(j("serviceAccount.assignRolesSuccess",{defaultValue:"Roles assigned successfully."})),i()},onError:l=>{console.error("Failed to assign roles:",l),t.message.error(j("serviceAccount.assignRolesError",{defaultValue:"Failed to assign roles."}))},manual:!0}),V=l=>{E(l.map(p=>h.find(k=>k.id===p)||{id:p,name:p,description:p}))};return e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(u.LockOutlined,{}),j("serviceAccount.authorization",{defaultValue:"Authorization"})]}),extra:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(u.SyncOutlined,{}),onClick:()=>{i()},disabled:S||R,loading:R,children:a("refresh",{defaultValue:"Refresh"})}),children:R?e.jsxRuntimeExports.jsx(t.Skeleton,{active:!0,paragraph:{rows:4}}):e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx($,{children:j("serviceAccount.roles",{defaultValue:"Roles"})}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:8},children:f.length>0?h.filter(l=>f.some(p=>p.id===l.id)).map(l=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:l.name},l.id)):e.jsxRuntimeExports.jsx(t.Empty,{image:t.Empty.PRESENTED_IMAGE_SIMPLE,description:j("serviceAccount.noRoles",{defaultValue:"No roles assigned."}),style:{margin:"10px 0"}})})]}),e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:16},children:[e.jsxRuntimeExports.jsx($,{children:j("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})}),e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",style:{width:"100%",marginTop:8},placeholder:j("serviceAccount.selectRoles",{defaultValue:"Select roles to assign"}),value:f.map(l=>l.id),onSearch:l=>{T(l)},onDropdownVisibleChange:l=>{l&&T(void 0)},onChange:V,loading:S||C,optionFilterProp:"label",options:h.map(l=>({label:l.name,value:l.id,title:l.description}))})]}),e.jsxRuntimeExports.jsx("div",{style:{marginTop:16},children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:z,loading:R,disabled:S,children:j("serviceAccount.assignRoles",{defaultValue:"Assign Roles"})})})]})})},{TabPane:L}=t.Tabs,ae={allow_all:{Statement:[{Effect:"Allow",Action:["*"]}]},deny_all:{Statement:[{Effect:"Deny",Action:["*"]}]},allow_with_action:{Statement:[{Effect:"Allow",Action:["authorization:user:view"]}]},allow_with_condition:{Statement:[{Effect:"Allow",Action:["authorization:user:update"],Condition:{StringEquals:{"id:":"abcdef"}}},{Effect:"Deny",Action:["*"]}]},allow_with_uri:{Statement:[{Effect:"Allow",Action:["authorization:user:view"],Condition:{StringEquals:{"http.uri":"/api/users/abcdef","http.method":"GET"}}},{Effect:"Deny",Action:["*"]}]}},oe=X.createStyles(({css:s})=>({rolePolicy:s`
       .ant-collapse-content>.ant-collapse-content-box{
        padding: 2px;
      }
      .ant-form-item-additional>#policy_document_extra{
        min-height: 0;
      }
    `,rolePermissionExtra:s`
      float: right;
      z-index: 1001;
      position: sticky;
    `,rolePolicyExtra:s`
      position: absolute;
      right: 20px;
      top: 5px;
    `})),ne=()=>{const{styles:s}=oe(),j=q.useLocation().hash.replace("#","")||"basic",{t:a}=O.useTranslation("authorization"),{t:h}=O.useTranslation("common"),{id:r}=q.useParams(),f=q.useNavigate(),{hasPermission:E}=U.usePermission(),[c,T]=x.useState(null),[v,C]=x.useState(!1),[z]=t.Form.useForm(),[R,V]=x.useState(!1);if(!r)return e.jsxRuntimeExports.jsx(Q.default,{});const{run:l,loading:p}=B.useRequest(async()=>{if(r)return _.api.authorization.getServiceAccountById({id:r})},{onSuccess:d=>{T(d||null)}});x.useEffect(()=>{l()},[r]);const k=d=>{f(`#${d}`)},F=async()=>{if(r)try{await _.api.authorization.deleteServiceAccount({id:r}),t.message.success(a("serviceAccount.deleteSuccess",{defaultValue:"Service account deleted successfully."})),f("/authorization/service-accounts")}catch(d){console.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}),d),t.message.error(a("serviceAccount.deleteError",{defaultValue:"Failed to delete service account."}))}},{run:y,loading:A}=B.useRequest(async()=>{if(c)return _.api.authorization.updateServiceAccountStatus({id:r},{status:c.status==="active"?"disabled":"active"})},{onSuccess:d=>{T(d||null),t.message.success(a("serviceAccount.statusUpdateSuccess",{defaultValue:"Service account status updated successfully."}))},onError:d=>{console.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}),d),t.message.error(a("serviceAccount.statusUpdateError",{defaultValue:"Failed to update service account status."}))},manual:!0}),b=async d=>{if(r)try{let g;try{g=JSON.parse(d.policy_document)}catch{t.message.error(a("serviceAccount.policyInvalidJson",{defaultValue:"Invalid JSON format for policy document."}));return}await _.api.authorization.setServiceAccountPolicy({id:r},{policy_document:g}),t.message.success(a("serviceAccount.policyUpdateSuccess",{defaultValue:"Policy document updated successfully."})),C(!1),l()}catch(g){console.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}),g),t.message.error(a("serviceAccount.policyUpdateError",{defaultValue:"Failed to update policy document."}))}};return p?e.jsxRuntimeExports.jsx(t.Spin,{size:"large",style:{display:"flex",justifyContent:"center",padding:"50px"}}):c?e.jsxRuntimeExports.jsxs(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(u.UserOutlined,{}),c.name,c.status==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:a("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:a("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})]}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(u.EditOutlined,{}),onClick:()=>V(!0),disabled:R,children:h("edit",{defaultValue:"Edit"})})}),e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{icon:c.status==="active"?e.jsxRuntimeExports.jsx(u.LockOutlined,{}):e.jsxRuntimeExports.jsx(u.CheckCircleOutlined,{}),onClick:y,loading:A,children:c.status==="active"?h("disable",{defaultValue:"Disable"}):h("enable",{defaultValue:"Enable"})})}),e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:delete",children:e.jsxRuntimeExports.jsx(t.Popconfirm,{title:a("serviceAccount.deleteConfirm",{defaultValue:"Are you sure you want to delete this service account?"}),onConfirm:F,okText:h("confirm",{defaultValue:"Confirm"}),cancelText:h("cancel",{defaultValue:"Cancel"}),children:e.jsxRuntimeExports.jsx(t.Button,{danger:!0,icon:e.jsxRuntimeExports.jsx(u.DeleteOutlined,{}),children:h("delete",{defaultValue:"Delete"})})})}),e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(u.RollbackOutlined,{}),onClick:()=>f("/authorization/service-accounts"),children:h("back",{defaultValue:"Back"})})]}),children:[e.jsxRuntimeExports.jsxs(t.Tabs,{defaultActiveKey:j,onChange:k,children:[e.jsxRuntimeExports.jsx(L,{tab:a("serviceAccount.tabs.basic",{defaultValue:"Basic Information"}),children:e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,column:2,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.name",{defaultValue:"Name"}),span:2,children:c.name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.description",{defaultValue:"Description"}),span:2,children:c.description||a("serviceAccount.noDescription",{defaultValue:"N/A"})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.status",{defaultValue:"Status"}),children:c.status==="active"?e.jsxRuntimeExports.jsx(t.Badge,{status:"success",text:a("serviceAccount.statusActive",{defaultValue:"Active"})}):e.jsxRuntimeExports.jsx(t.Badge,{status:"error",text:a("serviceAccount.statusDisabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.lastAccess",{defaultValue:"Last Access"}),children:c.last_access?P.formatDate(c.last_access):a("serviceAccount.neverAccessed",{defaultValue:"Never"})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.createdAt",{defaultValue:"Created At"}),children:P.formatDate(c.created_at)}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:a("serviceAccount.updatedAt",{defaultValue:"Updated At"}),children:P.formatDate(c.updated_at)})]})},"basic"),e.jsxRuntimeExports.jsx(L,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(u.KeyOutlined,{}),a("serviceAccount.accessKeys",{defaultValue:"Access Keys"})]}),disabled:!E("authorization:service_account:access_key:list"),children:e.jsxRuntimeExports.jsx(se,{serviceAccountID:r})},"access-keys"),e.jsxRuntimeExports.jsx(L,{tab:e.jsxRuntimeExports.jsxs("span",{children:[e.jsxRuntimeExports.jsx(u.LockOutlined,{}),a("serviceAccount.authorization",{defaultValue:"Authorization"})]}),disabled:!E("authorization:service_account:role:list"),children:e.jsxRuntimeExports.jsx(ie,{serviceAccount:c,onRefresh:l})},"authorization"),e.jsxRuntimeExports.jsxs(L,{tab:a("serviceAccount.tabs.policy",{defaultValue:"Policy Document"}),children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(t.Row,{justify:"end",children:e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(D.PermissionGuard,{permission:"authorization:service_account:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(u.EditOutlined,{}),onClick:()=>{C(!0),z.setFieldsValue({policy_document:JSON.stringify(c.policy_document,null,2)})},children:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"})})})})})}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:p,children:c.policy_document&&c.policy_document.Statement&&c.policy_document.Statement.length>0?e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx("pre",{style:{whiteSpace:"pre-wrap",overflowX:"auto"},children:JSON.stringify(c.policy_document,null,2)})}):e.jsxRuntimeExports.jsx(t.Empty,{description:a("serviceAccount.noPolicy",{defaultValue:"No policy document defined for this service account."})})})]},"policy")]}),e.jsxRuntimeExports.jsx(t.Modal,{title:a("serviceAccount.editPolicy",{defaultValue:"Edit Policy"}),open:v,onCancel:()=>{C(!1),z.resetFields()},footer:null,width:700,children:e.jsxRuntimeExports.jsxs(t.Form,{form:z,layout:"vertical",onFinish:b,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"policy_document",extra:e.jsxRuntimeExports.jsx("span",{className:s.rolePolicyExtra,children:e.jsxRuntimeExports.jsx(t.Select,{style:{width:120},placeholder:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),value:a("serviceAccount.insertTemplate",{defaultValue:"Insert Template"}),options:[{label:a("serviceAccount.allowAll",{defaultValue:"Allow All"}),value:"allow_all"},{label:a("serviceAccount.denyAll",{defaultValue:"Deny All"}),value:"deny_all"},{label:a("serviceAccount.allowWithAction",{defaultValue:"Allow with Action"}),value:"allow_with_action"},{label:a("serviceAccount.denyWithCondition",{defaultValue:"Allow with Condition"}),value:"allow_with_condition"},{label:a("serviceAccount.allowWithUri",{defaultValue:"Allow with URI"}),value:"allow_with_uri"}],onChange:d=>{const g=ae[d];g&&z.setFieldValue("policy_document",JSON.stringify(g,null,2))}})}),children:e.jsxRuntimeExports.jsx(e.TextArea,{rows:15,style:{fontFamily:"monospace"},placeholder:`{
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "account:EnableRegion",
                "account:DisableRegion"
            ],
            "Condition": {
                "StringEquals": {"id:": "abcdef"}
            }
        },
        {
            "Effect": "Allow",
            "Action": [
                "*"
            ]
        }
    ]
}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",children:h("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>C(!1),children:h("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(J,{serviceAccountID:r,onClose:()=>V(!1),open:R})]}):e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:"50px 0"},children:e.jsxRuntimeExports.jsx(t.Empty,{description:a("serviceAccount.notFound",{defaultValue:"Service account not found."})})})},ce=Object.freeze(Object.defineProperty({__proto__:null,default:ne},Symbol.toStringTag,{value:"Module"}));exports.ServiceAccountDetail=ce;exports.ServiceAccountList=ee;
