"use strict";var kn=Object.defineProperty;var Xn=(e,t,r)=>t in e?kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var O=(e,t,r)=>Xn(e,typeof t!="symbol"?t+"":t,r);const f=require("./vendor.js"),s=require("react"),I=require("classnames"),Kt=require("react-dom"),le=require("@ant-design/icons"),se=require("antd"),wt=require("./mermaid.js");function zn(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const r in e)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:()=>e[r]})}}return t.default=e,Object.freeze(t)}const A=zn(s);function et(e,t){return s.useImperativeHandle(e,()=>{const r=t(),{nativeElement:n}=r;return new Proxy(n,{get(o,i){return r[i]?r[i]:Reflect.get(o,i)}})})}const an=s.createContext({}),Fn={classNames:{},styles:{},className:"",style:{},shortcutKeys:{}},Ne=e=>{const t=s.useContext(an);return s.useMemo(()=>({...Fn,...t[e]}),[t[e]])};function ln(){}let Ie=null;function Kn(){Ie=null,f.resetWarned_1()}let gt=ln;process.env.NODE_ENV!=="production"&&(gt=(e,t,r)=>{f.default_1(e,`[antdx: ${t}] ${r}`),process.env.NODE_ENV==="test"&&Kn()});const qn=A.createContext({}),Vn=process.env.NODE_ENV!=="production"?e=>{const{strict:t}=A.useContext(qn),r=(n,o,i)=>{if(!n)if(t===!1&&o==="deprecated"){const a=Ie;Ie||(Ie={}),Ie[e]=Ie[e]||[],Ie[e].includes(i||"")||Ie[e].push(i||""),a||console.warn("[antd] There exists deprecated usage in your code:",Ie)}else gt(n,e,i)};return r.deprecated=(n,o,i,a)=>{r(n,"deprecated",`\`${o}\` is deprecated. Please use \`${i}\` instead.${a?` ${a}`:""}`)},r}:()=>{const e=()=>{};return e.deprecated=ln,e},cn=s.createContext(void 0),we={locale:"en",Conversations:{create:"New chat"},Sender:{stopLoading:"Stop loading",speechRecording:"Speech recording"},Actions:{feedbackLike:"Like",feedbackDislike:"Dislike",audio:"Play audio",audioRunning:"Audio playing",audioError:"Playback error",audioLoading:"Loading audio"},Bubble:{editableOk:"OK",editableCancel:"Cancel"},Mermaid:{zoomIn:"Zoom in",zoomOut:"Zoom out",zoomReset:"Reset",download:"Download",code:"Code",image:"Image"}},ze=(e,t)=>{const r=A.useContext(cn),n=A.useMemo(()=>{var l;const i=t||(we==null?void 0:we[e])||((l=f.defaultAntdEnUS)==null?void 0:l[e]),a=(r==null?void 0:r[e])??{};return{...typeof i=="function"?i():i,...a||{}}},[e,t,r]),o=A.useMemo(()=>{const i=r==null?void 0:r.locale;return r!=null&&r.exist&&!i?we.locale:i},[r]);return[n,o]},dn="internalMark",un=e=>{const{locale:t={},children:r,_ANT_MARK__:n}=e;process.env.NODE_ENV!=="production"&&Vn("LocaleProvider")(n===dn,"deprecated","`LocaleProvider` is deprecated. Please use `locale` with `XProvider` instead: https://x.ant.design/components/x-provider-cn#x-provider-demo-locale");const o=A.useMemo(()=>({...t,exist:!0}),[t]);return A.createElement(cn.Provider,{value:o},r)};process.env.NODE_ENV!=="production"&&(un.displayName="LocaleProvider");const Wn="ant";function pe(){const{getPrefixCls:e,direction:t,csp:r,iconPrefixCls:n,theme:o}=s.useContext(se.ConfigProvider.ConfigContext);return{theme:o,getPrefixCls:e,direction:t,csp:r,iconPrefixCls:n}}const mn=e=>{const{actions:t,attachments:r,bubble:n,conversations:o,prompts:i,sender:a,suggestion:l,thoughtChain:c,welcome:d,fileCard:u,think:m,theme:g,locale:p,children:y,mermaid:b,codeHighlighter:S,...x}=e,$=s.useMemo(()=>({actions:t,attachments:r,bubble:n,conversations:o,prompts:i,sender:a,suggestion:l,thoughtChain:c,fileCard:u,think:m,mermaid:b,codeHighlighter:S,welcome:d}),[t,r,n,o,i,a,l,c,d,b,m,u,S]);let E=y;return p&&(E=s.createElement(un,{locale:p,_ANT_MARK__:dn},E)),s.createElement(an.Provider,{value:$},s.createElement(se.ConfigProvider,f._extends({},x,{theme:g,locale:p}),E))};process.env.NODE_ENV!=="production"&&(mn.displayName="XProvider");const Ge=1e3,Ye=4,ft=140,qt=ft/2,dt=250,Vt=500,ut=.8;function fn({className:e}){const[t]=ze("Sender",we.Sender);return s.createElement("svg",{color:"currentColor",viewBox:`0 0 ${Ge} ${Ge}`,xmlns:"http://www.w3.org/2000/svg",className:e},s.createElement("title",null,t.speechRecording),Array.from({length:Ye}).map((r,n)=>{const o=(Ge-ft*Ye)/(Ye-1),i=n*(o+ft),a=Ge/2-dt/2,l=Ge/2-Vt/2;return s.createElement("rect",{fill:"currentColor",rx:qt,ry:qt,height:dt,width:ft,x:i,y:a,key:n},s.createElement("animate",{attributeName:"height",values:`${dt}; ${Vt}; ${dt}`,keyTimes:"0; 0.5; 1",dur:`${ut}s`,begin:`${ut/Ye*n}s`,repeatCount:"indefinite"}),s.createElement("animate",{attributeName:"y",values:`${a}; ${l}; ${a}`,keyTimes:"0; 0.5; 1",dur:`${ut}s`,begin:`${ut/Ye*n}s`,repeatCount:"indefinite"}))}))}const jn=e=>({[e.componentCls]:{[`${e.antCls}-motion-collapse-legacy`]:{overflow:"hidden","&-active":{transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}},[`${e.antCls}-motion-collapse`]:{overflow:"hidden",transition:`height ${e.motionDurationMid} ${e.motionEaseInOut},
        opacity ${e.motionDurationMid} ${e.motionEaseInOut} !important`}}}),Un=e=>({animationDuration:e,animationFillMode:"both"}),Gn=e=>({animationDuration:e,animationFillMode:"both"}),pn=(e,t,r,n,o=!1)=>{const i=o?"&":"";return{[`
      ${i}${e}-enter,
      ${i}${e}-appear
    `]:{...Un(n),animationPlayState:"paused"},[`${i}${e}-leave`]:{...Gn(n),animationPlayState:"paused"},[`
      ${i}${e}-enter${e}-enter-active,
      ${i}${e}-appear${e}-appear-active
    `]:{animationName:t,animationPlayState:"running"},[`${i}${e}-leave${e}-leave-active`]:{animationName:r,animationPlayState:"running",pointerEvents:"none"}}},Yn=new f.Keyframe("antXFadeInLeft",{"0%":{maskPosition:"100% 0"},"100%":{maskPosition:"0% 0%"}}),Zn=new f.Keyframe("antXFadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),gn=new f.Keyframe("antFadeOut",{"0%":{opacity:1},"100%":{opacity:0}}),Jn=(e,t=!1)=>{const{antCls:r}=e,n=`${r}-x-fade-left`,o=t?"&":"";return[{[e.componentCls]:{"&":pn(n,Yn,gn,"1s",t),[`${o}${n}-enter,${o}${n}-appear`]:{transitionProperty:"mask-position",animationTimingFunction:"linear",maskImage:`linear-gradient(90deg, ${e.colorTextBase} 33%, ${new f.FastColor(e.colorTextBase).setA(0)} 66%)`,maskSize:"300% 100%",maskPosition:"100% 0%"},[`${o}${n}-leave`]:{animationTimingFunction:"linear"}}}]},Qn=(e,t=!1)=>{const{antCls:r}=e,n=`${r}-x-fade`,o=t?"&":"";return[{[e.componentCls]:{"&":pn(n,Zn,gn,"1.2s",t),[`${o}${n}-enter,${o}${n}-appear`]:{opacity:0},[`${o}${n}-leave`]:{animationTimingFunction:"linear"}}}]},er="2.1.1",tr=f.createTheme(se.theme.defaultAlgorithm),nr={screenXS:!0,screenXSMin:!0,screenXSMax:!0,screenSM:!0,screenSMMin:!0,screenSMMax:!0,screenMD:!0,screenMDMin:!0,screenMDMax:!0,screenLG:!0,screenLGMin:!0,screenLGMax:!0,screenXL:!0,screenXLMin:!0,screenXLMax:!0,screenXXL:!0,screenXXLMin:!0},hn=(e,t,r)=>{const n=r.getDerivativeToken(e),{override:o,...i}=t;let a={...n,override:o};return a=f.formatToken(a),i&&Object.entries(i).forEach(([l,c])=>{const{theme:d,...u}=c;let m=u;d&&(m=hn({...a,...u},{override:u},d)),a[l]=m}),a};function yn(){const{token:e,hashed:t,theme:r,override:n,cssVar:o}=s.useContext(se.theme._internalContext),i={prefix:(o==null?void 0:o.prefix)||"ant",key:(o==null?void 0:o.key)||"css-var-root"},a=r||tr,[l,c,d]=f.useCacheToken(a,[se.theme.defaultSeed,e],{salt:`${er}-${t||""}`,override:n,getComputedToken:hn,cssVar:{...i,unitless:f.unitless,ignore:f.ignore,preserve:nr}});return[a,d,t?c:"",l,i]}function rr(){const[e,t,r]=yn();return{theme:e,token:t,hashId:r}}const{genStyleHooks:Ve}=f.genStyleUtils({usePrefix:()=>{const{getPrefixCls:e,iconPrefixCls:t}=pe();return{iconPrefixCls:t,rootPrefixCls:e()}},useToken:()=>{const[e,t,r,n,o]=yn();return{theme:e,realToken:t,hashId:r,token:n,cssVar:o}},useCSP:()=>{const{csp:e}=pe();return e??{}},layer:{name:"antdx",dependencies:["antd"]}}),sr=e=>{const{componentCls:t}=e,r=`${t}-audio`;return{[r]:{[`&${r}-rtl`]:{direction:"rtl"},[`${r}-recording-icon`]:{width:e.fontSize,height:e.fontSize}}}},or=e=>{const{componentCls:t}=e,r=`${t}-copy`;return{[t]:{[`&${r}-rtl`]:{direction:"rtl"},[`${r}-copy`]:{fontSize:"inherit",[`&:not(${t}-copy-success)`]:{color:"inherit!important"}}}}},ir=e=>{const{componentCls:t}=e,r=`${t}-feedback`;return{[t]:{[`&${r}-rtl`]:{direction:"rtl"}}}},ar=e=>{const{componentCls:t,antCls:r,calc:n}=e;return{[t]:{[`&${t}-rtl`]:{direction:"rtl"},[`${r}-pagination-item-link`]:{width:e.controlHeightSM},[`${t}-variant-outlined`]:{paddingInline:f.unit(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadius,border:`${f.unit(e.lineWidth)} ${e.lineType}, ${e.colorBorderSecondary}`},[`${t}-variant-filled`]:{paddingInline:f.unit(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadius,backgroundColor:e.colorBorderSecondary,[`${t}-item`]:{paddingInline:f.unit(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,"&:hover":{color:e.colorTextSecondary,background:"transparent"}}},[`${t}-list-danger`]:{color:e.colorError},[`&${t}-item,${t}-item`]:{cursor:"pointer",fontSize:e.fontSize,paddingInline:f.unit(n(e.paddingXXS).add(1).equal()),paddingBlock:e.paddingXXS,borderRadius:e.borderRadiusSM,height:e.controlHeightSM,boxSizing:"border-box",display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeight,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`${t}-icon`]:{display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:e.fontSize},"&:hover":{background:e.colorBgTextHover}},[`&${t}-list,${t}-list`]:{display:"inline-flex",flexDirection:"row",alignItems:"center",color:e.colorText,gap:e.paddingXS}}}},lr=()=>({}),tt=Ve("Actions",e=>{const t=f.merge(e,{});return[ar(t),or(t),ir(t),sr(t),Jn(t),Qn(t)]},lr);let De=function(e){return e.LOADING="loading",e.ERROR="error",e.RUNNING="running",e.DEFAULT="default",e}({});const bn=e=>{const{status:t="default",defaultIcon:r,runningIcon:n,label:o,className:i,classNames:a={},styles:l={},style:c,prefixCls:d,rootClassName:u,...m}=e,g=f._default(m,{attr:!0,aria:!0,data:!0}),{direction:p,getPrefixCls:y}=pe(),b=y("actions",d),[S,x]=tt(b),$=`${b}-button-item`,E=I($,S,x,u,i,a.root,b,`${b}-item`,{[`${$}-rtl`]:p==="rtl",[`${a[t]}`]:a[t]}),B={[De.LOADING]:s.createElement(le.LoadingOutlined,null),[De.ERROR]:s.createElement(le.CloseCircleOutlined,null),[De.RUNNING]:n,[De.DEFAULT]:r},j=t&&B[t]?B[t]:r;return s.createElement(se.Tooltip,{title:o},s.createElement("div",f._extends({},g,{className:E,style:{...c,...l.root,...l==null?void 0:l[t]}}),j))},cr=e=>{const{status:t=De.DEFAULT,className:r,style:n,prefixCls:o,rootClassName:i,classNames:a={},styles:l={},...c}=e,{direction:d,getPrefixCls:u}=pe(),m=u("actions",o),[g,p]=tt(m),y=`${m}-audio`,b=I(m,y,g,p,i,r,a.root,{[`${y}-rtl`]:d==="rtl",[`${y}-${t}`]:t}),[S]=ze("Actions",we.Actions),x={[De.LOADING]:S.audioLoading,[De.ERROR]:S.audioError,[De.RUNNING]:S.audioRunning,[De.DEFAULT]:S.audio};return s.createElement(bn,f._extends({label:t?x[t]:"",style:n,styles:l,classNames:{...a,root:b},status:t,defaultIcon:s.createElement(le.MutedOutlined,null),runningIcon:s.createElement(fn,{className:`${y}-recording-icon`})},c))},{Text:dr}=se.Typography,ur=e=>{const{text:t="",icon:r,className:n,style:o,prefixCls:i,rootClassName:a,classNames:l={},styles:c={},...d}=e,u=f._default(d,{attr:!0,aria:!0,data:!0}),{direction:m,getPrefixCls:g}=pe(),p=g("actions",i),[y,b]=tt(p),S=`${p}-copy`,x=I(p,`${p}-item`,y,b,a,n,l.root,{[`${S}-rtl`]:m==="rtl"});return s.createElement(dr,f._extends({},u,{className:x,style:{...o,...c.root},prefixCls:S,copyable:{text:t,icon:r}}))};var ve=function(e){return e.like="like",e.dislike="dislike",e.default="default",e}(ve||{});const mr=e=>{const{value:t="default",onChange:r,className:n,style:o,classNames:i={},styles:a={},prefixCls:l,rootClassName:c,...d}=e,u=f._default(d,{attr:!0,aria:!0,data:!0}),[m]=ze("Actions",we.Actions),{direction:g,getPrefixCls:p}=pe(),y=p("actions",l),[b,S]=tt(y),x=`${y}-feedback`,$=I(y,x,b,S,c,i.root,`${y}-list`,n,{[`${x}-rtl`]:g==="rtl"}),E=()=>r==null?void 0:r(t===ve.dislike?ve.default:ve.dislike);return s.createElement("div",f._extends({},u,{className:$,style:{...o,...a.root}}),[ve.default,ve.like].includes(t)&&s.createElement(se.Tooltip,{title:m.feedbackLike},s.createElement("span",{onClick:()=>r==null?void 0:r(t===ve.like?ve.default:ve.like),style:{...a.like,...t==="like"?a.liked:{}},className:I(`${x}-item`,`${y}-item`,`${x}-item-like`,i.like,{[`${i.liked}`]:i.liked&&t==="like",[`${x}-item-like-active`]:t==="like"})},t===ve.like?s.createElement(le.LikeFilled,null):s.createElement(le.LikeOutlined,null))),[ve.default,ve.dislike].includes(t)&&s.createElement(se.Tooltip,{title:m.feedbackDislike},s.createElement("span",{onClick:E,style:{...a.dislike,...t==="dislike"?a.disliked:{}},className:I(`${x}-item`,`${y}-item`,`${x}-item-dislike`,i.dislike,{[`${i.disliked}`]:i.disliked&&t==="like",[`${x}-item-dislike-active`]:t==="dislike"})},t===ve.dislike?s.createElement(le.DislikeFilled,null):s.createElement(le.DislikeOutlined,null))))},Pt=s.createContext(null),Je=(e,t)=>{const r=e[0];for(const n of t){if(!n)return null;if(n.key===r){if(e.length===1)return n;if(n.subItems)return Je(e.slice(1),n==null?void 0:n.subItems)}}return null},fr=e=>{const{onClick:t,item:r,dropdownProps:n={}}=e,{prefixCls:o,classNames:i={},styles:a={}}=s.useContext(Pt)||{},{subItems:l=[],triggerSubMenuAction:c="hover"}=r,d=(r==null?void 0:r.icon)??s.createElement(le.EllipsisOutlined,null),u={items:l,onClick:({key:m,keyPath:g,domEvent:p})=>{var y,b,S;if((y=Je(g,l))!=null&&y.onItemClick){(S=(b=Je(g,l))==null?void 0:b.onItemClick)==null||S.call(b,Je(g,l));return}t==null||t({key:m,keyPath:[...g,(r==null?void 0:r.key)||""],domEvent:p,item:Je(g,l)})}};return s.createElement(se.Dropdown,f._extends({menu:u,trigger:[c]},n,{className:I(`${o}-dropdown`,i.itemDropdown,n==null?void 0:n.className),styles:{root:a.itemDropdown,...n==null?void 0:n.styles}}),s.createElement("div",{className:I(`${o}-item`,`${o}-sub-item`,i==null?void 0:i.item),style:a==null?void 0:a.item},s.createElement("div",{className:`${o}-icon`},d)))},pr=e=>{const{item:t,onClick:r,dropdownProps:n={}}=e,{prefixCls:o,classNames:i={},styles:a={}}=s.useContext(Pt)||{},l=s.useId(),c=(t==null?void 0:t.key)||l;return t?t.actionRender?typeof t.actionRender=="function"?t.actionRender(t):t.actionRender:t.subItems?s.createElement(fr,{key:c,item:t,onClick:r,dropdownProps:n}):s.createElement("div",{className:I(`${o}-item`,i.item,{[`${o}-list-danger`]:t==null?void 0:t.danger}),style:a.item,onClick:d=>{if(t!=null&&t.onItemClick){t.onItemClick(t);return}r==null||r({key:c,item:t,keyPath:[c],domEvent:d})},key:c},s.createElement(se.Tooltip,{title:t.label},s.createElement("div",{className:`${o}-icon`},t==null?void 0:t.icon))):null},gr=s.forwardRef((e,t)=>{const{items:r=[],onClick:n,dropdownProps:o={},fadeIn:i,fadeInLeft:a,variant:l="borderless",prefixCls:c,classNames:d={},rootClassName:u="",className:m="",styles:g={},style:p={},...y}=e,b=f._default(y,{attr:!0,aria:!0,data:!0}),{getPrefixCls:S,direction:x}=pe(),$=S("actions",c),E=Ne("actions"),[B,j]=tt($),W=S(),G=i||a?`${W}-x-fade${a?"-left":""}`:"",R=I($,E.className,E.classNames.root,u,m,d.root,j,B,{[`${$}-rtl`]:x==="rtl"}),D={...E.style,...g.root,...p},P=s.useRef(null);return et(t,()=>({nativeElement:P.current})),s.createElement(f.CSSMotion,{motionName:G},({className:M},T)=>s.createElement("div",f._extends({ref:f.composeRef_1(P,T)},b,{className:R,style:D}),s.createElement(Pt.Provider,{value:{prefixCls:$,classNames:{item:I(E.classNames.item,d.item),itemDropdown:I(E.classNames.itemDropdown,d.itemDropdown)},styles:{item:{...E.styles.item,...g.item},itemDropdown:{...E.styles.itemDropdown,...g.itemDropdown}}}},s.createElement("div",{className:I(`${$}-list`,`${$}-variant-${l}`,M)},r.map((Y,U)=>s.createElement(pr,{item:Y,onClick:n,dropdownProps:o,key:Y.key||U}))))))}),He=gr;process.env.NODE_ENV!=="production"&&(He.displayName="Actions");He.Feedback=mr;He.Copy=ur;He.Item=bn;He.Audio=cr;const Cn=s.createContext({});function hr(e){const t=getComputedStyle(e).display;return t==="block"||t==="flex"||t==="list-item"||t==="table"}function yr(e){var n;const t=[""],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);for(;r.nextNode();){const o=r.currentNode;if(o.nodeType===Node.TEXT_NODE){t[t.length-1]+=o.textContent;continue}o.tagName==="BR"&&((n=o.parentNode)==null?void 0:n.childElementCount)===1||(o.tagName==="BR"||hr(o))&&t.push("")}return t.join(`
`)}const br=({content:e,prefixCls:t,okText:r,cancelText:n,onEditConfirm:o,onEditCancel:i})=>{const a=s.useRef(null),[l]=ze("Bubble",we.Bubble),c=f.useEvent(()=>{o==null||o(yr(a.current))}),d=f.useEvent(()=>i==null?void 0:i());if(s.useEffect(()=>{a.current.textContent=e,a.current.focus();const m=window.getSelection(),g=document.createRange();g.selectNodeContents(a.current),g.collapse(!1),m.removeAllRanges(),m.addRange(g)},[]),typeof e!="string")throw new Error("Content of editable Bubble should be string");const u=s.useMemo(()=>s.createElement("div",{ref:a,contentEditable:!0}),[]);return s.createElement(s.Fragment,null,u,s.createElement(se.Flex,{rootClassName:`${t}-editing-opts`,gap:8},s.createElement(se.Button,{type:"primary",shape:"round",size:"small",onClick:c},r||l.editableOk),s.createElement(se.Button,{type:"text",shape:"round",size:"small",onClick:d},n||l.editableCancel)))},Cr=({prefixCls:e})=>s.createElement("span",{className:`${e}-dot`},s.createElement("i",{className:`${e}-dot-item`,key:"item-1"}),s.createElement("i",{className:`${e}-dot-item`,key:"item-2"}),s.createElement("i",{className:`${e}-dot-item`,key:"item-3"})),Sr=new f.Keyframe("loadingMove",{"0%":{transform:"translateY(0)"},"10%":{transform:"translateY(4px)"},"20%":{transform:"translateY(0)"},"30%":{transform:"translateY(-4px)"},"40%":{transform:"translateY(0)"}}),xr=new f.Keyframe("cursorBlink",{"0%":{opacity:1},"50%":{opacity:0},"100%":{opacity:1}}),vr=new f.Keyframe("fadeIn",{"0%":{opacity:0},"100%":{opacity:1}}),$r=e=>{const{componentCls:t,fontSize:r,typingContent:n,typingAnimationDuration:o,typingAnimationName:i,lineHeight:a,paddingSM:l,colorText:c,calc:d}=e;return[{[t]:{display:"flex",columnGap:l,[`&${t}-rtl`]:{direction:"rtl"},[`&${t}-loading`]:{alignItems:"center"},[`${t}-body`]:{display:"flex",flexDirection:"column",maxWidth:"100%"},[`${t}-content`]:{position:"relative",boxSizing:"border-box",minWidth:0,maxWidth:"100%",minHeight:d(l).mul(2).add(d(a).mul(r)).equal(),paddingInline:`${f.unit(e.padding)}`,paddingBlock:`${f.unit(l)}`,color:c,fontSize:e.fontSize,lineHeight:e.lineHeight,wordBreak:"break-word","&-string":{whiteSpace:"pre-wrap"}},[`${t}-typing:last-child::after`]:{content:n,fontWeight:900,userSelect:"none",opacity:1,marginInlineStart:"0.1em",animationName:i,animationDuration:f.unit(o),animationIterationCount:"infinite",animationTimingFunction:"linear"},[`${t}-fade-in .fade-in`]:{display:"inline",animationName:vr,animationDuration:"1s",animationTimingFunction:"linear"},[`${t}-dot`]:{position:"relative",height:e.controlHeight,display:"flex",alignItems:"center",columnGap:e.marginXS,padding:`0 ${f.unit(e.paddingXXS)}`,alignSelf:"center","&-item":{backgroundColor:e.colorPrimary,borderRadius:"100%",width:4,height:4,animationName:Sr,animationDuration:"2s",animationIterationCount:"infinite",animationTimingFunction:"linear","&:nth-child(1)":{animationDelay:"0s"},"&:nth-child(2)":{animationDelay:"0.2s"},"&:nth-child(3)":{animationDelay:"0.4s"}}},[`&${t}-start`]:{flexDirection:"row",[`& ${t}-header`]:{flexDirection:"row"}},[`&${t}-end`]:{flexDirection:"row-reverse",justifySelf:"flex-end",[`& ${t}-header`]:{flexDirection:"row-reverse"},[`& ${t}-editing-opts`]:{flexDirection:"row-reverse"}}}},xr]},Er=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-content`]:{"&-filled":{backgroundColor:e.colorFillContent},"&-outlined":{border:`1px solid ${e.colorBorderSecondary}`},"&-shadow":{boxShadow:e.boxShadowTertiary},"&-borderless":{backgroundColor:"transparent",padding:0,minHeight:0}}}}},wr=e=>{const{componentCls:t,fontSize:r,lineHeight:n,paddingSM:o,borderRadius:i,calc:a}=e,l=a(r).mul(n).div(2).add(o).equal(),c=a(i).mul(2).equal(),d=`${t}-content`;return{[t]:{[d]:{"&-default":{borderRadius:{_skip_check_:!0,value:c}},"&-round":{borderRadius:{_skip_check_:!0,value:l}},"&-corner":{borderRadius:{_skip_check_:!0,value:c}},"&-editing":{"div:first-child":{outline:"none"},[`${t}-editing-opts`]:{marginBlockStart:e.marginSM,"button:last-child":{backgroundColor:e.colorBgContainer,"&:hover":{backgroundColor:e.colorBgLayout}}}}},[`&${t}-start ${t}-content-corner`]:{borderStartStartRadius:e.borderRadiusXS},[`&${t}-end ${t}-content-corner`]:{borderStartEndRadius:e.borderRadiusXS}}}},Nr=e=>{const{componentCls:t}=e;return{[t]:{"&-divider":{width:"100%",justifyContent:"center",[`& ${t}-body`]:{width:"100%"}}}}},Rr=e=>{const{componentCls:t,padding:r}=e;return{[`${t}-list`]:{gap:r,maxHeight:"100%",width:"100%",boxSizing:"border-box",[`& ${t}`]:{width:"100%",boxSizing:"border-box",paddingBlock:e.padding},[`& ${t}-start:not(${t}-divider):not(${t}-system)`]:{paddingInlineEnd:"15%"},[`& ${t}-end:not(${t}-divider):not(${t}-system)`]:{paddingInlineStart:"15%"},[`${t}-list-scroll-box`]:{overflowY:"auto",display:"flex",alignItems:"center",width:"100%",scrollbarWidth:"thin",maxHeight:"100%",flexDirection:"column",boxSizing:"border-box",paddingInline:e.paddingXS,scrollbarColor:`${e.colorTextTertiary} transparent`,"&::-webkit-scrollbar":{width:8,backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:e.colorTextTertiary,borderRadius:e.borderRadiusSM}},[`${t}-list-autoscroll`]:{flexDirection:"column-reverse"}}}},Tr=e=>{const{componentCls:t,fontSize:r,lineHeight:n,paddingXXS:o,margin:i,colorText:a,fontSizeLG:l,calc:c}=e;return{[t]:{[`${t}-header`]:{display:"flex",marginBottom:o,fontSize:r,lineHeight:n,color:a},[`${t}-footer`]:{display:"flex",marginBlockStart:i,fontSize:r,lineHeight:n,color:a,"&-start":{flexDirection:"row"},"&-end":{flexDirection:"row-reverse"}},[`${t}-avatar`]:{minWidth:c(l).mul(2).equal()}}}},Mr=e=>{const{componentCls:t,paddingSM:r,paddingXS:n,lineHeight:o,fontSize:i,fontSizeSM:a,calc:l}=e;return{[t]:{[`&${t}-system`]:{width:"100%",justifyContent:"center",[`${t}-content`]:{display:"flex",gap:`${f.unit(a)}`,alignItems:"center",minHeight:l(n).mul(2).add(l(o).mul(i)).equal(),fontSize:`${f.unit(i)}`,paddingInline:`${f.unit(r)}`,paddingBlock:`${f.unit(n)}`},[`${t}-system-content`]:{},[`${t}-system-extra`]:{}}}}},Ir=()=>({typingContent:'"|"',typingAnimationName:"cursorBlink",typingAnimationDuration:"0.8s"}),ht=Ve("Bubble",e=>{const t=f.merge(e,{});return[$r(t),Er(t),wr(t),Tr(t),Rr(t),Mr(t),Nr(t)]},Ir);function Dr(e){return!e||e.length===0?"":e.reduce((t,r)=>{let n=0;for(;n<t.length&&n<r.length&&t[n]===r[n];)n++;return t.slice(0,n)})}function Ar({streaming:e,content:t,typing:r,onTyping:n,onTypingComplete:o}){const[i,a]=s.useState([]),l=s.useRef(!1),c=s.useRef(""),d=s.useRef(1),u=s.useRef(-1),m=s.useRef(e);m.current=e;const g=s.useMemo(()=>{const x={effect:"fade-in",interval:100,step:6,keepPrefix:!0};if(r===!0)return x;const{step:$=6,interval:E=100}=r,B=j=>typeof j=="number";if(!B(E)||E<=0)throw"[Bubble] invalid prop typing.interval, expect positive number.";if(!B($)&&!Array.isArray($))throw"[Bubble] invalid prop typing.step, expect positive number or positive number array";if(B($)&&$<=0)throw"[Bubble] invalid prop typing.step, expect positive number";if(Array.isArray($)){if(!B($[0])||$[0]<=0)throw"[Bubble] invalid prop typing.step[0], expect positive number";if(!B($[1])||$[1]<=0)throw"[Bubble] invalid prop typing.step[1], expect positive number";if($[0]>$[1])throw"[Bubble] invalid prop typing.step, step[0] should less than step[1]"}return{...x,...r}},[r]),p=s.useRef({content:t,interval:g.interval,step:g.step});p.current={content:t,interval:g.interval,step:g.step};const y=()=>Math.random().toString().slice(2),b=s.useCallback(x=>{let $=0;c.current=g.keepPrefix?Dr([p.current.content,c.current]):"",a(c.current?[{text:c.current,id:y(),taskId:x,done:!0}]:[]);const E=()=>{if(x!==d.current)return;const B=performance.now(),{content:j,interval:W,step:G}=p.current;if(B-$<W){u.current=requestAnimationFrame(E);return}const R=c.current.length,D=typeof G=="number"?G:Math.floor(Math.random()*(G[1]-G[0]))+G[0],P=j.slice(R,R+D);if(!P){if(m.current){u.current=requestAnimationFrame(E);return}a(T=>[{text:T.map(({text:Y})=>Y).join(""),id:y(),taskId:x,done:!0}]),o==null||o(j),l.current=!1,d.current++;return}c.current+=P;const M={id:y(),text:P,taskId:x,done:!1};a(T=>T.concat(M)),l.current||(l.current=!0),$=B,u.current=requestAnimationFrame(E),n==null||n(c.current,j)};E()},[g.keepPrefix,n,o]),S=s.useCallback(()=>{cancelAnimationFrame(u.current),a([]),c.current="",l.current=!1},[]);return f.useLayoutEffect(()=>{if(!t)return S();t!==c.current&&(l.current&&!t.startsWith(c.current)?(cancelAnimationFrame(u.current),l.current=!1,requestAnimationFrame(()=>b(++d.current))):l.current===!1&&b(d.current))},[t,b]),{renderedData:i,animating:l.current,memoedAnimationCfg:g}}const Pr=({prefixCls:e,streaming:t,content:r,typing:n,onTyping:o,onTypingComplete:i})=>{const{renderedData:a,animating:l,memoedAnimationCfg:c}=Ar({streaming:t,content:r,typing:n,onTyping:o,onTypingComplete:i}),{effect:d}=c,u=a.map(g=>d==="fade-in"&&!g.done?s.createElement("span",{key:g.id,className:"fade-in"},g.text):g.text),m=n===!0?!1:d==="typing";return s.createElement("div",{className:I({[`${e}-typing`]:m&&l,[`${e}-fade-in`]:!m})},u)},_r=({prefixCls:e,rootClassName:t,style:r,className:n,styles:o={},classNames:i={},placement:a="start",content:l,contentRender:c,editable:d=!1,typing:u,streaming:m=!1,variant:g="filled",shape:p="default",header:y,footer:b,avatar:S,extra:x,footerPlacement:$,loading:E,loadingRender:B,onTyping:j,onTypingComplete:W,onEditConfirm:G,onEditCancel:R,...D},P)=>{const M=s.useRef(null);s.useImperativeHandle(P,()=>({nativeElement:M.current}));const T=Ne("bubble"),{direction:Y,getPrefixCls:U}=pe(),q=U("bubble",e),_=s.useContext(Cn),[K,Q]=ht(q),k={...T.style,...T.styles.root,...o.root,...r},X=I(q,T.className,T.classNames.root,i.root,t,n,K,Q,`${q}-${a}`,{[`${q}-${_.status}`]:_.status,[`${q}-rtl`]:Y==="rtl",[`${q}-loading`]:E}),z=f._default(D,{attr:!0,aria:!0,data:!0}),V={key:_==null?void 0:_.key,status:_==null?void 0:_.status,extraInfo:_==null?void 0:_.extraInfo},F=s.useMemo(()=>c?c(l,V):l,[l,c,V.key,V.status,V.extraInfo]),oe=typeof u=="function"?u(l,V):u,ee=!!oe&&typeof F=="string";s.useEffect(()=>{ee||m||l&&(W==null||W(l))},[F,ee,m]);const v=$||(a==="start"?"outer-start":"outer-end"),re=typeof d=="boolean"?d:d.editing,te=()=>{if(E)return B?B():s.createElement(Cr,{prefixCls:q});const ue=s.createElement(s.Fragment,null,ee?s.createElement(Pr,{prefixCls:q,streaming:m,typing:oe,content:F,onTyping:j,onTypingComplete:W}):F),Pe=v.includes("inner");return s.createElement("div",{className:Z("body"),style:ae("body")},Ae(),s.createElement("div",{style:{...T.styles.content,...o.content},className:I(`${q}-content`,`${q}-content-${g}`,T.classNames.content,i.content,{[`${q}-content-${_==null?void 0:_.status}`]:_==null?void 0:_.status,[`${q}-content-${p}`]:g!=="borderless",[`${q}-content-editing`]:re,[`${q}-content-string`]:typeof F=="string"})},re?s.createElement(br,{prefixCls:q,content:l,okText:d==null?void 0:d.okText,cancelText:d==null?void 0:d.cancelText,onEditConfirm:G,onEditCancel:R}):s.createElement(s.Fragment,null,Pe?s.createElement("div",{className:I(`${q}-content-with-footer`)},ue):ue,Pe&&Se())),!re&&!Pe&&Se())},Z=ue=>I(`${q}-${ue}`,T.classNames[ue],i[ue]),ae=ue=>({...T.styles[ue],...o[ue]}),ce=ue=>typeof ue=="function"?ue(l,V):ue,Ce=()=>S?s.createElement("div",{className:Z("avatar"),style:ae("avatar")},ce(S)):null,ye=()=>x?s.createElement("div",{className:Z("extra"),style:ae("extra")},ce(x)):null,Ae=()=>y?s.createElement("div",{className:Z("header"),style:ae("header")},ce(y)):null,Se=()=>{if(!b)return null;const ue=I(Z("footer"),{[`${q}-footer-start`]:v.includes("start"),[`${q}-footer-end`]:v.includes("end")});return s.createElement("div",{className:ue,style:ae("footer")},ce(b))};return s.createElement("div",f._extends({className:X,style:k},D,z,{ref:M}),Ce(),te(),!re&&!E&&ye())},Oe=s.forwardRef(_r);process.env.NODE_ENV!=="production"&&(Oe.displayName="Bubble");const Br=({prefixCls:e,content:t="",rootClassName:r,style:n,className:o,styles:i={},classNames:a={},dividerProps:l,...c},d)=>{const{getPrefixCls:u}=pe(),m=Ne("bubble"),g=u("bubble",e),[p,y]=ht(g),b=I(p,y,g,`${g}-divider`,m.className,m.classNames.root,o,a.root,r),S=x=>s.createElement(se.Divider,l,x);return s.createElement(Oe,f._extends({ref:d,style:n,styles:i,className:b,classNames:a,prefixCls:g,variant:"borderless",content:t,contentRender:S},c))},_t=s.forwardRef(Br);process.env.NODE_ENV!=="production"&&(_t.displayName="DividerBubble");function Hr(e){const t=s.useRef(null),r=s.useRef(!0),n=s.useRef(!1),o=s.useRef(0),i=s.useRef(void 0),a=s.useRef(!1),l=!e||getComputedStyle(e).flexDirection!=="column-reverse";s.useEffect(()=>{if(l)return;if(!t.current){const p=document.createElement("div");p.style.bottom="0",p.style.flexShrink="0",p.style.pointerEvents="none",p.style.height="10px",p.style.visibility="hidden",e.insertBefore(p,e.firstChild),t.current=p}const m=new IntersectionObserver(([p])=>{r.current=p.isIntersecting,n.current=!p.isIntersecting},{root:e,threshold:0});m.observe(t.current);const g=new MutationObserver(()=>{n.current&&!l&&d()});return g.observe(e,{childList:!0,subtree:!0,attributes:!1}),()=>{m.disconnect(),g.disconnect(),clearTimeout(i.current),t.current&&t.current.parentNode&&(t.current.parentNode.removeChild(t.current),t.current=null)}},[e,l]);const c=s.useCallback(()=>{const{scrollTop:m,scrollHeight:g}=e;if(o.current=g+m,a.current){a.current=!1;return}i.current&&clearTimeout(i.current),i.current=setTimeout(()=>{clearTimeout(i.current),i.current=void 0},50)},[e]);s.useEffect(()=>(l||e.addEventListener("scroll",c,{capture:!0}),()=>e==null?void 0:e.removeEventListener("scroll",c,{capture:!0})),[e,l,c]);const d=s.useCallback(()=>{if(i.current)return;const m=o.current-e.scrollHeight;e.scrollTop=m,a.current=!0},[e]);return{reset:s.useCallback(()=>{l||(r.current=!0,n.current=!1,o.current=e.scrollHeight)},[e,l])}}const Or=({prefixCls:e,content:t,variant:r="shadow",shape:n,style:o,className:i,styles:a={},classNames:l={},rootClassName:c,...d},u)=>{const m=Ne("bubble"),{getPrefixCls:g}=pe(),p=g("bubble",e),[y,b]=ht(p),S=`${p}-system`,x=I(y,b,S,p,m.className,m.classNames.root,l.root,i,c);return s.createElement(Oe,f._extends({ref:u,style:o,className:x,styles:a,classNames:l,variant:r,shape:n,content:t},d))},Bt=s.forwardRef(Or);process.env.NODE_ENV!=="production"&&(Bt.displayName="SystemBubble");function Lr(e){return typeof e=="function"&&e instanceof Function}const kr=A.memo(Oe),Xr=A.memo(_t),zr=A.memo(Bt),Fr=e=>{const{_key:t,bubblesRef:r,extraInfo:n,status:o,role:i,classNames:a={},styles:l={},...c}=e,d=A.useCallback(E=>{E?r.current[t]=E:delete r.current[t]},[t]),{bubble:u,divider:m,system:g,...p}=a,{bubble:y,divider:b,system:S,...x}=l;let $=A.createElement(kr,f._extends({ref:d,style:y,className:u,classNames:p,styles:x},c));return i==="divider"?$=A.createElement(Xr,f._extends({ref:d,style:b,className:m,classNames:p,styles:x},c)):i==="system"&&($=A.createElement(zr,f._extends({ref:d,style:S,className:g,classNames:p,styles:x},c))),A.createElement(Cn.Provider,{value:{key:t,status:o,extraInfo:n}},$)},Kr=(e,t)=>{var M;const{prefixCls:r,rootClassName:n,className:o,styles:i={},classNames:a={},style:l,items:c,autoScroll:d=!0,role:u,onScroll:m,...g}=e,p=f.pickAttrs(g,{attr:!0,aria:!0}),y=A.useRef(null),b=A.useRef(null),S=A.useRef({}),{reset:x}=Hr(d?b.current:null),{getPrefixCls:$}=pe(),E=$("bubble",r),B=`${E}-list`,[j,W]=ht(E),G=I(B,n,o,a.root,j,W),R={...i.root,...l},D=((M=c[c.length-1])==null?void 0:M.key)||c.length;A.useEffect(()=>{var T;b.current&&(x(),(T=b.current)==null||T.scrollTo({top:d?0:b.current.scrollHeight}))},[D,d,x]),et(t,()=>({nativeElement:y.current,scrollBoxNativeElement:b.current,scrollTo:({key:T,top:Y,behavior:U="smooth",block:q})=>{var Q,k,X;const{scrollHeight:_,clientHeight:K}=b.current;if(typeof Y=="number")(Q=b.current)==null||Q.scrollTo({top:d?-_+K+Y:Y,behavior:U});else if(Y==="bottom"){const z=d?0:_;(k=b.current)==null||k.scrollTo({top:z,behavior:U})}else if(Y==="top"){const z=d?-_:0;(X=b.current)==null||X.scrollTo({top:z,behavior:U})}else T&&S.current[T]&&S.current[T].nativeElement.scrollIntoView({behavior:U,block:q})}}));const P=d?[...c].reverse():c;return A.createElement("div",f._extends({},p,{className:G,style:R,ref:y}),A.createElement("div",{className:I(`${B}-scroll-box`,a.scroll,{[`${B}-autoscroll`]:d}),style:i.scroll,ref:b,onScroll:m},P.map(T=>{let Y;if(T.role&&u){const U=u[T.role];Y={...Lr(U)?U(T):U,...T}}else Y=T;return A.createElement(Fr,f._extends({classNames:a,styles:i},f.omit(Y,["key"]),{key:T.key,_key:T.key,bubblesRef:S}))})))},Sn=A.forwardRef(Kr);process.env.NODE_ENV!=="production"&&(Sn.displayName="BubbleList");Oe.List=Sn;Oe.System=Bt;Oe.Divider=_t;const qr=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-header`]:{display:"flex",alignItems:"center",justifyContent:"space-between",color:e.colorText,background:e.colorFillContent,padding:e.paddingSM,borderStartStartRadius:e.borderRadius,borderStartEndRadius:e.borderRadius},[`${t}-header-title`]:{fontSize:e.fontSize,fontWeight:e.fontWeightStrong},[`${t}-code`]:{borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,borderStartStartRadius:0,borderStartEndRadius:0,background:e.colorBgContainer,border:`1px solid ${e.colorBorderSecondary}`,borderTop:"none",overflow:"hidden","pre,code":{whiteSpace:"pre",fontSize:e.fontSize,fontFamily:e.fontFamilyCode,lineHeight:2,borderRadius:0,border:"none"},"code[class*='language-'],pre[class*='language-']":{background:"none"}},[`&${t}-rtl`]:{direction:"rtl"}}}},Vr=e=>({colorBgTitle:e.colorFillContent,colorBorderCode:e.colorBorderSecondary,colorTextTitle:e.colorText}),Wr=Ve("CodeHighlighter",e=>{const t=f.merge(e,{});return[qr(t)]},Vr),jr={...f.oneLight,'pre[class*="language-"]':{...f.oneLight['pre[class*="language-"]'],margin:0}},xn=s.forwardRef((e,t)=>{var j,W;const{lang:r,children:n,header:o,prefixCls:i,className:a,classNames:l={},styles:c={},style:d={},highlightProps:u,...m}=e,{getPrefixCls:g,direction:p}=pe(),y=g("codeHighlighter",i),[b,S]=Wr(y),x=Ne("codeHighlighter"),$=I(y,x.className,a,(j=x.classNames)==null?void 0:j.root,l.root,b,S,{[`${y}-rtl`]:p==="rtl"}),E={...x.style,...c==null?void 0:c.root,...d},B=()=>{var G,R,D,P;return o===null?null:o||s.createElement("div",{className:I(`${y}-header`,(G=x.classNames)==null?void 0:G.header,l.header),style:{...(R=x.styles)==null?void 0:R.header,...c.header}},s.createElement("span",{className:I(`${y}-header-title`,l.headerTitle,(D=x.classNames)==null?void 0:D.headerTitle),style:{...(P=x.styles)==null?void 0:P.headerTitle,...c.headerTitle}},r),s.createElement(He.Copy,{text:n}))};return n?r?s.createElement("div",f._extends({ref:t,className:$,style:E},m),B(),s.createElement("div",{className:I(`${y}-code`,(W=x.classNames)==null?void 0:W.code,l.code),style:{...x.styles.code,...c.code}},s.createElement(f.highlighter,f._extends({language:r,wrapLines:!0,style:jr},u),n.replace(/\n$/,"")))):s.createElement("code",null,n):null});process.env.NODE_ENV!=="production"&&(xn.displayName="CodeHighlighter");const Nt=()=>({height:0,opacity:0}),Wt=e=>{const{scrollHeight:t}=e;return{height:t,opacity:1}},Ur=e=>({height:e?e.offsetHeight:0}),Rt=(e,t)=>(t==null?void 0:t.deadline)===!0||t.propertyName==="height",Gr=(e=Wn)=>({motionName:`${e}-motion-collapse`,onAppearStart:Nt,onEnterStart:Nt,onAppearActive:Wt,onEnterActive:Wt,onLeaveStart:Ur,onLeaveActive:Nt,onAppearEnd:Rt,onEnterEnd:Rt,onLeaveEnd:Rt,motionDeadline:500}),Yr=(e,t,r)=>{const n=typeof e=="boolean"||(e==null?void 0:e.expandedKeys)===void 0,[o,i,a,l]=s.useMemo(()=>{let g={expandedKeys:[],defaultExpandedKeys:[],onExpand:()=>{}};return e?(typeof e=="object"&&(g={...g,...e}),[!0,g.defaultExpandedKeys,g.expandedKeys,g.onExpand]):[!1,g.defaultExpandedKeys,g.expandedKeys,g.onExpand]},[e]),[c,d]=f._default$1(i||[],{value:n?void 0:a,onChange:l}),u=g=>{d(p=>{const y=n?p:a,b=y.includes(g)?y.filter(S=>S!==g):[...y,g];return l==null||l(b),b})},m=s.useMemo(()=>o?{...Gr(r),motionAppear:!1,leavedClassName:`${t}-content-hidden`}:{},[r,t,o]);return[o,c,o?u:void 0,m]},ke={Alt:["altKey","⌥","Alt"],Ctrl:["ctrlKey","⌃","Ctrl"],Meta:["metaKey","⌘","Win"],Shift:["shiftKey","⇧","Shift"]},Mt=Array.from({length:9},(e,t)=>f.default_1$1.ONE+t),jt=/(mac|iphone|ipod|ipad)/i.test(typeof navigator<"u"?navigator==null?void 0:navigator.platform:""),Ut=e=>{var t,r,n;return e==="number"?e:typeof e=="string"&&((t=ke==null?void 0:ke[e])!=null&&t[jt?1:2])?ke[e][jt?1:2]:((n=(r=Object.entries(f.default_1$1||{}))==null?void 0:r.find(([o,i])=>i===e))==null?void 0:n[0])||""},Zr=(e,t)=>{const r=[...e],n=r.pop();return r.reduce((a,l)=>{var c;return a&&(t[(c=ke==null?void 0:ke[l])==null?void 0:c[0]]||!1)},n===t.keyCode)?{actionShortcutKey:e,actionKeyCodeNumber:Mt.indexOf(t.keyCode)>-1?Mt.indexOf(t.keyCode):!1,actionKeyCode:t.keyCode,timeStamp:t.timeStamp}:!1},Jr=e=>{const t=[...e],r=t.pop();return{keyCodeDict:r==="number"?Mt:[r],prefixKeys:t}},Gt=(e,t,r)=>{const n=!!e.find(({shortcutKey:o})=>o.toString()===t.toString());gt(!n,r,`Same shortcutKey ${t.toString()}`)},Qr=(e,t,r)=>{const n=Object.assign({},t||{},r);return Object.keys(n).reduce(({flattenShortcutKeys:o,shortcutKeysInfo:i},a)=>{const l=n[a];if(!Array.isArray(l))return{flattenShortcutKeys:o,shortcutKeysInfo:i};if(i={...i,[a]:{shortcutKeys:l,shortcutKeysIcon:[]}},l.every(c=>Array.isArray(c)))l.forEach((c,d)=>{const u=c;Gt(o,u,e),o.push({name:a,shortcutKey:u,index:d}),i[a].shortcutKeysIcon.push(u==null?void 0:u.map(m=>Ut(m)))});else{const{keyCodeDict:c,prefixKeys:d}=Jr(l);c.forEach(u=>{Gt(o,[...d,u],e),o.push({name:a,shortcutKey:[...d,u]})}),i[a].shortcutKeysIcon=l.map(u=>Ut(u))}return{flattenShortcutKeys:o,shortcutKeysInfo:i}},{flattenShortcutKeys:[],shortcutKeysInfo:{}})},es=()=>{const e=s.useRef(void 0);return[e,r=>{e.current=r}]},ts=(e,t)=>{const r=Ne(e),{flattenShortcutKeys:n,shortcutKeysInfo:o}=Qr(e,r.shortcutKeys,t),[i,a]=s.useState(null),[l,c]=es(),d=s.useRef(!1),u=g=>{var p;for(const y of n){const b=Zr(y.shortcutKey,g);if(b){const S={...b,name:y.name,index:y==null?void 0:y.index};if(d.current)return;d.current=!0,a(S),(p=l==null?void 0:l.current)==null||p.call(l,S)}}},m=()=>{d.current=!1};return s.useEffect(()=>{if(n.length!==0)return document.addEventListener("keydown",u),document.addEventListener("keyup",m),()=>{document.removeEventListener("keydown",u),document.addEventListener("keyup",m)}},[n.length,l]),[i,o,c]},Yt=({shortcutKeysIcon:e,prefixCls:t})=>{const[r]=ze("Conversations",we.Conversations),n=!!(e!=null&&e.length);return s.createElement("div",{className:I(t,{[`${t}-shortcut-keys-show`]:n})},s.createElement("span",null,r.create),n&&s.createElement("span",{className:I(`${t}-shortcut-keys`)},e.map(o=>s.createElement("span",{className:I(`${t}-shortcut-key`),key:o},o))))},ns=({icon:e,label:t,align:r,shortcutKeyInfo:n,prefixCls:o})=>{const{shortcutKeysIcon:i}=n||{},a={label:s.createElement(Yt,{prefixCls:`${o}-label`,shortcutKeysIcon:i}),icon:s.createElement(le.PlusOutlined,{className:`${o}-icon`}),align:"center"};return t&&(a.label=typeof t=="function"?t({shortcutKeyInfo:n,components:{CreationLabel:Yt}}):t),e&&(a.icon=typeof e=="function"?e():e),[a.icon,a.label,r||a.align]},vn=({className:e,icon:t,label:r,align:n,style:o,disabled:i,onClick:a,prefixCls:l,shortcutKeyInfo:c})=>{const[d,u,m]=ns({prefixCls:l,label:r,icon:t,align:n,shortcutKeyInfo:c});return A.createElement("button",{type:"button",onClick:g=>{i||a==null||a(g)},style:o,className:I(l,e,`${l}-${m}`,{[`${l}-disabled`]:i})},d,u)},$n=s.createContext(null),rs=({className:e,children:t})=>{var b;const{prefixCls:r,groupInfo:n,enableCollapse:o,expandedKeys:i,onItemExpand:a,collapseMotion:l}=s.useContext($n)||{},{label:c,name:d,collapsible:u}=n||{},m=typeof c=="function"?c(d,{groupInfo:n}):c||d,g=u&&o,p=()=>{g&&(a==null||a(n.name))},y=g&&!!((b=i==null?void 0:i.includes)!=null&&b.call(i,d));return s.createElement("li",{className:e},s.createElement("div",{className:I(`${r}-group-title`,{[`${r}-group-title-collapsible`]:g}),onClick:p},m&&s.createElement("div",{className:I(`${r}-group-label`)},m),g&&s.createElement("div",{className:I(`${r}-group-collapse-trigger `,`${r}-group-collapse-trigger-${y?"open":"close"}`)},s.createElement(le.RightOutlined,null))),s.createElement(f.CSSMotion,f._extends({},l,{visible:g?y:!0}),({className:S,style:x},$)=>s.createElement("div",{className:I(S),ref:$,style:x},t)))},ss=(e,t=[])=>{const[r,n,o]=s.useMemo(()=>{let i={label:"",collapsibleHandle:!1,collapsibleOptions:{}};if(!e)return["",i.collapsibleHandle,i.collapsibleOptions];if(typeof e=="object"){const{collapsible:a,defaultExpandedKeys:l,expandedKeys:c,onExpand:d,...u}=e;i={...i,...u,collapsibleHandle:a,collapsibleOptions:{defaultExpandedKeys:l,expandedKeys:c,onExpand:d}}}return[i.label,i.collapsibleHandle,i.collapsibleOptions]},[e]);return s.useMemo(()=>{const i=t.reduce((l,c)=>{if((c==null?void 0:c.type)==="divider"||!c.group||!e)return l.push({data:[c],name:"",label:"",enableGroup:!1,collapsible:!1}),l;const d=c,u=l.some((g,p)=>g.name===(d==null?void 0:d.group)?(l[p].data.push(d),!0):!1),m=typeof n=="function"?n==null?void 0:n(d==null?void 0:d.group):n;return u||l.push({data:[d],enableGroup:!0,name:d==null?void 0:d.group,label:r,collapsible:m}),l},[]),a=i.reduce((l,c)=>(c.data.forEach(d=>{d.type!=="divider"&&l.push({key:d.key,disabled:d.disabled})}),l),[]);return[i,o,a]},[t,o])},Zt=e=>{e.stopPropagation()},os=e=>{const{prefixCls:t,info:r,className:n,direction:o,onClick:i,active:a,menu:l,...c}=e,d=f._default(c,{aria:!0,data:!0,attr:!0}),{disabled:u}=r,m=I(n,`${t}-item`,{[`${t}-item-active`]:a&&!u},{[`${t}-item-disabled`]:u}),g=()=>{!u&&i&&i(r.key)},{trigger:p,...y}=l||{},b=y==null?void 0:y.getPopupContainer,S=x=>{const $=s.createElement(le.EllipsisOutlined,{onClick:Zt,className:`${t}-menu-icon`});return p?typeof p=="function"?p(x,{originNode:$}):p:$};return s.createElement("li",f._extends({title:typeof r.label=="object"?void 0:`${r.label}`},d,{className:m,onClick:g}),r.icon&&s.createElement("div",{className:`${t}-icon`},r.icon),s.createElement(se.Typography.Text,{className:`${t}-label`},r.label),!u&&l&&s.createElement("div",{onClick:Zt},s.createElement(se.Dropdown,{menu:y,placement:o==="rtl"?"bottomLeft":"bottomRight",trigger:["click"],disabled:u,getPopupContainer:b},S(r))))},is=e=>{const{componentCls:t,calc:r}=e;return{[t]:{display:"flex",flexDirection:"column",gap:e.paddingXXS,overflowY:"auto",padding:e.paddingSM,margin:0,listStyle:"none","ul, ol":{margin:0,padding:0,listStyle:"none"},[`&${t}-rtl`]:{direction:"rtl"},[`${t}-creation`]:{backgroundColor:e.creationBgColor,color:e.colorPrimary,border:"none",fontWeight:500,paddingBlock:e.paddingXS,paddingInline:e.paddingSM,fontSize:e.fontSize,cursor:"pointer",display:"flex",gap:e.paddingXS,marginBlockEnd:e.marginSM,lineHeight:e.lineHeight,borderRadius:e.borderRadiusLG,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`&:not(${t}-creation-disabled):hover`]:{color:e.colorPrimary,background:e.creationHoverColor},[`&:not(${t}-creation-disabled)`]:{border:`${f.unit(e.lineWidth)} ${e.lineType}, ${e.creationBorderColor}`},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-label":{display:"flex",justifyContent:"space-between",alignItems:"center"},"&-label-shortcut-keys-show":{flex:1},"&-label-shortcut-keys":{height:e.controlHeightXS,display:"flex",alignItems:"center",gap:f.unit(4)},"&-label-shortcut-key":{borderRadius:e.borderRadiusSM,height:"100%",boxSizing:"border-box",fontSize:e.fontSizeIcon,paddingInline:`${f.unit(r(e.paddingXXS).sub(1).equal())}`,display:"flex",justifyContent:"center",alignItems:"center",color:e.shortcutKeyTextColor,border:`${f.unit(e.lineWidth)} ${e.lineType}, ${e.creationBorderColor}`},"&-disabled":{cursor:"not-allowed",background:e.colorBgContainerDisabled,[`& ${t}-creation-label, ${t}-creation-icon`]:{color:e.colorTextDisabled},[`& ${t}-creation-label-shortcut-keys`]:{color:e.colorTextDisabled,border:`${f.unit(e.lineWidth)} ${e.lineType}, ${e.colorBgContainerDisabled}`}}},[`${t}-divider`]:{marginBlock:e.marginXXS},[`${t}-item`]:{display:"flex",height:e.controlHeightLG,minHeight:e.controlHeightLG,gap:e.paddingXS,padding:`0 ${f.unit(e.paddingXS)}`,alignItems:"center",borderRadius:e.borderRadiusLG,cursor:"pointer",transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,[`&:not(${t}-item-disabled):hover`]:{backgroundColor:e.colorBgTextHover},"&-active":{backgroundColor:e.colorBgTextHover,[`& ${t}-label, ${t}-menu-icon`]:{color:e.colorText}},"&-disabled":{cursor:"not-allowed",[`& ${t}-label, ${t}-icon, ${t}-menu-icon`]:{color:e.colorTextDisabled}},"&:hover, &-active":{[`& ${t}-menu-icon`]:{opacity:.6}},[`${t}-menu-icon:hover`]:{opacity:1}},[`${t}-content-hidden`]:{display:"none"},[`${t}-label`]:{flex:1,color:e.colorText,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},[`${t}-menu-icon`]:{opacity:0,fontSize:e.fontSizeXL},[`${t}-list`]:{display:"flex",gap:e.paddingXXS,flexDirection:"column"},[`${t}-group-collapsible-list`]:{paddingBlockStart:e.paddingXXS,[`& ${t}-item`]:{paddingInlineStart:e.paddingXL}},[`${t}-group-title`]:{display:"flex",alignItems:"center",color:e.colorTextDescription,height:e.controlHeightLG,minHeight:e.controlHeightLG,padding:`0 ${f.unit(e.paddingXS)}`},[`${t}-group-title-collapsible`]:{justifyContent:"space-between",cursor:"pointer",color:e.colorText,borderRadius:e.borderRadiusLG,transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,"&:hover":{backgroundColor:e.colorBgTextHover}},[`${t}-group-collapse-trigger`]:{transition:`all ${e.motionDurationMid} ${e.motionEaseInOut}`,transform:"rotate(0deg)",transformOrigin:"center center"},[`${t}-group-collapse-trigger-open`]:{transform:"rotate(90deg)"},[`${t}-group-collapse-trigger-close`]:{transform:"rotate(0deg)"}}}},as=e=>{const t=new f.FastColor(e.colorPrimary).setA(.15),r=new f.FastColor(e.colorPrimary).setA(.22),n=new f.FastColor(e.colorPrimary).setA(.25),o=new f.FastColor(e.colorPrimary).setA(.65);return{creationBgColor:t.toRgbString(),creationBorderColor:r.toRgbString(),creationHoverColor:n.toRgbString(),shortcutKeyTextColor:o.toRgbString()}},ls=Ve("Conversations",e=>{const t=f.merge(e,{});return[is(t),jn(t)]},as),cs=s.forwardRef((e,t)=>{const{prefixCls:r,shortcutKeys:n,rootClassName:o,items:i,activeKey:a,defaultActiveKey:l,onActiveChange:c,menu:d,styles:u={},classNames:m={},groupable:g,className:p,style:y,creation:b,...S}=e,x=f._default(S,{attr:!0,aria:!0,data:!0}),$=s.useRef(null);et(t,()=>({nativeElement:$.current}));const[E,B]=f._default$1(l,{value:a,onChange:v=>{v&&(c==null||c(v))}}),[j,W,G]=ss(g,i),{getPrefixCls:R,direction:D}=pe(),P=R("conversations",r),M=Ne("conversations"),[T,Y]=ls(P),U=I(P,M.className,M.classNames.root,p,m.root,o,T,Y,{[`${P}-rtl`]:D==="rtl"}),q=v=>{B(v)},[_,K,Q]=ts("conversations",n);Q(v=>{var re,te,Z;switch(v==null?void 0:v.name){case"items":{const ae=(v==null?void 0:v.actionKeyCodeNumber)??(v==null?void 0:v.index);typeof ae=="number"&&!((re=G==null?void 0:G[ae])!=null&&re.disabled)&&((te=G==null?void 0:G[ae])!=null&&te.key)&&B((Z=G==null?void 0:G[ae])==null?void 0:Z.key)}break;case"creation":typeof(b==null?void 0:b.onClick)=="function"&&!(b!=null&&b.disabled)&&b.onClick();break}});const X=v=>v.map((re,te)=>{if(re.type==="divider")return s.createElement(se.Divider,{key:`key-divider-${te}`,className:`${P}-divider`,dashed:re.dashed});const Z=re,{label:ae,disabled:ce,icon:Ce,...ye}=Z;return s.createElement(os,f._extends({},ye,{key:Z.key||`key-${te}`,info:Z,prefixCls:P,direction:D,className:I(m.item,M.classNames.item,Z.className),style:{...M.styles.item,...u.item,...Z.style},menu:typeof d=="function"?d(Z):d,active:E===Z.key,onClick:q}))}),z=R(),[V,F,oe,ee]=Yr(W,P,z);return s.createElement("ul",f._extends({},x,{style:{...M.style,...y,...M.styles.root,...u.root},className:U,ref:$}),!!b&&s.createElement(vn,f._extends({className:I(M.classNames.creation,m.creation),style:{...M.styles.creation,...u.creation},shortcutKeyInfo:K==null?void 0:K.creation,prefixCls:`${P}-creation`},b)),j.map((v,re)=>{const te=X(v.data);return v.enableGroup?s.createElement($n.Provider,{key:v.name||`key-${re}`,value:{prefixCls:P,groupInfo:v,enableCollapse:V,expandedKeys:F,onItemExpand:oe,collapseMotion:ee}},s.createElement(rs,{className:I(M.classNames.group,m.group)},s.createElement("ul",{className:I(`${P}-list`,{[`${P}-group-collapsible-list`]:v.collapsible}),style:{...M.styles.group,...u.group}},te))):te}))}),Ht=cs;process.env.NODE_ENV!=="production"&&(Ht.displayName="Conversations");Ht.Creation=vn;const ds=e=>{const{componentCls:t}=e;return{[t]:{[`${t}-header`]:{display:"flex",alignItems:"center",justifyContent:"space-between",background:e.colorBgTitle,color:e.colorTextTitle,padding:e.paddingSM,borderStartStartRadius:e.borderRadius,borderStartEndRadius:e.borderRadius},[`${t}-graph`]:{display:"flex",alignItems:"center",justifyContent:"center",border:`1px solid ${e.colorBgTitle}`,borderTop:"none",padding:e.paddingSM,background:e.colorBgContainer,overflow:"auto",borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,height:"400px"},[`${t}-graph-hidden`]:{display:"none"},[`${t}-graph svg`]:{maxWidth:"100%",maxHeight:"100%",height:"auto",width:"auto"},[`${t}-code`]:{borderEndEndRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,borderBottom:`1px solid ${e.colorBgTitle}`,borderInlineStart:`1px solid ${e.colorBgTitle}`,borderInlineEnd:`1px solid ${e.colorBgTitle}`,background:e.colorBgContainer,paddingInline:e.paddingSM,paddingBlock:e.paddingSM,overflow:"auto",height:"400px","pre,code":{whiteSpace:"pre",fontSize:e.fontSize,fontFamily:e.fontFamilyCode,lineHeight:2,borderRadius:0,border:"none"},"code[class*='language-'],pre[class*='language-']":{background:"none"}},[`&${t}-rtl`]:{direction:"rtl"}}}},us=e=>({colorBgTitle:e.colorFillContent,colorBorderCode:e.colorBorderSecondary,colorBorderGraph:e.colorBorderSecondary,colorTextTitle:e.colorText}),ms=Ve("Mermaid",e=>{const t=f.merge(e,{});return[ds(t)]},us);var $e=function(e){return e.Code="code",e.Image="image",e}($e||{});let fs=0;const ps=s.memo(e=>{var oe,ee;const{prefixCls:t,className:r,style:n,classNames:o={},styles:i={},header:a,children:l,highlightProps:c,onRenderTypeChange:d}=e,[u,m]=s.useState($e.Image),[g,p]=s.useState(1),[y,b]=s.useState({x:0,y:0}),[S,x]=s.useState(!1),[$,E]=s.useState({x:0,y:0}),B=s.useRef(null),j=`mermaid-${fs++}-${(l==null?void 0:l.length)||0}`;s.useEffect(()=>{wt.mermaid_default.initialize({startOnLoad:!1,securityLevel:"strict",theme:"default",fontFamily:"monospace"})},[]);const[W]=ze("Mermaid",we.Mermaid),{getPrefixCls:G,direction:R}=pe(),D=G("mermaid",t),[P,M]=ms(D),T=Ne("mermaid"),Y=I(D,T.className,(oe=T.classNames)==null?void 0:oe.root,r,o.root,P,M,{[`${D}-rtl`]:R==="rtl"}),U=f.throttle(async()=>{if(!(!l||!B.current||u===$e.Code))try{if(!await wt.mermaid_default.parse(l,{suppressErrors:!0}))throw new Error("Invalid Mermaid syntax");const re=l.replace(/[`\s]+$/g,""),{svg:te}=await wt.mermaid_default.render(j,re,B.current);B.current.innerHTML=te}catch(v){console.warn(`Mermaid render failed: ${v}`)}},100);s.useEffect(()=>{u===$e.Code&&B.current?B.current.innerHTML="":U()},[l,u]),s.useEffect(()=>{const v=B.current;if(!v||u!==$e.Image)return;let re=0;const te=Z=>{Z.preventDefault(),Z.stopPropagation();const ae=Date.now();if(ae-re<16)return;re=ae;const ce=Z.deltaY>0?-.1:.1;p(Ce=>Math.max(.5,Math.min(3,Ce+ce)))};return v.addEventListener("wheel",te,{passive:!1}),()=>{v.removeEventListener("wheel",te)}},[u]),s.useEffect(()=>{if(B.current&&u===$e.Image){const v=B.current.querySelector("svg");v&&(v.style.transform=`scale(${g}) translate(${y.x}px, ${y.y}px)`,v.style.transformOrigin="center",v.style.transition=S?"none":"transform 0.1s ease-out",v.style.cursor=S?"grabbing":"grab")}},[g,y,u,S]);const q=v=>{u===$e.Image&&(v.preventDefault(),x(!0),E({x:v.clientX,y:v.clientY}))},_=v=>{if(!S||u!==$e.Image)return;v.preventDefault();const re=v.clientX-$.x,te=v.clientY-$.y;b(Z=>({x:Z.x+re/g,y:Z.y+te/g})),E({x:v.clientX,y:v.clientY})},K=()=>{x(!1)},Q=()=>{p(1),b({x:0,y:0})};if(!l)return null;const k=async()=>{var Ae;const v=(Ae=B.current)==null?void 0:Ae.querySelector("svg");if(!v)return;const re=new XMLSerializer().serializeToString(v),te=document.createElement("canvas"),Z=te.getContext("2d");if(!Z)return;const{width:ae,height:ce}=v.getBoundingClientRect(),Ce=window.devicePixelRatio||1;te.width=ae*Ce,te.height=ce*Ce,te.style.width=`${ae}px`,te.style.height=`${ce}px`,Z.scale(Ce,Ce);const ye=new Image;ye.onload=()=>{Z.drawImage(ye,0,0,ae,ce);const Se=document.createElement("a");Se.download=`${Date.now()}.png`,Se.href=te.toDataURL("image/png",1),Se.click()},ye.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(re)}`},X=()=>{p(v=>Math.min(v+.2,3))},z=()=>{p(v=>Math.max(v-.2,.5))},V=()=>{var re,te;if(a===null)return null;if(a)return a;const v=u===$e.Image?[{key:"zoomIn",icon:s.createElement(le.ZoomInOutlined,null),label:W.zoomIn,onItemClick:X},{key:"zoomOut",icon:s.createElement(le.ZoomOutOutlined,null),label:W.zoomOut,onItemClick:z},{key:"zoomReset",actionRender:()=>s.createElement(se.Tooltip,{title:W.zoomReset},s.createElement(se.Button,{type:"text",size:"small",onClick:Q},W.zoomReset))},{key:"download",icon:s.createElement(le.DownloadOutlined,null),label:W.download,onItemClick:k}]:[{key:"copy",actionRender:()=>s.createElement(He.Copy,{text:l})}];return s.createElement("div",{className:I(`${D}-header`,(re=T.classNames)==null?void 0:re.header,o==null?void 0:o.header),style:{...(te=T.styles)==null?void 0:te.header,...i.header}},s.createElement(se.Segmented,{options:[{label:W.image,value:$e.Image},{label:W.code,value:$e.Code}],value:u,onChange:Z=>{m(Z),d==null||d(Z)}}),s.createElement(He,{items:v}))},F=()=>{var v,re,te,Z;return s.createElement(s.Fragment,null,s.createElement("div",{className:I(`${D}-graph`,(v=T.classNames)==null?void 0:v.graph,u===$e.Code&&`${D}-graph-hidden`,o==null?void 0:o.graph),style:{...(re=T.styles)==null?void 0:re.graph,...i.graph},ref:B,onMouseDown:q,onMouseMove:_,onMouseUp:K,onMouseLeave:K}),u===$e.Code?s.createElement("div",{className:I(`${D}-code`,(te=T.classNames)==null?void 0:te.code,o==null?void 0:o.code),style:{...(Z=T.styles)==null?void 0:Z.code,...i.code}},s.createElement(f.highlighter$1,f._extends({customStyle:{padding:0,background:"transparent"},language:"mermaid",wrapLines:!0},c),l.replace(/\n$/,""))):null)};return s.createElement("div",{className:Y,style:{...n,...T.style,...(ee=T.styles)==null?void 0:ee.root,...i.root}},V(),F())}),yt=s.createContext(null);function gs(e,t){const{className:r,action:n,onClick:o,...i}=e,a=s.useContext(yt),{prefixCls:l,disabled:c,setSubmitDisabled:d}=a,u=i.disabled??c??a[`${n}Disabled`];return s.useEffect(()=>{n==="onSend"&&(d==null||d(u))},[u,n,d]),s.createElement(se.Button,f._extends({type:"text"},i,{ref:t,onClick:m=>{var g;u||((g=a[n])==null||g.call(a),o==null||o(m))},disabled:u,className:I(l,r,{[`${l}-disabled`]:u})}))}const bt=s.forwardRef(gs);function hs(e,t){return A.createElement(bt,f._extends({icon:A.createElement(le.ClearOutlined,null)},e,{action:"onClear",ref:t}))}const ys=A.forwardRef(hs),bs=s.memo(e=>{const{className:t}=e,[r]=ze("Sender",we.Sender);return s.createElement("svg",{color:"currentColor",viewBox:"0 0 1000 1000",xmlns:"http://www.w3.org/2000/svg",className:t},s.createElement("title",null,r.stopLoading),s.createElement("rect",{fill:"currentColor",height:"250",rx:"24",ry:"24",width:"250",x:"375",y:"375"}),s.createElement("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor",strokeWidth:"100",opacity:"0.45"}),s.createElement("circle",{cx:"500",cy:"500",fill:"none",r:"450",stroke:"currentColor",strokeWidth:"100",strokeDasharray:"600 9999999"},s.createElement("animateTransform",{attributeName:"transform",dur:"1s",from:"0 500 500",repeatCount:"indefinite",to:"360 500 500",type:"rotate"})))});function Cs(e,t){const{prefixCls:r}=A.useContext(yt),{className:n}=e;return A.createElement(bt,f._extends({icon:A.createElement(bs,{className:`${r}-loading-icon`}),color:"primary",variant:"text",shape:"circle"},e,{className:I(n,`${r}-loading-button`),action:"onCancel",ref:t}))}const En=A.forwardRef(Cs);function Ss(e,t){return A.createElement(bt,f._extends({icon:A.createElement(le.ArrowUpOutlined,null),type:"primary",shape:"circle"},e,{action:"onSend",ref:t}))}const wn=A.forwardRef(Ss);function xs(e,t){const{speechRecording:r,onSpeechDisabled:n,prefixCls:o}=A.useContext(yt);let i=null;return r?i=A.createElement(fn,{className:`${o}-recording-icon`}):n?i=A.createElement(le.AudioMutedOutlined,null):i=A.createElement(le.AudioOutlined,null),A.createElement(bt,f._extends({icon:i,color:"primary",variant:"text"},e,{action:"onSpeech",ref:t}))}const Nn=A.forwardRef(xs),Ct=s.createContext({});function vs(e,t){const r=f.useEvent(e),[n,o,i]=s.useMemo(()=>typeof t=="object"?[t.recording,t.onRecordingChange,typeof t.recording=="boolean"]:[void 0,void 0,!1],[t]),[a,l]=s.useState(null);s.useEffect(()=>{if(!i&&"permissions"in navigator){let S=null;return navigator.permissions.query({name:"microphone"}).then(x=>{l(x.state),x.onchange=function(){l(this.state)},S=x}),()=>{S&&(S.onchange=null)}}},[i]);let c;!c&&typeof window<"u"&&(c=window.SpeechRecognition||window.webkitSpeechRecognition);const d=!!(i||c&&a!=="denied"),u=s.useRef(null),[m,g]=f.useMergedState(!1,{value:n}),p=s.useRef(!1),y=()=>{if(d&&!u.current){const S=new c;S.onstart=()=>{g(!0)},S.onend=()=>{g(!1)},S.onresult=x=>{var $,E,B;if(!p.current){const j=(B=(E=($=x.results)==null?void 0:$[0])==null?void 0:E[0])==null?void 0:B.transcript;r(j)}p.current=!1},u.current=S}},b=f.useEvent(S=>{S&&!m||(p.current=S,i?o==null||o(!m):(y(),u.current&&(m?(u.current.stop(),o==null||o(!1)):(u.current.start(),o==null||o(!0)))))});return[d,b,m]}const Rn=A.createContext({}),Jt=()=>({height:0}),Qt=e=>({height:e.scrollHeight});function $s(e){const{title:t,onOpenChange:r,open:n,children:o,className:i,style:a,classNames:l={},styles:c={},prefixCls:d,closable:u,forceRender:m}=e,{prefixCls:g}=A.useContext(Rn),{direction:p,getPrefixCls:y}=pe(),b=y("sender",d||g),S=`${b}-header`,x=()=>{r==null||r(!n)};return A.createElement(f.CSSMotion,{motionEnter:!0,motionLeave:!0,motionName:`${S}-motion`,leavedClassName:`${S}-motion-hidden`,onEnterStart:Jt,onEnterActive:Qt,onLeaveStart:Qt,onLeaveActive:Jt,visible:n,forceRender:m},({className:$,style:E})=>A.createElement("div",{className:I(b,S,$,i,{[`${S}-rtl`]:p==="rtl"}),style:{...E,...a}},(u!==!1||t)&&A.createElement("div",{className:I(`${S}-header`,l.header),style:{...c.header}},A.createElement("div",{className:`${S}-title`},t),u!==!1&&A.createElement("div",{className:`${S}-close`},A.createElement(se.Button,{type:"text",icon:A.createElement(le.CloseOutlined,null),size:"small",onClick:x}))),o&&A.createElement("div",{className:I(`${S}-content`,l.content),style:{...c.content}},o)))}const Es=e=>{const{componentCls:t,calc:r}=e,n=`${t}-header`;return{[t]:{[`&${n}-rtl`]:{direction:"rtl"},[`${n}`]:{borderBottomWidth:e.lineWidth,borderBottomStyle:"solid",borderBottomColor:e.colorBorderInput,[`${n}-header`]:{background:e.colorFillAlter,fontSize:e.fontSize,lineHeight:e.lineHeight,paddingBlock:r(e.paddingSM).sub(e.lineWidthBold).equal(),paddingInlineStart:e.padding,paddingInlineEnd:e.paddingXS,display:"flex",borderRadius:{_skip_check_:!0,value:r(e.borderRadius).mul(2).equal()},borderEndStartRadius:0,borderEndEndRadius:0,[`${n}-title`]:{flex:"auto"}},[`${n}-content`]:{padding:e.padding}},[`${n}-motion`]:{transition:["height","border"].map(o=>`${o} ${e.motionDurationSlow}`).join(","),overflow:"hidden","&-enter-start, &-leave-active":{borderBottomColor:"transparent"},"&-hidden":{display:"none"}}}}},ws=e=>{const{componentCls:t,antCls:r,calc:n}=e,o=`${t}-slot`,i=`${r}-input`,a=`${r}-dropdown-trigger`,l=`${t}-slot-input`,c=`${t}-slot-select`,d=`${t}-slot-tag`,u=`${t}-slot-content`,m=`${t}-skill`;return{[t]:{[`${t}-input-slot`]:{outline:"none",cursor:"text",whiteSpace:"pre-wrap",width:"100%",caretColor:e.colorPrimary,fontSize:e.fontSize,lineHeight:e.lineHeight,"&:empty::before":{content:"attr(data-placeholder)",color:e.colorTextPlaceholder}},[`${o}:not(${u})`]:{display:"inline-block",verticalAlign:"middle",alignItems:"center",marginBlock:1,height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),wordBreak:"break-all",marginInline:e.marginXXS},[`${i}${l}`]:{height:"100%",background:e.colorBgSlot,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,paddingInline:e.paddingXXS,fontSize:"inherit",lineHeight:"inherit",position:"relative","&::placeholder":{color:e.colorTextSlotPlaceholder,fontSize:"inherit",lineHeight:"inherit"},[o]:{display:"inline-flex",margin:`0 ${f.unit(e.marginXXS)}`,verticalAlign:"bottom",alignItems:"center",marginBlock:f.unit(n(e.marginXXS).div(2).equal()),minHeight:e.controlHeightSM,wordBreak:"break-all"}},[c]:{fontSize:e.fontSize,lineHeight:e.lineHeight,paddingInline:e.paddingXXS,transition:`border-color  ${e.motionDurationMid}`,position:"relative",display:"inline-flex",alignItems:"center",cursor:"pointer",background:e.colorBgSlot,height:"100%",boxSizing:"border-box",borderRadius:e.borderRadius,color:e.colorTextSlot,border:`1px solid ${e.colorBorderSlot}`,"&.placeholder":{color:e.colorTextSlotPlaceholder},[`${c}`]:{fontSize:e.fontSize,lineHeight:e.lineHeight,padding:`0 ${f.unit(e.paddingXXS)}`,transition:`border-color  ${e.motionDurationMid}`,position:"relative",display:"inline",cursor:"pointer",background:e.colorBgSlot,alignItems:"center",justifyContent:"center",borderRadius:e.borderRadius,color:e.colorTextSlot,border:`1px solid ${e.colorBorderSlot}`,"&.placeholder":{color:e.colorTextSlotPlaceholder},[`&${a}-open`]:{borderColor:e.colorBorderSlotHover}},[`${c}-value`]:{flex:1,fontSize:e.fontSize,lineHeight:e.lineHeight,"&:empty::before":{content:"attr(data-placeholder)"}},[`${c}-arrow`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSize,lineHeight:e.lineHeight,display:"inline-flex",alignItems:"center",justifyContent:"center"},[`${d}`]:{background:e.colorBgSlot,border:`1px solid ${e.colorBorderSlot}`,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,padding:`0 ${f.unit(e.paddingXXS)}`,fontSize:e.fontSize,lineHeight:e.lineHeight,position:"relative",cursor:"default"}},[`${c}-arrow`]:{marginInlineStart:e.marginXXS,fontSize:e.fontSize,lineHeight:e.lineHeight,display:"inline-flex",alignItems:"center",justifyContent:"center"},[d]:{background:e.colorBgSlot,border:`1px solid ${e.colorBorderSlot}`,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,padding:`0 ${f.unit(e.paddingXXS)}`,fontSize:e.fontSize,lineHeight:e.lineHeight,height:"100%",boxSizing:"border-box",position:"relative",cursor:"default"},[u]:{height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),caretColor:e.colorPrimary,background:e.colorBgSlot,outline:"none",color:e.colorTextSlot,borderRadius:e.borderRadius,paddingInline:e.paddingXXS,boxSizing:"border-box",verticalAlign:"middle",fontSize:e.fontSize,marginBlock:1,lineHeight:e.lineHeight,display:"inline-block",position:"relative",cursor:"text","&:empty":{width:"fit-content","&::after":{display:"inline-block",height:"inherit",content:"attr(data-placeholder)",color:e.colorTextSlotPlaceholder}}},[`${o}-no-width`]:{userSelect:"none",width:"3px",display:"inline-block",lineHeight:"inherit"},[m]:{display:"inline-block",verticalAlign:"baseline",alignItems:"center",marginBlock:1,height:n(e.fontSize).mul(e.lineHeight).add(2).equal(),wordBreak:"break-all",paddingInlineEnd:0,paddingInlineStart:0,marginInlineEnd:0,marginInlineStart:-1,[`&${m}-empty`]:{"&::after":{display:"inline-block",pointerEvents:"none",height:"inherit",content:"attr(data-placeholder)",color:e.colorTextPlaceholder}}},[`${m}-wrapper`]:{height:"100%",display:"inline-flex"},[`${m}-tag`]:{paddingInline:e.paddingXS,height:"100%",backgroundColor:e.colorBgSkill,borderRadius:e.borderRadius,color:e.colorPrimary,alignItems:"center",fontWeight:500,display:"inline-flex",cursor:"pointer",gap:e.marginXXS,transition:`background-color ${e.motionDurationMid}`,"&:hover":{backgroundColor:e.colorBgSkillHover,[`${m}-tag-close:not(${m}-tag-close-disabled)`]:{color:e.colorPrimaryHover}},"&-close":{fontSize:e.fontSizeSM,display:"inline-flex",transition:`color ${e.motionDurationMid}`,color:e.colorPrimary},"&-close-disabled":{cursor:"not-allowed",color:e.colorTextDisabled}},[`${m}-holder`]:{width:e.marginXS,height:"100%"}}}},Ns=e=>{const{componentCls:t,antCls:r}=e,n=`${t}-switch`;return{[t]:{[`&${n}-rtl`]:{direction:"rtl"},[`&${n}`]:{display:"inline-block",[`${r}-btn:not(:disabled):not(${r}-btn-disabled):hover`]:{background:e.switchUncheckedHoverBg,borderColor:e.colorBorder,color:e.colorText},[`&${n}-checked`]:{[`${r}-btn:not(:disabled):not(${r}-btn-disabled):hover`]:{background:e.switchCheckedHoverBg,borderColor:e.colorPrimary,color:e.colorPrimaryText},[`${n}-content`]:{background:e.switchCheckedBg}}}}}},Rs=e=>{const{componentCls:t,paddingSM:r,paddingXS:n,paddingXXS:o,lineWidth:i,calc:a}=e;return{[t]:{[`&${t}-main`]:{position:"relative",width:"100%",boxSizing:"border-box",boxShadow:`${e.boxShadowTertiary}`,borderRadius:{_skip_check_:!0,value:a(e.borderRadius).mul(2).equal()},borderColor:e.colorBorderInput,borderWidth:i,borderStyle:"solid"},[`&${t}-disabled`]:{background:e.colorBgContainerDisabled},[`&${t}-rtl`]:{direction:"rtl"},[`${t}-content`]:{display:"flex",gap:n,width:"100%",paddingBlock:r,paddingInlineStart:r,paddingInlineEnd:r,boxSizing:"border-box",alignItems:"flex-end"},[`${t}-prefix`]:{flex:"none"},[`${t}-input`]:{paddingInline:0,borderRadius:0,flex:"auto",alignSelf:"center",caretColor:e.colorPrimary,fontSize:e.fontSize},[`${t}-actions-list`]:{flex:"none",display:"flex","&-presets":{gap:e.paddingXS}},[`${t}-actions-btn`]:{"&-disabled":{background:e.colorPrimary,opacity:.45,color:e.colorTextLightSolid},"&-loading-button":{padding:0,border:0},"&-loading-icon":{height:e.controlHeight,width:e.controlHeight,verticalAlign:"top"},"&-recording-icon":{height:"1.2em",width:"1.2em",verticalAlign:"top"}},[`${t}-footer`]:{paddingInlineStart:r,paddingInlineEnd:r,paddingBlockEnd:r,paddingBlockStart:o,boxSizing:"border-box"}}}},Ts=e=>{const{colorPrimary:t,colorFillTertiary:r}=e,n=new f.FastColor(t).setA(.06).toRgbString(),o=new f.FastColor(t).setA(.08).toRgbString(),i=new f.FastColor(t).setA(.15).toRgbString(),a=t,l=new f.FastColor(t).setA(.25).toRgbString(),c=new f.FastColor(t).setA(.1).toRgbString(),d=n,u=new f.FastColor(t).setA(.08).toRgbString(),m=new f.FastColor(r).setA(.04).toRgbString(),g=new f.FastColor(t).setA(.1).toRgbString(),p=new f.FastColor(r).setA(.1).toRgbString(),y=`0 4px 12px 0 ${new f.FastColor(t).setA(.1).toRgbString()}`;return{colorBgSlot:n,colorBgSkill:o,colorBgSkillHover:i,colorTextSlot:a,colorTextSlotPlaceholder:l,colorBorderSlotHover:c,colorBorderSlot:d,switchCheckedBg:u,switchCheckedHoverBg:g,switchUncheckedHoverBg:m,colorBorderInput:p,boxShadowInput:y}},Tn=Ve("Sender",e=>{const{paddingXS:t,calc:r}=e,n=f.merge(e,{SenderContentMaxWidth:`calc(100% - ${f.unit(r(t).add(32).equal())})`});return[Rs(n),Es(n),Ns(n),ws(n)]},Ts),Ms=A.forwardRef((e,t)=>{const{children:r,className:n,classNames:o={},styles:i={},icon:a,style:l,onChange:c,rootClassName:d,loading:u,defaultValue:m,value:g,checkedChildren:p,unCheckedChildren:y,disabled:b,prefixCls:S,...x}=e,{styles:$={},classNames:E={},prefixCls:B}=A.useContext(Ct),j=f._default(x,{attr:!0,aria:!0,data:!0}),W=A.useId(),{direction:G,getPrefixCls:R}=pe(),D=R("sender",S||B),P=`${D}-switch`,[M,T]=Tn(D),Y=A.useRef(null);et(t,()=>({nativeElement:Y.current}));const[U,q]=f._default$1(m,{value:g,onChange:Q=>{c==null||c(Q)}}),_=Ne("sender"),K=I(D,P,n,d,_.classNames.switch,E.switch,o.root,M,T,{[`${P}-checked`]:U,[`${P}-rtl`]:G==="rtl"});return A.createElement("div",f._extends({ref:Y,className:K,key:W,style:{...l,..._.styles.switch,...$.switch,...i.root}},j),A.createElement(se.Button,{disabled:b,loading:u,className:I(`${P}-content`,o.content),style:i.content,styles:{icon:i.icon,content:i.title},classNames:{icon:o.icon,content:o.title},variant:"outlined",color:U?"primary":"default",icon:a,onClick:()=>{q(!U)}},U?p:y,r))}),Mn=({removeSkill:e,prefixCls:t,toolTip:r,closable:n,title:o,value:i})=>{const a=`${t}-skill`,l=s.useMemo(()=>{if(!n)return[null];const u=typeof n=="boolean"?{}:n,m=y=>{var b;u.disabled||(y.stopPropagation(),e(),(b=u.onClose)==null||b.call(u,y))},g=u.closeIcon||s.createElement(le.CloseOutlined,{className:`${a}-close-icon`});return s.createElement("div",{className:I(`${a}-close`,{[`${a}-close-disabled`]:u.disabled}),onClick:m,role:"button","aria-label":"Close skill",tabIndex:0},g)},[n,e]),c=o||i,d=r?s.createElement(se.Tooltip,r,c):c;return s.createElement("div",{className:`${a}-wrapper`,contentEditable:!1},s.createElement("div",{className:`${a}-tag`,contentEditable:!1,role:"button",tabIndex:0},s.createElement("span",{className:`${a}-tag-text`},d),l),s.createElement("div",{className:`${a}-holder`}))};Mn.displayName="Skill";const en=4.35,Is=(e,t,r)=>{const{token:n}=rr(),o=r.current?window.getComputedStyle(r.current):{},i=parseFloat(`${e.lineHeight||n.lineHeight}`),a=parseFloat(`${(o==null?void 0:o.fontSize)||e.fontSize||n.fontSize}`),l=o!=null&&o.lineHeight?parseFloat(`${o==null?void 0:o.lineHeight}`):i*a;return t===!1||!t?{}:t===!0?{height:"auto"}:{minHeight:t.minRows?(l+en)*t.minRows:"auto",maxHeight:t.maxRows?(l+en)*t.maxRows:"auto",overflowY:"auto"}},Ds=(e,t)=>e==null?void 0:e.reduce((r,n)=>{var o,i,a;return n.key&&(n.type==="input"||n.type==="select"||n.type==="custom"||n.type==="content"?r[n.key]=((o=n.props)==null?void 0:o.defaultValue)||"":n.type==="tag"&&(r[n.key]=((i=n.props)==null?void 0:i.value)||((a=n.props)==null?void 0:a.label)||""),t.current.set(n.key,n)),r},{});function As(e){const[t,r]=s.useState({}),n=s.useRef(t),o=s.useRef(new Map);s.useEffect(()=>{if(!e)return;const c=Ds(e,o);r(c),n.current=c},[e]);const i=s.useCallback(c=>{const d=typeof c=="function"?c(n.current):c;n.current=d,r(d)},[]),a=s.useCallback(c=>{c.forEach(d=>{d.key&&o.current.set(d.key,d)})},[]),l=s.useCallback(()=>n.current,[]);return[o.current,l,i,a]}const In=s.forwardRef((e,t)=>{var Xt;const{onChange:r,onKeyUp:n,onKeyDown:o,onPaste:i,onPasteFile:a,disabled:l,readOnly:c,submitType:d="enter",prefixCls:u,styles:m={},classNames:g={},autoSize:p,triggerSend:y,placeholder:b,onFocus:S,onBlur:x,slotConfig:$,skill:E,submitDisabled:B,...j}=s.useContext(Ct),{direction:W,getPrefixCls:G}=pe(),R=`${G("sender",u)}`,D=Ne("sender"),P=`${R}-input`,M=s.useRef(null),T=s.useRef(new Map),Y=s.useRef(!1),U=s.useRef(!1),q=s.useRef(null),_=s.useRef(null),K=s.useRef(null),Q=s.useRef(!1),k={...(Xt=D.styles)==null?void 0:Xt.input,...m.input},X=Is(k,p,M),V={...f._default(j,{attr:!0,aria:!0,data:!0}),ref:M},[F,oe,ee,v]=As($),[re,te]=s.useState(new Map),[Z,ae]=s.useState(null),ce=h=>{const C=Te();_.current&&(!(C!=null&&C.value)&&C.slotConfig.length===0?(_.current.setAttribute("contenteditable","true"),_.current.classList.add(`${R}-skill-empty`)):(_.current.setAttribute("contenteditable","false"),_.current.classList.remove(`${R}-skill-empty`))),r==null||r(C.value,h,C.slotConfig,C.skill)},Ce=h=>{const C=document.createElement("span");return C.setAttribute("contenteditable","false"),C.dataset.slotKey=h,C.className=`${R}-slot`,C},ye=h=>{const C=document.createElement("span");return C.setAttribute("contenteditable","false"),C.dataset.skillKey=h,C.dataset.placeholder=b,C.className=`${R}-skill`,C},Ae=h=>{const C=document.createElement("span");return C.setAttribute("contenteditable","true"),C.dataset.slotKey=h.key,C.className=I(`${R}-slot`,`${R}-slot-content`),C},Se=(h,C)=>{const N=document.createElement("span");return N.setAttribute("contenteditable","false"),N.dataset.slotKey=h,N.dataset.nodeType="nbsp",N.className=I(`${R}-slot-${C}`,`${R}-slot-no-width`),N.innerHTML="&nbsp;",N},ue=(h,C)=>{T.current.set(h,C)},Pe=h=>T.current.get(h),We=(h,C,N)=>{const w=Pe(h),H=F.get(h);if(ee(ne=>({...ne,[h]:C})),w&&H){const ne=Fe(H,w);te(J=>{const me=new Map(J);return me.set(h,ne),me}),ce(N)}},Fe=(h,C)=>{if(!h.key)return null;const N=oe()[h.key],w=()=>{var H,ne,J,me,L,fe,xe,be,_e;switch(h.type){case"content":return C.innerHTML=N||"",C.setAttribute("data-placeholder",((H=h.props)==null?void 0:H.placeholder)||""),null;case"input":return s.createElement(se.Input,{readOnly:c,className:`${R}-slot-input`,placeholder:((ne=h.props)==null?void 0:ne.placeholder)||"","data-slot-input":h.key,size:"small",variant:"borderless",value:N||"",tabIndex:0,onKeyDown:Re,onChange:he=>{We(h.key,he.target.value,he)},spellCheck:!1});case"select":return s.createElement(se.Dropdown,{disabled:c,menu:{items:(me=(J=h.props)==null?void 0:J.options)==null?void 0:me.map(he=>({label:he,key:he})),defaultSelectedKeys:(L=h.props)!=null&&L.defaultValue?[h.props.defaultValue]:[],selectable:!0,onSelect:({key:he,domEvent:Me})=>{We(h.key,he,Me)}},trigger:["click"]},s.createElement("span",{className:I(`${R}-slot-select`,{placeholder:!N,[`${R}-slot-select-selector-value`]:N})},s.createElement("span",{"data-placeholder":(fe=h.props)==null?void 0:fe.placeholder,className:`${R}-slot-select-value`},N||""),s.createElement("span",{className:`${R}-slot-select-arrow`},s.createElement(le.CaretDownFilled,null))));case"tag":return s.createElement("div",{className:`${R}-slot-tag`},((xe=h.props)==null?void 0:xe.label)||((be=h.props)==null?void 0:be.value)||"");case"custom":return(_e=h.customRender)==null?void 0:_e.call(h,N,he=>{We(h.key,he)},{disabled:l,readOnly:c},h);default:return null}};return Kt.createPortal(w(),C)},nt=h=>h.reduce((C,N)=>{if(N.type==="text")return C.push(document.createTextNode(N.value||"")),C;const w=N.key;if(gt(!!w,"sender",`Slot key is missing: ${w}`),w){let H,ne;if(N.type==="content"?(ne=Ae(N),H=[Se(w,"before"),ne,Se(w,"after")]):(ne=Ce(w),H=[ne]),ue(w,ne),ne){const J=Fe(N,ne);J&&(te(me=>{const L=new Map(me);return L.set(w,J),L}),C.push(...H))}}return C},[]),Le=h=>{if(h.nodeType===Node.TEXT_NODE)return h.textContent||"";if(h.nodeType!==Node.ELEMENT_NODE)return"";const C=h,{dataset:N}=C;if(N.slotKey){if(N.nodeType==="nbsp")return" ";const w=F.get(N.slotKey);if(!w)return"";if(w.type==="content")return C.innerText||"";const H=oe()[N.slotKey]??"";return w.formatResult?w.formatResult(H):H}if(N.skillKey){const w=C.querySelector(`.${R}-skill-wrapper`),H=C.innerText||"";if(!w)return H;const ne=w.innerText||"";return H.replace(ne,"").replace(/\n/g,"")}return""},Te=()=>{var w;const h=[],C=[];let N;if((w=M.current)==null||w.childNodes.forEach(H=>{const ne=Le(H);if(h.push(ne),H.nodeType===Node.TEXT_NODE)C.push({type:"text",value:ne});else if(H.nodeType===Node.ELEMENT_NODE){const J=H,me=J.getAttribute("data-slot-key"),L=J.getAttribute("data-node-type");if(J.getAttribute("data-skill-key")&&E&&(N=E),me&&L!=="nbsp"){const xe=F.get(me);xe&&C.push({...xe,value:ne})}}}),!h.length){const H=M.current;H&&(H.innerHTML="")}return N||(_.current=null),{value:h.join(""),slotConfig:C,skill:N}},rt=()=>{var C;const h=M.current;h&&(h.innerHTML="",_.current=null,K.current=null,(C=T==null?void 0:T.current)==null||C.clear())},st=h=>{var me,L,fe;if(h==="start")return{type:"start"};if(h==="end")return{type:"end"};const C=(me=window==null?void 0:window.getSelection)==null?void 0:me.call(window);if(!C)return{type:"end"};const N=C.rangeCount>0?C.getRangeAt(0):null,w=q.current||N;if(!w)return{type:"end"};const H=M.current;if(!H)return{type:"end"};const ne=w.endContainer;return(L=ne==null?void 0:ne.className)!=null&&L.includes(`${R}-skill`)||(fe=ne==null?void 0:ne.className)!=null&&fe.includes(`${R}-slot`)?{type:"slot",range:w}:w.endContainer===H||w.endContainer.parentElement===H?{type:"box",range:w}:{type:"end"}},ot=h=>{h.forEach(C=>{var N;(N=M.current)==null||N.appendChild(C)})},it=(h,C)=>{const N=M.current;N&&(N.querySelectorAll(`[data-slot-key="${h}"]`).forEach(w=>{w.remove()}),T.current.delete(h),ee(w=>{const{[h]:H,...ne}=w;return ne}),te(w=>{const H=new Map(w);return H.delete(h),H}),ce(C))},je=()=>{if(E&&K.current!==E){Ue(!1),K.current=E;const h=ye(E.value),C=Kt.createPortal(s.createElement(Mn,f._extends({removeSkill:Ue},E,{prefixCls:R})),h);ae(C);const N=document.createRange(),w=M.current;if(!w)return;N.setStart(w,0),N.insertNode(h),_.current=h,ce()}},Ue=(h=!0)=>{var N;!M.current||!_.current||((N=_.current)==null||N.remove(),_.current=null,K.current=null,h&&ce())},xt=h=>{d!=="enter"||!h||h.querySelectorAll("br").forEach(C=>{C.remove()})},vt=h=>{const C=M.current;if(!C)return;const w=(()=>{var H,ne;if(h){const J=Pe(h);return(J==null?void 0:J.querySelector("input"))||null}for(const J of Array.from(C.childNodes)){const me=((H=J==null?void 0:J.getAttribute)==null?void 0:H.call(J,"data-slot-key"))||"",L=((ne=J==null?void 0:J.getAttribute)==null?void 0:ne.call(J,"data-node-type"))||"",fe=F.get(me);if(J.nodeType===Node.ELEMENT_NODE){if((fe==null?void 0:fe.type)==="input")return J.querySelector("input");if((fe==null?void 0:fe.type)==="content"&&L!=="nbsp")return J}}return null})();if(w&&w.nodeName==="INPUT"){w.focus();return}w&&(C.focus(),Ot(w,0))},ie=()=>{$&&$.length>0&&M.current&&(rt(),ot(nt($)))},ge=()=>{Y.current=!0},Ee=()=>{Y.current=!1,U.current=!1},Re=h=>{var fe,xe,be,_e,he,Me,Et,zt,ct,Ft;const{key:C,target:N,shiftKey:w,ctrlKey:H,altKey:ne,metaKey:J}=h,me=o==null?void 0:o(h);if(U.current||Y.current||me===!1){o==null||o(h);return}const L=window.getSelection();if(C==="Backspace"&&N===M.current){if((L==null?void 0:L.focusOffset)===1&&((be=(xe=(fe=L.anchorNode)==null?void 0:fe.parentNode)==null?void 0:xe.getAttribute)==null?void 0:be.call(xe,"data-slot-key"))&&(_e=L.anchorNode)!=null&&_e.parentNode){h.preventDefault(),L.anchorNode.parentNode.innerHTML="";return}if((L==null?void 0:L.focusOffset)===0){const Ke=(Et=(Me=(he=L.anchorNode)==null?void 0:he.previousSibling)==null?void 0:Me.getAttribute)==null?void 0:Et.call(Me,"data-slot-key");if(Ke){h.preventDefault(),it(Ke,h);return}if((Ft=(ct=(zt=L.anchorNode)==null?void 0:zt.previousSibling)==null?void 0:ct.getAttribute)==null?void 0:Ft.call(ct,"data-skill-key")){h.preventDefault(),Ue();return}}}if(C==="Enter"){const Ke=H||ne||J;if(d==="enter"&&!w&&!Ke||d==="shiftEnter"&&w&&!Ke){h.preventDefault(),Q.current||(U.current=!0,y==null||y());return}}_.current&&(L!=null&&L.anchorNode)&&_.current.contains(L.anchorNode)&&(_.current.setAttribute("contenteditable","false"),_.current.classList.remove(`${R}-skill-empty`),kt({cursor:"end"}))},at=h=>{const C=window.getSelection();if(C){const N=document.createRange();N.selectNodeContents(M.current),N.collapse(!0),C.removeAllRanges(),C.addRange(N)}S==null||S(h)},lt=h=>{var w;U.current&&(U.current=!1);const C=window.getSelection();C&&(q.current=C.rangeCount?(w=C==null?void 0:C.getRangeAt)==null?void 0:w.call(C,0):null);const N=setTimeout(()=>{q.current=null,clearTimeout(N)},200);x==null||x(h)},$t=h=>{xt(M==null?void 0:M.current),ce(h)},_n=h=>{var w,H;h.preventDefault();const C=(w=h.clipboardData)==null?void 0:w.files,N=(H=h.clipboardData)==null?void 0:H.getData("text/plain");if(!N&&(C!=null&&C.length)&&a){a(C);return}N&&Lt([{type:"text",value:N.replace(/\n/g,"")}]),i==null||i(h)},Bn=h=>{h.key==="Enter"&&(U.current=!1),n==null||n(h)},Ot=(h,C)=>{const N=document.createRange();N.setStart(h,C),N.setEnd(h,C);const w=window.getSelection();w&&(w.removeAllRanges(),N.collapse(!1),w.addRange(N))},Hn=()=>{const h=M.current,C=window.getSelection();h&&(C==null?void 0:C.focusNode)===h&&C.focusOffset===0&&Te().skill&&Ot(h,1)},Lt=(h,C="cursor",N)=>{var xe;const w=M.current,H=window.getSelection();if(!w||!H)return;const ne=nt(h),{type:J,range:me}=st(C);let L=document.createRange();if(ee(be=>({...be,...h})),v(h),J==="end"){H.removeAllRanges(),H.addRange(L);const be=w.childNodes[w.childNodes.length-1];be.nodeType===Node.TEXT_NODE&&be.textContent===`
`?L.setStart(w,w.childNodes.length-1):L.setStart(w,w.childNodes.length)}if(J==="start"&&L.setStart(w,Te().skill?1:0),J==="box"&&(L=me),J==="slot"&&(L=(xe=H==null?void 0:H.getRangeAt)==null?void 0:xe.call(H,0),H.focusNode&&L.setStartAfter(H.focusNode)),N!=null&&N.length){const be=L.startOffset,_e=L.startContainer,he=L.cloneRange();he.selectNodeContents(w),he.setEnd(L.endContainer,L.endOffset),he.setStart(w,0);const Me=he.toString();Me.length>=N.length&&Me.endsWith(N)&&(L.setStart(_e,be-N.length),L.setEnd(_e,be),L.deleteContents())}H.deleteFromDocument(),ne.forEach(be=>{L.insertNode(be),L.setStartAfter(be),L=L.cloneRange()}),w.focus(),L.collapse(!1),H.removeAllRanges(),H.addRange(L);const fe=setTimeout(()=>{$t(null),clearTimeout(fe)},0)},kt=h=>{const C=M.current;if(!C||(C.focus({preventScroll:(h==null?void 0:h.preventScroll)||!1}),!(h!=null&&h.cursor)))return;if((h==null?void 0:h.cursor)==="slot")return vt(h==null?void 0:h.key);const N=window.getSelection();if(!N)return;const w=document.createRange();switch(w.selectNodeContents(C),h.cursor){case"start":w.collapse(!0);break;case"all":break;default:w.collapse(!1);break}N.removeAllRanges(),N.addRange(w)},On=()=>{var C;const h=M.current;h&&(h.innerHTML="",K.current=null,_.current=null,F.clear(),je(),ee({}),(C=T==null?void 0:T.current)==null||C.clear(),$t(null))};return s.useEffect(()=>{Q.current=B??!1},[B]),s.useEffect(()=>{ie(),E?je():ce()},[$]),s.useEffect(()=>{je()},[E]),s.useImperativeHandle(t,()=>({nativeElement:M.current,focus:kt,blur:()=>{var h;(h=M.current)==null||h.blur()},insert:Lt,clear:On,getValue:Te})),s.createElement(s.Fragment,null,s.createElement("div",f._extends({},V,{role:"textbox",tabIndex:0,style:{...k,...X},className:I(P,`${P}-slot`,D.classNames.input,g.input,{[`${R}-rtl`]:W==="rtl"}),"data-placeholder":b,contentEditable:!c,suppressContentEditableWarning:!0,spellCheck:!1,onKeyDown:Re,onKeyUp:Bn,onPaste:_n,onCompositionStart:ge,onCompositionEnd:Ee,onFocus:at,onBlur:lt,onSelect:Hn,onInput:$t},j)),s.createElement("div",{style:{display:"none"},id:`${R}-slot-placeholders`},Array.from(re.values()),Z))});process.env.NODE_ENV!=="production"&&(In.displayName="SlotTextArea");function Ps(e,t,r){return f._default$2(e,t)||r}const Dn=s.forwardRef((e,t)=>{const{value:r,onChange:n,onKeyUp:o,onKeyDown:i,onPaste:a,onPasteFile:l,disabled:c,readOnly:d,submitType:u="enter",prefixCls:m,styles:g={},classNames:p={},autoSize:y,components:b,submitDisabled:S,triggerSend:x,placeholder:$,onFocus:E,onBlur:B,...j}=s.useContext(Ct),W=s.useRef(null),G=(k,X="cursor")=>{var ee,v;const z=(v=(ee=W.current)==null?void 0:ee.resizableTextArea)==null?void 0:v.textArea,V=z.value;let F=V.length,oe=V.length;X==="cursor"&&(F=z==null?void 0:z.selectionStart,oe=z==null?void 0:z.selectionEnd),X==="start"&&(F=0,oe=0),z.value=V.substring(0,F)+k+V.substring(oe,V.length),z.selectionStart=F+k.length,z.selectionEnd=F+k.length,z.focus(),n==null||n(z.value)},R=()=>{n==null||n("")},D=()=>({value:r||"",slotConfig:[]});s.useImperativeHandle(t,()=>{var k,X,z,V;return{nativeElement:(X=(k=W.current)==null?void 0:k.resizableTextArea)==null?void 0:X.textArea,focus:(z=W.current)==null?void 0:z.focus,blur:(V=W.current)==null?void 0:V.blur,insert:G,clear:R,getValue:D}});const P=s.useRef(!1),M=()=>{P.current=!0},T=()=>{P.current=!1},Y=k=>{const X=i==null?void 0:i(k),{key:z,shiftKey:V,ctrlKey:F,altKey:oe,metaKey:ee}=k;if(!(P.current||z!=="Enter"||X===!1)&&z==="Enter"){const v=F||oe||ee;if(u==="enter"&&!V&&!v||u==="shiftEnter"&&V&&!v){k.preventDefault(),S||x==null||x();return}}},U=k=>{var V,F;const X=(V=k.clipboardData)==null?void 0:V.files;!((F=k.clipboardData)==null?void 0:F.getData("text/plain"))&&(X!=null&&X.length)&&l&&(l(X),k.preventDefault()),a==null||a(k)},q=Ps(b,["input"],se.Input.TextArea),K={...f._default(j,{attr:!0,aria:!0,data:!0}),ref:W},Q=k=>{n==null||n(k.target.value,k)};return s.createElement(q,f._extends({},K,{disabled:c,style:g.input,className:I(`${m}-input`,p.input),autoSize:y,value:r,onChange:Q,onKeyUp:o,onCompositionStart:M,onCompositionEnd:T,onKeyDown:Y,onPaste:U,variant:"borderless",readOnly:d,placeholder:$,onFocus:E,onBlur:B}))});process.env.NODE_ENV!=="production"&&(Dn.displayName="TextArea");const mt={SendButton:wn,ClearButton:ys,LoadingButton:En,SpeechButton:Nn},_s=s.forwardRef((e,t)=>{const{prefixCls:r,styles:n={},classNames:o={},className:i,rootClassName:a,style:l,defaultValue:c,value:d,slotConfig:u,readOnly:m,submitType:g="enter",onSubmit:p,loading:y,components:b,onCancel:S,onChange:x,suffix:$,onKeyUp:E,onKeyDown:B,disabled:j,allowSpeech:W,prefix:G,footer:R,header:D,onPaste:P,onPasteFile:M,autoSize:T={maxRows:8},placeholder:Y,onFocus:U,onBlur:q,skill:_,...K}=e,Q=f._default(K,{attr:!0,aria:!0,data:!0}),k=s.useId(),X=Array.isArray(u)||(_==null?void 0:_.value),{direction:z,getPrefixCls:V}=pe(),F=V("sender",r),oe=s.useRef(null),ee=s.useRef(null);et(t,()=>{var ie,ge,Ee,Re,at,lt;return{nativeElement:oe.current,inputElement:(ie=ee.current)==null?void 0:ie.nativeElement,focus:(ge=ee.current)==null?void 0:ge.focus,blur:(Ee=ee.current)==null?void 0:Ee.blur,insert:(Re=ee.current)==null?void 0:Re.insert,clear:(at=ee.current)==null?void 0:at.clear,getValue:(lt=ee.current)==null?void 0:lt.getValue}});const v=Ne("sender"),re=`${F}-input`,[te,Z]=Tn(F),ae=I(F,v.className,i,a,v.classNames.root,o.root,te,Z,`${F}-main`,{[`${F}-rtl`]:z==="rtl",[`${F}-disabled`]:j}),ce=`${F}-actions-btn`,Ce=`${F}-actions-list`,[ye,Ae]=f.useMergedState(c||"",{value:d}),Se=(ie,ge,Ee,Re)=>{Ae(ie),x==null||x(ie,ge,Ee??[],Re)},[ue,Pe,We]=vs(ie=>{var ge,Ee;X?(Ee=(ge=ee.current)==null?void 0:ge.insert)==null||Ee.call(ge,[{type:"text",value:ie}]):Se(`${ye} ${ie}`)},W),Fe=()=>{if(ee!=null&&ee.current&&p&&!y){const ie=ee.current.getValue();p(ie.value,ie.slotConfig,ie.skill)}},nt=()=>{var ie,ge;Se(""),X&&((ge=(ie=ee.current)==null?void 0:ie.clear)==null||ge.call(ie))},Le=s.createElement(se.Flex,{className:`${Ce}-presets`},W&&s.createElement(Nn,null),y?s.createElement(En,null):s.createElement(wn,null));let Te=Le;typeof $=="function"?Te=$(Le,{components:mt}):($||$===!1)&&(Te=$);const rt=typeof G=="function"?G(Le,{components:mt}):G||null,st=typeof D=="function"?D(Le,{components:mt}):D||null,ot=typeof R=="function"?R(Le,{components:mt}):R||null,[it,je]=s.useState(!ye),Ue={prefixCls:ce,onSend:Fe,onSendDisabled:!ye,onClear:nt,onClearDisabled:!ye,onCancel:S,onCancelDisabled:!y,onSpeech:()=>Pe(!1),onSpeechDisabled:!ue,speechRecording:We,disabled:j,setSubmitDisabled:je},xt=s.useMemo(()=>({value:ye,onChange:Se,slotConfig:u,onKeyUp:E,onKeyDown:B,onPaste:P,onPasteFile:M,disabled:j,readOnly:m,submitType:g,prefixCls:F,styles:n,classNames:o,autoSize:T,components:b,triggerSend:Fe,placeholder:Y,onFocus:U,onBlur:q,skill:_,submitDisabled:it,...K}),[ye,Se,u,E,B,P,M,j,m,g,F,n,o,T,b,Fe,Y,U,q,_,it,K]),vt=ie=>{var ge,Ee,Re;!X&&ie.target!==((ge=oe.current)==null?void 0:ge.querySelector(`.${re}`))&&ie.preventDefault(),ie.target===((Ee=oe.current)==null?void 0:Ee.querySelector(`.${re}`))&&((Re=ee.current)==null||Re.focus())};return s.createElement("div",f._extends({key:k,ref:oe,className:ae,style:{...v.style,...l,...v.styles.root,...n.root}},Q),s.createElement(Ct.Provider,{value:xt},s.createElement(yt.Provider,{value:Ue},st&&s.createElement(Rn.Provider,{value:{prefixCls:F}},st),s.createElement("div",{className:I(`${F}-content`,o.content),style:n.content,onMouseDown:vt},rt&&s.createElement("div",{className:I(`${F}-prefix`,v.classNames.prefix,o.prefix),style:{...v.styles.prefix,...n.prefix}},rt),X?s.createElement(In,{ref:ee}):s.createElement(Dn,{ref:ee}),Te&&s.createElement("div",{className:I(Ce,v.classNames.suffix,o.suffix),style:{...v.styles.suffix,...n.suffix}},Te)),ot&&s.createElement("div",{className:I(`${F}-footer`,v.classNames.footer,o.footer),style:{...v.styles.footer,...n.footer}},ot))))}),St=_s;process.env.NODE_ENV!=="production"&&(St.displayName="Sender");St.Header=$s;St.Switch=Ms;class Bs{constructor(t){O(this,"_request");O(this,"_getMessagesFn");O(this,"_originalCallbacks");var n;const r=typeof t.request=="function"?t.request():t.request;if(!r.manual)throw new Error("request must be manual");this._request=r,this._originalCallbacks=(n=this._request.options)==null?void 0:n.callbacks}get request(){return this._request}getMessages(){return this==null?void 0:this._getMessagesFn()}injectGetMessages(t){this._getMessagesFn=t}injectRequest({onUpdate:t,onSuccess:r,onError:n}){var l,c,d;const o=(l=this._originalCallbacks)==null?void 0:l.onUpdate,i=(c=this._originalCallbacks)==null?void 0:c.onSuccess,a=(d=this._originalCallbacks)==null?void 0:d.onError;this._request.options.callbacks={onUpdate:(u,m)=>{t(u,m),o&&o(u,m)},onSuccess:(u,m)=>{r(u,m),i&&i(u,m)},onError:(u,m)=>{n(u,m),a&&a(u,m)}}}}const Be={_chatMessagesStores:new Map,get:e=>Be._chatMessagesStores.get(e),set:(e,t)=>{Be._chatMessagesStores.set(e,t)},delete:e=>{Be._chatMessagesStores.delete(e)},getMessages:e=>{const t=Be._chatMessagesStores.get(e);return t==null?void 0:t.getMessages()}};class Hs{constructor(t,r){O(this,"messages",[]);O(this,"listeners",[]);O(this,"conversationKey");O(this,"throttleTimer",null);O(this,"pendingEmit",!1);O(this,"throttleInterval",50);O(this,"setMessagesInternal",(t,r=!0)=>{let n;return typeof t=="function"?n=t(this.messages):n=t,this.messages=[...n],r?this.throttledEmitListeners():this.emitListeners(),!0});O(this,"setMessages",t=>this.setMessagesInternal(t,!0));O(this,"getMessages",()=>this.messages);O(this,"getMessage",t=>this.messages.find(r=>r.id===t));O(this,"addMessage",t=>this.getMessage(t.id)?!1:(this.setMessages([...this.messages,t]),!0));O(this,"setMessage",(t,r)=>{const n=this.getMessage(t);if(n){const o=typeof r=="function"?r(n):r;return Object.assign(n,o),this.setMessages([...this.messages]),!0}return!1});O(this,"removeMessage",t=>{const r=this.messages.findIndex(n=>n.id===t);return r!==-1?(this.messages.splice(r,1),this.setMessages([...this.messages]),!0):!1});O(this,"getSnapshot",()=>this.messages);O(this,"subscribe",t=>(this.listeners.push(t),()=>{this.listeners=this.listeners.filter(r=>r!==t),this.listeners.length===0&&(this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1)}));O(this,"destroy",()=>{this.throttleTimer&&(clearTimeout(this.throttleTimer),this.throttleTimer=null),this.pendingEmit=!1,this.listeners=[]});this.setMessagesInternal(t,!1),r&&(this.conversationKey=r,Be.set(this.conversationKey,this))}emitListeners(){this.listeners.forEach(t=>{t()})}throttledEmitListeners(){this.throttleTimer?this.pendingEmit=!0:(this.emitListeners(),this.pendingEmit=!1,this.throttleTimer=setTimeout(()=>{this.throttleTimer=null,this.pendingEmit&&(this.emitListeners(),this.pendingEmit=!1)},this.throttleInterval))}}function Os(e,t){const r=()=>{if(Be.get(t))return Be.get(t);const a=typeof e=="function"?e():e;return new Hs(a||[],t)},[n,o]=s.useState(r);return s.useEffect(()=>{o(r())},[t]),{messages:s.useSyncExternalStore(n.subscribe,n.getSnapshot,n.getSnapshot),addMessage:n.addMessage,removeMessage:n.removeMessage,setMessage:n.setMessage,getMessage:n.getMessage,setMessages:n.setMessages,getMessages:n.getMessages}}function Ls(e){return Array.isArray(e)?e:[e]}const qe=new Map,ks=()=>Symbol("ConversationKey");function Xs(e){const{defaultMessages:t,requestFallback:r,requestPlaceholder:n,parser:o,provider:i,conversationKey:a}=e,l=s.useRef(0),c=s.useRef(void 0),[d,u]=s.useState(!1),[m,g]=s.useState(a||ks());s.useEffect(()=>{a&&g(a)},[a]);const{messages:p,setMessages:y,getMessages:b,setMessage:S}=Os(()=>(t||[]).map((R,D)=>({id:`default_${D}`,status:"local",...R})),m),x=(R,D,P)=>{const M={id:`msg_${l.current}`,message:R,status:D};return P&&(M.extraInfo=P),l.current+=1,M},$=s.useMemo(()=>{const R=[];return p.forEach(D=>{const P=o?o(D.message):D.message,M=Ls(P);M.forEach((T,Y)=>{let U=D.id;M.length>1&&(U=`${U}_${Y}`),R.push({id:U,message:T,status:D.status})})}),R},[p]),E=R=>R.filter(D=>D.status!=="loading").map(D=>D.message);i==null||i.injectGetMessages(()=>E(b())),c.current=i==null?void 0:i.request;const B=()=>E(b()),j=(R,D)=>{if(!i)return;const{updatingId:P,reload:M}=D||{};let T=null;const Y=i.transformLocalMessage(R),U=(Array.isArray(Y)?Y:[Y]).map(K=>x(K,"local",D==null?void 0:D.extraInfo));M?(T=P,y(K=>{const Q=[...K];if(n){let k;typeof n=="function"?k=n(R,{messages:E(Q)}):k=n,Q.forEach(X=>{X.id===P&&(X.status="loading",X.message=k,D!=null&&D.extraInfo&&(X.extraInfo=D==null?void 0:D.extraInfo))})}return Q})):y(K=>{let Q=[...K,...U];if(n){let k;typeof n=="function"?k=n(R,{messages:E(Q)}):k=n;const X=x(k,"loading");T=X.id,Q=[...Q,X]}return Q});let q=null;const _=(K,Q,k,X)=>{let z=b().find(V=>V.id===q);if(z)y(V=>V.map(F=>{if(F.id===q){const oe=i.transformMessage({originMessage:F.message,chunk:Q,chunks:k,status:K,responseHeaders:X});return{...F,message:oe,status:K}}return F}));else if(M&&P)z=b().find(V=>V.id===P),z&&(z.status=K,z.message=i.transformMessage({chunk:Q,status:K,chunks:k,responseHeaders:X}),y(V=>[...V]),q=z.id);else{const V=i.transformMessage({chunk:Q,status:K,chunks:k,responseHeaders:X});z=x(V,K),y(F=>[...F.filter(ee=>ee.id!==T),z]),q=z.id}return z};i.injectRequest({onUpdate:(K,Q)=>{_("updating",K,[],Q)},onSuccess:(K,Q)=>{u(!1),m&&qe.delete(m),_("success",void 0,K,Q)},onError:async(K,Q)=>{if(u(!1),m&&qe.delete(m),r){let k;if(typeof r=="function"){const X=B(),z=b().find(V=>V.id===T||V.id===q);k=await r(R,{error:K,errorInfo:Q,messageInfo:z,messages:X})}else k=r;y(X=>[...X.filter(z=>z.id!==T&&z.id!==q),x(k,K.name==="AbortError"?"abort":"error")])}else y(k=>k.map(X=>X.id===T||X.id===q?{...X,status:K.name==="AbortError"?"abort":"error"}:X))}}),u(!0),m&&qe.set(m,!0),i.request.run(i.transformParams(R,i.request.options))},W=f.useEvent((R,D)=>{if(!i)throw new Error("provider is required");j(R,D)}),G=(R,D,P)=>{if(!i)throw new Error("provider is required");if(!R||!b().find(M=>M.id===R))throw new Error(`message [${R}] is not found`);j(D,{updatingId:R,reload:!0,extraInfo:P==null?void 0:P.extraInfo})};return{onRequest:W,messages:p,parsedMessages:$,setMessages:y,setMessage:S,abort:()=>{var R;if(!i)throw new Error("provider is required");(R=c.current)==null||R.abort()},isRequesting:m?(qe==null?void 0:qe.get(m))||!1:d,onReload:G}}const Qe={_allConversationStores:new Map,set:(e,t)=>{Qe._allConversationStores.set(e,t)},delete:e=>{Qe._allConversationStores.delete(e)},getConversation:e=>{for(const t of Qe._allConversationStores.values())if(t){const r=t.getConversation(e);if(r)return r}}};class zs{constructor(t,r){O(this,"conversations",[]);O(this,"listeners",[]);O(this,"storeKey");O(this,"activeConversationKey");O(this,"setActiveConversationKey",t=>(this.activeConversationKey=t,this.emitListeners(),!0));O(this,"setConversations",t=>(this.conversations=[...t],this.emitListeners(),!0));O(this,"getConversation",t=>this.conversations.find(r=>r.key===t));O(this,"addConversation",(t,r)=>this.getConversation(t.key)?!1:(this.setConversations(r==="prepend"?[t,...this.conversations]:[...this.conversations,t]),!0));O(this,"setConversation",(t,r)=>{const n=this.getConversation(t);return n?(Object.assign(n,r),this.setConversations([...this.conversations]),!0):!1});O(this,"removeConversation",t=>{const r=this.conversations.findIndex(n=>n.key===t);return r!==-1?(this.conversations.splice(r,1),this.setConversations([...this.conversations]),!0):!1});O(this,"getMessages",t=>Be.getMessages(t));O(this,"getSnapshot",()=>this.conversations);O(this,"getActiveConversationKey",()=>this.activeConversationKey);O(this,"subscribe",t=>(this.listeners.push(t),()=>{this.listeners=this.listeners.filter(r=>r!==t)}));O(this,"destroy",()=>{Qe.delete(this.storeKey)});this.setConversations(t),this.storeKey=Math.random().toString(),Qe.set(this.storeKey,this),this.activeConversationKey=r}emitListeners(){this.listeners.forEach(t=>{t()})}}function Fs(e){const[t]=s.useState(()=>new zs((e==null?void 0:e.defaultConversations)||[],(e==null?void 0:e.defaultActiveConversationKey)||""));s.useEffect(()=>()=>{t.destroy()},[]);const r=s.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getSnapshot),n=s.useSyncExternalStore(t.subscribe,t.getActiveConversationKey,t.getActiveConversationKey);return{conversations:r,activeConversationKey:n,setActiveConversationKey:t.setActiveConversationKey,addConversation:t.addConversation,removeConversation:t.removeConversation,setConversation:t.setConversation,getConversation:t.getConversation,setConversations:t.setConversations,getMessages:t.getMessages}}const Ks=`

`,qs=`
`,tn=":",It=e=>(e??"").trim()!=="";function Vs(){let e="";return new TransformStream({transform(t,r){e+=t;const n=e.split(Ks);n.slice(0,-1).forEach(o=>{It(o)&&r.enqueue(o)}),e=n[n.length-1]},flush(t){It(e)&&t.enqueue(e)}})}function Ws(){return new TransformStream({transform(e,t){const n=e.split(qs).reduce((o,i)=>{const a=i.indexOf(tn);if(a===-1)throw new Error(`The key-value separator "${tn}" is not found in the sse line chunk!`);const l=i.slice(0,a);if(!It(l))return o;const c=i.slice(a+1);return{...o,[l]:c}},{});Object.keys(n).length!==0&&t.enqueue(n)}})}function nn(e){const{readableStream:t,transformStream:r}=e;if(!(t instanceof ReadableStream))throw new Error("The options.readableStream must be an instance of ReadableStream.");const n=new TextDecoderStream,o=r?t.pipeThrough(n).pipeThrough(r):t.pipeThrough(n).pipeThrough(Vs()).pipeThrough(Ws());return o[Symbol.asyncIterator]=async function*(){const i=this.getReader();for(;;){const{done:a,value:l}=await i.read();if(a)break;l&&(yield l)}},o}const js=async(e,t)=>{const{fetch:r=globalThis.fetch,middlewares:n={},...o}=t;if(typeof r!="function")throw new Error("The options.fetch must be a typeof fetch function!");let i=[e,o];typeof n.onRequest=="function"&&(i=await n.onRequest(...i));let a=await r(...i);if(typeof n.onResponse=="function"){const l=await n.onResponse(a);if(!(l instanceof Response))throw new Error("The options.onResponse must return a Response instance!");a=l}if(!a.ok)throw new Error(`Fetch failed with status ${a.status}`);if(!a.body)throw new Error("The response body is empty.");return a},Us={headers:{"Content-Type":"application/json"}};class Gs{constructor(t,r){O(this,"baseURL");O(this,"options");if(!t||typeof t!="string")throw new Error("The baseURL is not valid!");this.baseURL=t,this.options=r||{}}}class Ys extends Gs{constructor(r,n){super(r,n);O(this,"_asyncHandler");O(this,"timeoutHandler");O(this,"_isTimeout",!1);O(this,"streamTimeoutHandler");O(this,"_isStreamTimeout",!1);O(this,"abortController");O(this,"_isRequesting",!1);O(this,"_manual",!1);O(this,"customResponseHandler",async(r,n,o,i)=>{const a=nn({readableStream:r.body,transformStream:o});await this.processStream(a,r,n,i)});O(this,"sseResponseHandler",async(r,n,o)=>{const i=nn({readableStream:r.body});await this.processStream(i,r,n,o)});O(this,"jsonResponseHandler",async(r,n)=>{var i,a,l;const o=await r.json();if((o==null?void 0:o.success)===!1){const c=new Error(o.message||"System error");c.name=o.name||"SystemError",(i=n==null?void 0:n.onError)==null||i.call(n,c,o)}else(a=n==null?void 0:n.onUpdate)==null||a.call(n,o,r.headers),this.finishRequest(),(l=n==null?void 0:n.onSuccess)==null||l.call(n,[o],r.headers)});this._manual=(n==null?void 0:n.manual)||!1,this.manual||this.init()}get asyncHandler(){return this._asyncHandler}get isTimeout(){return this._isTimeout}set isTimeout(r){this._isTimeout=r}get isStreamTimeout(){return this._isStreamTimeout}set isStreamTimeout(r){this._isStreamTimeout=r}get isRequesting(){return this._isRequesting}get manual(){return this._manual}run(r){this.manual?this.init(r):console.warn("The request is not manual, so it cannot be run!")}abort(){clearTimeout(this.timeoutHandler),clearTimeout(this.streamTimeoutHandler),this.abortController.abort()}init(r){this.abortController=new AbortController;const{callbacks:n,params:o,headers:i={},transformStream:a,fetch:l,timeout:c,streamTimeout:d,middlewares:u,...m}=this.options,g={...m,method:"POST",body:JSON.stringify({...o,...r||{}}),params:{...o,...r},headers:Object.assign({},Us.headers||{},i),signal:this.abortController.signal,middlewares:u};c&&c>0&&(this.timeoutHandler=window.setTimeout(()=>{var p;this.isTimeout=!0,this.finishRequest(),(p=n==null?void 0:n.onError)==null||p.call(n,new Error("TimeoutError"))},c)),this.startRequest(),this._asyncHandler=js(this.baseURL,{fetch:l,...g}).then(async p=>{if(clearTimeout(this.timeoutHandler),this.isTimeout)return;if(a){let S=a;typeof a=="function"&&(S=a(this.baseURL,p.headers)),await this.customResponseHandler(p,n,S,d);return}const y=p.headers.get("content-type")||"";switch(y.split(";")[0].trim()){case"text/event-stream":await this.sseResponseHandler(p,n,d);break;case"application/json":await this.jsonResponseHandler(p,n);break;default:throw new Error(`The response content-type: ${y} is not support!`)}}).catch(p=>{var b;clearTimeout(this.timeoutHandler),this.finishRequest();const y=p instanceof Error||p instanceof DOMException?p:new Error("Unknown error!");(b=n==null?void 0:n.onError)==null||b.call(n,y)})}startRequest(){this._isRequesting=!0}finishRequest(){this._isRequesting=!1}async processStream(r,n,o,i){var d,u;const a=[],l=r[Symbol.asyncIterator]();let c;do if(i&&(this.streamTimeoutHandler=window.setTimeout(()=>{var m;this.isStreamTimeout=!0,this.finishRequest(),(m=o==null?void 0:o.onError)==null||m.call(o,new Error("StreamTimeoutError"))},i)),c=await l.next(),a.push(c.value),(d=o==null?void 0:o.onUpdate)==null||d.call(o,c.value,n.headers),clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)break;while(!c.done);if(i&&(clearTimeout(this.streamTimeoutHandler),this.isStreamTimeout)){this.finishRequest();return}this.finishRequest(),(u=o==null?void 0:o.onSuccess)==null||u.call(o,a,n.headers)}}function Zs(e,t){return new Ys(e,t)}const Xe={escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeTest:/[&<>"']/,notSpaceStart:/^\S*/,endingNewline:/\n$/,escapeReplace:/[&<>"']/g,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,completeFencedCode:/^ {0,3}(`{3,}|~{3,})([\s\S]*?)\n {0,3}\1[ \n\t]*$/},Js={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},rn=e=>Js[e];function sn(e,t){if(t){if(Xe.escapeTest.test(e))return e.replace(Xe.escapeReplace,rn)}else if(Xe.escapeTestNoEncode.test(e))return e.replace(Xe.escapeReplaceNoEncode,rn);return e}class Qs{constructor(t={}){O(this,"options");O(this,"markdownInstance");const{markedConfig:r={}}=t;this.options=t,this.markdownInstance=new f.Marked,this.configureLinkRenderer(),this.configureParagraphRenderer(),this.configureCodeRenderer(),this.markdownInstance.use(r)}configureLinkRenderer(){if(!this.options.openLinksInNewTab)return;const t={link({href:r,title:n,tokens:o}){const i=this.parser.parseInline(o),a=n?` title="${n}"`:"";return`<a href="${r}"${a} target="_blank" rel="noopener noreferrer">${i}</a>`}};this.markdownInstance.use({renderer:t})}configureParagraphRenderer(){const{paragraphTag:t}=this.options;if(!t)return;const r={paragraph({tokens:n}){return`<${t}>${this.parser.parseInline(n)}</${t}>
`}};this.markdownInstance.use({renderer:r})}configureCodeRenderer(){const t={code({text:r,raw:n,lang:o,escaped:i,codeBlockStyle:a}){var p;const l=(p=(o||"").match(Xe.notSpaceStart))==null?void 0:p[0],c=`${r.replace(Xe.endingNewline,"")}
`,u=a==="indented"||Xe.completeFencedCode.test(n)?"done":"loading",m=i?c:sn(c,!0),g=l?` class="language-${sn(l)}"`:"";return`<pre><code data-block="true" data-state="${u}"${g}>${m}</code></pre>
`}};this.markdownInstance.use({renderer:t})}parse(t){return this.markdownInstance.parse(t)}}const eo=s.memo(e=>{const{text:t,animationConfig:r}=e,{fadeDuration:n=200,easing:o="ease-in-out"}=r||{},[i,a]=s.useState([]),l=s.useRef("");s.useEffect(()=>{if(t===l.current)return;if(!(l.current&&t.indexOf(l.current)===0)){a([t]),l.current=t;return}const d=t.slice(l.current.length);d&&(a(u=>[...u,d]),l.current=t)},[t]);const c=s.useMemo(()=>({animation:`x-markdown-fade-in ${n}ms ${o} forwards`}),[n,o]);return s.createElement(s.Fragment,null,i.map((d,u)=>s.createElement("span",{style:c,key:`animation-text-${u}`},d)))}),pt=class pt{constructor(t){O(this,"options");this.options=t}detectUnclosedTags(t){var a;const r=new Set,n=[],o=/<\/?([a-zA-Z][a-zA-Z0-9-]*)(?:\s[^>]*)?>/g;let i=o.exec(t);for(;i!==null;){const[l,c]=i,d=l.startsWith("</"),u=l.endsWith("/>");if((a=this.options.components)!=null&&a[c.toLowerCase()])if(d){const m=n.lastIndexOf(c.toLowerCase());m!==-1&&n.splice(m,1)}else u||n.push(c.toLowerCase());i=o.exec(t)}return n.forEach(l=>{r.add(l)}),r}configureDOMPurify(){const t=Object.keys(this.options.components||{}),r=this.options.dompurifyConfig||{},n=Array.isArray(r.ADD_TAGS)?r.ADD_TAGS:[],o=Array.isArray(r.ADD_ATTR)?r.ADD_ATTR:[];return{...r,ADD_TAGS:Array.from(new Set([...t,...n])),ADD_ATTR:Array.from(new Set(["target","rel",...o]))}}createReplaceElement(t,r){const{enableAnimation:n,animationConfig:o}=this.options.streaming||{};return i=>{var b,S,x;const a=`x-markdown-component-${r.current++}`,l=i.type==="text"&&i.data&&pt.NON_WHITESPACE_REGEX.test(i.data),c=(b=i.parent)==null?void 0:b.name,d=c&&((S=this.options.components)==null?void 0:S[c]);if(n&&l&&!d)return s.createElement(eo,{text:i.data,key:a,animationConfig:o});if(!("name"in i))return;const{name:m,attribs:g,children:p}=i,y=(x=this.options.components)==null?void 0:x[m];if(y){const $=t!=null&&t.has(m)?"loading":"done",E={domNode:i,streamStatus:$,key:a,...g,...g.disabled!==void 0&&{disabled:!0},...g.checked!==void 0&&{checked:!0}},B=[E.className,E.classname,E.class].filter(Boolean).join(" ").trim();if(E.className=B||"",m==="code"){const{"data-block":j="false","data-state":W="done"}=g||{};E.block=j==="true",E.streamStatus=W==="loading"?"loading":"done"}return p&&(E.children=this.processChildren(p,t,r)),s.createElement(y,E)}}}processChildren(t,r,n){return f.lib.domToReact(t,{replace:this.createReplaceElement(r,n)})}processHtml(t){const r=this.detectUnclosedTags(t),n={current:0},o=this.configureDOMPurify(),i=f.purify.sanitize(t,o);return f.parseHtml(i,{replace:this.createReplaceElement(r,n)})}render(t){return this.processHtml(t)}};O(pt,"NON_WHITESPACE_REGEX",/[^\r\n\s]+/);let Dt=pt,de=function(e){return e.Text="text",e.Link="link",e.Image="image",e.Html="html",e.Emphasis="emphasis",e.List="list",e.Table="table",e}({});const to=/^(`{3,}|~{3,})/,Ze={image:[/^!\[[^\]\r\n]{0,1000}$/,/^!\[[^\r\n]{0,1000}\]\(*[^)\r\n]{0,1000}$/],link:[/^\[[^\]\r\n]{0,1000}$/,/^\[[^\r\n]{0,1000}\]\(*[^)\r\n]{0,1000}$/],html:[/^<\/$/,/^<\/?[a-zA-Z][a-zA-Z0-9-]{0,100}[^>\r\n]{0,1000}$/],commonEmphasis:[/^(\*{1,3}|_{1,3})(?!\s)(?!.*\1$)[^\r\n]{0,1000}$/],list:[/^[-+*]\s{0,3}$/,/^[-+*]\s{1,3}(\*{1,3}|_{1,3})(?!\s)(?!.*\1$)[^\r\n]{0,1000}$/]},no=e=>{if(e.includes(`

`))return!1;const t=e.split(`
`);if(t.length<=1)return!0;const[r,n]=t,o=r.trim();if(!/^\|.*\|$/.test(o))return!1;const a=n.trim().split("|").map(c=>c.trim()).filter(Boolean),l=/^:?-+:?$/;return a.every((c,d)=>d===a.length-1&&c===":"||l.test(c))},An={[de.Link]:{tokenType:de.Link,isStartOfToken:e=>e.startsWith("["),isStreamingValid:e=>Ze.link.some(t=>t.test(e))},[de.Image]:{tokenType:de.Image,isStartOfToken:e=>e.startsWith("!"),isStreamingValid:e=>Ze.image.some(t=>t.test(e))},[de.Html]:{tokenType:de.Html,isStartOfToken:e=>e.startsWith("<"),isStreamingValid:e=>Ze.html.some(t=>t.test(e))},[de.Emphasis]:{tokenType:de.Emphasis,isStartOfToken:e=>e.startsWith("*")||e.startsWith("_"),isStreamingValid:e=>Ze.commonEmphasis.some(t=>t.test(e))},[de.List]:{tokenType:de.List,isStartOfToken:e=>/^[-+*]/.test(e),isStreamingValid:e=>Ze.list.some(t=>t.test(e))},[de.Table]:{tokenType:de.Table,isStartOfToken:e=>e.startsWith("|"),isStreamingValid:no}},ro=(e,t)=>{const r=An[t];if(!r)return;const{token:n,pending:o}=e;if(n===de.Text&&r.isStartOfToken(o)){e.token=t;return}n===t&&!r.isStreamingValid(o)&&At(e)},on=Object.values(An).map(e=>({tokenType:e.tokenType,recognize:t=>ro(t,e.tokenType)})),Tt=()=>({pending:"",token:de.Text,processedLength:0,completeMarkdown:""}),At=e=>{e.pending&&(e.completeMarkdown+=e.pending,e.pending=""),e.token=de.Text},so=e=>{const t=e.split(`
`);let r=!1,n="",o=0;for(const i of t){const l=(i.endsWith("\r")?i.slice(0,-1):i).match(to);if(l){const c=l[1],d=c[0],u=c.length;r?d===n&&u>=o&&(r=!1,n="",o=0):(r=!0,n=d,o=u)}}return r},oo=e=>{let t="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r);n>=55296&&n<=56319?r+1<e.length&&e.charCodeAt(r+1)>=56320&&e.charCodeAt(r+1)<=57343&&(t+=e[r]+e[r+1],r++):(n<56320||n>57343)&&(t+=e[r])}return t},io=e=>{try{return encodeURIComponent(e)}catch(t){return t instanceof URIError?encodeURIComponent(oo(e)):""}},ao=(e,t)=>{const{streaming:r,components:n={}}=t||{},{hasNextChunk:o=!1,incompleteMarkdownComponentMap:i}=r||{},[a,l]=s.useState(""),c=s.useRef(Tt()),d=s.useCallback(m=>{const{token:g,pending:p}=m;if(g===de.Text||g===de.Image&&p==="!")return;if(g===de.Table&&p.split(`
`).length>2)return p;const b=(i||{})[g]||`incomplete-${g}`,S=io(p);return n!=null&&n[b]?`<${b} data-raw="${S}" />`:void 0},[i,n]),u=s.useCallback(m=>{if(!m){l(""),c.current=Tt();return}const g=c.current.completeMarkdown+c.current.pending;m.startsWith(g)||(c.current=Tt());const p=c.current,y=m.slice(p.processedLength);if(!y)return;p.processedLength+=y.length;const b=so(m);for(const x of y){if(p.pending+=x,b){At(p);continue}if(p.token===de.Text)for(const $ of on)$.recognize(p);else{const $=on.find(E=>E.tokenType===p.token);$==null||$.recognize(p)}p.token===de.Text&&At(p)}const S=d(p);l(p.completeMarkdown+(S||""))},[d]);return s.useEffect(()=>{if(typeof e!="string"){console.error(`X-Markdown: input must be string, not ${typeof e}.`),l("");return}o?u(e):l(e)},[e,o,u]),a},Pn=s.memo(e=>{const{streaming:t,config:r,components:n,paragraphTag:o,content:i,children:a,rootClassName:l,className:c,style:d,openLinksInNewTab:u,dompurifyConfig:m}=e,g=I("x-markdown",l,c),p=ao(i||a||"",{streaming:t,components:n}),y=s.useMemo(()=>new Qs({markedConfig:r,paragraphTag:o,openLinksInNewTab:u}),[r,o,u]),b=s.useMemo(()=>new Dt({components:n,dompurifyConfig:m,streaming:t}),[n,m,t]),S=s.useMemo(()=>p?y.parse(p):"",[p,y]);return p?s.createElement("div",{className:g,style:d},b.render(S)):null});process.env.NODE_ENV!=="production"&&(Pn.displayName="XMarkdown");exports.AbstractChatProvider=Bs;exports.CodeHighlighter=xn;exports.Conversations=Ht;exports.ForwardBubble=Oe;exports.Mermaid=ps;exports.Sender=St;exports.XMarkdown=Pn;exports.XProvider=mn;exports.XRequest=Zs;exports.useXChat=Xs;exports.useXConversations=Fs;
