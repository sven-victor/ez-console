"use strict";const e=require("./vendor.js"),_=require("react-router-dom"),A=require("./contexts.js"),B=require("./base.js"),t=require("antd"),v=require("react-i18next"),$=require("classnames"),z=require("antd-style"),x=require("react"),R=require("@ant-design/icons"),F=require("ahooks"),E=require("./index.js"),T=require("./client.js"),K=require("antd-img-crop"),G=require("lodash");function W(s){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const n in s)if(n!=="default"){const i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:()=>s[n]})}}return r.default=s,Object.freeze(r)}const Q=W(R),D=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(t.Spin,{size:"large"})}),J=({element:s,requiredPermission:r,requiredPermissions:n})=>{const{user:i,loading:o}=A.useAuth(),{hasPermission:a,hasAllPermissions:m}=A.usePermission();return o?e.jsxRuntimeExports.jsx(D,{}):i?r&&!a(r)?e.jsxRuntimeExports.jsx(_.Navigate,{to:"/forbidden",replace:!0}):n&&!m(n)?e.jsxRuntimeExports.jsx(_.Navigate,{to:"/forbidden",replace:!0}):s:(window.location.href=B.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},X=z.createStyles(({token:s,css:r})=>({container:r`
      ${r`
        @media screen and (max-width: ${s.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${s.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${s.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:s.colorPrimaryTextHover}}})),q=({overlayClassName:s,overlay:r,hidden:n,children:i,...o})=>{if(n)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:a}=X();return e.jsxRuntimeExports.jsx(t.Dropdown,{dropdownRender:r,overlayClassName:$(a.container,s),...o,children:e.jsxRuntimeExports.jsx("span",{className:a.iconStyle,children:i})})},Z=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),Y=z.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),M=[{lang:"en-US",label:"English",icon:"🇺🇸"},{lang:"sv-SE",label:"Svenska",icon:"🇸🇪"},{lang:"ar-AE",label:"العربية",icon:"🇦🇪"},{lang:"de-DE",label:"Deutsch",icon:"🇩🇪"},{lang:"es-ES",label:"Español",icon:"🇪🇸"},{lang:"fr-FR",label:"Français",icon:"🇫🇷"},{lang:"zh-CN",label:"中文",icon:"🇨🇳"}],ee=({transformLangConfig:s=r=>r})=>{const{i18n:r}=v.useTranslation(),{styles:n}=Y(),i=a=>{r.changeLanguage(a)},o={selectedKeys:[r.language],onClick:a=>{i(a.key)},items:s(M).map(a=>({key:a.lang,className:n.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(a==null?void 0:a.label)||"en-US",className:n.menuItemIconStyle,children:(a==null?void 0:a.icon)||"🌐"}),(a==null?void 0:a.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(q,{menu:o,children:e.jsxRuntimeExports.jsx(Z,{})})},te=z.createStyles(({css:s})=>({avatarItem:s`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),U=s=>G.isString(s)&&s.match(/^[-_a-zA-Z0-9]+$/)?T.baseURL.endsWith("/")?T.baseURL+`files/${s}`:T.baseURL+`/files/${s}`:s,V=({src:s,...r})=>e.jsxRuntimeExports.jsx(t.Avatar,{src:U(s),...r}),se=({onChange:s,shape:r="square"})=>{const[n,i]=x.useState([]),{styles:o}=te(),[a,m]=x.useState(!1),[u,j]=x.useState(!0),[h,f]=x.useState(0),{run:c,loading:d}=F.useRequest(()=>E.api.base.listFiles({current:h+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:l})=>{i([...n,...l]),j(l.length===40),f(h+1)}}),y=()=>{j(!0),f(0),i([])};return e.jsxRuntimeExports.jsx(t.Popover,{style:{zIndex:1e3},onOpenChange:l=>{m(l),l?c():y()},open:a,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:n.length,next:()=>{c()},hasMore:u,loader:e.jsxRuntimeExports.jsx(t.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(t.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(t.List,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:d,renderItem:({id:l})=>e.jsxRuntimeExports.jsx("div",{className:o.avatarItem,onClick:g=>{g.stopPropagation(),s==null||s(l),m(!1),y()},children:e.jsxRuntimeExports.jsx(V,{shape:r,src:l})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(R.UploadOutlined,{shape:r,style:{width:112,height:112,placeContent:"center"}})})},N=({value:s,onChange:r,shape:n,...i})=>{const[o,a]=x.useState(void 0),[m,u]=x.useState(!1),[j,h]=x.useState(void 0),f=async c=>{u(!0),h(c.url??c.preview)};return x.useEffect(()=>{a(s?{uid:s,name:s,url:U(s)}:void 0)},[s]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(K,{beforeCrop:async c=>{if(c.type==="image/svg+xml"){const d=await E.api.base.uploadFile({type:"avatar"},c);return d.length>0&&(r==null||r(d[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(t.Upload,{customRequest:async c=>{var y,l;const d=await E.api.base.uploadFile({type:"avatar",access:"public"},c.file);d.length>0?((y=c.onSuccess)==null||y.call(c,d[0].id),r==null||r(d[0].id)):(l=c.onError)==null||l.call(c,new Error("Upload file failed"))},listType:"picture-card",onPreview:f,maxCount:1,onChange:({file:c})=>{switch(c.status){case"removed":r==null||r(void 0);break;case"done":break;default:a(c);break}},fileList:o?[o]:[],...i,children:o?void 0:e.jsxRuntimeExports.jsx(se,{shape:n,onChange:r})})}),e.jsxRuntimeExports.jsx(t.Modal,{open:m,footer:null,onCancel:()=>u(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:j})})]})},O=({permission:s,permissions:r=[],checkAll:n=!1,fallback:i=null,children:o})=>{const{hasPermission:a,hasAnyPermission:m,hasAllPermissions:u,isAdmin:j,loading:h}=A.usePermission();return h?null:j?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o}):s?a(s)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):r.length>0?(n?u(r):m(r))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o})},ne=({fallback:s=null,children:r})=>{const{isAdmin:n,loading:i}=A.usePermission();return i?null:n?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:s})},k=s=>{const{permission:r,icon:n,tooltip:i,onClick:o,confirm:a,...m}=s;return r?e.jsxRuntimeExports.jsx(O,{permission:r,children:k({icon:n,tooltip:i,onClick:o,confirm:a,...m})},s.key):a?e.jsxRuntimeExports.jsx(t.Popconfirm,{title:a.title,onConfirm:a.onConfirm||o,okText:a.okText,cancelText:a.cancelText,children:k({icon:n,tooltip:i,...m})},s.key):i?e.jsxRuntimeExports.jsx(t.Tooltip,{title:i,children:k({icon:n,onClick:o,...m})},s.key):x.createElement(t.Button,{type:"text",size:"small",icon:n,onClick:o,...m,key:s.key})},re=({actions:s})=>s.filter(r=>!r.hidden).map(r=>k(r)),ie=Q,H=s=>ie[s],ae=({iconName:s})=>{if(!s)return null;const r=H(s);return r?e.jsxRuntimeExports.jsx(x.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(r,{})}):null},oe=({onChange:s})=>{const[r,n]=x.useState(""),[i,o]=x.useState("");return e.jsxRuntimeExports.jsxs(t.Space.Compact,{children:[e.jsxRuntimeExports.jsx(t.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:a=>n(a.target.value)}),e.jsxRuntimeExports.jsx(t.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(t.Input,{style:{width:"calc(100% - 80px)"},value:i,onChange:a=>o(a.target.value)}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(R.PlusOutlined,{}),onClick:()=>{s(r,i)}})]})},le=({request:s,tableRef:r,...n},i)=>{const[o,a]=x.useState({current:1,pageSize:10}),[m,u]=x.useState(0),{data:j,loading:h,refresh:f}=F.useRequest(async()=>{const c=await s({current:o.current,page_size:o.pageSize});return u(c.total),c.data},{refreshDeps:[o]});return x.useImperativeHandle(i,()=>({reload:()=>{f()}})),e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",loading:h,dataSource:j??[],pagination:{...o,total:m,onChange:(c,d)=>{a({current:c,pageSize:d})}},...n,ref:r})},ue=({actionRef:s,...r})=>{const[n,i]=x.useState();return x.useEffect(()=>{i(x.forwardRef(le))},[]),n?e.jsxRuntimeExports.jsx(n,{...r,ref:s}):null},ce=({onSuccess:s,token:r})=>{const{t:n}=v.useTranslation("authorization"),{t:i}=v.useTranslation("common"),[o]=t.Form.useForm(),{run:a,loading:m}=F.useRequest(async u=>E.api.authorization.changePassword(u,r?{headers:{Authorization:`Bearer ${r}`}}:{}),{manual:!0,onSuccess:()=>{t.message.success(n("user.passwordChanged")),o.resetFields(),s==null||s()},onError:u=>{if(u instanceof T.ApiError){const j=u.code??"normal";t.message.error(n(`user.passwordChangeFailed.${j}`,{error:u.message,defaultValue:"Password change failed: {{error}}"}))}else t.message.error(n("user.passwordChangeFailed.normal",{error:u.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",u)}});return e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:a,style:{maxWidth:500,margin:"0 auto"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"old_password",label:n("user.oldPassword"),rules:[{required:!0,message:n("validation.oldPasswordRequired")}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"new_password",label:n("user.newPassword"),rules:[{required:!0,message:n("validation.newPasswordRequired")},{min:8,message:n("validation.passwordMinLength")}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"confirm_password",label:n("user.confirmPassword"),rules:[{required:!0,message:n("validation.confirmPasswordRequired")},({getFieldValue:u})=>({validator(j,h){return!h||u("new_password")===h?Promise.resolve():Promise.reject(new Error(n("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(t.Input.Password,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:m,children:i("save")})})]})},xe=({user:s,onSuccess:r})=>{const{t:n}=v.useTranslation("authorization"),{t:i}=v.useTranslation("common"),[o]=t.Form.useForm(),[a,m]=x.useState(!1);x.useEffect(()=>{s&&o.setFieldsValue({username:s.username,email:s.email,full_name:s.full_name,phone:s.phone||"",avatar:s.avatar})},[s,o]);const u=async j=>{try{m(!0),await E.api.authorization.updateCurrentUser(j),t.message.success(i("updateSuccess")),r()}catch(h){t.message.error(i("updateFailed")),console.error("Failed to update user information:",h)}finally{m(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(s==null?void 0:s.full_name)||(s==null?void 0:s.username)}),(s==null?void 0:s.roles)&&s.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[n("user.roles"),": ",s.roles.map(j=>j.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:u,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(N,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"username",label:n("user.username"),children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"phone",label:n("user.phone"),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:a,children:i("save")})})]})]})},me=({user:s,onSuccess:r})=>{const{t:n}=v.useTranslation("authorization"),{t:i}=v.useTranslation("common"),[o,a]=x.useState(0),[m,u]=x.useState(!1),[j,h]=x.useState(!0),[f,c]=x.useState(""),[d,y]=x.useState("totp"),{run:l,data:g={secret:"",qr_code:"",token:void 0}}=F.useRequest(()=>E.api.authorization.enableMfa(d),{manual:!0,onSuccess:()=>{a(1)},onBefore:()=>{u(!0)},onFinally:()=>{u(!1)}}),L=async()=>{if(!f){t.message.warning(n("mfa.enterVerificationCode"));return}const S={code:f,mfa_type:d};"token"in g&&(S.token=g.token);try{u(!0),await E.api.authorization.verifyAndActivateMfa(S),t.message.success(n("mfa.enableSuccess")),a(2),r()}catch(b){t.message.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",b)}finally{u(!1)}},p=async()=>{try{u(!0),await E.api.authorization.disableMfa(),t.message.success(n("mfa.disableSuccess")),r()}catch(S){t.message.error(i("operationFailed")),console.error("Failed to disable MFA:",S)}finally{u(!1)}},w=()=>{if(!s)return null;if(s.mfa_enabled)return e.jsxRuntimeExports.jsx(t.Result,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(t.Button,{danger:!0,onClick:()=>{t.Modal.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:p,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const S=()=>{var b;switch(o){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(t.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:n("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:n(d==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:l,loading:m,children:n("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(t.Alert,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:d==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:d==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(t.QRCode,{value:g.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:d==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:s==null?void 0:s.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:d==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:j?"*".repeat(((b=g.secret)==null?void 0:b.length)??0):g.secret}),e.jsxRuntimeExports.jsx(t.Button,{type:"link",onClick:()=>h(!j),icon:j?e.jsxRuntimeExports.jsx(R.EyeOutlined,{}):e.jsxRuntimeExports.jsx(R.EyeInvisibleOutlined,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:f,onChange:C=>c(C.target.value)})}),e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>a(0),children:i("previous")}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:L,loading:m,children:i("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(t.Result,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",onClick:()=>a(0),children:i("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:o===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(t.Segmented,{defaultValue:"totp",onChange:b=>{y(b),a(0)},value:d,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(R.ClockCircleFilled,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(R.MailOutlined,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(t.Divider,{})]}),e.jsxRuntimeExports.jsx(t.Steps,{current:o,items:[{title:n(d==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(d==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(d==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(d==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(d==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(d==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),S()]})};return e.jsxRuntimeExports.jsx(t.Card,{title:n("mfa.title"),children:w()})},{Text:P}=t.Typography,de=()=>{const{t:s}=v.useTranslation("authorization"),{t:r}=v.useTranslation("common"),[n,i]=x.useState([]),[o,a]=x.useState(!1),[m,u]=x.useState(null),[j,h]=x.useState(!1),f=async()=>{try{a(!0);const l=await E.api.authorization.getUserSessions({});i(l)}catch(l){t.message.error(s("session.getSessionsFailed",{error:l,defaultValue:"Failed to get session list: {{error}}"}))}finally{a(!1)}};x.useEffect(()=>{f()},[]);const c=async l=>{try{u(l),await E.api.authorization.terminateSession({id:l}),i(n.filter(g=>g.id!==l)),t.message.success(s("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(g){t.message.error(s("session.terminateFailed",{error:g,defaultValue:"Failed to terminate session: {{error}}"}))}finally{u(null)}},d=async()=>{try{h(!0),await E.api.authorization.terminateOtherSessions(),i(n.filter(l=>l.is_current)),t.message.success(s("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(l){t.message.error(s("session.terminateAllFailed",{error:l,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{h(!1)}},y=[{title:s("session.device"),dataIndex:"user_agent",key:"device",render:(l,g)=>e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(R.LaptopOutlined,{}),e.jsxRuntimeExports.jsx(P,{strong:!0,children:l})]}),e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(R.EnvironmentOutlined,{}),e.jsxRuntimeExports.jsx(P,{type:"secondary",children:g.location})]})]})},{title:s("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:l=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(R.GlobalOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:l})]})},{title:s("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:l=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(R.ClockCircleOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(l).toLocaleString()})]})},{title:s("session.status"),key:"status",render:l=>l.is_current?e.jsxRuntimeExports.jsx(t.Tag,{color:"green",children:s("session.current")}):e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:s("session.active")})},{title:r("actions"),key:"action",render:l=>l.is_current?e.jsxRuntimeExports.jsx(P,{type:"secondary",children:s("session.currentSession")}):e.jsxRuntimeExports.jsx(t.Popconfirm,{title:s("session.confirmTerminate"),onConfirm:()=>c(l.id),okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",danger:!0,loading:m===l.id,children:s("session.terminate")})})}];return e.jsxRuntimeExports.jsx(t.Card,{title:s("session.title"),extra:n.length>1&&e.jsxRuntimeExports.jsx(t.Popconfirm,{title:s("session.confirmTerminateAll"),onConfirm:d,okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(t.Button,{danger:!0,loading:j,children:s("session.terminateOthers")})}),children:n.length===0?e.jsxRuntimeExports.jsx(t.Empty,{description:s("session.noSessions")}):e.jsxRuntimeExports.jsx(t.Table,{columns:y,dataSource:n,rowKey:"id",loading:o,pagination:!1})})},{RangePicker:pe}=t.DatePicker,{Option:I}=t.Select,je=s=>s||"N/A",he=(s,r)=>s==="success"?e.jsxRuntimeExports.jsx(t.Tag,{color:"success",children:r("statuses.success")}):e.jsxRuntimeExports.jsx(t.Tag,{color:"error",children:r("statuses.failed")}),ge=({userId:s,request:r=i=>s?E.api.authorization.getUserLogs({id:s,...i}):E.api.authorization.getCurrentUserLogs(i),columnsFilter:n=i=>i})=>{const{t:i}=v.useTranslation("authorization"),{t:o}=v.useTranslation("common"),[a,m]=x.useState({current:1,pageSize:10,total:0}),[u,j]=x.useState({}),[h]=t.Form.useForm(),{loading:f,run:c,data:{data:d}={}}=F.useRequest(async(p=u,w=1,S=10)=>r({...p,current:w??1,page_size:S??10}),{onError(p){t.message.error(i("auditLog.fetchFailed",{error:p}))},onSuccess({total:p}){m({...a,total:p})}});x.useEffect(()=>{c(u,1,a.pageSize)},[]);const y=p=>{m({...a,current:p.current,pageSize:p.pageSize}),c({},p.current,p.pageSize)},l=p=>{var w,S,b,C;c({...p,start_time:(S=(w=p.dateRange)==null?void 0:w[0])==null?void 0:S.toISOString(),end_time:(C=(b=p.dateRange)==null?void 0:b[1])==null?void 0:C.toISOString()},1,a.pageSize)},g=()=>{h.resetFields(),j({}),m({...a,current:1}),c({},1,a.pageSize)},L=[{title:i("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:p=>B.formatDate(p)},{title:i("auditLog.action"),dataIndex:"action",key:"action",render:(p,w)=>p?i(`action.${p.replace(":",".")}`,{defaultValue:w.action_name}):w.action_name??w.action},{title:i("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:i("auditLog.ip"),dataIndex:"ip",key:"ip",render:p=>je(p)},{title:i("auditLog.status"),dataIndex:"status",key:"status",render:p=>he(p,i)},{title:i("auditLog.details"),dataIndex:"details",key:"details",render:p=>e.jsxRuntimeExports.jsx(t.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(R.EyeOutlined,{}),onClick:()=>{t.Modal.info({title:i("auditLog.details"),content:JSON.stringify(p)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Form,{form:h,layout:"horizontal",onFinish:l,initialValues:u,children:[e.jsxRuntimeExports.jsxs(t.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(t.Col,{span:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"search",label:i("auditLog.search"),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:i("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(t.Col,{span:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"action",label:i("auditLog.action"),children:e.jsxRuntimeExports.jsxs(t.Select,{allowClear:!0,placeholder:i("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(I,{value:"login",children:i("actions.login")}),e.jsxRuntimeExports.jsx(I,{value:"logout",children:i("actions.logout")}),e.jsxRuntimeExports.jsx(I,{value:"password_reset",children:i("actions.passwordReset")}),e.jsxRuntimeExports.jsx(I,{value:"mfa_change",children:i("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(t.Col,{span:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:i("auditLog.status"),children:e.jsxRuntimeExports.jsxs(t.Select,{allowClear:!0,placeholder:i("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(I,{value:"success",children:i("statuses.success")}),e.jsxRuntimeExports.jsx(I,{value:"failed",children:i("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(t.Col,{span:6,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"dateRange",label:i("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(pe,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(t.Row,{children:e.jsxRuntimeExports.jsx(t.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{onClick:g,children:o("reset")}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(R.SearchOutlined,{}),children:o("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(t.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(R.ReloadOutlined,{}),onClick:g,style:{marginRight:8},children:o("refresh")})}),e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",columns:n(L),dataSource:d,pagination:{...a,showSizeChanger:!0,showTotal:p=>o("totalItems",{total:p})},loading:f,onChange:y,scroll:{x:"max-content"}})]})]})};exports.Actions=re;exports.AdminGuard=ne;exports.AllLangUIConfig=M;exports.Avatar=V;exports.AvatarUpload=N;exports.DynamicIcon=ae;exports.HeaderDropdown=q;exports.LabelCreater=oe;exports.LanguageSwitch=ee;exports.Loading=D;exports.PermissionGuard=O;exports.PrivateRoute=J;exports.ProfileBasic=xe;exports.ProfileMFA=me;exports.ProfilePassword=ce;exports.ProfileSessions=de;exports.Table=ue;exports.UserAuditLogs=ge;exports.getIconByName=H;
