"use strict";var Fe=Object.defineProperty;var Ae=(t,r,n)=>r in t?Fe(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n;var Z=(t,r,n)=>Ae(t,typeof r!="symbol"?r+"":r,n);const e=require("./vendor.js"),ee=require("react-router-dom"),A=require("./contexts.js"),H=require("./base.js"),s=require("antd"),w=require("react-i18next"),D=require("antd-style"),v=require("@ant-design/icons"),ne=require("classnames"),p=require("react"),S=require("./index.js"),L=require("ahooks"),q=require("dayjs"),$=require("./client.js"),Te=require("antd-img-crop"),Le=require("lodash");function Pe(t){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,o.get?o:{enumerable:!0,get:()=>t[n]})}}return r.default=t,Object.freeze(r)}const Me=Pe(v),re=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(s.Spin,{size:"large"})}),ze=({element:t,requiredPermission:r,requiredPermissions:n})=>{const{t:o}=w.useTranslation(),{user:a,loading:i,error:x}=A.useAuth(),{hasPermission:l,hasAllPermissions:j}=A.usePermission();return i?e.jsxRuntimeExports.jsx(re,{}):x?e.jsxRuntimeExports.jsx(s.Result,{status:"500",title:"500",subTitle:o("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(x==null?void 0:x.message)||x})}):a?r&&!l(r)?e.jsxRuntimeExports.jsx(ee.Navigate,{to:"/forbidden",replace:!0}):n&&!j(n)?e.jsxRuntimeExports.jsx(ee.Navigate,{to:"/forbidden",replace:!0}):t:(window.location.href=H.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},_e=D.createStyles(({token:t,css:r})=>({container:r`
      ${r`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),W=({overlayClassName:t,overlay:r,hidden:n,children:o,...a})=>{if(n)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:i}=_e();return e.jsxRuntimeExports.jsx(s.Dropdown,{dropdownRender:r,overlayClassName:ne(i.container,t),...a,children:e.jsxRuntimeExports.jsx("span",{className:i.iconStyle,children:o})})},Be=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),De=D.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),oe=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],$e=({transformLangConfig:t=r=>r})=>{const{i18n:r}=w.useTranslation(),{styles:n}=De(),o=i=>{r.changeLanguage(i)},a={selectedKeys:[r.language],onClick:i=>{o(i.key)},items:t(oe).map(i=>({key:i.lang,className:n.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(i==null?void 0:i.label)||"en-US",className:n.menuItemIconStyle,children:(i==null?void 0:i.icon)||"ðŸŒ"}),(i==null?void 0:i.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(W,{menu:a,children:e.jsxRuntimeExports.jsx(Be,{})})},Oe=D.createStyles(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),ie=t=>Le.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?$.baseURL.endsWith("/")?$.baseURL+`files/${t}`:$.baseURL+`/files/${t}`:t,ae=({src:t,fallback:r,...n})=>e.jsxRuntimeExports.jsx(s.Avatar,{src:ie(t),icon:r,...n}),qe=({onChange:t,shape:r="square"})=>{const[n,o]=p.useState([]),{styles:a}=Oe(),[i,x]=p.useState(!1),[l,j]=p.useState(!0),[h,g]=p.useState(0),{run:c,loading:d}=L.useRequest(()=>S.api.base.listFiles({current:h+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:m})=>{o([...n,...m]),j(m.length===40),g(h+1)}}),E=()=>{j(!0),g(0),o([])};return e.jsxRuntimeExports.jsx(s.Popover,{style:{zIndex:1e3},onOpenChange:m=>{x(m),m?c():E()},open:i,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:n.length,next:()=>{c()},hasMore:l,loader:e.jsxRuntimeExports.jsx(s.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(s.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(s.List,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:d,renderItem:({id:m})=>e.jsxRuntimeExports.jsx("div",{className:a.avatarItem,onClick:f=>{f.stopPropagation(),t==null||t(m),x(!1),E()},children:e.jsxRuntimeExports.jsx(ae,{shape:r,src:m})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(v.UploadOutlined,{shape:r,style:{width:112,height:112,placeContent:"center"}})})},le=({value:t,onChange:r,shape:n,...o})=>{const[a,i]=p.useState(void 0),[x,l]=p.useState(!1),[j,h]=p.useState(void 0),g=async c=>{l(!0),h(c.url??c.preview)};return p.useEffect(()=>{i(t?{uid:t,name:t,url:ie(t)}:void 0)},[t]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(Te,{beforeCrop:async c=>{if(c.type==="image/svg+xml"){const d=await S.api.base.uploadFile({type:"avatar"},c);return d.length>0&&(r==null||r(d[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(s.Upload,{customRequest:async c=>{var E,m;const d=await S.api.base.uploadFile({type:"avatar",access:"public"},c.file);d.length>0?((E=c.onSuccess)==null||E.call(c,d[0].id),r==null||r(d[0].id)):(m=c.onError)==null||m.call(c,new Error("Upload file failed"))},listType:"picture-card",onPreview:g,maxCount:1,onChange:({file:c})=>{switch(c.status){case"removed":r==null||r(void 0);break;case"done":break;default:i(c);break}},fileList:a?[a]:[],...o,children:a?void 0:e.jsxRuntimeExports.jsx(qe,{shape:n,onChange:r})})}),e.jsxRuntimeExports.jsx(s.Modal,{open:x,footer:null,onCancel:()=>l(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:j})})]})},Ve=()=>{const{t}=w.useTranslation("common"),{user:r}=A.useAuth(),{currentOrgId:n,setCurrentOrgId:o}=A.useSite(),a=(r==null?void 0:r.organizations)||[],i=h=>{o(h),window.location.reload()};if(a.length===0)return null;const x=a.find(h=>h.id===n),l=x?x.name:t("organization.global",{defaultValue:"Global"}),j=[...a.map(h=>({key:h.id,label:e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxRuntimeExports.jsx("span",{children:h.name}),n===h.id&&e.jsxRuntimeExports.jsx(v.CheckOutlined,{})]}),onClick:()=>i(h.id)}))];return e.jsxRuntimeExports.jsxs(W,{menu:{items:j,selectedKeys:n?[n]:[""]},children:[e.jsxRuntimeExports.jsx(v.TeamOutlined,{style:{marginRight:4}}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:l})]})},Ne=({onResize:t,minWidth:r=300,maxWidth:n=window.innerWidth*.5})=>{const[o,a]=p.useState(!1),[i,x]=p.useState(!1),l=p.useCallback(g=>{g.preventDefault(),a(!0)},[]),j=p.useCallback(g=>{if(!o)return;const c=window.innerWidth-g.clientX,d=Math.max(r,Math.min(n,c));t(d)},[o,r,n,t]),h=p.useCallback(()=>{a(!1)},[]);return p.useEffect(()=>{if(o)return document.addEventListener("mousemove",j),document.addEventListener("mouseup",h),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",h),document.body.style.cursor="",document.body.style.userSelect=""}},[o,j,h]),e.jsxRuntimeExports.jsx("div",{onMouseDown:l,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:o?"none":"background-color 0.2s ease",backgroundColor:o?"#1890ff":i?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:o||i?"#fff":"#999",opacity:o||i?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},ue=p.lazy(()=>Promise.resolve().then(()=>it)),Ue=D.createStyles(({token:t,css:r})=>({siderLayout:r`
      position: relative;
      height: 100vh;
    `,floatSiderLayout:r`
      position: fixed;
      right: 16px;
      top: 16px;
      height: calc(100vh - 32px);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
      z-index: 1000;
      overflow: hidden;
      backdrop-filter: blur(8px);
      border: 1px solid ${t.colorBorderSecondary};
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      &:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15), 0 6px 12px rgba(0, 0, 0, 0.1);
      }
    `})),He=()=>{const{visible:t,setVisible:r,setLoaded:n}=A.useAI();return p.useEffect(()=>{n(!0)},[n]),e.jsxRuntimeExports.jsx(s.Modal,{width:1200,open:t,closable:!1,onCancel:()=>r(!1),footer:null,children:S.withSuspense(ue)})},We=()=>{const{styles:t}=Ue(),{layout:r,visible:n}=A.useAI(),[o,a]=p.useState(()=>{const l=localStorage.getItem("ai-sidebar-width");return l?parseInt(l,10):400}),{setLoaded:i}=A.useAI();p.useEffect(()=>{i(!0)},[i]),p.useEffect(()=>{localStorage.setItem("ai-sidebar-width",o.toString())},[o]);const x=l=>{a(l)};return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsxs("div",{style:{width:`${o}px`,display:n?"flex":"none",overflow:"hidden",flexShrink:0},className:ne("ai-sidebar-layout",r==="float-sidebar"?t.floatSiderLayout:t.siderLayout),children:[e.jsxRuntimeExports.jsx(Ne,{onResize:x,minWidth:300,maxWidth:window.innerWidth*.5}),e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",overflow:"hidden",borderRadius:r==="float-sidebar"?"12px":"0"},children:e.jsxRuntimeExports.jsx("div",{children:S.withSuspense(ue)})})]})})},Ke=()=>{const{setVisible:t,visible:r}=A.useAI(),{t:n}=w.useTranslation("ai");return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(s.Tooltip,{title:n("chat.openAssistant",{defaultValue:"Open AI Assistant"}),placement:"left",style:{display:r?"none":"block"},children:e.jsxRuntimeExports.jsx(s.FloatButton,{icon:e.jsxRuntimeExports.jsx(v.RobotOutlined,{}),type:"primary",onClick:()=>t(!0),style:{right:24,bottom:24,display:r?"none":"block"}})})})},K=({permission:t,permissions:r=[],checkAll:n=!1,fallback:o=null,children:a})=>{const{hasPermission:i,hasAnyPermission:x,hasAllPermissions:l,isAdmin:j,loading:h}=A.usePermission();return h?null:j?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:a}):t?i(t)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:a}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o}):r.length>0?(n?l(r):x(r))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:a}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:o}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:a})},Ge=({fallback:t=null,children:r})=>{const{isAdmin:n,loading:o}=A.usePermission();return o?null:n?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:t})},te=t=>{const[r,n]=p.useState(!1),{permission:o,icon:a,tooltip:i,onClick:x,confirm:l,label:j,...h}=t,g=x?async()=>{n(!0);try{await x()}finally{n(!1)}}:void 0;let c=e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",loading:r,icon:a,onClick:l?void 0:g,...h,children:j&&e.jsxRuntimeExports.jsx("span",{style:{position:"inherit",top:"-2px"},children:j})});if(i&&(c=e.jsxRuntimeExports.jsx(s.Tooltip,{title:i,children:c})),l){const d=async()=>{l.onConfirm?l.onConfirm():g&&await g()};c=e.jsxRuntimeExports.jsx(s.Popconfirm,{title:l.title,description:l.description,onConfirm:d,okText:l.okText,cancelText:l.cancelText,children:c})}return o&&(c=e.jsxRuntimeExports.jsx(K,{permission:o,children:c})),c},Xe=({actions:t,maxVisibleItems:r})=>{const n=t.filter(x=>!x.hidden);if(!r||n.length<=r)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n.map(({key:x,...l})=>e.jsxRuntimeExports.jsx(te,{...l},x))});const o=n.slice(0,r-1),i=n.slice(r-1).map(x=>{const{key:l,label:j,icon:h,permission:g,onClick:c,confirm:d,disabled:E,tooltip:m}=x,I={key:l,label:j,icon:h,disabled:E,onClick:async()=>{d?s.Modal.confirm({title:d.title,content:d.description,onOk:d.onConfirm,okText:d.okText,cancelText:d.cancelText}):c&&await c()}};return g?{...I,label:e.jsxRuntimeExports.jsx(K,{permission:g,children:e.jsxRuntimeExports.jsx("span",{children:j??m})})}:I});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[o.map(({key:x,...l})=>e.jsxRuntimeExports.jsx(te,{...l},x)),e.jsxRuntimeExports.jsx(s.Dropdown,{menu:{items:i},trigger:["click"],children:e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(v.MoreOutlined,{})})})]})},Je=Me,ce=t=>Je[t],Ye=({iconName:t})=>{if(!t)return null;const r=ce(t);return r?e.jsxRuntimeExports.jsx(p.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(r,{})}):null},Qe=({onChange:t})=>{const[r,n]=p.useState(""),[o,a]=p.useState("");return e.jsxRuntimeExports.jsxs(s.Space.Compact,{children:[e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:i=>n(i.target.value)}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:o,onChange:i=>a(i.target.value)}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(v.PlusOutlined,{}),onClick:()=>{t(r,o)}})]})},Ze=({request:t,tableRef:r,...n},o)=>{const[a,i]=p.useState({current:1,pageSize:10}),[x,l]=p.useState(0),{data:j,loading:h,refresh:g}=L.useRequest(async()=>{const c=await t({current:a.current,page_size:a.pageSize});return l(c.total),c.data},{refreshDeps:[a]});return p.useImperativeHandle(o,()=>({reload:()=>{g()}})),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",loading:h,dataSource:j??[],pagination:{...a,total:x,onChange:(c,d)=>{i({current:c,pageSize:d})}},...n,ref:r})},et=({actionRef:t,...r})=>{const[n,o]=p.useState();return p.useEffect(()=>{o(p.forwardRef(Ze))},[]),n?e.jsxRuntimeExports.jsx(n,{...r,ref:t}):null},tt=D.createStyles(({token:t,css:r})=>({siderLayout:r`
      width: 100%;
      height: calc(100vh - 100px);
      display: flex;
      background: ${t.colorBgContainer};
      font-family: AlibabaPuHuiTi, ${t.fontFamily}, sans-serif;
    `,classicLayout:r`
      width: 100%;
      height: 70vh;
      display: flex;
      background: ${t.colorBgContainer};
      font-family: AlibabaPuHuiTi, ${t.fontFamily}, sans-serif;
    `,sider:r`
      background: ${t.colorBgLayout}80;
      width: 280px;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 0 12px;
      box-sizing: border-box;
    `,logo:r`
      display: flex;
      align-items: center;
      justify-content: start;
      padding: 0 24px;
      box-sizing: border-box;
      gap: 8px;
      margin: 24px 0;

      span {
        font-weight: bold;
        color: ${t.colorText};
        font-size: 16px;
      }
    `,addBtn:r`
      background: #1677ff0f;
      border: 1px solid #1677ff34;
      height: 40px;
    `,conversationsSpin:r`
      height: 100%;
      overflow-y: auto;
    `,conversations:r`
      flex: 1;
      overflow-y: auto;
      margin-top: 12px;
      padding: 0;

      .ant-conversations-list {
        padding-inline-start: 0;
      }
    `,siderFooter:r`
      border-top: 1px solid ${t.colorBorderSecondary};
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    `,chat:r`
      height: 100%;
      width: 100%;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      padding-block: ${t.paddingLG}px;
      gap: 16px;
    `,chatPrompt:r`
      .ant-prompts-label {
        color: #000000e0 !important;
      }
      .ant-prompts-desc {
        color: #000000a6 !important;
        width: 100%;
      }
      .ant-prompts-icon {
        color: #000000a6 !important;
      }
    `,chatList:r`
      flex: 1;
      overflow: auto;
      .ant-spin-nested-loading{
        height: 100%;
        .ant-spin-container{
          height: 100%;
        }
      }
      .ant-bubble > .ant-bubble-content{
        max-width: 90%;
      }
      .ant-bubble-end{
        .ant-bubble-content{
          background-color: rgb(22 119 255 / 15%);
        }
      }
      .ant-bubble-list-autoscroll{
        flex-direction: column-reverse;
      }
    `,loadingMessage:r`
      background-image: linear-gradient(90deg, #ff6b23 0%, #af3cb8 31%, #53b6ff 89%);
      background-size: 100% 2px;
      background-repeat: no-repeat;
      background-position: bottom;
    `,placeholder:r`
      padding-top: 32px;
    `,sender:r`
      width: 100%;
      max-width: min(90%, 700px);
      margin: 0 auto;
    `,speechButton:r`
      font-size: 18px;
      color: ${t.colorText} !important;
    `,senderPrompt:r`
      width: 100%;
      max-width: 700px;
      margin: 0 auto;
      color: ${t.colorText};
    `}));class st extends Error{constructor(n,o){super(n);Z(this,"buffer");this.buffer=o}}class nt extends e.AbstractChatProvider{transformParams(r,n){if(typeof r!="object")throw new Error("requestParams must be an object");return{...(n==null?void 0:n.params)||{},...r||{}}}transformLocalMessage({content:r}){return{content:r,role:"user"}}transformMessage(r){const{originMessage:n,chunk:o}=r||{};if(!o)return{content:(n==null?void 0:n.content)||"",role:"assistant"};const a=JSON.parse(o.data),i=(n==null?void 0:n.content)||"";switch(a.event_type){case"content":return{content:`${i||""}${a.content||""}`,role:"assistant"};case"tool_call":return{content:i.endsWith("<br/>")?`${i}${a.content||""}`:`${i}<br/>${a.content||""}`,role:"assistant"};case"error":return{content:i,role:"assistant",error:a.content}}}}const V=new Map,rt=t=>(V.get(t)||V.set(t,new nt({request:e.XRequest(`/api/ai/chat/sessions/${t}`,{manual:!0,middlewares:{onRequest:async(r,n)=>{const o=localStorage.getItem("orgID"),{sessionId:a}=n.params,i={...n.headers,"Accept-Language":localStorage.getItem("i18nextLng")||"en-US",Authorization:`Bearer ${localStorage.getItem("token")}`,...o?{"X-Scope-OrgID":o}:{}};return[a?`/api/ai/chat/sessions/${a}`:r,{...n,headers:i}]}}})})),V.get(t)),xe=()=>{const t=s.theme.useToken(),r=p.useMemo(()=>{var o;return((o=t==null?void 0:t.theme)==null?void 0:o.id)===0},[t]);return[p.useMemo(()=>r?"x-markdown-light":"x-markdown-dark",[r])]},ot=p.createContext({}),me=()=>{const{layout:t,setVisible:r,setLayout:n,onCallAI:o,activeConversationKey:a,setActiveConversationKey:i,conversations:x,fetchConversationsLoading:l}=A.useAI(),{t:j}=w.useTranslation("ai"),{t:h}=w.useTranslation("common"),{styles:g}=tt(),c=u=>({key:u.id,label:u.title,group:q(u.start_time).isSame(q(),"day")?j("chat.today"):q(u.start_time).format("YYYY-MM-DD")}),{conversations:d,activeConversationKey:E,setActiveConversationKey:m,addConversation:f,setConversations:I,getConversation:R,setConversation:C,removeConversation:k,getMessages:T}=e.useXConversations({defaultActiveConversationKey:a,defaultConversations:(x==null?void 0:x.map(u=>c(u)))||[]}),[M]=xe(),[G,de]=s.message.useMessage(),[X,J]=p.useState(""),[B,Y]=p.useState(),{onRequest:Q,messages:P,isRequesting:pe,abort:je,onReload:he,setMessages:ge,setMessage:fe}=e.useXChat({provider:rt(E),conversationKey:E,defaultMessages:[],requestPlaceholder:()=>({content:h("loading"),role:"assistant"}),requestFallback:(u,{error:b})=>b instanceof st?{content:b.buffer.join(""),role:"assistant",error:b.message}:{content:`${b}`,role:"assistant"}}),Re=u=>{if(u){if(!E){z(u);return}Q({content:u})}},{run:Ee,loading:ye}=L.useRequest(async u=>await S.api.ai.getChatSession({sessionId:u}),{manual:!0,onError:()=>{s.message.error(j("chat.fetchConversationFailed",{defaultValue:"Failed to fetch conversation"}))},onSuccess:u=>{if(P&&P.length>0&&(P[P.length-1].status==="loading"||P.length>u.messages.length))return;const b=[];let y={id:"",message:{content:"",role:"assistant"},status:"success"};for(const F of u.messages)switch(F.role){case"assistant":y.status=F.status==="completed"&&y.status==="success"?"success":"error",y.message.role="assistant",y.id=F.id,F.tool_calls&&F.tool_calls.length>0?y.message.content.endsWith("<br/>")?y.message.content=`${y.message.content}${F.content}`:y.message.content=`${y.message.content}<br/>${F.content}`:y.message.content=`${y.message.content}${F.content}`;break;case"user":case"system":y.message.content.length>0&&(b.push({id:y.id,message:{content:y.message.content,role:y.message.role},status:y.status}),y={id:"",message:{content:"",role:"assistant"},status:"success"}),b.push({id:F.id,message:{content:F.content,role:F.role},status:F.status==="completed"?"success":"error"});break}y.message.content.length>0&&b.push({id:y.id,message:{content:y.message.content,role:y.message.role},status:y.status}),ge(b)}}),{run:z,loading:O}=L.useRequest(async(u,b)=>await S.api.ai.createChatSession({title:j("chat.defaultConversationTitle"),model_id:"",messages:b||[]}),{manual:!0,onError:()=>{s.message.error(j("chat.createConversationFailed",{defaultValue:"Failed to create conversation"}))},onSuccess:(u,[b])=>{f(c(u),"prepend"),b&&Y({message:b,sessionId:u.id}),m(u.id),i(u.id)}});p.useEffect(()=>{I((x==null?void 0:x.map(u=>c(u)))||[])},[x]);const{run:be}=L.useRequest(async u=>await S.api.ai.deleteChatSession({sessionId:u}),{manual:!0,onError(u,[b]){G.error(j("chat.deleteConversationFailed",{defaultValue:"Failed to delete conversation"}));const y=R(b);y&&C(b,{...y,loading:!1})},onSuccess(u,[b]){k(b)}}),{run:ve}=L.useRequest(async u=>S.api.ai.generateChatSessionTitle({sessionId:u},{title:""}),{manual:!0,onSuccess:({title:u},[b])=>{const y=R(b);y&&C(b,{...y,title:u,loading:!1})},onError:(u,[b])=>{G.error(j("chat.titleGenerationFailed",{defaultValue:"Failed to generate title: {{error}}",error:u.message||u}));const y=R(b);y&&C(b,{...y,loading:!1})}});p.useEffect(()=>{E&&(B==null?void 0:B.sessionId)===E&&(Q({content:B.message}),Y(void 0))},[E,B]),p.useEffect(()=>{if(E){const u=T(E);if(u&&u.length>0)return;Ee(E)}},[E]),p.useEffect(()=>{o&&z&&o((u,b)=>{z(u,b)})},[z,o]);const Se=e.jsxRuntimeExports.jsxs("div",{className:g.sider,children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>{z()},type:"link",className:g.addBtn,icon:e.jsxRuntimeExports.jsx(v.PlusOutlined,{}),loading:O,children:j("chat.newConversation",{defaultValue:"New Conversation"})}),e.jsxRuntimeExports.jsx(s.Spin,{spinning:l,wrapperClassName:g.conversationsSpin,children:e.jsxRuntimeExports.jsx(e.Conversations,{items:d,activeKey:E,onActiveChange:async u=>{u&&(m(u),i(u))},className:g.conversations,groupable:!0,styles:{item:{padding:"0 8px"}},menu:u=>({items:[{label:j("chat.regenerateTitle"),key:"regenerateTitle",icon:e.jsxRuntimeExports.jsx(v.ReloadOutlined,{}),onClick:()=>{C(u.key,{...u,loading:!0}),ve(u.key)}},{label:h("delete"),key:"delete",icon:e.jsxRuntimeExports.jsx(v.DeleteOutlined,{}),danger:!0,onClick:()=>{C(u.key,{...u,loading:!0}),be(u.key)}}]})})})]}),we=({message:u})=>{if(u.error)return e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(e.XMarkdown,{content:u.error})})},Ce=P==null?void 0:P.map(u=>({...u.message,key:u.id,contentRender:b=>e.jsxRuntimeExports.jsx(e.XMarkdown,{paragraphTag:"div",content:b,className:M}),footer:we(u)})),Ie=e.jsxRuntimeExports.jsx("div",{className:g.chatList,children:e.jsxRuntimeExports.jsx(s.Spin,{spinning:ye||O,children:e.jsxRuntimeExports.jsx(e.ForwardBubble.List,{items:Ce,style:{height:"100%",paddingInline:t==="classic"?"calc(calc(100% - 700px) /2)":"20px"},roles:{assistant:{placement:"start",loadingRender:()=>e.jsxRuntimeExports.jsx(s.Spin,{size:"small"})},user:{placement:"end"}},role:{assistant:{placement:"start",loadingRender:()=>e.jsxRuntimeExports.jsx(s.Spin,{size:"small"})},user:{placement:"end"}}})})}),ke=e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(e.Sender,{value:X,onSubmit:async()=>{Re(X.trim()),J("")},onChange:J,onCancel:()=>{je()},loading:pe,className:g.sender,placeholder:j("chat.inputPlaceholder")})});return e.jsxRuntimeExports.jsxs(e.XProvider,{children:[de,e.jsxRuntimeExports.jsxs(ot.Provider,{value:{onReload:he,setMessage:fe},children:[e.jsxRuntimeExports.jsxs("div",{style:{height:"50px",width:"100%",position:"relative"},children:[e.jsxRuntimeExports.jsx(s.Radio.Group,{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},options:[{label:e.jsxRuntimeExports.jsx(v.BlockOutlined,{}),value:"classic"},{label:e.jsxRuntimeExports.jsx(v.BorderRightOutlined,{}),value:"sidebar"},{label:e.jsxRuntimeExports.jsx(v.BorderRightOutlined,{}),value:"float-sidebar"}],optionType:"button",onChange:u=>n(u.target.value),value:t}),e.jsxRuntimeExports.jsxs(s.Space,{style:{float:"right",marginTop:10},children:[e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:()=>{z()},loading:O,icon:e.jsxRuntimeExports.jsx(v.PlusOutlined,{}),style:{display:t==="classic"?"none":"block"}}),e.jsxRuntimeExports.jsx(s.Dropdown,{menu:{items:d.map(u=>({label:u.label,key:u.key})),onClick:({key:u})=>{m(u),i(u)}},placement:"bottomRight",children:e.jsxRuntimeExports.jsx(s.Button,{icon:l?e.jsxRuntimeExports.jsx(s.Spin,{size:"small"}):e.jsxRuntimeExports.jsx(v.HistoryOutlined,{}),style:{display:t==="classic"?"none":"block"}})}),e.jsxRuntimeExports.jsx(s.Button,{type:"text",onClick:()=>r(!1),children:e.jsxRuntimeExports.jsx(v.CloseOutlined,{})})]})]}),e.jsxRuntimeExports.jsxs("div",{className:t==="classic"?g.classicLayout:g.siderLayout,style:{minWidth:t==="classic"?"500px":"400px"},children:[t==="classic"?Se:null,e.jsxRuntimeExports.jsxs("div",{className:g.chat,children:[Ie,ke]})]})]})]})},it=Object.freeze(Object.defineProperty({__proto__:null,default:me,useMarkdownTheme:xe},Symbol.toStringTag,{value:"Module"})),at=({onSuccess:t,token:r})=>{const{t:n}=w.useTranslation("authorization"),{t:o}=w.useTranslation("common"),[a]=s.Form.useForm(),{run:i,loading:x}=L.useRequest(async l=>S.api.authorization.changePassword(l,r?{headers:{Authorization:`Bearer ${r}`}}:{}),{manual:!0,onSuccess:()=>{s.message.success(n("user.passwordChanged")),a.resetFields(),t==null||t()},onError:l=>{if(l instanceof $.ApiError){const j=l.code??"normal";s.message.error(n(`user.passwordChangeFailed.${j}`,{error:l.message,defaultValue:"Password change failed: {{error}}"}))}else s.message.error(n("user.passwordChangeFailed.normal",{error:l.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",l)}});return e.jsxRuntimeExports.jsxs(s.Form,{form:a,layout:"vertical",onFinish:i,style:{maxWidth:500,margin:"0 auto"},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{name:"old_password",label:n("user.oldPassword"),rules:[{required:!0,message:n("validation.oldPasswordRequired")}],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"new_password",label:n("user.newPassword"),rules:[{required:!0,message:n("validation.newPasswordRequired")},{min:8,message:n("validation.passwordMinLength")}],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"confirm_password",label:n("user.confirmPassword"),rules:[{required:!0,message:n("validation.confirmPasswordRequired")},({getFieldValue:l})=>({validator(j,h){return!h||l("new_password")===h?Promise.resolve():Promise.reject(new Error(n("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:x,children:o("save")})})]})},lt=({user:t,onSuccess:r})=>{const{t:n}=w.useTranslation("authorization"),{t:o}=w.useTranslation("common"),[a]=s.Form.useForm(),[i,x]=p.useState(!1);p.useEffect(()=>{t&&a.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,a]);const l=async j=>{try{x(!0),await S.api.authorization.updateCurrentUser(j),s.message.success(o("updateSuccess")),r()}catch(h){s.message.error(o("updateFailed")),console.error("Failed to update user information:",h)}finally{x(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[n("user.roles"),": ",t.roles.map(j=>j.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(s.Form,{form:a,layout:"vertical",onFinish:l,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(le,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"username",label:n("user.username"),children:e.jsxRuntimeExports.jsx(s.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"phone",label:n("user.phone"),children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:i,children:o("save")})})]})]})},ut=({user:t,onSuccess:r})=>{const{t:n}=w.useTranslation("authorization"),{t:o}=w.useTranslation("common"),[a,i]=p.useState(0),[x,l]=p.useState(!1),[j,h]=p.useState(!0),[g,c]=p.useState(""),[d,E]=p.useState("totp"),{run:m,data:f={secret:"",qr_code:"",token:void 0}}=L.useRequest(()=>S.api.authorization.enableMfa(d),{manual:!0,onSuccess:()=>{i(1)},onBefore:()=>{l(!0)},onFinally:()=>{l(!1)}}),I=async()=>{if(!g){s.message.warning(n("mfa.enterVerificationCode"));return}const k={code:g,mfa_type:d};"token"in f&&(k.token=f.token);try{l(!0),await S.api.authorization.verifyAndActivateMfa(k),s.message.success(n("mfa.enableSuccess")),i(2),r()}catch(T){s.message.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",T)}finally{l(!1)}},R=async()=>{try{l(!0),await S.api.authorization.disableMfa(),s.message.success(n("mfa.disableSuccess")),r()}catch(k){s.message.error(o("operationFailed")),console.error("Failed to disable MFA:",k)}finally{l(!1)}},C=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,onClick:()=>{s.Modal.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:R,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const k=()=>{var T;switch(a){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:n("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:n(d==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:m,loading:x,children:n("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:d==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:d==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(s.QRCode,{value:f.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:d==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:d==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:j?"*".repeat(((T=f.secret)==null?void 0:T.length)??0):f.secret}),e.jsxRuntimeExports.jsx(s.Button,{type:"link",onClick:()=>h(!j),icon:j?e.jsxRuntimeExports.jsx(v.EyeOutlined,{}):e.jsxRuntimeExports.jsx(v.EyeInvisibleOutlined,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:g,onChange:M=>c(M.target.value)})}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>i(0),children:o("previous")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:I,loading:x,children:o("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:()=>i(0),children:o("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:a===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(s.Segmented,{defaultValue:"totp",onChange:T=>{E(T),i(0)},value:d,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(v.ClockCircleFilled,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(v.MailOutlined,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(s.Divider,{})]}),e.jsxRuntimeExports.jsx(s.Steps,{current:a,items:[{title:n(d==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(d==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(d==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(d==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(d==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(d==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),k()]})};return e.jsxRuntimeExports.jsx(s.Card,{title:n("mfa.title"),children:C()})},{Text:N}=s.Typography,ct=()=>{const{t}=w.useTranslation("authorization"),{t:r}=w.useTranslation("common"),[n,o]=p.useState([]),[a,i]=p.useState(!1),[x,l]=p.useState(null),[j,h]=p.useState(!1),g=async()=>{try{i(!0);const m=await S.api.authorization.getUserSessions({});o(m)}catch(m){s.message.error(t("session.getSessionsFailed",{error:m,defaultValue:"Failed to get session list: {{error}}"}))}finally{i(!1)}};p.useEffect(()=>{g()},[]);const c=async m=>{try{l(m),await S.api.authorization.terminateSession({id:m}),o(n.filter(f=>f.id!==m)),s.message.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(f){s.message.error(t("session.terminateFailed",{error:f,defaultValue:"Failed to terminate session: {{error}}"}))}finally{l(null)}},d=async()=>{try{h(!0),await S.api.authorization.terminateOtherSessions(),o(n.filter(m=>m.is_current)),s.message.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(m){s.message.error(t("session.terminateAllFailed",{error:m,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{h(!1)}},E=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(m,f)=>e.jsxRuntimeExports.jsxs(s.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(v.LaptopOutlined,{}),e.jsxRuntimeExports.jsx(N,{strong:!0,children:m})]}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(v.EnvironmentOutlined,{}),e.jsxRuntimeExports.jsx(N,{type:"secondary",children:f.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:m=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(v.GlobalOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:m})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:m=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(v.ClockCircleOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(m).toLocaleString()})]})},{title:t("session.status"),key:"status",render:m=>m.is_current?e.jsxRuntimeExports.jsx(s.Tag,{color:"green",children:t("session.current")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"blue",children:t("session.active")})},{title:r("actions"),key:"action",render:m=>m.is_current?e.jsxRuntimeExports.jsx(N,{type:"secondary",children:t("session.currentSession")}):e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminate"),onConfirm:()=>c(m.id),okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"link",danger:!0,loading:x===m.id,children:t("session.terminate")})})}];return e.jsxRuntimeExports.jsx(s.Card,{title:t("session.title"),extra:n.length>1&&e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminateAll"),onConfirm:d,okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,loading:j,children:t("session.terminateOthers")})}),children:n.length===0?e.jsxRuntimeExports.jsx(s.Empty,{description:t("session.noSessions")}):e.jsxRuntimeExports.jsx(s.Table,{columns:E,dataSource:n,rowKey:"id",loading:a,pagination:!1})})},{RangePicker:xt}=s.DatePicker,{Option:_}=s.Select,mt=t=>t||"N/A",dt=(t,r)=>t==="success"?e.jsxRuntimeExports.jsx(s.Tag,{color:"success",children:r("statuses.success")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"error",children:r("statuses.failed")}),pt=({userId:t,request:r=o=>t?S.api.authorization.getUserLogs({id:t,...o}):S.api.authorization.getCurrentUserLogs(o),columnsFilter:n=o=>o})=>{const{t:o}=w.useTranslation("authorization"),{t:a}=w.useTranslation("common"),[i,x]=p.useState({current:1,pageSize:10,total:0}),[l,j]=p.useState({}),[h]=s.Form.useForm(),{loading:g,run:c,data:{data:d}={}}=L.useRequest(async(R=l,C=1,k=10)=>r({...R,current:C??1,page_size:k??10}),{onError(R){s.message.error(o("auditLog.fetchFailed",{error:R}))},onSuccess({total:R}){x({...i,total:R})}});p.useEffect(()=>{c(l,1,i.pageSize)},[]);const E=R=>{x({...i,current:R.current,pageSize:R.pageSize}),c({},R.current,R.pageSize)},m=R=>{var C,k,T,M;c({...R,start_time:(k=(C=R.dateRange)==null?void 0:C[0])==null?void 0:k.toISOString(),end_time:(M=(T=R.dateRange)==null?void 0:T[1])==null?void 0:M.toISOString()},1,i.pageSize)},f=()=>{h.resetFields(),j({}),x({...i,current:1}),c({},1,i.pageSize)},I=[{title:o("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:R=>H.formatDate(R)},{title:o("auditLog.action"),dataIndex:"action",key:"action",render:(R,C)=>R?o(`action.${R.replace(":",".")}`,{defaultValue:C.action_name}):C.action_name??C.action},{title:o("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:o("auditLog.ip"),dataIndex:"ip",key:"ip",render:R=>mt(R)},{title:o("auditLog.status"),dataIndex:"status",key:"status",render:R=>dt(R,o)},{title:o("auditLog.details"),dataIndex:"details",key:"details",render:R=>e.jsxRuntimeExports.jsx(s.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(v.EyeOutlined,{}),onClick:()=>{s.Modal.info({title:o("auditLog.details"),content:JSON.stringify(R)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(s.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(s.Form,{form:h,layout:"horizontal",onFinish:m,initialValues:l,children:[e.jsxRuntimeExports.jsxs(s.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"search",label:o("auditLog.search"),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:o("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"action",label:o("auditLog.action"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:o("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(_,{value:"login",children:o("actions.login")}),e.jsxRuntimeExports.jsx(_,{value:"logout",children:o("actions.logout")}),e.jsxRuntimeExports.jsx(_,{value:"password_reset",children:o("actions.passwordReset")}),e.jsxRuntimeExports.jsx(_,{value:"mfa_change",children:o("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"status",label:o("auditLog.status"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:o("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(_,{value:"success",children:o("statuses.success")}),e.jsxRuntimeExports.jsx(_,{value:"failed",children:o("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"dateRange",label:o("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(xt,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(s.Row,{children:e.jsxRuntimeExports.jsx(s.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:f,children:a("reset")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(v.SearchOutlined,{}),children:a("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(s.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(v.ReloadOutlined,{}),onClick:f,style:{marginRight:8},children:a("refresh")})}),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",columns:n(I),dataSource:d,pagination:{...i,showSizeChanger:!0,showTotal:R=>a("totalItems",{total:R})},loading:g,onChange:E,scroll:{x:"max-content"}})]})]})},{TextArea:se}=s.Input,{Option:U}=s.Select,jt=({field:t,selectedType:r,dependentValues:n,formValues:o={}})=>{const{t:a}=w.useTranslation("system"),{t:i}=w.useTranslation("common"),x=p.useMemo(()=>H.checkVisibilityCondition(t.visible_when,o),[t.visible_when,o]),{options:l,loading:j}=A.useDynamicDataSource(t.data_source,t.options,n),h=p.useMemo(()=>t.data_source&&t.data_source.type!=="static"?l:t.options||[],[t.data_source,t.options,l]),g=h&&h.length>0;if(!x)return null;const c=[{required:t.required,message:a("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],d=()=>a(`settings.toolsets.${r}.${t.name}`,{defaultValue:t.display_name||t.name}),E=()=>a(`settings.toolsets.${r}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${i("enter",{defaultValue:"Enter"})} ${t.name}`}),m=()=>{if(t.description)return a(`settings.toolsets.${r}.${t.name}Tooltip`,{defaultValue:t.description})};if(!x)return null;if(t.type==="select"||t.data_source)return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Select,{loading:j,allowClear:!0,placeholder:E(),showSearch:!0,filterOption:(f,I)=>{var R;return(R=I==null?void 0:I.children)==null?void 0:R.toLowerCase().includes(f.toLowerCase())},children:h.map(f=>e.jsxRuntimeExports.jsx(U,{value:f.value,children:f.label},f.value))})},t.name);switch(t.type){case"text":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,children:e.jsxRuntimeExports.jsx(se,{placeholder:E(),rows:4})},t.name);case"string":return g?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:E(),children:h.map(f=>e.jsxRuntimeExports.jsx(U,{value:f.value,children:f.label},f.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:E()})},t.name);case"password":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Input.Password,{placeholder:E(),autoComplete:"new-password"})},t.name);case"number":return g?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:E(),children:h.map(f=>e.jsxRuntimeExports.jsx(U,{value:f.value,children:f.label},f.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.InputNumber,{style:{width:"100%"},placeholder:E()})},t.name);case"boolean":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),valuePropName:"checked",tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Switch,{})},t.name);case"array":return g?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Checkbox.Group,{style:{width:"100%"},children:e.jsxRuntimeExports.jsx(s.Space,{direction:"vertical",children:h.map(f=>e.jsxRuntimeExports.jsx(s.Checkbox,{value:f.value,children:f.label},f.value))})})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:c,tooltip:m(),children:e.jsxRuntimeExports.jsx(s.Select,{mode:"tags",style:{width:"100%"},placeholder:E(),tokenSeparators:[","]})},t.name);case"object":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:d(),rules:[...c,{validator:(f,I)=>{if(!I)return Promise.resolve();try{return JSON.parse(I),Promise.resolve()}catch{return Promise.reject(new Error(a("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:m(),children:e.jsxRuntimeExports.jsx(se,{rows:4,placeholder:E()})},t.name);default:return null}};exports.AIChat=me;exports.AIChatButton=Ke;exports.AIChatModal=He;exports.AIChatSider=We;exports.Actions=Xe;exports.AdminGuard=Ge;exports.AllLangUIConfig=oe;exports.Avatar=ae;exports.AvatarUpload=le;exports.DynamicConfigField=jt;exports.DynamicIcon=Ye;exports.HeaderDropdown=W;exports.LabelCreater=Qe;exports.LanguageSwitch=$e;exports.Loading=re;exports.OrganizationSwitcher=Ve;exports.PermissionGuard=K;exports.PrivateRoute=ze;exports.ProfileBasic=lt;exports.ProfileMFA=ut;exports.ProfilePassword=at;exports.ProfileSessions=ct;exports.Table=et;exports.UserAuditLogs=pt;exports.getIconByName=ce;
