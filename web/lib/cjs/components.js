"use strict";const e=require("./vendor.js"),L=require("react-router-dom"),b=require("./contexts.js"),A=require("./base.js"),c=require("react"),f=require("./index.js"),I=require("./client.js"),q=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(e.Spin,{size:"large",tip:"Loading..."})}),$=({element:t,requiredPermission:r,requiredPermissions:s})=>{const{user:n,loading:i}=b.useAuth(),{hasPermission:o,hasAllPermissions:x}=b.usePermission();return i?e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:e.jsxRuntimeExports.jsx(e.Spin,{size:"large",tip:"Loading..."})}):n?r&&!o(r)?e.jsxRuntimeExports.jsx(L.Navigate,{to:"/forbidden",replace:!0}):s&&!x(s)?e.jsxRuntimeExports.jsx(L.Navigate,{to:"/forbidden",replace:!0}):t:(window.location.href=A.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},V=e.createStyles(({token:t,css:r})=>({container:r`
      ${r`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),k=({overlayClassName:t,overlay:r,hidden:s,children:n,...i})=>{if(s)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:o}=V();return e.jsxRuntimeExports.jsx(e.Dropdown,{dropdownRender:r,overlayClassName:e.classNames(o.container,t),...i,children:e.jsxRuntimeExports.jsx("span",{className:o.iconStyle,children:n})})},U=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),N=e.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),P=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],H=()=>{const{i18n:t}=e.useTranslation(),{styles:r}=N(),s=i=>{t.changeLanguage(i)},n={selectedKeys:[t.language],onClick:i=>{s(i.key)},items:P.map(i=>({key:i.lang,className:r.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(i==null?void 0:i.label)||"en-US",className:r.menuItemIconStyle,children:(i==null?void 0:i.icon)||"ðŸŒ"}),(i==null?void 0:i.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(k,{menu:n,children:e.jsxRuntimeExports.jsx(U,{})})},K=e.createStyles(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),M=t=>e.lodashExports.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?I.baseURL.endsWith("/")?I.baseURL+`files/${t}`:I.baseURL+`/files/${t}`:t,z=({src:t,...r})=>e.jsxRuntimeExports.jsx(e.Avatar,{src:M(t),...r}),W=({onChange:t,shape:r="square"})=>{const[s,n]=c.useState([]),{styles:i}=K(),[o,x]=c.useState(!1),[l,p]=c.useState(!0),[j,R]=c.useState(0),{run:u,loading:m}=e.useRequest(()=>f.api.base.listFiles({current:j+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:a})=>{n([...s,...a]),p(a.length===40),R(j+1)}}),g=()=>{p(!0),R(0),n([])};return e.jsxRuntimeExports.jsx(e.Popover,{style:{zIndex:1e3},onOpenChange:a=>{x(a),a?u():g()},open:o,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:s.length,next:()=>{u()},hasMore:l,loader:e.jsxRuntimeExports.jsx(e.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(e.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(e.List,{grid:{gutter:16,column:8},dataSource:s,style:{margin:"0 8px"},loading:m,renderItem:({id:a})=>e.jsxRuntimeExports.jsx("div",{className:i.avatarItem,onClick:h=>{h.stopPropagation(),t==null||t(a),x(!1),g()},children:e.jsxRuntimeExports.jsx(z,{shape:r,src:a})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(e.RefIcon,{shape:r,style:{width:112,height:112,placeContent:"center"}})})},B=({value:t,onChange:r,shape:s,...n})=>{const[i,o]=c.useState(void 0),[x,l]=c.useState(!1),[p,j]=c.useState(void 0),R=async u=>{l(!0),j(u.url??u.preview)};return c.useEffect(()=>{o(t?{uid:t,name:t,url:M(t)}:void 0)},[t]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(e.ImgCrop,{beforeCrop:async u=>{if(u.type==="image/svg+xml"){const m=await f.api.base.uploadFile({type:"avatar"},u);return m.length>0&&(r==null||r(m[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(e.Upload,{customRequest:async u=>{var g,a;const m=await f.api.base.uploadFile({type:"avatar",access:"public"},u.file);m.length>0?((g=u.onSuccess)==null||g.call(u,m[0].id),r==null||r(m[0].id)):(a=u.onError)==null||a.call(u,new Error("Upload file failed"))},listType:"picture-card",onPreview:R,maxCount:1,onChange:({file:u})=>{switch(u.status){case"removed":r==null||r(void 0);break;case"done":break;default:o(u);break}},fileList:i?[i]:[],...n,children:i?void 0:e.jsxRuntimeExports.jsx(W,{shape:s,onChange:r})})}),e.jsxRuntimeExports.jsx(e.Modal,{open:x,footer:null,onCancel:()=>l(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:p})})]})},_=({permission:t,permissions:r=[],checkAll:s=!1,fallback:n=null,children:i})=>{const{hasPermission:o,hasAnyPermission:x,hasAllPermissions:l,isAdmin:p,loading:j}=b.usePermission();return j?null:p?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):t?o(t)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n}):r.length>0?(s?l(r):x(r))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i})},G=({fallback:t=null,children:r})=>{const{isAdmin:s,loading:n}=b.usePermission();return n?null:s?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:t})},F=t=>{const{permission:r,icon:s,tooltip:n,onClick:i,confirm:o,...x}=t;return r?e.jsxRuntimeExports.jsx(_,{permission:r,children:F({icon:s,tooltip:n,onClick:i,confirm:o,...x})},t.key):o?e.jsxRuntimeExports.jsx(e.Popconfirm,{title:o.title,onConfirm:o.onConfirm||i,okText:o.okText,cancelText:o.cancelText,children:F({icon:s,tooltip:n,...x})},t.key):n?e.jsxRuntimeExports.jsx(e.Tooltip,{title:n,children:F({icon:s,onClick:i,...x})},t.key):c.createElement(e.Button,{type:"text",size:"small",icon:s,onClick:i,...x,key:t.key})},Q=({actions:t})=>t.filter(r=>!r.hidden).map(r=>F(r)),J=e.Icons,D=t=>J[t],X=({iconName:t})=>{if(!t)return null;const r=D(t);return r?e.jsxRuntimeExports.jsx(c.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(r,{})}):null},Z=({onChange:t})=>{const[r,s]=c.useState(""),[n,i]=c.useState("");return e.jsxRuntimeExports.jsxs(e.Space.Compact,{children:[e.jsxRuntimeExports.jsx(e.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:o=>s(o.target.value)}),e.jsxRuntimeExports.jsx(e.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(e.Input,{style:{width:"calc(100% - 80px)"},value:n,onChange:o=>i(o.target.value)}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$1,{}),onClick:()=>{t(r,n)}})]})},Y=({request:t,tableRef:r,...s},n)=>{const[i,o]=c.useState({current:1,pageSize:10}),[x,l]=c.useState(0),{data:p,loading:j,refresh:R}=e.useRequest(async()=>{const u=await t({current:i.current,page_size:i.pageSize});return l(u.total),u.data},{refreshDeps:[i]});return c.useImperativeHandle(n,()=>({reload:()=>{R()}})),e.jsxRuntimeExports.jsx(e.ForwardTable,{rowKey:"id",loading:j,dataSource:p??[],pagination:{...i,total:x,onChange:(u,m)=>{o({current:u,pageSize:m})}},...s,ref:r})},O=({actionRef:t,...r})=>{const[s,n]=c.useState();return c.useEffect(()=>{n(c.forwardRef(Y))},[]),s?e.jsxRuntimeExports.jsx(s,{...r,ref:t}):null},ee=({onSuccess:t,token:r})=>{const{t:s}=e.useTranslation("authorization"),{t:n}=e.useTranslation("common"),[i]=e.Form.useForm(),{run:o,loading:x}=e.useRequest(async l=>f.api.authorization.changePassword(l,r?{headers:{Authorization:`Bearer ${r}`}}:{}),{manual:!0,onSuccess:()=>{e.staticMethods.success(s("user.passwordChanged")),i.resetFields(),t==null||t()},onError:l=>{if(l instanceof I.ApiError){const p=l.code??"normal";e.staticMethods.error(s(`user.passwordChangeFailed.${p}`,{error:l.message,defaultValue:"Password change failed: {{error}}"}))}else e.staticMethods.error(s("user.passwordChangeFailed.normal",{error:l.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",l)}});return e.jsxRuntimeExports.jsxs(e.Form,{form:i,layout:"vertical",onFinish:o,style:{maxWidth:500,margin:"0 auto"},children:[e.jsxRuntimeExports.jsx(e.Form.Item,{name:"old_password",label:s("user.oldPassword"),rules:[{required:!0,message:s("validation.oldPasswordRequired")}],children:e.jsxRuntimeExports.jsx(e.Input.Password,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"new_password",label:s("user.newPassword"),rules:[{required:!0,message:s("validation.newPasswordRequired")},{min:8,message:s("validation.passwordMinLength")}],children:e.jsxRuntimeExports.jsx(e.Input.Password,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"confirm_password",label:s("user.confirmPassword"),rules:[{required:!0,message:s("validation.confirmPasswordRequired")},({getFieldValue:l})=>({validator(p,j){return!j||l("new_password")===j?Promise.resolve():Promise.reject(new Error(s("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(e.Input.Password,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:x,children:n("save")})})]})},te=({user:t,onSuccess:r})=>{const{t:s}=e.useTranslation("authorization"),{t:n}=e.useTranslation("common"),[i]=e.Form.useForm(),[o,x]=c.useState(!1);c.useEffect(()=>{t&&i.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,i]);const l=async p=>{try{x(!0),await f.api.authorization.updateCurrentUser(p),e.staticMethods.success(n("updateSuccess")),r()}catch(j){e.staticMethods.error(n("updateFailed")),console.error("Failed to update user information:",j)}finally{x(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[s("user.roles"),": ",t.roles.map(p=>p.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(e.Form,{form:i,layout:"vertical",onFinish:l,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(e.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(B,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"username",label:s("user.username"),children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"email",label:s("user.email"),rules:[{required:!0,message:s("validation.emailRequired")},{type:"email",message:s("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(e.Input,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"full_name",label:s("user.fullName"),rules:[{required:!0,message:s("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(e.Input,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"phone",label:s("user.phone"),children:e.jsxRuntimeExports.jsx(e.Input,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:o,children:n("save")})})]})]})},se=({user:t,onSuccess:r})=>{const{t:s}=e.useTranslation("authorization"),{t:n}=e.useTranslation("common"),[i,o]=c.useState(0),[x,l]=c.useState(!1),[p,j]=c.useState(!0),[R,u]=c.useState(""),[m,g]=c.useState("totp"),{run:a,data:h={secret:"",qr_code:"",token:void 0}}=e.useRequest(()=>f.api.authorization.enableMfa(m),{manual:!0,onSuccess:()=>{o(1)},onBefore:()=>{l(!0)},onFinally:()=>{l(!1)}}),C=async()=>{if(!R){e.staticMethods.warning(s("mfa.enterVerificationCode"));return}const E={code:R,mfa_type:m};"token"in h&&(E.token=h.token);try{l(!0),await f.api.authorization.verifyAndActivateMfa(E),e.staticMethods.success(s("mfa.enableSuccess")),o(2),r()}catch(S){e.staticMethods.error(s("mfa.verificationFailed")),console.error("Failed to verify MFA:",S)}finally{l(!1)}},d=async()=>{try{l(!0),await f.api.authorization.disableMfa(),e.staticMethods.success(s("mfa.disableSuccess")),r()}catch(E){e.staticMethods.error(n("operationFailed")),console.error("Failed to disable MFA:",E)}finally{l(!1)}},y=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsxRuntimeExports.jsx(e.Result,{status:"success",title:s("mfa.enabled"),subTitle:s("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(e.Button,{danger:!0,onClick:()=>{e.Modal.confirm({title:s("mfa.confirmDisable"),content:s("mfa.disableWarning"),onOk:d,okButtonProps:{danger:!0}})},children:s("mfa.disable")})});const E=()=>{var S;switch(i){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(e.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:s("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:s(m==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:a,loading:x,children:s("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(e.Alert,{message:s("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:m==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:m==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(e.QRCode,{value:h.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:m==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[s("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:m==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[s("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:p?"*".repeat(((S=h.secret)==null?void 0:S.length)??0):h.secret}),e.jsxRuntimeExports.jsx(e.Button,{type:"link",onClick:()=>j(!p),icon:p?e.jsxRuntimeExports.jsx(e.RefIcon$4,{}):e.jsxRuntimeExports.jsx(e.RefIcon$5,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:s("mfa.enterCode"),style:{width:200},maxLength:6,value:R,onChange:w=>u(w.target.value)})}),e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>o(0),children:n("previous")}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:C,loading:x,children:n("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(e.Result,{status:"success",title:s("mfa.setupSuccess"),subTitle:s("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",onClick:()=>o(0),children:n("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:i===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(e.Segmented,{defaultValue:"totp",onChange:S=>{g(S),o(0)},value:m,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(e.RefIcon$2,{}),label:s("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(e.RefIcon$3,{}),label:s("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(e.Divider,{})]}),e.jsxRuntimeExports.jsx(e.Steps,{current:i,items:[{title:s(m==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:s(m==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:s(m==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:s(m==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:s(m==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:s(m==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),E()]})};return e.jsxRuntimeExports.jsx(e.Card,{title:s("mfa.title"),children:y()})},{Text:T}=e.Typography,ne=()=>{const{t}=e.useTranslation("authorization"),{t:r}=e.useTranslation("common"),[s,n]=c.useState([]),[i,o]=c.useState(!1),[x,l]=c.useState(null),[p,j]=c.useState(!1),R=async()=>{try{o(!0);const a=await f.api.authorization.getUserSessions({});n(a)}catch(a){e.staticMethods.error(t("session.getSessionsFailed",{error:a,defaultValue:"Failed to get session list: {{error}}"}))}finally{o(!1)}};c.useEffect(()=>{R()},[]);const u=async a=>{try{l(a),await f.api.authorization.terminateSession({id:a}),n(s.filter(h=>h.id!==a)),e.staticMethods.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(h){e.staticMethods.error(t("session.terminateFailed",{error:h,defaultValue:"Failed to terminate session: {{error}}"}))}finally{l(null)}},m=async()=>{try{j(!0),await f.api.authorization.terminateOtherSessions(),n(s.filter(a=>a.is_current)),e.staticMethods.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(a){e.staticMethods.error(t("session.terminateAllFailed",{error:a,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{j(!1)}},g=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(a,h)=>e.jsxRuntimeExports.jsxs(e.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$6,{}),e.jsxRuntimeExports.jsx(T,{strong:!0,children:a})]}),e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$7,{}),e.jsxRuntimeExports.jsx(T,{type:"secondary",children:h.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:a=>e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$8,{}),e.jsxRuntimeExports.jsx("span",{children:a})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:a=>e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.RefIcon$9,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(a).toLocaleString()})]})},{title:t("session.status"),key:"status",render:a=>a.is_current?e.jsxRuntimeExports.jsx(e.Tag,{color:"green",children:t("session.current")}):e.jsxRuntimeExports.jsx(e.Tag,{color:"blue",children:t("session.active")})},{title:r("actions"),key:"action",render:a=>a.is_current?e.jsxRuntimeExports.jsx(T,{type:"secondary",children:t("session.currentSession")}):e.jsxRuntimeExports.jsx(e.Popconfirm,{title:t("session.confirmTerminate"),onConfirm:()=>u(a.id),okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(e.Button,{type:"link",danger:!0,loading:x===a.id,children:t("session.terminate")})})}];return e.jsxRuntimeExports.jsx(e.Card,{title:t("session.title"),extra:s.length>1&&e.jsxRuntimeExports.jsx(e.Popconfirm,{title:t("session.confirmTerminateAll"),onConfirm:m,okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(e.Button,{danger:!0,loading:p,children:t("session.terminateOthers")})}),children:s.length===0?e.jsxRuntimeExports.jsx(e.Empty,{description:t("session.noSessions")}):e.jsxRuntimeExports.jsx(e.ForwardTable,{columns:g,dataSource:s,rowKey:"id",loading:i,pagination:!1})})},{RangePicker:re}=e.DatePicker,{Option:v}=e.Select,ie=t=>t||"N/A",oe=(t,r)=>t==="success"?e.jsxRuntimeExports.jsx(e.Tag,{color:"success",children:r("statuses.success")}):e.jsxRuntimeExports.jsx(e.Tag,{color:"error",children:r("statuses.failed")}),ae=({userId:t,request:r=n=>t?f.api.authorization.getUserLogs({id:t,...n}):f.api.authorization.getCurrentUserLogs(n),columnsFilter:s=n=>n})=>{const{t:n}=e.useTranslation("authorization"),{t:i}=e.useTranslation("common"),[o,x]=c.useState({current:1,pageSize:10,total:0}),[l,p]=c.useState({}),[j]=e.Form.useForm(),{loading:R,run:u,data:{data:m}={}}=e.useRequest(async(d=l,y=1,E=10)=>r({...d,current:y??1,page_size:E??10}),{onError(d){e.staticMethods.error(n("auditLog.fetchFailed",{error:d}))},onSuccess({total:d}){x({...o,total:d})}});c.useEffect(()=>{u(l,1,o.pageSize)},[]);const g=d=>{x({...o,current:d.current,pageSize:d.pageSize}),u({},d.current,d.pageSize)},a=d=>{var y,E,S,w;u({...d,start_time:(E=(y=d.dateRange)==null?void 0:y[0])==null?void 0:E.toISOString(),end_time:(w=(S=d.dateRange)==null?void 0:S[1])==null?void 0:w.toISOString()},1,o.pageSize)},h=()=>{j.resetFields(),p({}),x({...o,current:1}),u({},1,o.pageSize)},C=[{title:n("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:d=>A.formatDate(d)},{title:n("auditLog.action"),dataIndex:"action",key:"action",render:(d,y)=>d?n(`action.${d.replace(":",".")}`,{defaultValue:y.action_name}):y.action_name??y.action},{title:n("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:n("auditLog.ip"),dataIndex:"ip",key:"ip",render:d=>ie(d)},{title:n("auditLog.status"),dataIndex:"status",key:"status",render:d=>oe(d,n)},{title:n("auditLog.details"),dataIndex:"details",key:"details",render:d=>e.jsxRuntimeExports.jsx(e.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(e.RefIcon$4,{}),onClick:()=>{e.Modal.info({title:n("auditLog.details"),content:JSON.stringify(d)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(e.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(e.Form,{form:j,layout:"horizontal",onFinish:a,initialValues:l,children:[e.jsxRuntimeExports.jsxs(e.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(e.Col,{span:6,children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"search",label:n("auditLog.search"),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:n("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(e.Col,{span:6,children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"action",label:n("auditLog.action"),children:e.jsxRuntimeExports.jsxs(e.Select,{allowClear:!0,placeholder:n("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(v,{value:"login",children:n("actions.login")}),e.jsxRuntimeExports.jsx(v,{value:"logout",children:n("actions.logout")}),e.jsxRuntimeExports.jsx(v,{value:"password_reset",children:n("actions.passwordReset")}),e.jsxRuntimeExports.jsx(v,{value:"mfa_change",children:n("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(e.Col,{span:6,children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"status",label:n("auditLog.status"),children:e.jsxRuntimeExports.jsxs(e.Select,{allowClear:!0,placeholder:n("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(v,{value:"success",children:n("statuses.success")}),e.jsxRuntimeExports.jsx(v,{value:"failed",children:n("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(e.Col,{span:6,children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"dateRange",label:n("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(re,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(e.Row,{children:e.jsxRuntimeExports.jsx(e.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{onClick:h,children:i("reset")}),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(e.RefIcon$10,{}),children:i("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(e.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),onClick:h,style:{marginRight:8},children:i("refresh")})}),e.jsxRuntimeExports.jsx(e.ForwardTable,{rowKey:"id",columns:s(C),dataSource:m,pagination:{...o,showSizeChanger:!0,showTotal:d=>i("totalItems",{total:d})},loading:R,onChange:g,scroll:{x:"max-content"}})]})]})};exports.Actions=Q;exports.AdminGuard=G;exports.AllLangUIConfig=P;exports.Avatar=z;exports.AvatarUpload=B;exports.DynamicIcon=X;exports.HeaderDropdown=k;exports.LabelCreater=Z;exports.LanguageSwitch=H;exports.Loading=q;exports.PermissionGuard=_;exports.PrivateRoute=$;exports.ProfileBasic=te;exports.ProfileMFA=se;exports.ProfilePassword=ee;exports.ProfileSessions=ne;exports.Table=O;exports.UserAuditLogs=ae;exports.getIconByName=D;
