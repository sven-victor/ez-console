"use strict";const e=require("./vendor.js"),q=require("react-router-dom"),F=require("./contexts.js"),_=require("./base.js"),s=require("antd"),y=require("react-i18next"),M=require("antd-style"),E=require("@ant-design/icons"),k=require("classnames"),j=require("react"),T=require("ahooks"),S=require("./index.js"),A=require("./client.js"),W=require("lodash-es");function J(t){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return i.default=t,Object.freeze(i)}const Q=J(E),V=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(s.Spin,{size:"large"})}),X=({element:t,requiredPermission:i,requiredPermissions:n})=>{const{t:r}=y.useTranslation(),{user:u,loading:l,error:o}=F.useAuth(),{hasPermission:m,hasAllPermissions:d}=F.usePermission();return l?e.jsxRuntimeExports.jsx(V,{}):o?e.jsxRuntimeExports.jsx(s.Result,{status:"500",title:"500",subTitle:r("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(o==null?void 0:o.message)||o})}):u?i&&!m(i)?e.jsxRuntimeExports.jsx(q.Navigate,{to:"/forbidden",replace:!0}):n&&!d(n)?e.jsxRuntimeExports.jsx(q.Navigate,{to:"/forbidden",replace:!0}):t:(window.location.href=_.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},Z=M.createStyles(({token:t,css:i})=>({container:i`
      ${i`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),D=({overlayClassName:t,overlay:i,hidden:n,children:r,...u})=>{if(n)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:l}=Z();return e.jsxRuntimeExports.jsx(s.Dropdown,{dropdownRender:i,overlayClassName:k(l.container,t),...u,children:e.jsxRuntimeExports.jsx("span",{className:l.iconStyle,children:r})})},Y=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),ee=M.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),U=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],te=({transformLangConfig:t=n=>n,className:i})=>{const{i18n:n}=y.useTranslation(),{styles:r}=ee(),u=o=>{n.changeLanguage(o)},l={selectedKeys:[n.language],onClick:o=>{u(o.key)},items:t(U).map(o=>({key:o.lang,className:r.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(o==null?void 0:o.label)||"en-US",className:r.menuItemIconStyle,children:(o==null?void 0:o.icon)||"ðŸŒ"}),(o==null?void 0:o.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(D,{className:i,menu:l,children:e.jsxRuntimeExports.jsx(Y,{})})},se=M.createStyles(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),$=t=>W.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?A.baseURL.endsWith("/")?A.baseURL+`files/${t}`:A.baseURL+`/files/${t}`:t,H=({src:t,fallback:i,...n})=>e.jsxRuntimeExports.jsx(s.Avatar,{src:$(t),icon:i,...n}),ne=({onChange:t,shape:i="square"})=>{const[n,r]=j.useState([]),{styles:u}=se(),[l,o]=j.useState(!1),[m,d]=j.useState(!0),[h,p]=j.useState(0),{run:a,loading:c}=T.useRequest(()=>S.api.base.listFiles({current:h+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:x})=>{r([...n,...x]),d(x.length===40),p(h+1)}}),f=()=>{d(!0),p(0),r([])};return e.jsxRuntimeExports.jsx(s.Popover,{style:{zIndex:1e3},onOpenChange:x=>{o(x),x?a():f()},open:l,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:n.length,next:()=>{a()},hasMore:m,loader:e.jsxRuntimeExports.jsx(s.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(s.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(s.List,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:c,renderItem:({id:x})=>e.jsxRuntimeExports.jsx("div",{className:u.avatarItem,onClick:g=>{g.stopPropagation(),t==null||t(x),o(!1),f()},children:e.jsxRuntimeExports.jsx(H,{shape:i,src:x})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(E.UploadOutlined,{shape:i,style:{width:112,height:112,placeContent:"center"}})})},G=({value:t,onChange:i,shape:n,...r})=>{const[u,l]=j.useState(void 0),[o,m]=j.useState(!1),[d,h]=j.useState(void 0),p=async a=>{m(!0),h(a.url??a.preview)};return j.useEffect(()=>{l(t?{uid:t,name:t,url:$(t)}:void 0)},[t]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(e.ImgCrop,{beforeCrop:async a=>{if(a.type==="image/svg+xml"){const c=await S.api.base.uploadFile({type:"avatar"},a);return c.length>0&&(i==null||i(c[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(s.Upload,{customRequest:async a=>{var f,x;const c=await S.api.base.uploadFile({type:"avatar",access:"public"},a.file);c.length>0?((f=a.onSuccess)==null||f.call(a,c[0].id),i==null||i(c[0].id)):(x=a.onError)==null||x.call(a,new Error("Upload file failed"))},listType:"picture-card",onPreview:p,maxCount:1,onChange:({file:a})=>{switch(a.status){case"removed":i==null||i(void 0);break;case"done":break;default:l(a);break}},fileList:u?[u]:[],...r,children:u?void 0:e.jsxRuntimeExports.jsx(ne,{shape:n,onChange:i})})}),e.jsxRuntimeExports.jsx(s.Modal,{open:o,footer:null,onCancel:()=>m(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:d})})]})},re=({className:t})=>{const{t:i}=y.useTranslation("common"),{user:n}=F.useAuth(),{currentOrgId:r,setCurrentOrgId:u}=F.useSite(),l=(n==null?void 0:n.organizations)||[],o=p=>{u(p),window.location.reload()};if(l.length===0)return null;const m=l.find(p=>p.id===r),d=m?m.name:i("organization.global",{defaultValue:"Global"}),h=[...l.map(p=>({key:p.id,label:e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxRuntimeExports.jsx("span",{children:p.name}),r===p.id&&e.jsxRuntimeExports.jsx(E.CheckOutlined,{})]}),onClick:()=>o(p.id)}))];return e.jsxRuntimeExports.jsxs(D,{className:t,menu:{items:h,selectedKeys:r?[r]:[""]},children:[e.jsxRuntimeExports.jsx(E.TeamOutlined,{style:{marginRight:4}}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:d})]})},ie=({onResize:t,minWidth:i=300,maxWidth:n=window.innerWidth*.5})=>{const[r,u]=j.useState(!1),[l,o]=j.useState(!1),m=j.useCallback(p=>{p.preventDefault(),u(!0)},[]),d=j.useCallback(p=>{if(!r)return;const a=window.innerWidth-p.clientX,c=Math.max(i,Math.min(n,a));t(c)},[r,i,n,t]),h=j.useCallback(()=>{u(!1)},[]);return j.useEffect(()=>{if(r)return document.addEventListener("mousemove",d),document.addEventListener("mouseup",h),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h),document.body.style.cursor="",document.body.style.userSelect=""}},[r,d,h]),e.jsxRuntimeExports.jsx("div",{onMouseDown:m,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:r?"none":"background-color 0.2s ease",backgroundColor:r?"#1890ff":l?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:r||l?"#fff":"#999",opacity:r||l?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},B=({permission:t,permissions:i=[],checkAll:n=!1,fallback:r=null,children:u})=>{const{hasPermission:l,hasAnyPermission:o,hasAllPermissions:m,isAdmin:d,loading:h}=F.usePermission();return h?null:d?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:u}):t?l(t)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:u}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):i.length>0?(n?m(i):o(i))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:u}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:u})},oe=({fallback:t=null,children:i})=>{const{isAdmin:n,loading:r}=F.usePermission();return r?null:n?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:t})},O=t=>{const[i,n]=j.useState(!1),{permission:r,icon:u,tooltip:l,onClick:o,confirm:m,label:d,...h}=t,p=o?async()=>{n(!0);try{await o()}finally{n(!1)}}:void 0;let a=e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",loading:i,icon:u,onClick:m?void 0:p,...h,children:d&&e.jsxRuntimeExports.jsx("span",{style:{position:"inherit",top:"-2px"},children:d})});if(l&&(a=e.jsxRuntimeExports.jsx(s.Tooltip,{title:l,children:a})),m){const c=async()=>{m.onConfirm?m.onConfirm():p&&await p()};a=e.jsxRuntimeExports.jsx(s.Popconfirm,{title:m.title,description:m.description,onConfirm:c,okText:m.okText,cancelText:m.cancelText,children:a})}return r&&(a=e.jsxRuntimeExports.jsx(B,{permission:r,children:a})),a},ae=({actions:t,maxVisibleItems:i})=>{const n=t.filter(o=>!o.hidden);if(!i||n.length<=i)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n.map(({key:o,...m})=>e.jsxRuntimeExports.jsx(O,{...m},o))});const r=n.slice(0,i-1),l=n.slice(i-1).map(o=>{const{key:m,label:d,icon:h,permission:p,onClick:a,confirm:c,disabled:f,tooltip:x}=o,v={key:m,label:d,icon:h,disabled:f,onClick:async()=>{c?s.Modal.confirm({title:c.title,content:c.description,onOk:c.onConfirm,okText:c.okText,cancelText:c.cancelText}):a&&await a()}};return p?{...v,label:e.jsxRuntimeExports.jsx(B,{permission:p,children:e.jsxRuntimeExports.jsx("span",{children:d??x})})}:v});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[r.map(({key:o,...m})=>e.jsxRuntimeExports.jsx(O,{...m},o)),e.jsxRuntimeExports.jsx(s.Dropdown,{menu:{items:l},trigger:["click"],children:e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(E.MoreOutlined,{})})})]})},le=Q,K=t=>le[t],ue=({iconName:t})=>{if(!t)return null;const i=K(t);return i?e.jsxRuntimeExports.jsx(j.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(i,{})}):null},ce=({onChange:t})=>{const[i,n]=j.useState(""),[r,u]=j.useState("");return e.jsxRuntimeExports.jsxs(s.Space.Compact,{children:[e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:i,onChange:l=>n(l.target.value)}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:l=>u(l.target.value)}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(E.PlusOutlined,{}),onClick:()=>{t(i,r)}})]})},xe=({request:t,tableRef:i,...n},r)=>{const[u,l]=j.useState({current:1,pageSize:10}),[o,m]=j.useState(0),{data:d,loading:h,refresh:p}=T.useRequest(async()=>{const a=await t({current:u.current,page_size:u.pageSize});return m(a.total),a.data},{refreshDeps:[u]});return j.useImperativeHandle(r,()=>({reload:()=>{p()}})),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",loading:h,dataSource:d??[],pagination:{...u,total:o,onChange:(a,c)=>{l({current:a,pageSize:c})}},...n,ref:i})},me=({actionRef:t,...i})=>{const[n,r]=j.useState();return j.useEffect(()=>{r(j.forwardRef(xe))},[]),n?e.jsxRuntimeExports.jsx(n,{...i,ref:t}):null},de=({className:t,onSuccess:i,token:n})=>{const{t:r}=y.useTranslation("authorization"),{t:u}=y.useTranslation("common"),[l]=s.Form.useForm(),{run:o,loading:m}=T.useRequest(async d=>S.api.authorization.changePassword(d,n?{headers:{Authorization:`Bearer ${n}`}}:{}),{manual:!0,onSuccess:()=>{s.message.success(r("user.passwordChanged")),l.resetFields(),i==null||i()},onError:d=>{if(d instanceof A.ApiError){const h=d.code??"normal";s.message.error(r(`user.passwordChangeFailed.${h}`,{error:d.message,defaultValue:"Password change failed: {{error}}"}))}else s.message.error(r("user.passwordChangeFailed.normal",{error:d.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",d)}});return e.jsxRuntimeExports.jsxs(s.Form,{form:l,layout:"vertical",onFinish:o,style:{maxWidth:500,margin:"0 auto"},className:k("profile-password",t),children:[e.jsxRuntimeExports.jsx(s.Form.Item,{name:"old_password",label:r("user.oldPassword"),rules:[{required:!0,message:r("validation.oldPasswordRequired")}],className:k("profile-password-item","profile-password-item-old-password"),children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"new_password",label:r("user.newPassword"),rules:[{required:!0,message:r("validation.newPasswordRequired")},{min:8,message:r("validation.passwordMinLength")}],className:k("profile-password-item","profile-password-item-new-password"),children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"confirm_password",label:r("user.confirmPassword"),className:k("profile-password-item","profile-password-item-confirm-password"),rules:[{required:!0,message:r("validation.confirmPasswordRequired")},({getFieldValue:d})=>({validator(h,p){return!p||d("new_password")===p?Promise.resolve():Promise.reject(new Error(r("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{className:k("profile-password-item","profile-password-item-submit"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:m,children:u("save")})})]})},pe=({user:t,onSuccess:i})=>{const{t:n}=y.useTranslation("authorization"),{t:r}=y.useTranslation("common"),[u]=s.Form.useForm(),[l,o]=j.useState(!1);j.useEffect(()=>{t&&u.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,u]);const m=async d=>{try{o(!0),await S.api.authorization.updateCurrentUser(d),s.message.success(r("updateSuccess")),i()}catch(h){s.message.error(r("updateFailed")),console.error("Failed to update user information:",h)}finally{o(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[n("user.roles"),": ",t.roles.map(d=>d.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(s.Form,{form:u,layout:"vertical",onFinish:m,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(G,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"username",label:n("user.username"),children:e.jsxRuntimeExports.jsx(s.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"phone",label:n("user.phone"),children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:l,children:r("save")})})]})]})},je=({user:t,onSuccess:i})=>{const{t:n}=y.useTranslation("authorization"),{t:r}=y.useTranslation("common"),[u,l]=j.useState(0),[o,m]=j.useState(!1),[d,h]=j.useState(!0),[p,a]=j.useState(""),[c,f]=j.useState("totp"),{run:x,data:g={secret:"",qr_code:"",token:void 0}}=T.useRequest(()=>S.api.authorization.enableMfa(c),{manual:!0,onSuccess:()=>{l(1)},onBefore:()=>{m(!0)},onFinally:()=>{m(!1)}}),v=async()=>{if(!p){s.message.warning(n("mfa.enterVerificationCode"));return}const w={code:p,mfa_type:c};"token"in g&&(w.token=g.token);try{m(!0),await S.api.authorization.verifyAndActivateMfa(w),s.message.success(n("mfa.enableSuccess")),l(2),i()}catch(I){s.message.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",I)}finally{m(!1)}},R=async()=>{try{m(!0),await S.api.authorization.disableMfa(),s.message.success(n("mfa.disableSuccess")),i()}catch(w){s.message.error(r("operationFailed")),console.error("Failed to disable MFA:",w)}finally{m(!1)}},b=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,onClick:()=>{s.Modal.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:R,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const w=()=>{var I;switch(u){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:n("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:n(c==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:x,loading:o,children:n("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:c==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:c==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(s.QRCode,{value:g.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:c==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:c==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:d?"*".repeat(((I=g.secret)==null?void 0:I.length)??0):g.secret}),e.jsxRuntimeExports.jsx(s.Button,{type:"link",onClick:()=>h(!d),icon:d?e.jsxRuntimeExports.jsx(E.EyeOutlined,{}):e.jsxRuntimeExports.jsx(E.EyeInvisibleOutlined,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:p,onChange:L=>a(L.target.value)})}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>l(0),children:r("previous")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:v,loading:o,children:r("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:()=>l(0),children:r("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:u===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(s.Segmented,{defaultValue:"totp",onChange:I=>{f(I),l(0)},value:c,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(E.ClockCircleFilled,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(E.MailOutlined,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(s.Divider,{})]}),e.jsxRuntimeExports.jsx(s.Steps,{current:u,items:[{title:n(c==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(c==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(c==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(c==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(c==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(c==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),w()]})};return e.jsxRuntimeExports.jsx(s.Card,{title:n("mfa.title"),children:b()})},{Text:P}=s.Typography,he=()=>{const{t}=y.useTranslation("authorization"),{t:i}=y.useTranslation("common"),[n,r]=j.useState([]),[u,l]=j.useState(!1),[o,m]=j.useState(null),[d,h]=j.useState(!1),p=async()=>{try{l(!0);const x=await S.api.authorization.getUserSessions({});r(x)}catch(x){s.message.error(t("session.getSessionsFailed",{error:x,defaultValue:"Failed to get session list: {{error}}"}))}finally{l(!1)}};j.useEffect(()=>{p()},[]);const a=async x=>{try{m(x),await S.api.authorization.terminateSession({id:x}),r(n.filter(g=>g.id!==x)),s.message.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(g){s.message.error(t("session.terminateFailed",{error:g,defaultValue:"Failed to terminate session: {{error}}"}))}finally{m(null)}},c=async()=>{try{h(!0),await S.api.authorization.terminateOtherSessions(),r(n.filter(x=>x.is_current)),s.message.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(x){s.message.error(t("session.terminateAllFailed",{error:x,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{h(!1)}},f=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(x,g)=>e.jsxRuntimeExports.jsxs(s.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.LaptopOutlined,{}),e.jsxRuntimeExports.jsx(P,{strong:!0,children:x})]}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.EnvironmentOutlined,{}),e.jsxRuntimeExports.jsx(P,{type:"secondary",children:g.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:x=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.GlobalOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:x})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:x=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.ClockCircleOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(x).toLocaleString()})]})},{title:t("session.status"),key:"status",render:x=>x.is_current?e.jsxRuntimeExports.jsx(s.Tag,{color:"green",children:t("session.current")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"blue",children:t("session.active")})},{title:i("actions"),key:"action",render:x=>x.is_current?e.jsxRuntimeExports.jsx(P,{type:"secondary",children:t("session.currentSession")}):e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminate"),onConfirm:()=>a(x.id),okText:i("confirm"),cancelText:i("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"link",danger:!0,loading:o===x.id,children:t("session.terminate")})})}];return e.jsxRuntimeExports.jsx(s.Card,{title:t("session.title"),extra:n.length>1&&e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminateAll"),onConfirm:c,okText:i("confirm"),cancelText:i("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,loading:d,children:t("session.terminateOthers")})}),children:n.length===0?e.jsxRuntimeExports.jsx(s.Empty,{description:t("session.noSessions")}):e.jsxRuntimeExports.jsx(s.Table,{columns:f,dataSource:n,rowKey:"id",loading:u,pagination:!1})})},{RangePicker:ge}=s.DatePicker,{Option:C}=s.Select,Re=t=>t||"N/A",fe=(t,i)=>t==="success"?e.jsxRuntimeExports.jsx(s.Tag,{color:"success",children:i("statuses.success")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"error",children:i("statuses.failed")}),Ee=({userId:t,request:i=r=>t?S.api.authorization.getUserLogs({id:t,...r}):S.api.authorization.getCurrentUserLogs(r),columnsFilter:n=r=>r})=>{const{t:r}=y.useTranslation("authorization"),{t:u}=y.useTranslation("common"),[l,o]=j.useState({current:1,pageSize:10,total:0}),[m,d]=j.useState({}),[h]=s.Form.useForm(),{loading:p,run:a,data:{data:c}={}}=T.useRequest(async(R=m,b=1,w=10)=>i({...R,current:b??1,page_size:w??10}),{onError(R){s.message.error(r("auditLog.fetchFailed",{error:R}))},onSuccess({total:R}){o({...l,total:R})}});j.useEffect(()=>{a(m,1,l.pageSize)},[]);const f=R=>{o({...l,current:R.current,pageSize:R.pageSize}),a({},R.current,R.pageSize)},x=R=>{var b,w,I,L;a({...R,start_time:(w=(b=R.dateRange)==null?void 0:b[0])==null?void 0:w.toISOString(),end_time:(L=(I=R.dateRange)==null?void 0:I[1])==null?void 0:L.toISOString()},1,l.pageSize)},g=()=>{h.resetFields(),d({}),o({...l,current:1}),a({},1,l.pageSize)},v=[{title:r("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:R=>_.formatDate(R)},{title:r("auditLog.action"),dataIndex:"action",key:"action",render:(R,b)=>R?r(`action.${R.replace(":",".")}`,{defaultValue:b.action_name}):b.action_name??b.action},{title:r("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:r("auditLog.ip"),dataIndex:"ip",key:"ip",render:R=>Re(R)},{title:r("auditLog.status"),dataIndex:"status",key:"status",render:R=>fe(R,r)},{title:r("auditLog.details"),dataIndex:"details",key:"details",render:R=>e.jsxRuntimeExports.jsx(s.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(E.EyeOutlined,{}),onClick:()=>{s.Modal.info({title:r("auditLog.details"),content:JSON.stringify(R)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(s.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(s.Form,{form:h,layout:"horizontal",onFinish:x,initialValues:m,children:[e.jsxRuntimeExports.jsxs(s.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"search",label:r("auditLog.search"),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:r("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"action",label:r("auditLog.action"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:r("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(C,{value:"login",children:r("actions.login")}),e.jsxRuntimeExports.jsx(C,{value:"logout",children:r("actions.logout")}),e.jsxRuntimeExports.jsx(C,{value:"password_reset",children:r("actions.passwordReset")}),e.jsxRuntimeExports.jsx(C,{value:"mfa_change",children:r("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"status",label:r("auditLog.status"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:r("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(C,{value:"success",children:r("statuses.success")}),e.jsxRuntimeExports.jsx(C,{value:"failed",children:r("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"dateRange",label:r("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(ge,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(s.Row,{children:e.jsxRuntimeExports.jsx(s.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:g,children:u("reset")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(E.SearchOutlined,{}),children:u("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(s.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(E.ReloadOutlined,{}),onClick:g,style:{marginRight:8},children:u("refresh")})}),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",columns:n(v),dataSource:c,pagination:{...l,showSizeChanger:!0,showTotal:R=>u("totalItems",{total:R})},loading:p,onChange:f,scroll:{x:"max-content"}})]})]})},{TextArea:N}=s.Input,{Option:z}=s.Select,ye=({field:t,selectedType:i,dependentValues:n,formValues:r={}})=>{const{t:u}=y.useTranslation("system"),{t:l}=y.useTranslation("common"),o=j.useMemo(()=>_.checkVisibilityCondition(t.visible_when,r),[t.visible_when,r]),{options:m,loading:d}=F.useDynamicDataSource(t.data_source,t.options,n),h=j.useMemo(()=>t.data_source&&t.data_source.type!=="static"?m:t.options||[],[t.data_source,t.options,m]),p=h&&h.length>0;if(!o)return null;const a=[{required:t.required,message:u("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],c=()=>u(`settings.toolsets.${i}.${t.name}`,{defaultValue:t.display_name||t.name}),f=()=>u(`settings.toolsets.${i}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${l("enter",{defaultValue:"Enter"})} ${t.name}`}),x=()=>{if(t.description)return u(`settings.toolsets.${i}.${t.name}Tooltip`,{defaultValue:t.description})};if(!o)return null;if(t.type==="select"||t.data_source)return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{loading:d,allowClear:!0,placeholder:f(),showSearch:!0,filterOption:(g,v)=>{var R;return(R=v==null?void 0:v.children)==null?void 0:R.toLowerCase().includes(g.toLowerCase())},children:h.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name);switch(t.type){case"text":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,children:e.jsxRuntimeExports.jsx(N,{placeholder:f(),rows:4})},t.name);case"string":return p?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:f(),children:h.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:f()})},t.name);case"password":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Input.Password,{placeholder:f(),autoComplete:"new-password"})},t.name);case"number":return p?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:f(),children:h.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.InputNumber,{style:{width:"100%"},placeholder:f()})},t.name);case"boolean":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),valuePropName:"checked",tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Switch,{})},t.name);case"array":return p?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Checkbox.Group,{style:{width:"100%"},children:e.jsxRuntimeExports.jsx(s.Space,{direction:"vertical",children:h.map(g=>e.jsxRuntimeExports.jsx(s.Checkbox,{value:g.value,children:g.label},g.value))})})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:a,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{mode:"tags",style:{width:"100%"},placeholder:f(),tokenSeparators:[","]})},t.name);case"object":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:[...a,{validator:(g,v)=>{if(!v)return Promise.resolve();try{return JSON.parse(v),Promise.resolve()}catch{return Promise.reject(new Error(u("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:x(),children:e.jsxRuntimeExports.jsx(N,{rows:4,placeholder:f()})},t.name);default:return null}};exports.Actions=ae;exports.AdminGuard=oe;exports.AllLangUIConfig=U;exports.Avatar=H;exports.AvatarUpload=G;exports.DynamicConfigField=ye;exports.DynamicIcon=ue;exports.HeaderDropdown=D;exports.LabelCreater=ce;exports.LanguageSwitch=te;exports.Loading=V;exports.OrganizationSwitcher=re;exports.PermissionGuard=B;exports.PrivateRoute=X;exports.ProfileBasic=pe;exports.ProfileMFA=je;exports.ProfilePassword=de;exports.ProfileSessions=he;exports.ResizeDivider=ie;exports.Table=me;exports.UserAuditLogs=Ee;exports.getIconByName=K;
