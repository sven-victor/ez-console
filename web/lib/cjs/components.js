"use strict";const e=require("./vendor.js"),O=require("react-router-dom"),C=require("./contexts.js"),_=require("./base.js"),s=require("antd"),y=require("react-i18next"),D=require("antd-style"),f=require("@ant-design/icons"),T=require("classnames"),j=require("react"),F=require("ahooks"),X=require("@ant-design/x-markdown"),V=require("@ant-design/x"),S=require("./index.js"),A=require("./client.js"),Q=require("lodash-es");function Z(t){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return i.default=t,Object.freeze(i)}const Y=Z(f),M=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(s.Spin,{size:"large"})}),ee=({element:t,requiredPermission:i,requiredPermissions:n})=>{const{t:r}=y.useTranslation(),{user:l,loading:u,error:a}=C.useAuth(),{hasPermission:x,hasAllPermissions:m}=C.usePermission();return u?e.jsxRuntimeExports.jsx(M,{}):a?a.code==="E4011"?e.jsxRuntimeExports.jsx(M,{}):e.jsxRuntimeExports.jsx(s.Result,{status:"500",title:"500",subTitle:r("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(a==null?void 0:a.message)||a})}):l?i&&!x(i)?e.jsxRuntimeExports.jsx(O.Navigate,{to:"/forbidden",replace:!0}):n&&!m(n)?e.jsxRuntimeExports.jsx(O.Navigate,{to:"/forbidden",replace:!0}):t:(window.location.href=_.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},te=D.createStyles(({token:t,css:i})=>({container:i`
      ${i`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),B=({overlayClassName:t,overlay:i,hidden:n,children:r,...l})=>{if(n)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:u}=te();return e.jsxRuntimeExports.jsx(s.Dropdown,{dropdownRender:i,overlayClassName:T(u.container,t),...l,children:e.jsxRuntimeExports.jsx("span",{className:u.iconStyle,children:r})})},se=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),ne=D.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),$=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],re=({transformLangConfig:t=n=>n,className:i})=>{const{i18n:n}=y.useTranslation(),{styles:r}=ne(),l=a=>{n.changeLanguage(a)},u={selectedKeys:[n.language],onClick:a=>{l(a.key)},items:t($).map(a=>({key:a.lang,className:r.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(a==null?void 0:a.label)||"en-US",className:r.menuItemIconStyle,children:(a==null?void 0:a.icon)||"ðŸŒ"}),(a==null?void 0:a.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(B,{className:i,menu:u,children:e.jsxRuntimeExports.jsx(se,{})})},ie=D.createStyles(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),H=t=>Q.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?A.baseURL.endsWith("/")?A.baseURL+`files/${t}`:A.baseURL+`/files/${t}`:t,G=({src:t,fallback:i,...n})=>e.jsxRuntimeExports.jsx(s.Avatar,{src:H(t),icon:i,...n}),oe=({onChange:t,shape:i="square"})=>{const[n,r]=j.useState([]),{styles:l}=ie(),[u,a]=j.useState(!1),[x,m]=j.useState(!0),[p,d]=j.useState(0),{run:c,loading:o}=F.useRequest(()=>S.api.base.listFiles({current:p+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:R})=>{r([...n,...R]),m(R.length===40),d(p+1)}}),E=()=>{m(!0),d(0),r([])};return e.jsxRuntimeExports.jsx(s.Popover,{style:{zIndex:1e3},onOpenChange:R=>{a(R),R?c():E()},open:u,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:n.length,next:()=>{c()},hasMore:x,loader:e.jsxRuntimeExports.jsx(s.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(s.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(s.List,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:o,renderItem:({id:R})=>e.jsxRuntimeExports.jsx("div",{className:l.avatarItem,onClick:g=>{g.stopPropagation(),t==null||t(R),a(!1),E()},children:e.jsxRuntimeExports.jsx(G,{shape:i,src:R})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(f.UploadOutlined,{shape:i,style:{width:112,height:112,placeContent:"center"}})})},K=({value:t,onChange:i,shape:n,...r})=>{const[l,u]=j.useState(void 0),[a,x]=j.useState(!1),[m,p]=j.useState(void 0),d=async c=>{x(!0),p(c.url??c.preview)};return j.useEffect(()=>{u(t?{uid:t,name:t,url:H(t)}:void 0)},[t]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(e.ImgCrop,{beforeCrop:async c=>{if(c.type==="image/svg+xml"){const o=await S.api.base.uploadFile({type:"avatar"},c);return o.length>0&&(i==null||i(o[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(s.Upload,{customRequest:async c=>{var E,R;const o=await S.api.base.uploadFile({type:"avatar",access:"public"},c.file);o.length>0?((E=c.onSuccess)==null||E.call(c,o[0].id),i==null||i(o[0].id)):(R=c.onError)==null||R.call(c,new Error("Upload file failed"))},listType:"picture-card",onPreview:d,maxCount:1,onChange:({file:c})=>{switch(c.status){case"removed":i==null||i(void 0);break;case"done":break;default:u(c);break}},fileList:l?[l]:[],...r,children:l?void 0:e.jsxRuntimeExports.jsx(oe,{shape:n,onChange:i})})}),e.jsxRuntimeExports.jsx(s.Modal,{open:a,footer:null,onCancel:()=>x(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:m})})]})},ae=({className:t})=>{const{t:i}=y.useTranslation("common"),{user:n}=C.useAuth(),{currentOrgId:r,setCurrentOrgId:l}=C.useSite(),u=(n==null?void 0:n.organizations)||[],a=d=>{l(d),window.location.reload()};if(u.length===0)return null;const x=u.find(d=>d.id===r),m=x?x.name:i("organization.global",{defaultValue:"Global"}),p=[...u.map(d=>({key:d.id,label:e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxRuntimeExports.jsx("span",{children:d.name}),r===d.id&&e.jsxRuntimeExports.jsx(f.CheckOutlined,{})]}),onClick:()=>a(d.id)}))];return e.jsxRuntimeExports.jsxs(B,{className:t,menu:{items:p,selectedKeys:r?[r]:[""]},children:[e.jsxRuntimeExports.jsx(f.TeamOutlined,{style:{marginRight:4}}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:m})]})},le=({onResize:t,minWidth:i=300,maxWidth:n=window.innerWidth*.5})=>{const[r,l]=j.useState(!1),[u,a]=j.useState(!1),x=j.useCallback(d=>{d.preventDefault(),l(!0)},[]),m=j.useCallback(d=>{if(!r)return;const c=window.innerWidth-d.clientX,o=Math.max(i,Math.min(n,c));t(o)},[r,i,n,t]),p=j.useCallback(()=>{l(!1)},[]);return j.useEffect(()=>{if(r)return document.addEventListener("mousemove",m),document.addEventListener("mouseup",p),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",p),document.body.style.cursor="",document.body.style.userSelect=""}},[r,m,p]),e.jsxRuntimeExports.jsx("div",{onMouseDown:x,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:r?"none":"background-color 0.2s ease",backgroundColor:r?"#1890ff":u?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:r||u?"#fff":"#999",opacity:r||u?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},q=({permission:t,permissions:i=[],checkAll:n=!1,fallback:r=null,children:l})=>{const{hasPermission:u,hasAnyPermission:a,hasAllPermissions:x,isAdmin:m,loading:p}=C.usePermission();return p?null:m?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):t?u(t)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):i.length>0?(n?x(i):a(i))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l})},ue=({fallback:t=null,children:i})=>{const{isAdmin:n,loading:r}=C.usePermission();return r?null:n?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:t})},N=t=>{const[i,n]=j.useState(!1),{permission:r,icon:l,tooltip:u,onClick:a,confirm:x,label:m,...p}=t,d=a?async()=>{n(!0);try{await a()}finally{n(!1)}}:void 0;let c=e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",loading:i,icon:l,onClick:x?void 0:d,...p,children:m&&e.jsxRuntimeExports.jsx("span",{style:{position:"inherit",top:"-2px"},children:m})});if(u&&(c=e.jsxRuntimeExports.jsx(s.Tooltip,{title:u,children:c})),x){const o=async()=>{x.onConfirm?x.onConfirm():d&&await d()};c=e.jsxRuntimeExports.jsx(s.Popconfirm,{title:x.title,description:x.description,onConfirm:o,okText:x.okText,cancelText:x.cancelText,children:c})}return r&&(c=e.jsxRuntimeExports.jsx(q,{permission:r,children:c})),c},ce=({actions:t,maxVisibleItems:i})=>{const n=t.filter(a=>!a.hidden);if(!i||n.length<=i)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n.map(({key:a,...x})=>e.jsxRuntimeExports.jsx(N,{...x},a))});const r=n.slice(0,i-1),u=n.slice(i-1).map(a=>{const{key:x,label:m,icon:p,permission:d,onClick:c,confirm:o,disabled:E,tooltip:R}=a,v={key:x,label:m,icon:p,disabled:E,onClick:async()=>{o?s.Modal.confirm({title:o.title,content:o.description,onOk:o.onConfirm,okText:o.okText,cancelText:o.cancelText}):c&&await c()}};return d?{...v,label:e.jsxRuntimeExports.jsx(q,{permission:d,children:e.jsxRuntimeExports.jsx("span",{children:m??R})})}:v});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[r.map(({key:a,...x})=>e.jsxRuntimeExports.jsx(N,{...x},a)),e.jsxRuntimeExports.jsx(s.Dropdown,{menu:{items:u},trigger:["click"],children:e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(f.MoreOutlined,{})})})]})},xe=Y,W=t=>xe[t],me=({iconName:t})=>{if(!t)return null;const i=W(t);return i?e.jsxRuntimeExports.jsx(j.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(i,{})}):null},de=({onChange:t})=>{const[i,n]=j.useState(""),[r,l]=j.useState("");return e.jsxRuntimeExports.jsxs(s.Space.Compact,{children:[e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:i,onChange:u=>n(u.target.value)}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:u=>l(u.target.value)}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(f.PlusOutlined,{}),onClick:()=>{t(i,r)}})]})},pe=({request:t,tableRef:i,...n},r)=>{const[l,u]=j.useState({current:1,pageSize:10}),[a,x]=j.useState(0),{data:m,loading:p,refresh:d}=F.useRequest(async()=>{const c=await t({current:l.current,page_size:l.pageSize});return x(c.total),c.data},{refreshDeps:[l]});return j.useImperativeHandle(r,()=>({reload:()=>{d()}})),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",loading:p,dataSource:m??[],pagination:{...l,total:a,onChange:(c,o)=>{u({current:c,pageSize:o})}},...n,ref:i})},je=({actionRef:t,...i})=>{const[n,r]=j.useState();return j.useEffect(()=>{r(j.forwardRef(pe))},[]),n?e.jsxRuntimeExports.jsx(n,{...i,ref:t}):null},J=t=>{var l;const{className:i,children:n}=t,r=((l=i==null?void 0:i.match(/language-(\w+)/))==null?void 0:l[1])||"";return typeof n!="string"?null:r==="mermaid"?e.jsxRuntimeExports.jsx(V.Mermaid,{children:n}):e.jsxRuntimeExports.jsx(V.CodeHighlighter,{lang:r,children:n})},he=({content:t,className:i,style:n,paragraphTag:r="div",rootClassName:l,components:u={code:J}})=>e.jsxRuntimeExports.jsx(X.XMarkdown,{content:t,className:i,style:n,components:u,paragraphTag:r,rootClassName:l}),ge=({className:t,onSuccess:i,token:n})=>{const{t:r}=y.useTranslation("authorization"),{t:l}=y.useTranslation("common"),[u]=s.Form.useForm(),{run:a,loading:x}=F.useRequest(async m=>S.api.authorization.changePassword(m,n?{headers:{Authorization:`Bearer ${n}`}}:{}),{manual:!0,onSuccess:()=>{s.message.success(r("user.passwordChanged")),u.resetFields(),i==null||i()},onError:m=>{if(m instanceof A.ApiError){const p=m.code??"normal";s.message.error(r(`user.passwordChangeFailed.${p}`,{error:m.message,defaultValue:"Password change failed: {{error}}"}))}else s.message.error(r("user.passwordChangeFailed.normal",{error:m.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",m)}});return e.jsxRuntimeExports.jsxs(s.Form,{form:u,layout:"vertical",onFinish:a,style:{maxWidth:500,margin:"0 auto"},className:T("profile-password",t),children:[e.jsxRuntimeExports.jsx(s.Form.Item,{name:"old_password",label:r("user.oldPassword"),rules:[{required:!0,message:r("validation.oldPasswordRequired")}],className:T("profile-password-item","profile-password-item-old-password"),children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"new_password",label:r("user.newPassword"),rules:[{required:!0,message:r("validation.newPasswordRequired")},{min:8,message:r("validation.passwordMinLength")}],className:T("profile-password-item","profile-password-item-new-password"),children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"confirm_password",label:r("user.confirmPassword"),className:T("profile-password-item","profile-password-item-confirm-password"),rules:[{required:!0,message:r("validation.confirmPasswordRequired")},({getFieldValue:m})=>({validator(p,d){return!d||m("new_password")===d?Promise.resolve():Promise.reject(new Error(r("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{className:T("profile-password-item","profile-password-item-submit"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:x,children:l("save")})})]})},Re=({user:t,onSuccess:i})=>{const{t:n}=y.useTranslation("authorization"),{t:r}=y.useTranslation("common"),[l]=s.Form.useForm(),[u,a]=j.useState(!1);j.useEffect(()=>{t&&l.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,l]);const x=async m=>{try{a(!0),await S.api.authorization.updateCurrentUser(m),s.message.success(r("updateSuccess")),i()}catch(p){s.message.error(r("updateFailed")),console.error("Failed to update user information:",p)}finally{a(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[n("user.roles"),": ",t.roles.map(m=>m.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(s.Form,{form:l,layout:"vertical",onFinish:x,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(K,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"username",label:n("user.username"),children:e.jsxRuntimeExports.jsx(s.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"phone",label:n("user.phone"),children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:u,children:r("save")})})]})]})},Ee=({user:t,onSuccess:i})=>{const{t:n}=y.useTranslation("authorization"),{t:r}=y.useTranslation("common"),[l,u]=j.useState(0),[a,x]=j.useState(!1),[m,p]=j.useState(!0),[d,c]=j.useState(""),[o,E]=j.useState("totp"),{run:R,data:g={secret:"",qr_code:"",token:void 0}}=F.useRequest(()=>S.api.authorization.enableMfa(o),{manual:!0,onSuccess:()=>{u(1)},onBefore:()=>{x(!0)},onFinally:()=>{x(!1)}}),v=async()=>{if(!d){s.message.warning(n("mfa.enterVerificationCode"));return}const w={code:d,mfa_type:o};"token"in g&&(w.token=g.token);try{x(!0),await S.api.authorization.verifyAndActivateMfa(w),s.message.success(n("mfa.enableSuccess")),u(2),i()}catch(I){s.message.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",I)}finally{x(!1)}},h=async()=>{try{x(!0),await S.api.authorization.disableMfa(),s.message.success(n("mfa.disableSuccess")),i()}catch(w){s.message.error(r("operationFailed")),console.error("Failed to disable MFA:",w)}finally{x(!1)}},b=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,onClick:()=>{s.Modal.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:h,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const w=()=>{var I;switch(l){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:n("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:n(o==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:R,loading:a,children:n("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:o==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:o==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(s.QRCode,{value:g.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:o==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:o==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:m?"*".repeat(((I=g.secret)==null?void 0:I.length)??0):g.secret}),e.jsxRuntimeExports.jsx(s.Button,{type:"link",onClick:()=>p(!m),icon:m?e.jsxRuntimeExports.jsx(f.EyeOutlined,{}):e.jsxRuntimeExports.jsx(f.EyeInvisibleOutlined,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:d,onChange:L=>c(L.target.value)})}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>u(0),children:r("previous")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:v,loading:a,children:r("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:()=>u(0),children:r("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:l===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(s.Segmented,{defaultValue:"totp",onChange:I=>{E(I),u(0)},value:o,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(f.ClockCircleFilled,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(f.MailOutlined,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(s.Divider,{})]}),e.jsxRuntimeExports.jsx(s.Steps,{current:l,items:[{title:n(o==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(o==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(o==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(o==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(o==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(o==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),w()]})};return e.jsxRuntimeExports.jsx(s.Card,{title:n("mfa.title"),children:b()})},{Text:P}=s.Typography,fe=()=>{const{t}=y.useTranslation("authorization"),{t:i}=y.useTranslation("common"),[n,r]=j.useState(null),[l,u]=j.useState(!1),{data:a=[],loading:x,run:m}=F.useRequest(()=>S.api.authorization.getUserSessions({}),{onError:o=>{s.message.error(t("session.getSessionsFailed",{error:o,defaultValue:"Failed to get session list: {{error}}"}))}}),{run:p}=F.useRequest(o=>S.api.authorization.terminateSession({id:o}),{onSuccess:()=>{s.message.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"})),m()},onError:o=>{s.message.error(t("session.terminateFailed",{error:o,defaultValue:"Failed to terminate session: {{error}}"}))},onFinally:()=>{r(null)},onBefore:([o])=>{r(o)},manual:!0}),{run:d}=F.useRequest(()=>S.api.authorization.terminateOtherSessions(),{onSuccess:()=>{s.message.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"})),m()},onError:o=>{s.message.error(t("session.terminateAllFailed",{error:o,defaultValue:"Failed to terminate all other sessions: {{error}}"}))},onFinally:()=>{u(!1)},onBefore:()=>{u(!0)},manual:!0}),c=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(o,E)=>e.jsxRuntimeExports.jsxs(s.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(f.LaptopOutlined,{}),e.jsxRuntimeExports.jsx(P,{strong:!0,children:o})]}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(f.EnvironmentOutlined,{}),e.jsxRuntimeExports.jsx(P,{type:"secondary",children:E.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:o=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(f.GlobalOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:o})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:o=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(f.ClockCircleOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(o).toLocaleString()})]})},{title:t("session.status"),key:"status",render:o=>o.is_current?e.jsxRuntimeExports.jsx(s.Tag,{color:"green",children:t("session.current")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"blue",children:t("session.active")})},{title:i("actions"),key:"action",render:o=>o.is_current?e.jsxRuntimeExports.jsx(P,{type:"secondary",children:t("session.currentSession")}):e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminate"),onConfirm:()=>p(o.id),okText:i("confirm"),cancelText:i("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"link",danger:!0,loading:n===o.id,children:t("session.terminate")})})}];return e.jsxRuntimeExports.jsx(s.Card,{title:t("session.title"),loading:x,extra:e.jsxRuntimeExports.jsxs(s.Space,{children:[a.length>1&&e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminateAll"),onConfirm:d,okText:i("confirm"),cancelText:i("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,loading:l,children:t("session.terminateOthers")})}),e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>m(),loading:x,children:i("refresh")})]}),children:!x&&a.length===0?e.jsxRuntimeExports.jsx(s.Empty,{description:t("session.noSessions")}):e.jsxRuntimeExports.jsx(s.Table,{columns:c,dataSource:a,rowKey:"id",loading:x,pagination:!1})})},{RangePicker:ye}=s.DatePicker,{Option:k}=s.Select,ve=t=>t||"N/A",Se=(t,i)=>t==="success"?e.jsxRuntimeExports.jsx(s.Tag,{color:"success",children:i("statuses.success")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"error",children:i("statuses.failed")}),we=({userId:t,request:i=r=>t?S.api.authorization.getUserLogs({id:t,...r}):S.api.authorization.getCurrentUserLogs(r),columnsFilter:n=r=>r})=>{const{t:r}=y.useTranslation("authorization"),{t:l}=y.useTranslation("common"),[u,a]=j.useState({current:1,pageSize:10,total:0}),[x,m]=j.useState({}),[p]=s.Form.useForm(),{loading:d,run:c,data:{data:o}={}}=F.useRequest(async(h=x,b=1,w=10)=>i({...h,current:b??1,page_size:w??10}),{onError(h){s.message.error(r("auditLog.fetchFailed",{error:h}))},onSuccess({total:h}){a({...u,total:h})}});j.useEffect(()=>{c(x,1,u.pageSize)},[]);const E=h=>{a({...u,current:h.current,pageSize:h.pageSize}),c({},h.current,h.pageSize)},R=h=>{var b,w,I,L;c({...h,start_time:(w=(b=h.dateRange)==null?void 0:b[0])==null?void 0:w.toISOString(),end_time:(L=(I=h.dateRange)==null?void 0:I[1])==null?void 0:L.toISOString()},1,u.pageSize)},g=()=>{p.resetFields(),m({}),a({...u,current:1}),c({},1,u.pageSize)},v=[{title:r("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:h=>_.formatDate(h)},{title:r("auditLog.action"),dataIndex:"action",key:"action",render:(h,b)=>h?r(`action.${h.replace(":",".")}`,{defaultValue:b.action_name}):b.action_name??b.action},{title:r("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:r("auditLog.ip"),dataIndex:"ip",key:"ip",render:h=>ve(h)},{title:r("auditLog.status"),dataIndex:"status",key:"status",render:h=>Se(h,r)},{title:r("auditLog.details"),dataIndex:"details",key:"details",render:h=>e.jsxRuntimeExports.jsx(s.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(f.EyeOutlined,{}),onClick:()=>{s.Modal.info({title:r("auditLog.details"),content:JSON.stringify(h)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(s.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(s.Form,{form:p,layout:"horizontal",onFinish:R,initialValues:x,children:[e.jsxRuntimeExports.jsxs(s.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"search",label:r("auditLog.search"),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:r("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"action",label:r("auditLog.action"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:r("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(k,{value:"login",children:r("actions.login")}),e.jsxRuntimeExports.jsx(k,{value:"logout",children:r("actions.logout")}),e.jsxRuntimeExports.jsx(k,{value:"password_reset",children:r("actions.passwordReset")}),e.jsxRuntimeExports.jsx(k,{value:"mfa_change",children:r("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"status",label:r("auditLog.status"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:r("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(k,{value:"success",children:r("statuses.success")}),e.jsxRuntimeExports.jsx(k,{value:"failed",children:r("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"dateRange",label:r("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(ye,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(s.Row,{children:e.jsxRuntimeExports.jsx(s.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:g,children:l("reset")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(f.SearchOutlined,{}),children:l("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(s.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(f.ReloadOutlined,{}),onClick:g,style:{marginRight:8},children:l("refresh")})}),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",columns:n(v),dataSource:o,pagination:{...u,showSizeChanger:!0,showTotal:h=>l("totalItems",{total:h})},loading:d,onChange:E,scroll:{x:"max-content"}})]})]})},{TextArea:U}=s.Input,{Option:z}=s.Select,be=({field:t,selectedType:i,dependentValues:n,formValues:r={}})=>{const{t:l}=y.useTranslation("system"),{t:u}=y.useTranslation("common"),a=j.useMemo(()=>_.checkVisibilityCondition(t.visible_when,r),[t.visible_when,r]),{options:x,loading:m}=C.useDynamicDataSource(t.data_source,t.options,n),p=j.useMemo(()=>t.data_source&&t.data_source.type!=="static"?x:t.options||[],[t.data_source,t.options,x]),d=p&&p.length>0;if(!a)return null;const c=[{required:t.required,message:l("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],o=()=>l(`settings.toolsets.${i}.${t.name}`,{defaultValue:t.display_name||t.name}),E=()=>l(`settings.toolsets.${i}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${u("enter",{defaultValue:"Enter"})} ${t.name}`}),R=()=>{if(t.description)return l(`settings.toolsets.${i}.${t.name}Tooltip`,{defaultValue:t.description})};if(!a)return null;if(t.type==="select"||t.data_source)return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Select,{loading:m,allowClear:!0,placeholder:E(),showSearch:!0,filterOption:(g,v)=>{var h;return(h=v==null?void 0:v.children)==null?void 0:h.toLowerCase().includes(g.toLowerCase())},children:p.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name);switch(t.type){case"text":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,children:e.jsxRuntimeExports.jsx(U,{placeholder:E(),rows:4})},t.name);case"string":return d?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:E(),children:p.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:E()})},t.name);case"password":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Input.Password,{placeholder:E(),autoComplete:"new-password"})},t.name);case"number":return d?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:E(),children:p.map(g=>e.jsxRuntimeExports.jsx(z,{value:g.value,children:g.label},g.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.InputNumber,{style:{width:"100%"},placeholder:E()})},t.name);case"boolean":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),valuePropName:"checked",tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Switch,{})},t.name);case"array":return d?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Checkbox.Group,{style:{width:"100%"},children:e.jsxRuntimeExports.jsx(s.Space,{direction:"vertical",children:p.map(g=>e.jsxRuntimeExports.jsx(s.Checkbox,{value:g.value,children:g.label},g.value))})})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:c,tooltip:R(),children:e.jsxRuntimeExports.jsx(s.Select,{mode:"tags",style:{width:"100%"},placeholder:E(),tokenSeparators:[","]})},t.name);case"object":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:o(),rules:[...c,{validator:(g,v)=>{if(!v)return Promise.resolve();try{return JSON.parse(v),Promise.resolve()}catch{return Promise.reject(new Error(l("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:R(),children:e.jsxRuntimeExports.jsx(U,{rows:4,placeholder:E()})},t.name);default:return null}};exports.Actions=ce;exports.AdminGuard=ue;exports.AllLangUIConfig=$;exports.Avatar=G;exports.AvatarUpload=K;exports.Code=J;exports.DynamicConfigField=be;exports.DynamicIcon=me;exports.HeaderDropdown=B;exports.LabelCreater=de;exports.LanguageSwitch=re;exports.Loading=M;exports.MarkdownViewer=he;exports.OrganizationSwitcher=ae;exports.PermissionGuard=q;exports.PrivateRoute=ee;exports.ProfileBasic=Re;exports.ProfileMFA=Ee;exports.ProfilePassword=ge;exports.ProfileSessions=fe;exports.ResizeDivider=le;exports.Table=je;exports.UserAuditLogs=we;exports.getIconByName=W;
