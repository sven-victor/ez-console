"use strict";const e=require("./vendor.js"),B=require("react-router-dom"),w=require("./contexts.js"),M=require("./base.js"),s=require("antd"),y=require("react-i18next"),L=require("antd-style"),E=require("@ant-design/icons"),V=require("classnames"),d=require("react"),v=require("./index.js"),k=require("ahooks"),T=require("./client.js"),J=require("antd-img-crop"),Q=require("lodash");function X(t){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:()=>t[n]})}}return r.default=t,Object.freeze(r)}const Z=X(E),N=()=>e.jsxRuntimeExports.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100%"},children:e.jsxRuntimeExports.jsx(s.Spin,{size:"large"})}),Y=({element:t,requiredPermission:r,requiredPermissions:n})=>{const{t:i}=y.useTranslation(),{user:l,loading:o,error:m}=w.useAuth(),{hasPermission:a,hasAllPermissions:j}=w.usePermission();return o?e.jsxRuntimeExports.jsx(N,{}):m?e.jsxRuntimeExports.jsx(s.Result,{status:"500",title:"500",subTitle:i("login.fetchCurrentUserError",{defaultValue:"Failed to fetch current user: {{error}}",error:(m==null?void 0:m.message)||m})}):l?r&&!a(r)?e.jsxRuntimeExports.jsx(B.Navigate,{to:"/forbidden",replace:!0}):n&&!j(n)?e.jsxRuntimeExports.jsx(B.Navigate,{to:"/forbidden",replace:!0}):t:(window.location.href=M.getURL("/login?redirect="+encodeURIComponent(window.location.href)),null)},ee=L.createStyles(({token:t,css:r})=>({container:r`
      ${r`
        @media screen and (max-width: ${t.screenXS}px) {
          width: 100% !important;
          > * {
            border-radius: 0 !important;
          }
        }
      `}
    > *{
      background-color: ${t.colorBgElevated};
      border-radius: 4px;
      box-shadow: ${t.boxShadowTertiary};
    }
    `,iconStyle:{cursor:"pointer",padding:"12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:18,verticalAlign:"middle","&:hover":{color:t.colorPrimaryTextHover}}})),_=({overlayClassName:t,overlay:r,hidden:n,children:i,...l})=>{if(n)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{});const{styles:o}=ee();return e.jsxRuntimeExports.jsx(s.Dropdown,{dropdownRender:r,overlayClassName:V(o.container,t),...l,children:e.jsxRuntimeExports.jsx("span",{className:o.iconStyle,children:i})})},te=()=>e.jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",focusable:"false",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",children:[e.jsxRuntimeExports.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),e.jsxRuntimeExports.jsx("path",{d:"M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z ",className:"css-c4d79v"})]}),se=L.createStyles(()=>({menuItemStyle:{minWidth:"160px"},menuItemIconStyle:{marginRight:"8px"}})),$=[{lang:"en-US",label:"English",icon:"ðŸ‡ºðŸ‡¸"},{lang:"sv-SE",label:"Svenska",icon:"ðŸ‡¸ðŸ‡ª"},{lang:"ar-AE",label:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",icon:"ðŸ‡¦ðŸ‡ª"},{lang:"de-DE",label:"Deutsch",icon:"ðŸ‡©ðŸ‡ª"},{lang:"es-ES",label:"EspaÃ±ol",icon:"ðŸ‡ªðŸ‡¸"},{lang:"fr-FR",label:"FranÃ§ais",icon:"ðŸ‡«ðŸ‡·"},{lang:"zh-CN",label:"ä¸­æ–‡",icon:"ðŸ‡¨ðŸ‡³"}],ne=({transformLangConfig:t=r=>r})=>{const{i18n:r}=y.useTranslation(),{styles:n}=se(),i=o=>{r.changeLanguage(o)},l={selectedKeys:[r.language],onClick:o=>{i(o.key)},items:t($).map(o=>({key:o.lang,className:n.menuItemStyle,label:e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("span",{role:"img","aria-label":(o==null?void 0:o.label)||"en-US",className:n.menuItemIconStyle,children:(o==null?void 0:o.icon)||"ðŸŒ"}),(o==null?void 0:o.label)||"en-US"]})}))};return e.jsxRuntimeExports.jsx(_,{menu:l,children:e.jsxRuntimeExports.jsx(te,{})})},re=L.createStyles(({css:t})=>({avatarItem:t`
    :hover {
      background: rgba(0, 0, 0, 0.12);
    }
    padding: 5px;
  `})),U=t=>Q.isString(t)&&t.match(/^[-_a-zA-Z0-9]+$/)?T.baseURL.endsWith("/")?T.baseURL+`files/${t}`:T.baseURL+`/files/${t}`:t,H=({src:t,fallback:r,...n})=>e.jsxRuntimeExports.jsx(s.Avatar,{src:U(t),icon:r,...n}),ie=({onChange:t,shape:r="square"})=>{const[n,i]=d.useState([]),{styles:l}=re(),[o,m]=d.useState(!1),[a,j]=d.useState(!0),[p,R]=d.useState(0),{run:u,loading:c}=k.useRequest(()=>v.api.base.listFiles({current:p+1,page_size:40,file_type:"avatar",access:"public",search:""}),{manual:!0,onSuccess:({data:x})=>{i([...n,...x]),j(x.length===40),R(p+1)}}),f=()=>{j(!0),R(0),i([])};return e.jsxRuntimeExports.jsx(s.Popover,{style:{zIndex:1e3},onOpenChange:x=>{m(x),x?u():f()},open:o,content:e.jsxRuntimeExports.jsx("div",{style:{width:360,height:200},children:e.jsxRuntimeExports.jsx("div",{id:"iconsScrollableDiv",style:{height:"100%",overflow:"auto"},children:e.jsxRuntimeExports.jsx(e.InfiniteScroll,{dataLength:n.length,next:()=>{u()},hasMore:a,loader:e.jsxRuntimeExports.jsx(s.Skeleton,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:e.jsxRuntimeExports.jsx(s.Divider,{plain:!0,children:"End"}),scrollableTarget:"iconsScrollableDiv",children:e.jsxRuntimeExports.jsx(s.List,{grid:{gutter:16,column:8},dataSource:n,style:{margin:"0 8px"},loading:c,renderItem:({id:x})=>e.jsxRuntimeExports.jsx("div",{className:l.avatarItem,onClick:h=>{h.stopPropagation(),t==null||t(x),m(!1),f()},children:e.jsxRuntimeExports.jsx(H,{shape:r,src:x})})})})})}),placement:"bottom",trigger:"hover",children:e.jsxRuntimeExports.jsx(E.UploadOutlined,{shape:r,style:{width:112,height:112,placeContent:"center"}})})},W=({value:t,onChange:r,shape:n,...i})=>{const[l,o]=d.useState(void 0),[m,a]=d.useState(!1),[j,p]=d.useState(void 0),R=async u=>{a(!0),p(u.url??u.preview)};return d.useEffect(()=>{o(t?{uid:t,name:t,url:U(t)}:void 0)},[t]),e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(J,{beforeCrop:async u=>{if(u.type==="image/svg+xml"){const c=await v.api.base.uploadFile({type:"avatar"},u);return c.length>0&&(r==null||r(c[0].id)),!1}return!0},children:e.jsxRuntimeExports.jsx(s.Upload,{customRequest:async u=>{var f,x;const c=await v.api.base.uploadFile({type:"avatar",access:"public"},u.file);c.length>0?((f=u.onSuccess)==null||f.call(u,c[0].id),r==null||r(c[0].id)):(x=u.onError)==null||x.call(u,new Error("Upload file failed"))},listType:"picture-card",onPreview:R,maxCount:1,onChange:({file:u})=>{switch(u.status){case"removed":r==null||r(void 0);break;case"done":break;default:o(u);break}},fileList:l?[l]:[],...i,children:l?void 0:e.jsxRuntimeExports.jsx(ie,{shape:n,onChange:r})})}),e.jsxRuntimeExports.jsx(s.Modal,{open:m,footer:null,onCancel:()=>a(!1),children:e.jsxRuntimeExports.jsx("img",{style:{width:"100%"},src:j})})]})},oe=()=>{const{t}=y.useTranslation("common"),{user:r}=w.useAuth(),{currentOrgId:n,setCurrentOrgId:i}=w.useSite(),l=(r==null?void 0:r.organizations)||[],o=p=>{i(p),window.location.reload()};if(l.length===0)return null;const m=l.find(p=>p.id===n),a=m?m.name:t("organization.global",{defaultValue:"Global"}),j=[...l.map(p=>({key:p.id,label:e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxRuntimeExports.jsx("span",{children:p.name}),n===p.id&&e.jsxRuntimeExports.jsx(E.CheckOutlined,{})]}),onClick:()=>o(p.id)}))];return e.jsxRuntimeExports.jsxs(_,{menu:{items:j,selectedKeys:n?[n]:[""]},children:[e.jsxRuntimeExports.jsx(E.TeamOutlined,{style:{marginRight:4}}),e.jsxRuntimeExports.jsx("span",{style:{height:"1em",lineHeight:"1em",marginLeft:"5px"},children:a})]})},ae=({onResize:t,minWidth:r=300,maxWidth:n=window.innerWidth*.5})=>{const[i,l]=d.useState(!1),[o,m]=d.useState(!1),a=d.useCallback(R=>{R.preventDefault(),l(!0)},[]),j=d.useCallback(R=>{if(!i)return;const u=window.innerWidth-R.clientX,c=Math.max(r,Math.min(n,u));t(c)},[i,r,n,t]),p=d.useCallback(()=>{l(!1)},[]);return d.useEffect(()=>{if(i)return document.addEventListener("mousemove",j),document.addEventListener("mouseup",p),document.body.style.cursor="col-resize",document.body.style.userSelect="none",()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",p),document.body.style.cursor="",document.body.style.userSelect=""}},[i,j,p]),e.jsxRuntimeExports.jsx("div",{onMouseDown:a,onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),style:{width:"8px",height:"100vh",cursor:"col-resize",position:"relative",flexShrink:0,transition:i?"none":"background-color 0.2s ease",backgroundColor:i?"#1890ff":o?"#bfbfbf":"#e8e8e8",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxRuntimeExports.jsx("div",{style:{width:"3px",height:"40px",borderRadius:"2px",backgroundColor:i||o?"#fff":"#999",opacity:i||o?1:.5,transition:"opacity 0.2s ease",pointerEvents:"none"}})})},G=d.lazy(()=>Promise.resolve().then(()=>require("./ai-chat.js"))),le=L.createStyles(({token:t,css:r})=>({siderLayout:r`
      position: relative;
      height: 100vh;
    `,floatSiderLayout:r`
      position: fixed;
      right: 16px;
      top: 16px;
      height: calc(100vh - 32px);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
      z-index: 1000;
      overflow: hidden;
      backdrop-filter: blur(8px);
      border: 1px solid ${t.colorBorderSecondary};
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      
      &:hover {
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15), 0 6px 12px rgba(0, 0, 0, 0.1);
      }
    `})),ue=()=>{const{visible:t,setVisible:r,setLoaded:n}=w.useAI();return d.useEffect(()=>{n(!0)},[n]),e.jsxRuntimeExports.jsx(s.Modal,{width:1200,open:t,closable:!1,onCancel:()=>r(!1),footer:null,children:v.withSuspense(G)})},ce=()=>{const{styles:t}=le(),{layout:r,visible:n}=w.useAI(),[i,l]=d.useState(()=>{const a=localStorage.getItem("ai-sidebar-width");return a?parseInt(a,10):400}),{setLoaded:o}=w.useAI();d.useEffect(()=>{o(!0)},[o]),d.useEffect(()=>{localStorage.setItem("ai-sidebar-width",i.toString())},[i]);const m=a=>{l(a)};return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsxs("div",{style:{width:`${i}px`,display:n?"flex":"none",overflow:"hidden",flexShrink:0},className:V("ai-sidebar-layout",r==="float-sidebar"?t.floatSiderLayout:t.siderLayout),children:[e.jsxRuntimeExports.jsx(ae,{onResize:m,minWidth:300,maxWidth:window.innerWidth*.5}),e.jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",backgroundColor:"#ffffff",overflow:"hidden",borderRadius:r==="float-sidebar"?"12px":"0"},children:e.jsxRuntimeExports.jsx("div",{children:v.withSuspense(G)})})]})})},xe=()=>{const{setVisible:t,visible:r}=w.useAI(),{t:n}=y.useTranslation("ai");return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(s.Tooltip,{title:n("chat.openAssistant",{defaultValue:"Open AI Assistant"}),placement:"left",style:{display:r?"none":"block"},children:e.jsxRuntimeExports.jsx(s.FloatButton,{icon:e.jsxRuntimeExports.jsx(E.RobotOutlined,{}),type:"primary",onClick:()=>t(!0),style:{right:24,bottom:24,display:r?"none":"block"}})})})},D=({permission:t,permissions:r=[],checkAll:n=!1,fallback:i=null,children:l})=>{const{hasPermission:o,hasAnyPermission:m,hasAllPermissions:a,isAdmin:j,loading:p}=w.usePermission();return p?null:j?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):t?o(t)?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):r.length>0?(n?a(r):m(r))?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:i}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:l})},me=({fallback:t=null,children:r})=>{const{isAdmin:n,loading:i}=w.usePermission();return i?null:n?e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:r}):e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:t})},q=t=>{const[r,n]=d.useState(!1),{permission:i,icon:l,tooltip:o,onClick:m,confirm:a,label:j,...p}=t,R=m?async()=>{n(!0);try{await m()}finally{n(!1)}}:void 0;let u=e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",loading:r,icon:l,onClick:a?void 0:R,...p,children:j&&e.jsxRuntimeExports.jsx("span",{style:{position:"inherit",top:"-2px"},children:j})});if(o&&(u=e.jsxRuntimeExports.jsx(s.Tooltip,{title:o,children:u})),a){const c=async()=>{a.onConfirm?a.onConfirm():R&&await R()};u=e.jsxRuntimeExports.jsx(s.Popconfirm,{title:a.title,description:a.description,onConfirm:c,okText:a.okText,cancelText:a.cancelText,children:u})}return i&&(u=e.jsxRuntimeExports.jsx(D,{permission:i,children:u})),u},de=({actions:t,maxVisibleItems:r})=>{const n=t.filter(m=>!m.hidden);if(!r||n.length<=r)return e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:n.map(({key:m,...a})=>e.jsxRuntimeExports.jsx(q,{...a},m))});const i=n.slice(0,r-1),o=n.slice(r-1).map(m=>{const{key:a,label:j,icon:p,permission:R,onClick:u,confirm:c,disabled:f,tooltip:x}=m,S={key:a,label:j,icon:p,disabled:f,onClick:async()=>{c?s.Modal.confirm({title:c.title,content:c.description,onOk:c.onConfirm,okText:c.okText,cancelText:c.cancelText}):u&&await u()}};return R?{...S,label:e.jsxRuntimeExports.jsx(D,{permission:R,children:e.jsxRuntimeExports.jsx("span",{children:j??x})})}:S});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[i.map(({key:m,...a})=>e.jsxRuntimeExports.jsx(q,{...a},m)),e.jsxRuntimeExports.jsx(s.Dropdown,{menu:{items:o},trigger:["click"],children:e.jsxRuntimeExports.jsx(s.Button,{type:"text",size:"small",icon:e.jsxRuntimeExports.jsx(E.MoreOutlined,{})})})]})},pe=Z,K=t=>pe[t],je=({iconName:t})=>{if(!t)return null;const r=K(t);return r?e.jsxRuntimeExports.jsx(d.Suspense,{fallback:null,children:e.jsxRuntimeExports.jsx(r,{})}):null},he=({onChange:t})=>{const[r,n]=d.useState(""),[i,l]=d.useState("");return e.jsxRuntimeExports.jsxs(s.Space.Compact,{children:[e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:r,onChange:o=>n(o.target.value)}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"40px"},readOnly:!0,value:"=",tabIndex:-1}),e.jsxRuntimeExports.jsx(s.Input,{style:{width:"calc(100% - 80px)"},value:i,onChange:o=>l(o.target.value)}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(E.PlusOutlined,{}),onClick:()=>{t(r,i)}})]})},ge=({request:t,tableRef:r,...n},i)=>{const[l,o]=d.useState({current:1,pageSize:10}),[m,a]=d.useState(0),{data:j,loading:p,refresh:R}=k.useRequest(async()=>{const u=await t({current:l.current,page_size:l.pageSize});return a(u.total),u.data},{refreshDeps:[l]});return d.useImperativeHandle(i,()=>({reload:()=>{R()}})),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",loading:p,dataSource:j??[],pagination:{...l,total:m,onChange:(u,c)=>{o({current:u,pageSize:c})}},...n,ref:r})},Re=({actionRef:t,...r})=>{const[n,i]=d.useState();return d.useEffect(()=>{i(d.forwardRef(ge))},[]),n?e.jsxRuntimeExports.jsx(n,{...r,ref:t}):null},fe=({onSuccess:t,token:r})=>{const{t:n}=y.useTranslation("authorization"),{t:i}=y.useTranslation("common"),[l]=s.Form.useForm(),{run:o,loading:m}=k.useRequest(async a=>v.api.authorization.changePassword(a,r?{headers:{Authorization:`Bearer ${r}`}}:{}),{manual:!0,onSuccess:()=>{s.message.success(n("user.passwordChanged")),l.resetFields(),t==null||t()},onError:a=>{if(a instanceof T.ApiError){const j=a.code??"normal";s.message.error(n(`user.passwordChangeFailed.${j}`,{error:a.message,defaultValue:"Password change failed: {{error}}"}))}else s.message.error(n("user.passwordChangeFailed.normal",{error:a.message,defaultValue:"Password change failed: {{error}}"}));console.error("Failed to change password:",a)}});return e.jsxRuntimeExports.jsxs(s.Form,{form:l,layout:"vertical",onFinish:o,style:{maxWidth:500,margin:"0 auto"},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{name:"old_password",label:n("user.oldPassword"),rules:[{required:!0,message:n("validation.oldPasswordRequired")}],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"new_password",label:n("user.newPassword"),rules:[{required:!0,message:n("validation.newPasswordRequired")},{min:8,message:n("validation.passwordMinLength")}],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"confirm_password",label:n("user.confirmPassword"),rules:[{required:!0,message:n("validation.confirmPasswordRequired")},({getFieldValue:a})=>({validator(j,p){return!p||a("new_password")===p?Promise.resolve():Promise.reject(new Error(n("validation.passwordMismatch")))}})],children:e.jsxRuntimeExports.jsx(s.Input.Password,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:m,children:i("save")})})]})},Ee=({user:t,onSuccess:r})=>{const{t:n}=y.useTranslation("authorization"),{t:i}=y.useTranslation("common"),[l]=s.Form.useForm(),[o,m]=d.useState(!1);d.useEffect(()=>{t&&l.setFieldsValue({username:t.username,email:t.email,full_name:t.full_name,phone:t.phone||"",avatar:t.avatar})},[t,l]);const a=async j=>{try{m(!0),await v.api.authorization.updateCurrentUser(j),s.message.success(i("updateSuccess")),r()}catch(p){s.message.error(i("updateFailed")),console.error("Failed to update user information:",p)}finally{m(!1)}};return e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsxRuntimeExports.jsxs("div",{style:{marginBottom:24,textAlign:"center"},children:[e.jsxRuntimeExports.jsx("h2",{children:(t==null?void 0:t.full_name)||(t==null?void 0:t.username)}),(t==null?void 0:t.roles)&&t.roles.length>0&&e.jsxRuntimeExports.jsxs("div",{children:[n("user.roles"),": ",t.roles.map(j=>j.name).join(", ")]})]}),e.jsxRuntimeExports.jsxs(s.Form,{form:l,layout:"vertical",onFinish:a,style:{width:"100%",maxWidth:500},children:[e.jsxRuntimeExports.jsx(s.Form.Item,{style:{marginBottom:24,textAlign:"center",justifyItems:"center"},name:"avatar",children:e.jsxRuntimeExports.jsx(W,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"username",label:n("user.username"),children:e.jsxRuntimeExports.jsx(s.Input,{disabled:!0})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"email",label:n("user.email"),rules:[{required:!0,message:n("validation.emailRequired")},{type:"email",message:n("validation.emailInvalid")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"full_name",label:n("user.fullName"),rules:[{required:!0,message:n("validation.fullNameRequired")}],children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{name:"phone",label:n("user.phone"),children:e.jsxRuntimeExports.jsx(s.Input,{})}),e.jsxRuntimeExports.jsx(s.Form.Item,{children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",loading:o,children:i("save")})})]})]})},ye=({user:t,onSuccess:r})=>{const{t:n}=y.useTranslation("authorization"),{t:i}=y.useTranslation("common"),[l,o]=d.useState(0),[m,a]=d.useState(!1),[j,p]=d.useState(!0),[R,u]=d.useState(""),[c,f]=d.useState("totp"),{run:x,data:h={secret:"",qr_code:"",token:void 0}}=k.useRequest(()=>v.api.authorization.enableMfa(c),{manual:!0,onSuccess:()=>{o(1)},onBefore:()=>{a(!0)},onFinally:()=>{a(!1)}}),S=async()=>{if(!R){s.message.warning(n("mfa.enterVerificationCode"));return}const b={code:R,mfa_type:c};"token"in h&&(b.token=h.token);try{a(!0),await v.api.authorization.verifyAndActivateMfa(b),s.message.success(n("mfa.enableSuccess")),o(2),r()}catch(C){s.message.error(n("mfa.verificationFailed")),console.error("Failed to verify MFA:",C)}finally{a(!1)}},g=async()=>{try{a(!0),await v.api.authorization.disableMfa(),s.message.success(n("mfa.disableSuccess")),r()}catch(b){s.message.error(i("operationFailed")),console.error("Failed to disable MFA:",b)}finally{a(!1)}},I=()=>{if(!t)return null;if(t.mfa_enabled)return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.enabled"),subTitle:n("mfa.enabledDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,onClick:()=>{s.Modal.confirm({title:n("mfa.confirmDisable"),content:n("mfa.disableWarning"),onOk:g,okButtonProps:{danger:!0}})},children:n("mfa.disable")})});const b=()=>{var C;switch(l){case 0:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx("p",{children:n("mfa.setupInfo")}),e.jsxRuntimeExports.jsx("p",{children:n(c==="totp"?"mfa.totpDescription":"mfa.emailDescription")})]}),type:"info",showIcon:!0,style:{marginBottom:20}}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:x,loading:m,children:n("mfa.startSetup")})]});case 1:return e.jsxRuntimeExports.jsxs("div",{style:{textAlign:"center",marginTop:20},children:[e.jsxRuntimeExports.jsx(s.Alert,{message:n("mfa.scanQrCode"),type:"info",showIcon:!0,style:{marginBottom:20,display:c==="totp"?"block":"none"}}),e.jsxRuntimeExports.jsx("div",{style:{display:c==="totp"?"flex":"none",justifyContent:"center",marginBottom:24},children:e.jsxRuntimeExports.jsx(s.QRCode,{value:h.qr_code??"",size:200})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:c==="email"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("user.email"),": ",e.jsxRuntimeExports.jsx("strong",{children:t==null?void 0:t.email})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16,display:c==="totp"?"block":"none"},children:e.jsxRuntimeExports.jsxs("p",{children:[n("mfa.secretKey"),": ",e.jsxRuntimeExports.jsx("strong",{children:j?"*".repeat(((C=h.secret)==null?void 0:C.length)??0):h.secret}),e.jsxRuntimeExports.jsx(s.Button,{type:"link",onClick:()=>p(!j),icon:j?e.jsxRuntimeExports.jsx(E.EyeOutlined,{}):e.jsxRuntimeExports.jsx(E.EyeInvisibleOutlined,{})})]})}),e.jsxRuntimeExports.jsx("div",{style:{marginBottom:24},children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:n("mfa.enterCode"),style:{width:200},maxLength:6,value:R,onChange:A=>u(A.target.value)})}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:()=>o(0),children:i("previous")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:S,loading:m,children:i("verify")})]})]});case 2:return e.jsxRuntimeExports.jsx(s.Result,{status:"success",title:n("mfa.setupSuccess"),subTitle:n("mfa.setupSuccessDescription"),extra:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",onClick:()=>o(0),children:i("done")})});default:return null}};return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("div",{style:{display:l===2?"none":"unset"},children:[e.jsxRuntimeExports.jsx(s.Segmented,{defaultValue:"totp",onChange:C=>{f(C),o(0)},value:c,options:[{value:"totp",icon:e.jsxRuntimeExports.jsx(E.ClockCircleFilled,{}),label:n("mfa.totp",{defaultValue:"TOTP"})},{value:"email",icon:e.jsxRuntimeExports.jsx(E.MailOutlined,{}),label:n("mfa.email",{defaultValue:"E-Mail"})}]}),e.jsxRuntimeExports.jsx(s.Divider,{})]}),e.jsxRuntimeExports.jsx(s.Steps,{current:l,items:[{title:n(c==="totp"?"mfa.totpStep1":"mfa.emailStep1"),description:n(c==="totp"?"mfa.totpStep1Description":"mfa.emailStep1Description")},{title:n(c==="totp"?"mfa.totpStep2":"mfa.emailStep2"),description:n(c==="totp"?"mfa.totpStep2Description":"mfa.emailStep2Description")},{title:n(c==="totp"?"mfa.totpStep3":"mfa.emailStep3"),description:n(c==="totp"?"mfa.totpStep3Description":"mfa.emailStep3Description")}],style:{marginBottom:30}}),b()]})};return e.jsxRuntimeExports.jsx(s.Card,{title:n("mfa.title"),children:I()})},{Text:P}=s.Typography,ve=()=>{const{t}=y.useTranslation("authorization"),{t:r}=y.useTranslation("common"),[n,i]=d.useState([]),[l,o]=d.useState(!1),[m,a]=d.useState(null),[j,p]=d.useState(!1),R=async()=>{try{o(!0);const x=await v.api.authorization.getUserSessions({});i(x)}catch(x){s.message.error(t("session.getSessionsFailed",{error:x,defaultValue:"Failed to get session list: {{error}}"}))}finally{o(!1)}};d.useEffect(()=>{R()},[]);const u=async x=>{try{a(x),await v.api.authorization.terminateSession({id:x}),i(n.filter(h=>h.id!==x)),s.message.success(t("session.terminateSuccess",{defaultValue:"Session terminated successfully"}))}catch(h){s.message.error(t("session.terminateFailed",{error:h,defaultValue:"Failed to terminate session: {{error}}"}))}finally{a(null)}},c=async()=>{try{p(!0),await v.api.authorization.terminateOtherSessions(),i(n.filter(x=>x.is_current)),s.message.success(t("session.terminateAllSuccess",{defaultValue:"All other sessions terminated successfully"}))}catch(x){s.message.error(t("session.terminateAllFailed",{error:x,defaultValue:"Failed to terminate all other sessions: {{error}}"}))}finally{p(!1)}},f=[{title:t("session.device"),dataIndex:"user_agent",key:"device",render:(x,h)=>e.jsxRuntimeExports.jsxs(s.Space,{direction:"vertical",size:0,children:[e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.LaptopOutlined,{}),e.jsxRuntimeExports.jsx(P,{strong:!0,children:x})]}),e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.EnvironmentOutlined,{}),e.jsxRuntimeExports.jsx(P,{type:"secondary",children:h.location})]})]})},{title:t("session.ipAddress"),dataIndex:"ip_address",key:"ip_address",render:x=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.GlobalOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:x})]})},{title:t("session.lastActive"),dataIndex:"last_active_at",key:"last_active",render:x=>e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(E.ClockCircleOutlined,{}),e.jsxRuntimeExports.jsx("span",{children:new Date(x).toLocaleString()})]})},{title:t("session.status"),key:"status",render:x=>x.is_current?e.jsxRuntimeExports.jsx(s.Tag,{color:"green",children:t("session.current")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"blue",children:t("session.active")})},{title:r("actions"),key:"action",render:x=>x.is_current?e.jsxRuntimeExports.jsx(P,{type:"secondary",children:t("session.currentSession")}):e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminate"),onConfirm:()=>u(x.id),okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{type:"link",danger:!0,loading:m===x.id,children:t("session.terminate")})})}];return e.jsxRuntimeExports.jsx(s.Card,{title:t("session.title"),extra:n.length>1&&e.jsxRuntimeExports.jsx(s.Popconfirm,{title:t("session.confirmTerminateAll"),onConfirm:c,okText:r("confirm"),cancelText:r("cancel"),children:e.jsxRuntimeExports.jsx(s.Button,{danger:!0,loading:j,children:t("session.terminateOthers")})}),children:n.length===0?e.jsxRuntimeExports.jsx(s.Empty,{description:t("session.noSessions")}):e.jsxRuntimeExports.jsx(s.Table,{columns:f,dataSource:n,rowKey:"id",loading:l,pagination:!1})})},{RangePicker:Se}=s.DatePicker,{Option:F}=s.Select,be=t=>t||"N/A",we=(t,r)=>t==="success"?e.jsxRuntimeExports.jsx(s.Tag,{color:"success",children:r("statuses.success")}):e.jsxRuntimeExports.jsx(s.Tag,{color:"error",children:r("statuses.failed")}),Ie=({userId:t,request:r=i=>t?v.api.authorization.getUserLogs({id:t,...i}):v.api.authorization.getCurrentUserLogs(i),columnsFilter:n=i=>i})=>{const{t:i}=y.useTranslation("authorization"),{t:l}=y.useTranslation("common"),[o,m]=d.useState({current:1,pageSize:10,total:0}),[a,j]=d.useState({}),[p]=s.Form.useForm(),{loading:R,run:u,data:{data:c}={}}=k.useRequest(async(g=a,I=1,b=10)=>r({...g,current:I??1,page_size:b??10}),{onError(g){s.message.error(i("auditLog.fetchFailed",{error:g}))},onSuccess({total:g}){m({...o,total:g})}});d.useEffect(()=>{u(a,1,o.pageSize)},[]);const f=g=>{m({...o,current:g.current,pageSize:g.pageSize}),u({},g.current,g.pageSize)},x=g=>{var I,b,C,A;u({...g,start_time:(b=(I=g.dateRange)==null?void 0:I[0])==null?void 0:b.toISOString(),end_time:(A=(C=g.dateRange)==null?void 0:C[1])==null?void 0:A.toISOString()},1,o.pageSize)},h=()=>{p.resetFields(),j({}),m({...o,current:1}),u({},1,o.pageSize)},S=[{title:i("auditLog.timestamp"),dataIndex:"timestamp",key:"timestamp",render:g=>M.formatDate(g)},{title:i("auditLog.action"),dataIndex:"action",key:"action",render:(g,I)=>g?i(`action.${g.replace(":",".")}`,{defaultValue:I.action_name}):I.action_name??I.action},{title:i("auditLog.user_agent"),dataIndex:"user_agent",key:"user_agent"},{title:i("auditLog.ip"),dataIndex:"ip",key:"ip",render:g=>be(g)},{title:i("auditLog.status"),dataIndex:"status",key:"status",render:g=>we(g,i)},{title:i("auditLog.details"),dataIndex:"details",key:"details",render:g=>e.jsxRuntimeExports.jsx(s.Button,{type:"link",icon:e.jsxRuntimeExports.jsx(E.EyeOutlined,{}),onClick:()=>{s.Modal.info({title:i("auditLog.details"),content:JSON.stringify(g)})}})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(s.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(s.Form,{form:p,layout:"horizontal",onFinish:x,initialValues:a,children:[e.jsxRuntimeExports.jsxs(s.Row,{gutter:24,children:[e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"search",label:i("auditLog.search"),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:i("auditLog.searchPlaceholder")})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"action",label:i("auditLog.action"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:i("auditLog.selectAction"),children:[e.jsxRuntimeExports.jsx(F,{value:"login",children:i("actions.login")}),e.jsxRuntimeExports.jsx(F,{value:"logout",children:i("actions.logout")}),e.jsxRuntimeExports.jsx(F,{value:"password_reset",children:i("actions.passwordReset")}),e.jsxRuntimeExports.jsx(F,{value:"mfa_change",children:i("actions.mfaChange")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"status",label:i("auditLog.status"),children:e.jsxRuntimeExports.jsxs(s.Select,{allowClear:!0,placeholder:i("auditLog.selectStatus"),children:[e.jsxRuntimeExports.jsx(F,{value:"success",children:i("statuses.success")}),e.jsxRuntimeExports.jsx(F,{value:"failed",children:i("statuses.failed")})]})})}),e.jsxRuntimeExports.jsx(s.Col,{span:6,children:e.jsxRuntimeExports.jsx(s.Form.Item,{name:"dateRange",label:i("auditLog.dateRange"),children:e.jsxRuntimeExports.jsx(Se,{style:{width:"100%"}})})})]}),e.jsxRuntimeExports.jsx(s.Row,{children:e.jsxRuntimeExports.jsx(s.Col,{span:24,style:{textAlign:"right"},children:e.jsxRuntimeExports.jsxs(s.Space,{children:[e.jsxRuntimeExports.jsx(s.Button,{onClick:h,children:l("reset")}),e.jsxRuntimeExports.jsx(s.Button,{type:"primary",htmlType:"submit",icon:e.jsxRuntimeExports.jsx(E.SearchOutlined,{}),children:l("search")})]})})})]})}),e.jsxRuntimeExports.jsxs(s.Card,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:16},children:e.jsxRuntimeExports.jsx(s.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(E.ReloadOutlined,{}),onClick:h,style:{marginRight:8},children:l("refresh")})}),e.jsxRuntimeExports.jsx(s.Table,{rowKey:"id",columns:n(S),dataSource:c,pagination:{...o,showSizeChanger:!0,showTotal:g=>l("totalItems",{total:g})},loading:R,onChange:f,scroll:{x:"max-content"}})]})]})},{TextArea:O}=s.Input,{Option:z}=s.Select,Ce=({field:t,selectedType:r,dependentValues:n,formValues:i={}})=>{const{t:l}=y.useTranslation("system"),{t:o}=y.useTranslation("common"),m=d.useMemo(()=>M.checkVisibilityCondition(t.visible_when,i),[t.visible_when,i]),{options:a,loading:j}=w.useDynamicDataSource(t.data_source,t.options,n),p=d.useMemo(()=>t.data_source&&t.data_source.type!=="static"?a:t.options||[],[t.data_source,t.options,a]),R=p&&p.length>0;if(!m)return null;const u=[{required:t.required,message:l("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${t.name}`,field:t.name})}],c=()=>l(`settings.toolsets.${r}.${t.name}`,{defaultValue:t.display_name||t.name}),f=()=>l(`settings.toolsets.${r}.${t.name}Placeholder`,{defaultValue:t.placeholder||`${o("enter",{defaultValue:"Enter"})} ${t.name}`}),x=()=>{if(t.description)return l(`settings.toolsets.${r}.${t.name}Tooltip`,{defaultValue:t.description})};if(!m)return null;if(t.type==="select"||t.data_source)return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{loading:j,allowClear:!0,placeholder:f(),showSearch:!0,filterOption:(h,S)=>{var g;return(g=S==null?void 0:S.children)==null?void 0:g.toLowerCase().includes(h.toLowerCase())},children:p.map(h=>e.jsxRuntimeExports.jsx(z,{value:h.value,children:h.label},h.value))})},t.name);switch(t.type){case"text":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,children:e.jsxRuntimeExports.jsx(O,{placeholder:f(),rows:4})},t.name);case"string":return R?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:f(),children:p.map(h=>e.jsxRuntimeExports.jsx(z,{value:h.value,children:h.label},h.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Input,{placeholder:f()})},t.name);case"password":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Input.Password,{placeholder:f(),autoComplete:"new-password"})},t.name);case"number":return R?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{allowClear:!0,placeholder:f(),children:p.map(h=>e.jsxRuntimeExports.jsx(z,{value:h.value,children:h.label},h.value))})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.InputNumber,{style:{width:"100%"},placeholder:f()})},t.name);case"boolean":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),valuePropName:"checked",tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Switch,{})},t.name);case"array":return R?e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Checkbox.Group,{style:{width:"100%"},children:e.jsxRuntimeExports.jsx(s.Space,{direction:"vertical",children:p.map(h=>e.jsxRuntimeExports.jsx(s.Checkbox,{value:h.value,children:h.label},h.value))})})},t.name):e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:u,tooltip:x(),children:e.jsxRuntimeExports.jsx(s.Select,{mode:"tags",style:{width:"100%"},placeholder:f(),tokenSeparators:[","]})},t.name);case"object":return e.jsxRuntimeExports.jsx(s.Form.Item,{name:["config",t.name],label:c(),rules:[...u,{validator:(h,S)=>{if(!S)return Promise.resolve();try{return JSON.parse(S),Promise.resolve()}catch{return Promise.reject(new Error(l("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:x(),children:e.jsxRuntimeExports.jsx(O,{rows:4,placeholder:f()})},t.name);default:return null}};exports.AIChatButton=xe;exports.AIChatModal=ue;exports.AIChatSider=ce;exports.Actions=de;exports.AdminGuard=me;exports.AllLangUIConfig=$;exports.Avatar=H;exports.AvatarUpload=W;exports.DynamicConfigField=Ce;exports.DynamicIcon=je;exports.HeaderDropdown=_;exports.LabelCreater=he;exports.LanguageSwitch=ne;exports.Loading=N;exports.OrganizationSwitcher=oe;exports.PermissionGuard=D;exports.PrivateRoute=Y;exports.ProfileBasic=Ee;exports.ProfileMFA=ye;exports.ProfilePassword=fe;exports.ProfileSessions=ve;exports.Table=Re;exports.UserAuditLogs=Ie;exports.getIconByName=K;
