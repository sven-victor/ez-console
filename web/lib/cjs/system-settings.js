"use strict";const e=require("./vendor.js"),t=require("antd"),D=require("react-i18next"),p=require("react"),S=require("ahooks"),V=require("@ant-design/icons"),k=require("./index.js"),me=require("./base.js"),U=require("./components.js"),ee=require("react-router-dom"),le=require("./system.js"),xe=require("./contexts.js"),ge=require("./authorization.js"),de=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,Re={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},Ee=({initialData:s,onRefresh:n})=>{const{t:l}=D.useTranslation("system"),{t:m}=D.useTranslation("common"),[x]=t.Form.useForm(),[c,E]=p.useState((s==null?void 0:s.provider)||"custom"),[b,j]=p.useState((s==null?void 0:s.provider)==="custom"||(s==null?void 0:s.provider)==="autoDiscover"),[a,u]=p.useState((s==null?void 0:s.enabled)||!1),[f,M]=p.useState((s==null?void 0:s.auto_create_user)||!1),{loading:A,data:C,refresh:R}=S.useRequest(k.api.system.getOauthSettings,{manual:!!s,onSuccess:F=>{x.setFieldsValue(F),E(F.provider),j(F.provider==="custom"||F.provider==="autoDiscover"),u(F.enabled),M(F.auto_create_user)},onError:F=>{t.message.error(l("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",F)}});p.useEffect(()=>{s&&(x.setFieldsValue(s),E(s.provider),j(s.provider==="custom"||s.provider==="autoDiscover"),u(s.enabled),M(s.auto_create_user))},[s,x]);const v=F=>{E(F),j(F==="custom"||F==="autoDiscover");const o=Re[F];o&&x.setFieldsValue({auth_endpoint:o.endpoints.auth_endpoint,token_endpoint:o.endpoints.token_endpoint,userinfo_endpoint:o.endpoints.userinfo_endpoint,scope:o.scope,email_field:o.email_field,username_field:o.username_field,full_name_field:o.full_name_field,avatar_field:o.avatar_field,role_field:o.role_field,icon_url:o.icon_url,display_name:o.display_name})},T=F=>{u(F)},_=F=>{M(F)},{loading:I,run:$}=S.useRequest(k.api.system.updateOauthSettings,{manual:!0,onSuccess:()=>{t.message.success(l("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),n?n():R()},onError:F=>{t.message.error(l("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",F)}}),P=F=>{$(F)},B=()=>{n?n():R()},{loading:H,run:w}=S.useRequest(async({redirect_uri:F,...o})=>{let z;return F?z=new URL(F):z=new URL(window.location.origin),z.pathname=me.getURL("/system/settings/oauth/test-callback"),z.searchParams.set("provider",c),k.api.system.testOauthConnection({redirect_uri:z.toString(),...o})},{manual:!0,onSuccess:({url:F})=>{window.open(F,"_blank")},onError:F=>{t.message.error(l("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:F.message})),console.error("Failed to test OAuth connection",F)}}),N=()=>c==="custom";return e.jsxRuntimeExports.jsx(t.Spin,{spinning:A,children:e.jsxRuntimeExports.jsxs(t.Form,{form:x,layout:"vertical",onFinish:P,initialValues:s||C,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"enabled",label:l("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:l("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:T})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:l("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:l("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:a,message:l("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxRuntimeExports.jsxs(t.Select,{onChange:v,disabled:!a,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"github",children:l("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"google",children:l("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"dingtalk",children:l("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"wechat",children:l("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"autoDiscover",children:l("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"custom",children:l("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"display_name",label:l("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:l("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a,placeholder:c!=="custom"?l(`settings.oauth.provider.options.${c}`,{defaultValue:c}):""})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"icon_url",label:l("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:l("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:de,message:l("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a,placeholder:"https://example.com/icon.png"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_id",label:l("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:l("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:a,message:l("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_secret",label:l("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:l("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:a,message:l("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!a,autoComplete:"new-password",visibilityToggle:!1,placeholder:l("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),N()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auth_endpoint",label:l("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:l("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:a&&c==="custom",message:l("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:de,message:l("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"wellknown_endpoint",hidden:c!=="autoDiscover",label:l("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:l("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:de,message:l("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:a&&c==="autoDiscover",message:l("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),N()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"token_endpoint",label:l("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:l("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:a&&c==="custom",message:l("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:de,message:l("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),N()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"userinfo_endpoint",label:l("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:l("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:a&&c==="custom",message:l("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:de,message:l("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"scope",label:l("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:l("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:a,message:l("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"redirect_uri",label:l("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:l("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[F=>F.getFieldValue("redirect_uri")!==""?{pattern:de,message:l("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a,placeholder:`http://${window.location.host}${me.getURL(`/login?provider=settings.${c}`)}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auto_create_user",label:l("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:l("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:_,disabled:!a})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"default_role",label:l("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:l("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:a&&f,message:l("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!a||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_mapping_mode",label:l("settings.oauth.roleMappingMode.label",{defaultValue:"Role Mapping Mode"}),tooltip:l("settings.oauth.roleMappingMode.tooltip",{defaultValue:"Controls how user roles are synchronized from OAuth2 provider."}),initialValue:"auto",children:e.jsxRuntimeExports.jsxs(t.Select,{disabled:!a,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"disabled",children:l("settings.oauth.roleMappingMode.options.disabled.label",{defaultValue:"Disabled"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"auto",children:l("settings.oauth.roleMappingMode.options.auto.label",{defaultValue:"Auto"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"enforce",children:l("settings.oauth.roleMappingMode.options.enforce.label",{defaultValue:"Enforce"})})]})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:l("settings.oauth.roleMappingMode.infoTitle",{defaultValue:"Role Mapping Mode Information"}),description:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.disabled.label",{defaultValue:"Disabled"}),":"]})," ",l("settings.oauth.roleMappingMode.options.disabled.description",{defaultValue:"Ignores role information from OAuth2 provider. New users get the default role."})]}),e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.auto.label",{defaultValue:"Auto"}),":"]})," ",l("settings.oauth.roleMappingMode.options.auto.description",{defaultValue:"Uses OAuth2 roles for new users or users without roles, but preserves existing role assignments."})]}),e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.enforce.label",{defaultValue:"Enforce"}),":"]})," ",l("settings.oauth.roleMappingMode.options.enforce.description",{defaultValue:"Always overwrites user roles with OAuth2 roles when available."})]})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enabled",label:l("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:l("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!a})}),e.jsxRuntimeExports.jsx(t.Divider,{children:l("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:l("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:b?"":l("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"email_field",label:l("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:l("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"email",disabled:!a||!b})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"username_field",label:l("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:l("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"login",autoComplete:"off",disabled:!a||!b})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"full_name_field",label:l("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:l("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"name",disabled:!a||!b})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"avatar_field",label:l("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:l("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"avatar_url",disabled:!a||!b})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_field",label:l("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:l("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"role",disabled:!a||!b})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:I,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:m("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{loading:H,onClick:async()=>{const F=x.getFieldsValue();w(F)},children:l("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:B,icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:m("refresh",{defaultValue:"Refresh"})})]})})]})})},ye=()=>{const{t:s}=D.useTranslation("system"),{t:n}=D.useTranslation("common"),[l]=t.Form.useForm(),{loading:m,data:x,refresh:c}=S.useRequest(k.api.system.getSecuritySettings,{onSuccess:a=>{l.setFieldsValue(a)},onError:a=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",a)}}),{loading:E,run:b}=S.useRequest(k.api.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),c()},onError:a=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",a)}}),j=a=>{b(a)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:m,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:j,initialValues:x,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enforced",label:s("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:s("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_complexity",label:s("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:s("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"low",children:s("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"medium",children:s("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"high",children:s("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"very_high",children:s("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_min_length",label:s("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:s("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:6,max:32,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_expiry_days",label:s("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:s("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lock",label:s("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:s("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(a,u)=>a.login_failure_lock!==u.login_failure_lock,children:({getFieldValue:a})=>a("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_attempts",label:s("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:s("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(a,u)=>a.login_failure_lock!==u.login_failure_lock,children:({getFieldValue:a})=>a("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lockout_minutes",label:s("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:s("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_check",label:s("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:s("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(a,u)=>a.history_password_check!==u.history_password_check,children:({getFieldValue:a})=>a("history_password_check")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_count",label:s("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:s("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"inactive_account_lock_days",label:s("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:s("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_timeout_minutes",label:s("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:s("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_idle_timeout_minutes",label:s("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:s("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:E,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:n("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>c(),icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:n("refresh",{defaultValue:"Refresh"})})]})})]})})},Ve=({fetchItems:s,importItems:n,columns:l,...m})=>{const{t:x}=D.useTranslation("system"),[c,E]=p.useState([]),[b,j]=p.useState([]),{run:a,loading:u}=S.useRequest(s,{onError:A=>{t.message.error(x("settings.ldap.importError",{error:`${A.message}`}))},onSuccess:A=>{E(A)},manual:!0}),{run:f,loading:M}=S.useRequest(async()=>{for(const A of b.filter(C=>{const R=c.find(v=>v.ldap_dn===C);return!(!R||R.status==="imported")})){const C=await n([A]);E(R=>[...R].map(T=>{for(const _ of C)if(T.ldap_dn===_.ldap_dn)return{..._,status:"imported"};return T}))}},{manual:!0});return p.useEffect(()=>{m.visible&&(E([]),a(),j([]))},[m.visible]),e.jsxRuntimeExports.jsx(t.Modal,{title:x("settings.ldap.importTitle"),...m,onOk:()=>{f()},width:900,confirmLoading:M,loading:u,children:e.jsxRuntimeExports.jsx(t.Table,{rowKey:"ldap_dn",rowSelection:{onChange:A=>{j(A)},getCheckboxProps:A=>({disabled:A.status==="imported"})},columns:l.map(({render:A,...C})=>A?{...C,render:(R,v,T)=>{const _=b.includes(v.ldap_dn)&&M&&v.status!=="imported";return A(R,v,T,_)}}:C),dataSource:c,pagination:!1,scroll:{y:400,x:"max-content"}})})},be=()=>{var v,T,_;const{t:s}=D.useTranslation("system"),[n]=t.Form.useForm(),[l,m]=p.useState(!1),[x,c]=p.useState(null),[E,b]=p.useState(!1),[j,a]=p.useState(!1),[u]=t.Form.useForm(),[f,M]=p.useState(!1);S.useRequest(k.api.system.getLdapSettings,{onSuccess:I=>{n.setFieldsValue(I),M(I.enabled)},onError:I=>{t.message.error(s("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${I.message}`}))}}),p.useEffect(()=>{c(null)},[E]);const A=async I=>{m(!0);try{await k.api.system.updateLdapSettings(I),t.message.success(s("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{t.message.error(s("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{m(!1)}},{run:C,loading:R}=S.useRequest(async I=>{const $=await n.validateFields();return await k.api.system.testLdapConnection({...I,...$})},{onSuccess:I=>{c(I)},onError:I=>{t.message.error(s("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${I.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Form,{form:n,layout:"vertical",onFinish:A,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:I=>M(I)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:f,message:s("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"ldap://ldap.example.com:389"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:f,message:s("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:f,message:s("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:f,message:s("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:f,message:s("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:f,message:s("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:f,message:s("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:f,message:s("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"timeout",label:s("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:s("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",defaultValue:15,disabled:!f})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(U.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:l,children:s("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,style:{marginLeft:8},onClick:()=>b(!0),children:s("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permissions:["authorization:user:create"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,style:{marginLeft:8},onClick:()=>{a(!0)},children:s("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxRuntimeExports.jsxs(t.Modal,{title:s("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:E,onCancel:()=>b(!1),footer:null,children:[e.jsxRuntimeExports.jsxs(t.Form,{form:u,layout:"vertical",onFinish:C,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:s("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:s("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!f})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(U.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,type:"primary",htmlType:"submit",children:s("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsxRuntimeExports.jsx(t.Button,{style:{marginLeft:8},onClick:()=>b(!1),children:s("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:R,children:e.jsxRuntimeExports.jsx(t.Skeleton,{active:R,loading:R,children:x&&(x.user?e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Username",span:3,children:x.user.username}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Email",span:3,children:x.user.email}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"FullName",span:3,children:x.user.full_name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"CreatedAt",span:3,children:x.user.created_at}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"UpdatedAt",span:3,children:x.user.updated_at})]}):e.jsxRuntimeExports.jsx(t.Steps,{direction:"vertical",current:(v=x.message)==null?void 0:v.findIndex(I=>!I.success),status:(T=x.message)!=null&&T.find(I=>!I.success)?"error":"finish",items:(_=x.message)==null?void 0:_.map(I=>({status:I.success?"finish":"error",title:I.message}))}))})})]}),e.jsxRuntimeExports.jsx(Ve,{visible:j,onCancel:()=>a(!1),fetchItems:()=>k.api.system.importLdapUsers({}),importItems:I=>k.api.system.importLdapUsers({user_dn:I}),columns:[{title:s("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:s("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:s("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:s("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(I,$,P,B)=>B?e.jsxRuntimeExports.jsx(t.Spin,{indicator:e.jsxRuntimeExports.jsx(V.LoadingOutlined,{spin:!0})}):I?e.jsxRuntimeExports.jsx(V.CheckCircleTwoTone,{twoToneColor:"#52c41a"}):$.id?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:s("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"green",children:s("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},Se=()=>{const{t:s}=D.useTranslation("system"),{t:n}=D.useTranslation("common"),[l]=t.Form.useForm(),[m,x]=p.useState(null),[c,E]=p.useState(!1),[b]=t.Form.useForm(),[j,a]=p.useState(!1),{loading:u}=S.useRequest(k.api.system.getSmtpSettings,{onSuccess:R=>{l.setFieldsValue(R),a(R.enabled)},onError:R=>{t.message.error(s("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${R.message}`}))}});p.useEffect(()=>{x(null)},[c]);const{run:f,loading:M}=S.useRequest(({port:R,...v})=>k.api.system.updateSmtpSettings({...v,port:Number(R)}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:R=>{t.message.error(s("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${R.message}`}))}}),{run:A,loading:C}=S.useRequest(async R=>{const{port:v,...T}=await l.validateFields();return await k.api.system.testSmtpConnection({...R,...T,port:Number(v)})},{onSuccess:R=>{x(R)},onError:R=>{t.message.error(s("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${R.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Spin,{spinning:u,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:f,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:R=>a(R)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:j,message:s("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!j,placeholder:"smtp.example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:j,message:s("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",disabled:!j,placeholder:"587"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:j,message:s("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!j,placeholder:"user@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!j,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:j,message:s("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxRuntimeExports.jsxs(t.Radio.Group,{disabled:!j,children:[e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"None",children:s("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"SSL/TLS",children:s("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"STARTTLS",children:s("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:j,message:s("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:s("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!j,placeholder:"noreply@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!j,placeholder:s("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:setting:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:M,style:{marginRight:8},children:n("save",{defaultValue:"Save"})})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>E(!0),disabled:!j||C,loading:C,children:s("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:c,onCancel:()=>E(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>E(!1),children:n("cancel",{defaultValue:"Cancel"})},"back"),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",loading:C,onClick:()=>b.submit(),children:s("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxRuntimeExports.jsxs(t.Form,{form:b,layout:"vertical",onFinish:R=>A(R),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:s("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:s("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"test@example.com"})}),m&&e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testResult",{defaultValue:"Test Result"}),children:m.success?e.jsxRuntimeExports.jsx("span",{style:{color:"green"},children:s("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsxRuntimeExports.jsx("span",{style:{color:"red"},children:s("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:m.message})})})]})})]})},Fe=()=>{const{t:s,i18n:n}=D.useTranslation("system"),{t:l}=D.useTranslation("common"),[m]=t.Form.useForm(),{loading:x,data:c,refresh:E}=S.useRequest(k.api.system.getSystemBaseSettings,{onSuccess:u=>{m.setFieldsValue(u)},onError:u=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",u)}}),{loading:b,run:j}=S.useRequest(k.api.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),E()},onError:u=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",u)}}),a=u=>{j(u)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:x,children:e.jsxRuntimeExports.jsxs(t.Form,{form:m,layout:"vertical",onFinish:a,initialValues:c,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.name",{defaultValue:"Name"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{items:[{key:"default",label:l("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",children:e.jsxRuntimeExports.jsx(t.Input,{})})})},...U.AllLangUIConfig.map(u=>({key:u.lang,label:n.language!==u.lang?l(`language.${u.lang}`,{defaultValue:u.label,lang:u.label}):u.label,forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:["name_i18n",u.lang],children:e.jsxRuntimeExports.jsx(t.Input,{})})})}))]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:s("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.enableMultiOrg",{defaultValue:"Enable Multi-Organization"}),name:"enable_multi_org",tooltip:s("settings.base.enableMultiOrgTooltip",{defaultValue:"Enable multi-organization feature. When enabled, organizations can be managed in the Organization Management tab."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:b,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:l("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>E(),icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:l("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:ke}=t.Input,ve=()=>{var K;const{t:s}=D.useTranslation("ai"),{t:n}=D.useTranslation("common"),[l]=t.Form.useForm(),[m,x]=p.useState(!1),[c,E]=p.useState(null),[b,j]=p.useState(""),[a,u]=p.useState(""),[f,M]=p.useState({}),{loading:A,data:C}=S.useRequest(()=>k.api.ai.getAiTypeDefinitions(),{refreshDeps:[],onError:d=>{t.message.error(s("models.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch AI type definitions"})),console.error("Failed to fetch AI type definitions:",d)}}),R=p.useMemo(()=>C==null?void 0:C.find(d=>d.provider===a),[C,a]),{loading:v,data:T,refresh:_}=S.useRequest(()=>k.api.ai.listAiModels({current:1,page_size:100,search:b}),{refreshDeps:[b],onError:d=>{t.message.error(s("models.fetchFailed",{defaultValue:"Failed to fetch AI models"})),console.error("Failed to fetch AI models:",d)}}),{loading:I,run:$}=S.useRequest(({config:d,...r})=>k.api.ai.createAiModel({config:d??{},...r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.createSuccess",{defaultValue:"AI model created successfully"})),x(!1),l.resetFields(),_()},onError:d=>{t.message.error(s("models.createFailed",{defaultValue:"Failed to create AI model"})),console.error("Failed to create AI model:",d)}}),{loading:P,run:B}=S.useRequest(({id:d,data:r})=>k.api.ai.updateAiModel({id:d},r),{manual:!0,onSuccess:()=>{t.message.success(s("models.updateSuccess",{defaultValue:"AI model updated successfully"})),x(!1),l.resetFields(),E(null),_()},onError:d=>{t.message.error(s("models.updateFailed",{defaultValue:"Failed to update AI model"})),console.error("Failed to update AI model:",d)}}),{runAsync:H}=S.useRequest(d=>k.api.ai.deleteAiModel({id:d}),{manual:!0,onSuccess:()=>{t.message.success(s("models.deleteSuccess",{defaultValue:"AI model deleted successfully"})),_()},onError:d=>{t.message.error(s("models.deleteFailed",{defaultValue:"Failed to delete AI model"})),console.error("Failed to delete AI model:",d)}}),{runAsync:w}=S.useRequest(d=>k.api.ai.testAiModel({id:d}),{manual:!0,onSuccess:()=>{t.message.success(s("models.testSuccess",{defaultValue:"AI model connection test successful"}))},onError:d=>{t.message.error(s("models.testFailed",{defaultValue:"AI model connection test failed"})),console.error("Failed to test AI model:",d)}}),{runAsync:N}=S.useRequest(d=>k.api.ai.setDefaultAiModel({id:d}),{manual:!0,onSuccess:()=>{t.message.success(s("models.setDefaultSuccess",{defaultValue:"Default AI model set successfully"})),_()},onError:d=>{t.message.error(s("models.setDefaultFailed",{defaultValue:"Failed to set default AI model"})),console.error("Failed to set default AI model:",d)}}),F=()=>{E(null),u(""),M({}),l.resetFields(),x(!0)},o=d=>{E(d),u(d.provider);const r=d.config||{},L={name:d.name,description:d.description,provider:d.provider,is_default:d.is_default,config:r,status:d.status};console.log(L),M(L),l.setFieldsValue(L),x(!0)},z=d=>{u(d),R!=null&&R.config_fields&&R.config_fields.forEach(r=>{l.setFieldValue(r.name,void 0)})},J=d=>{const r={};R!=null&&R.config_fields&&R.config_fields.forEach(W=>{var Y;const X=(Y=d.config)==null?void 0:Y[W.name];X!=null&&X!==""&&(r[W.name]=X)});const L={name:d.name,description:d.description,provider:d.provider,config:r,is_default:d.is_default,status:d.status};c?B({id:c.id,data:L}):$(L)},Q=d=>{var L;if(!((L=d.data_source)!=null&&L.depends_on))return{};const r={};return d.data_source.depends_on.forEach(W=>{r[W]=f[W]}),r},se=[{title:s("models.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(d,r)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx("span",{children:d}),r.is_default&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.defaultModel",{defaultValue:"Default Model"}),children:e.jsxRuntimeExports.jsx(V.StarFilled,{style:{color:"#faad14"}})})]})},{title:s("models.provider",{defaultValue:"Provider"}),dataIndex:"provider",key:"provider",render:d=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:d.toUpperCase()})},{title:s("models.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:d=>e.jsxRuntimeExports.jsx(t.Tag,{color:d==="enabled"?"green":"red",children:d==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:n("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(d,r)=>e.jsxRuntimeExports.jsx(U.Actions,{actions:[{key:"test",permission:"ai:models:test",icon:e.jsxRuntimeExports.jsx(V.CheckCircleOutlined,{}),tooltip:s("models.test",{defaultValue:"Test Connection"}),onClick:async()=>w(r.id)},{key:"setDefault",permission:"ai:models:setDefault",icon:e.jsxRuntimeExports.jsx(V.StarOutlined,{}),tooltip:s("models.setDefault",{defaultValue:"Set as Default"}),onClick:async()=>N(r.id)},{key:"update",permission:"ai:models:update",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),tooltip:n("edit",{defaultValue:"Edit"}),onClick:async()=>o(r)},{key:"delete",permission:"ai:models:delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),tooltip:n("delete",{defaultValue:"Delete"}),onClick:async()=>H(r.id),danger:!0}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("models.searchPlaceholder",{defaultValue:"Search AI models..."}),style:{width:300},value:b,onChange:d=>j(d.target.value),allowClear:!0})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:_,loading:v,children:n("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"ai:models:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:F,children:s("models.create",{defaultValue:"Create AI Model"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:se,dataSource:(T==null?void 0:T.data)||[],loading:v,rowKey:"id",pagination:{total:(T==null?void 0:T.total)||0,current:(T==null?void 0:T.current)||1,pageSize:(T==null?void 0:T.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(d,r)=>s("common.pagination.total",{defaultValue:`${r[0]}-${r[1]} of ${d} items`,start:r[0],end:r[1],total:d})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:c?s("models.edit",{defaultValue:"Edit AI Model"}):s("models.create",{defaultValue:"Create AI Model"}),open:m,onCancel:()=>{x(!1),l.resetFields(),E(null)},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:J,onValuesChange:(d,r)=>M(r),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("models.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("models.nameRequired",{defaultValue:"Please enter model name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("models.namePlaceholder",{defaultValue:"Enter model name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("models.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(ke,{rows:3,placeholder:s("models.descriptionPlaceholder",{defaultValue:"Enter model description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:s("models.provider",{defaultValue:"Provider"}),rules:[{required:!0,message:s("models.providerRequired",{defaultValue:"Please select provider"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:A,placeholder:s("models.providerPlaceholder",{defaultValue:"Select provider"}),onChange:z,value:a,options:C==null?void 0:C.map(d=>({label:d.name,value:d.provider}))})}),(K=R==null?void 0:R.config_fields)==null?void 0:K.map(d=>e.jsxRuntimeExports.jsx(U.DynamicConfigField,{field:d,selectedType:a,dependentValues:Q(d),formValues:f},d.name)),e.jsxRuntimeExports.jsxs(t.Form.Item,{name:"is_default",valuePropName:"checked",children:[e.jsxRuntimeExports.jsx(t.Switch,{})," ",e.jsxRuntimeExports.jsx("span",{style:{marginLeft:8},children:s("models.setAsDefault",{defaultValue:"Set as default model"})})]}),e.jsxRuntimeExports.jsx(t.Form.Item,{hidden:!0,name:"status",label:s("models.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:I||P,children:c?n("update",{defaultValue:"Update"}):n("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{x(!1),l.resetFields(),E(null),u(""),M({})},children:n("cancel",{defaultValue:"Cancel"})})]})})]})})]})},{TextArea:Ie}=t.Input,Ce=()=>{var y;const{t:s}=D.useTranslation("system"),{t:n}=D.useTranslation("common"),[l]=t.Form.useForm(),[m,x]=p.useState(!1),[c,E]=p.useState(null),[b,j]=p.useState(""),[a,u]=p.useState(!1),[f,M]=p.useState(null),[A,C]=p.useState(""),[R,v]=p.useState(!1),[T,_]=p.useState([]),[I,$]=p.useState({}),[P,B]=p.useState(),{loading:H,data:w,refresh:N}=S.useRequest(()=>k.api.system.listToolSets({current:1,page_size:100,search:b,type:P}),{refreshDeps:[b,P],onError:i=>{t.message.error(s("settings.toolsets.fetchFailed",{defaultValue:"Failed to fetch toolsets"})),console.error("Failed to fetch toolsets:",i)}}),{loading:F,data:o}=S.useRequest(()=>k.api.system.getToolSetTypeDefinitions(),{refreshDeps:[],onError:i=>{t.message.error(s("settings.toolsets.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch toolset type definitions"})),console.error("Failed to fetch toolset type definitions:",i)}}),z=p.useMemo(()=>o==null?void 0:o.find(i=>i.tool_set_type===A),[o,A]),{loading:J,run:Q}=S.useRequest(i=>k.api.system.createToolSet({...i,type:i.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.createSuccess",{defaultValue:"toolset created successfully"})),x(!1),l.resetFields(),N()},onError:i=>{t.message.error(s("settings.toolsets.createFailed",{defaultValue:"Failed to create toolset"})),console.error("Failed to create toolset:",i)}}),{loading:se,run:K}=S.useRequest(({id:i,data:g})=>k.api.system.updateToolSet({id:i},{...g,type:g.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.updateSuccess",{defaultValue:"toolset updated successfully"})),x(!1),l.resetFields(),E(null),N()},onError:i=>{t.message.error(s("settings.toolsets.updateFailed",{defaultValue:"Failed to update toolset"})),console.error("Failed to update toolset:",i)}}),{run:d}=S.useRequest(i=>k.api.system.deleteToolSet({id:i}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.deleteSuccess",{defaultValue:"toolset deleted successfully"})),N()},onError:i=>{t.message.error(s("settings.toolsets.deleteFailed",{defaultValue:"Failed to delete toolset"})),console.error("Failed to delete toolset:",i)}}),{runAsync:r}=S.useRequest(i=>k.api.system.testToolSet({id:i}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.testSuccess",{defaultValue:"toolset connection test successful"}))},onError:i=>{t.message.error(s("settings.toolsets.testFailed",{defaultValue:"toolset connection test failed"})),console.error("Failed to test toolset:",i)}}),{loading:L,runAsync:W}=S.useRequest(i=>k.api.system.getToolSetTools({id:i}),{manual:!0,onSuccess:i=>{_(i||[]),v(!0)},onError:i=>{t.message.error(s("settings.toolsets.fetchToolsFailed",{defaultValue:"Failed to fetch tools"})),console.error("Failed to fetch tools:",i)}}),{runAsync:X}=S.useRequest(({id:i,status:g})=>k.api.system.updateToolSetStatus({id:i},{status:g}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),N()},onError:i=>{t.message.error(s("settings.toolsets.statusUpdateFailed",{defaultValue:"Failed to update status"})),console.error("Failed to update status:",i)}}),Y=()=>{E(null),l.resetFields(),C(""),x(!0)},ie=i=>{E(i),C(i.type);const g={...i};if(g.config){const O=o==null?void 0:o.find(q=>q.tool_set_type===i.type);if(O){const q={};O.config_fields.forEach(Z=>{var ue,pe;Z.type==="object"&&((ue=g.config)!=null&&ue[Z.name])?q[Z.name]=JSON.stringify(g.config[Z.name],null,2):((pe=g.config)==null?void 0:pe[Z.name])!==void 0&&(q[Z.name]=g.config[Z.name])}),g.config=q}}l.setFieldsValue(g),x(!0)};console.log(A,o);const ne=i=>{C(i);const g=o==null?void 0:o.find(O=>O.tool_set_type===i);if(g){const O={};g.config_fields.forEach(q=>{if(q.default)switch(q.type){case"number":O[q.name]=Number(q.default);break;case"boolean":O[q.name]=q.default==="true";break;case"array":O[q.name]=q.default.split(",");break;default:O[q.name]=q.default}}),l.setFieldValue("config",O)}else l.setFieldValue("config",void 0)},oe=i=>{if(i.config&&z){const g={};z.config_fields.forEach(O=>{var Z;const q=(Z=i.config)==null?void 0:Z[O.name];if(q!==void 0)if(O.type==="object")try{g[O.name]=typeof q=="string"?JSON.parse(q):q}catch{g[O.name]=q}else g[O.name]=q}),i.config=g}c?K({id:c.id,data:i}):Q(i)},ae=i=>{d(i)},h=i=>{M(i),u(!0)},G=i=>{console.log(new Date,"handleToggleStatus");const g=i.status==="enabled"?"disabled":"enabled";return X({id:i.id,status:g}).then(()=>{console.log(new Date,"handleToggleStatus1")})},te=i=>{var O;if(!((O=i.data_source)!=null&&O.depends_on)||i.data_source.depends_on.length===0)return{};const g={};return i.data_source.depends_on.forEach(q=>{var ue;const Z=(ue=I.config)==null?void 0:ue[q];Z!==void 0&&(g[q]=Z)}),g};console.log(w);const re=[{title:s("settings.toolsets.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.toolsets.type",{defaultValue:"Type"}),dataIndex:"type",key:"type",render:i=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:i.toUpperCase()})},{title:s("settings.toolsets.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:i=>e.jsxRuntimeExports.jsx(t.Tag,{color:i==="enabled"?"green":"red",children:i==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:n("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(i,g)=>e.jsxRuntimeExports.jsx(U.Actions,{actions:[{key:"test",permission:"system:toolsets:test",tooltip:s("settings.toolsets.test",{defaultValue:"Test Connection"}),icon:e.jsxRuntimeExports.jsx(V.ThunderboltOutlined,{}),disabled:g.status!=="enabled",onClick:async()=>r(g.id)},{key:"viewTools",icon:e.jsxRuntimeExports.jsx(V.ToolOutlined,{}),permission:"system:toolsets:view",disabled:g.status!=="enabled",tooltip:s("settings.toolsets.viewTools",{defaultValue:"View Tools"}),onClick:async()=>W(g.id)},{key:"viewConfig",icon:e.jsxRuntimeExports.jsx(V.SettingOutlined,{}),permission:"system:toolsets:view",tooltip:s("settings.toolsets.viewConfig",{defaultValue:"View Configuration"}),onClick:async()=>h(g.config),disabled:!g.config},{key:"edit",permission:"system:toolsets:update",tooltip:s("settings.toolsets.edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>ie(g)},{key:"toggleStatus",icon:g.status==="enabled"?e.jsxRuntimeExports.jsx(V.LockOutlined,{}):e.jsxRuntimeExports.jsx(V.CheckCircleOutlined,{}),onClick:async()=>G(g),permission:"system:toolsets:update",tooltip:g.status==="enabled"?n("disable",{defaultValue:"Disable"}):n("enable",{defaultValue:"Enable"})},{key:"delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),permission:"system:toolsets:delete",tooltip:n("delete",{defaultValue:"Delete"}),onClick:async()=>ae(g.id),danger:!0,confirm:{title:s("settings.toolsets.deleteConfirm",{defaultValue:"Are you sure you want to delete this toolset?"}),onConfirm:async()=>ae(g.id),okText:n("confirm",{defaultValue:"Confirm"}),cancelText:n("cancel",{defaultValue:"Cancel"})}}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("settings.toolsets.searchPlaceholder",{defaultValue:"Search toolsets..."}),style:{width:300},value:b,onChange:i=>j(i.target.value),allowClear:!0}),e.jsxRuntimeExports.jsxs(t.Select,{placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),value:P,onChange:i=>B(i),options:o==null?void 0:o.map(i=>({label:i.name,value:i.tool_set_type})),style:{minWidth:110},allowClear:!0,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"",children:"All"}),o==null?void 0:o.map(i=>e.jsxRuntimeExports.jsx(t.Select.Option,{value:i.tool_set_type,children:i.name},i.tool_set_type))]})]})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:N,loading:H,children:n("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:toolsets:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:Y,children:s("settings.toolsets.create",{defaultValue:"Create Toolset"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:re,dataSource:(w==null?void 0:w.data)||[],loading:H,rowKey:"id",pagination:{total:(w==null?void 0:w.total)||0,current:(w==null?void 0:w.current)||1,pageSize:(w==null?void 0:w.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(i,g)=>s("common.pagination.total",{defaultValue:`${g[0]}-${g[1]} of ${i} items`,start:g[0],end:g[1],total:i})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:c?s("settings.toolsets.edit",{defaultValue:"Edit Toolset"}):s("settings.toolsets.create",{defaultValue:"Create Toolset"}),open:m,onCancel:()=>{x(!1),l.resetFields(),E(null),C("")},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:oe,onValuesChange:(i,g)=>$(g),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.toolsets.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("settings.toolsets.nameRequired",{defaultValue:"Please enter toolset name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("settings.toolsets.namePlaceholder",{defaultValue:"Enter toolset name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.toolsets.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Ie,{rows:3,placeholder:s("settings.toolsets.descriptionPlaceholder",{defaultValue:"Enter toolset description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"type",label:s("settings.toolsets.type",{defaultValue:"Type"}),rules:[{required:!0,message:s("settings.toolsets.typeRequired",{defaultValue:"Please select type"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:F,placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),onChange:ne,value:A,options:o==null?void 0:o.map(i=>({label:i.name,value:i.tool_set_type}))})}),(y=z==null?void 0:z.config_fields)==null?void 0:y.map(i=>e.jsxRuntimeExports.jsx(U.DynamicConfigField,{field:i,selectedType:A,dependentValues:te(i),formValues:I},i.name)),e.jsxRuntimeExports.jsx(t.Form.Item,{hidden:!0,name:"status",label:s("settings.toolsets.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:J||se,children:c?n("update",{defaultValue:"Update"}):n("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{x(!1),l.resetFields(),E(null),C("")},children:n("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.configuration",{defaultValue:"Configuration"}),open:a,onCancel:()=>u(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>u(!1),children:n("close",{defaultValue:"Close"})},"close")],width:600,children:e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto"},children:JSON.stringify(f,null,2)})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.tools",{defaultValue:"Tools"}),open:R,onCancel:()=>v(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>v(!1),children:n("close",{defaultValue:"Close"})},"close")],width:800,children:e.jsxRuntimeExports.jsx("div",{style:{maxHeight:"600px",overflow:"auto"},children:L?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40},children:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{style:{fontSize:24},spin:!0})}):T.length===0?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40,color:"#999"},children:s("settings.toolsets.noTools",{defaultValue:"No tools available"})}):T.map((i,g)=>{var O,q,Z;return e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(V.ToolOutlined,{}),e.jsxRuntimeExports.jsx("strong",{children:((O=i.function)==null?void 0:O.name)||"Unknown"})]}),children:e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,children:[e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.description",{defaultValue:"Description"}),":"]})}),e.jsxRuntimeExports.jsx("p",{style:{marginBottom:16},children:((q=i.function)==null?void 0:q.description)||"-"})]}),((Z=i.function)==null?void 0:Z.parameters)&&e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.parameters",{defaultValue:"Parameters"}),":"]})}),e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto",fontSize:12},children:JSON.stringify(i.function.parameters,null,2)})]})]})},g)})})})]})},{TextArea:fe}=t.Input,_e=()=>{const{t:s}=D.useTranslation("system"),{t:n}=D.useTranslation("common"),l=ee.useNavigate(),[m]=t.Form.useForm(),[x,c]=p.useState(""),[E,b]=p.useState(),[j,a]=p.useState(!1),[u,f]=p.useState(null),[M,A]=p.useState(!1),[C]=t.Form.useForm(),{loading:R,data:v,refresh:T}=S.useRequest(()=>k.api.system.listSkills({current:1,page_size:100,search:x||void 0,domain:E}),{refreshDeps:[x,E],onError:()=>{t.message.error(s("settings.skills.fetchFailed",{defaultValue:"Failed to fetch skills"}))}}),{data:_}=S.useRequest(()=>k.api.system.listSkillDomains()),I=_??[],$=(v==null?void 0:v.data)??[],P=(v==null?void 0:v.total)??0,{loading:B,run:H}=S.useRequest(r=>k.api.system.createSkill(r),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.createSuccess",{defaultValue:"Skill created"})),a(!1),m.resetFields(),T()},onError:()=>{t.message.error(s("settings.skills.createFailed",{defaultValue:"Failed to create skill"}))}}),{loading:w,run:N}=S.useRequest(({id:r,body:L})=>k.api.system.updateSkill({id:r},L),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.updateSuccess",{defaultValue:"Skill updated"})),a(!1),f(null),m.resetFields(),T()},onError:()=>{t.message.error(s("settings.skills.updateFailed",{defaultValue:"Failed to update skill"}))}}),{run:F}=S.useRequest(r=>k.api.system.deleteSkill({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.deleteSuccess",{defaultValue:"Skill deleted"})),T()},onError:()=>{t.message.error(s("settings.skills.deleteFailed",{defaultValue:"Failed to delete skill"}))}}),{loading:o,run:z}=S.useRequest(r=>k.api.system.uploadSkill(r.body,r.file),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.uploadSuccess",{defaultValue:"Skill uploaded"})),A(!1),C.resetFields(),T()},onError:()=>{t.message.error(s("settings.skills.uploadFailed",{defaultValue:"Upload failed"}))}}),J=()=>{f(null),m.resetFields(),a(!0)},Q=r=>{f(r),m.setFieldsValue({name:r.name,description:r.description,category:r.category,domain:r.domain}),a(!0)},se=()=>{m.validateFields().then(r=>{u?N({id:u.id,body:{name:r.name,description:r.description??"",category:r.category??"",domain:r.domain??""}}):H({name:r.name,description:r.description??"",category:r.category??"",domain:r.domain??"",content:r.content??""})})},K=()=>{var Y,ie;const r=(Y=C.getFieldValue("file"))==null?void 0:Y.fileList,L=((ie=r==null?void 0:r[0])==null?void 0:ie.originFileObj)??(r==null?void 0:r[0]);if(!L){t.message.error(s("settings.skills.selectFile",{defaultValue:"Please select a file"}));return}const W=C.getFieldValue("category"),X=C.getFieldValue("domain");z({body:{category:W,domain:X},file:L})},d=[{title:s("settings.skills.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.skills.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",ellipsis:!0},{title:s("settings.skills.category",{defaultValue:"Category"}),dataIndex:"category",key:"category",render:r=>r?e.jsxRuntimeExports.jsx(t.Tag,{children:r}):"-"},{title:s("settings.skills.domain",{defaultValue:"Domain"}),dataIndex:"domain",key:"domain",render:r=>r?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:r}):"-"},{title:n("actions",{defaultValue:"Actions"}),key:"actions",render:(r,L)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:edit_files",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.FileTextOutlined,{}),onClick:()=>l(`/system/settings/skills/${L.id}/edit`),children:s("settings.skills.editFiles",{defaultValue:"Edit files"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:view",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.EyeOutlined,{}),onClick:()=>l(`/system/settings/skills/${L.id}/preview`),children:n("preview",{defaultValue:"Preview"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:()=>Q(L),children:n("edit",{defaultValue:"Edit"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:delete",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",danger:!0,icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),onClick:()=>t.Modal.confirm({title:n("confirmDelete",{defaultValue:"Confirm delete?"}),onOk:()=>F(L.id)}),children:n("delete",{defaultValue:"Delete"})})})]})}];return e.jsxRuntimeExports.jsxs(t.Card,{title:s("settings.skills.title",{defaultValue:"AI Agent Skills"}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:n("search",{defaultValue:"Search"}),allowClear:!0,onSearch:c,style:{width:200}}),e.jsxRuntimeExports.jsx(t.Select,{placeholder:s("settings.skills.domain",{defaultValue:"Domain"}),allowClear:!0,style:{width:120},value:E,onChange:b,options:I.map(r=>({value:r,label:r}))}),e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:()=>T(),children:n("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:J,children:s("settings.skills.create",{defaultValue:"Create skill"})})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:skills:create",children:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.UploadOutlined,{}),onClick:()=>A(!0),children:s("settings.skills.upload",{defaultValue:"Upload"})})})]}),children:[e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",loading:R,columns:d,dataSource:$,pagination:{total:P,pageSize:10,showSizeChanger:!0}}),e.jsxRuntimeExports.jsx(t.Modal,{title:u?s("settings.skills.editSkill",{defaultValue:"Edit skill"}):s("settings.skills.createSkill",{defaultValue:"Create skill"}),open:j,onOk:se,onCancel:()=>{a(!1),f(null)},confirmLoading:B||w,width:560,children:e.jsxRuntimeExports.jsxs(t.Form,{form:m,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.skills.name",{defaultValue:"Name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.skills.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(fe,{rows:2})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"category",label:s("settings.skills.category",{defaultValue:"Category"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"domain",label:s("settings.skills.domain",{defaultValue:"Domain"}),children:e.jsxRuntimeExports.jsx(t.Select,{allowClear:!0,placeholder:n("optional",{defaultValue:"Optional"}),options:I.map(r=>({value:r,label:r}))})}),!u&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"content",label:s("settings.skills.initialContent",{defaultValue:"Initial SKILL.md content (optional)"}),children:e.jsxRuntimeExports.jsx(fe,{rows:6,placeholder:`---
name: my-skill
description: ...
---

# My Skill`})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.skills.upload",{defaultValue:"Upload skill"}),open:M,onOk:K,onCancel:()=>A(!1),confirmLoading:o,children:e.jsxRuntimeExports.jsxs(t.Form,{form:C,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"file",label:s("settings.skills.file",{defaultValue:"File (.md or .zip)"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Upload,{maxCount:1,beforeUpload:()=>!1,accept:".md,.zip",children:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.UploadOutlined,{}),children:n("selectFile",{defaultValue:"Select file"})})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"category",label:s("settings.skills.category",{defaultValue:"Category"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"domain",label:s("settings.skills.domain",{defaultValue:"Domain"}),children:e.jsxRuntimeExports.jsx(t.Select,{allowClear:!0,placeholder:n("optional",{defaultValue:"Optional"}),options:I.map(r=>({value:r,label:r}))})})]})})]})},{TextArea:we}=t.Input,Te=()=>{const s=ee.useNavigate(),{t:n}=D.useTranslation("system"),{t:l}=D.useTranslation("common"),[m]=t.Form.useForm(),[x,c]=p.useState(!1),[E,b]=p.useState(null),[j,a]=p.useState(""),[u,f]=p.useState(1),[M,A]=p.useState(10),{loading:C,data:R,refresh:v}=S.useRequest(()=>le.listOrganizations({current:u,page_size:M,search:j}),{refreshDeps:[u,M,j],onError:o=>{t.message.error(n("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organizations"})),console.error("Failed to fetch organizations:",o)}}),{loading:T,run:_}=S.useRequest(o=>le.createOrganization(o),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.createSuccess",{defaultValue:"Organization created successfully"})),c(!1),m.resetFields(),b(null),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||n("settings.organizations.createFailed",{defaultValue:"Failed to create organization"}))}}),{loading:I,run:$}=S.useRequest(({id:o,...z})=>le.updateOrganization({id:o},z),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.updateSuccess",{defaultValue:"Organization updated successfully"})),c(!1),m.resetFields(),b(null),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||n("settings.organizations.updateFailed",{defaultValue:"Failed to update organization"}))}}),{run:P}=S.useRequest(o=>le.deleteOrganization({id:o}),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.deleteSuccess",{defaultValue:"Organization deleted successfully"})),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||n("settings.organizations.deleteFailed",{defaultValue:"Failed to delete organization"}))}}),B=()=>{b(null),m.resetFields(),m.setFieldsValue({status:"active"}),c(!0)},H=o=>{b(o),m.setFieldsValue({name:o.name,description:o.description,status:o.status}),c(!0)},w=o=>{t.Modal.confirm({title:n("settings.organizations.deleteConfirm",{defaultValue:"Delete Organization"}),content:n("settings.organizations.deleteConfirmContent",{defaultValue:`Are you sure you want to delete organization "${o.name}"? This action cannot be undone.`}),onOk:()=>P(o.id)})},N=()=>{m.validateFields().then(o=>{E?$({id:E.id,...o}):_(o)})},F=[{title:n("settings.organizations.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:n("settings.organizations.description",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:n("settings.organizations.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:o=>e.jsxRuntimeExports.jsx(t.Tag,{color:o==="active"?"green":"default",children:o==="active"?n("settings.organizations.active",{defaultValue:"Active"}):n("settings.organizations.disabled",{defaultValue:"Disabled"})})},{title:l("actions",{defaultValue:"Actions"}),key:"actions",render:(o,z)=>e.jsxRuntimeExports.jsx(U.Actions,{actions:[{key:"view",label:l("view",{defaultValue:"View"}),icon:e.jsxRuntimeExports.jsx(V.EyeOutlined,{}),onClick:async()=>s(`/system/settings/organizations/${z.id}`),permission:"system:organization:view"},{key:"edit",label:l("edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>H(z),permission:"system:organization:update"},{key:"delete",label:l("delete",{defaultValue:"Delete"}),icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),danger:!0,onClick:async()=>w(z),permission:"system:organization:delete"}]})}];return e.jsxRuntimeExports.jsxs(t.Card,{title:n("settings.organizations.title",{defaultValue:"Organization Management"}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:v,children:l("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(U.PermissionGuard,{permission:"system:organization:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:B,children:n("settings.organizations.create",{defaultValue:"Create Organization"})})})]}),children:[e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:n("settings.organizations.searchPlaceholder",{defaultValue:"Search organizations..."}),allowClear:!0,onSearch:o=>{a(o),f(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:F,dataSource:(R==null?void 0:R.data)||[],loading:C,rowKey:"id",pagination:{current:u,pageSize:M,total:(R==null?void 0:R.total)||0,showSizeChanger:!0,showTotal:(o,z)=>n("common.pagination.total",{defaultValue:`${z[0]}-${z[1]} of ${o} items`,start:z[0],end:z[1],total:o}),onChange:(o,z)=>{f(o),A(z)}}})]}),e.jsxRuntimeExports.jsx(t.Modal,{title:E?n("settings.organizations.edit",{defaultValue:"Edit Organization"}):n("settings.organizations.create",{defaultValue:"Create Organization"}),open:x,onOk:N,onCancel:()=>{c(!1),m.resetFields(),b(null)},confirmLoading:T||I,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:m,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:n("settings.organizations.name",{defaultValue:"Name"}),rules:[{required:!0,message:n("settings.organizations.nameRequired",{defaultValue:"Please enter organization name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:n("settings.organizations.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(we,{rows:3})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:n("settings.organizations.status",{defaultValue:"Status"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"active",children:n("settings.organizations.active",{defaultValue:"Active"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"disabled",children:n("settings.organizations.disabled",{defaultValue:"Disabled"})})]})})]})})]})},Ae=({transformItems:s=n=>n})=>{const{t:n}=D.useTranslation("system"),l=ee.useNavigate(),m=ee.useLocation(),E=m.hash.replace("#","")||"base",{enableMultiOrg:b}=xe.useSite(),{hasPermission:j}=xe.usePermission(),a=[{key:"base",label:n("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsxRuntimeExports.jsx(Fe,{}),hidden:!j("system:settings:update")},{key:"security",label:n("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsxRuntimeExports.jsx(ye,{}),hidden:!j("system:security:update")},{key:"oauth",label:n("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsxRuntimeExports.jsx(Ee,{}),hidden:!j("system:settings:update")},{key:"ldap",label:n("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsxRuntimeExports.jsx(be,{}),hidden:!j("system:settings:update")},{key:"smtp",label:n("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsxRuntimeExports.jsx(Se,{}),hidden:!j("system:settings:update")},{key:"ai-models",label:n("settings.tabs.aiModels",{defaultValue:"AI Models"}),children:e.jsxRuntimeExports.jsx(ve,{}),hidden:!j("ai:models:view")},{key:"ai-toolsets",label:n("settings.tabs.toolSets",{defaultValue:"Tool Sets"}),children:e.jsxRuntimeExports.jsx(Ce,{}),hidden:!j("system:toolsets:view")},{key:"skills",label:n("settings.tabs.skills",{defaultValue:"Skills"}),children:e.jsxRuntimeExports.jsx(_e,{}),hidden:!j("system:skills:view")},...b?[{key:"organizations",label:n("settings.tabs.organizations",{defaultValue:"Organizations"}),children:e.jsxRuntimeExports.jsx(Te,{}),hidden:!j("system:organization:view")}]:[]];return e.jsxRuntimeExports.jsx(t.Card,{title:n("settings.title",{defaultValue:"System Settings"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{defaultActiveKey:E,onChange:u=>{l(`${m.pathname}#${u}`)},items:s(a.filter(u=>!u.hidden),n)})})},ze=Object.freeze(Object.defineProperty({__proto__:null,default:Ae},Symbol.toStringTag,{value:"Module"})),Oe=()=>{var ne,oe,ae;const s=ee.useNavigate(),{id:n}=ee.useParams(),{t:l}=D.useTranslation("system"),{t:m}=D.useTranslation("common"),[x]=t.Form.useForm(),[c]=t.Form.useForm(),[E,b]=p.useState(!1),[j,a]=p.useState(!1),[u,f]=p.useState(null),[M,A]=p.useState(""),[C,R]=p.useState(1),[v,T]=p.useState(10),{data:_,loading:I,refresh:$}=S.useRequest(()=>le.getOrganization({id:n}),{ready:!!n,onError:h=>{t.message.error(l("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organization"})),console.error("Failed to fetch organization:",h)}}),{data:P,loading:B,refresh:H}=S.useRequest(()=>le.listOrganizationUsers({id:n,current:C,page_size:v,search:M}),{ready:!!n,refreshDeps:[n,C,v,M],onError:h=>{t.message.error(l("settings.organizations.users.fetchFailed",{defaultValue:"Failed to fetch organization users"})),console.error("Failed to fetch organization users:",h)}}),{data:w,loading:N}=S.useRequest(()=>ge.listUsers({current:1,page_size:1e3}),{ready:E}),{data:F,loading:o}=S.useRequest(()=>ge.listRoles({organization_id:n,current:1,page_size:1e3}),{ready:!!n}),{loading:z,run:J}=S.useRequest(h=>le.addUserToOrganization({id:n},h),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.addSuccess",{defaultValue:"User added to organization successfully"})),b(!1),x.resetFields(),H()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.addFailed",{defaultValue:"Failed to add user to organization"}))}}),{loading:Q,run:se}=S.useRequest(h=>le.updateUserOrganizationRoles({id:n,user_id:u==null?void 0:u.id},h),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.updateRolesSuccess",{defaultValue:"User roles updated successfully"})),a(!1),c.resetFields(),f(null),H()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.updateRolesFailed",{defaultValue:"Failed to update user roles"}))}}),{run:K}=S.useRequest(h=>le.removeUserFromOrganization({id:n,user_id:h}),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.removeSuccess",{defaultValue:"User removed from organization successfully"})),H()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.removeFailed",{defaultValue:"Failed to remove user from organization"}))}}),d=()=>{b(!0),x.resetFields()},r=h=>{var G;f(h),c.setFieldsValue({role_ids:((G=h.organization_roles)==null?void 0:G.map(te=>te.id))||[]}),a(!0)},L=h=>{t.Modal.confirm({title:l("settings.organizations.users.removeConfirm",{defaultValue:"Remove User"}),content:l("settings.organizations.users.removeConfirmContent",{defaultValue:`Are you sure you want to remove user "${h.full_name||h.username}" from this organization? This will also remove all their roles in this organization.`}),onOk:()=>K(h.id)})},W=()=>{x.validateFields().then(h=>{J(h)})},X=()=>{c.validateFields().then(h=>{se(h)})},Y=((ne=w==null?void 0:w.data)==null?void 0:ne.filter(h=>{var G;return!((G=P==null?void 0:P.data)!=null&&G.some(te=>te.id===h.id))}))||[],ie=[{title:l("settings.organizations.users.username",{defaultValue:"Username"}),dataIndex:"username",key:"username"},{title:l("settings.organizations.users.email",{defaultValue:"Email"}),dataIndex:"email",key:"email"},{title:l("settings.organizations.users.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name",key:"full_name"},{title:l("settings.organizations.users.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:h=>e.jsxRuntimeExports.jsx(t.Tag,{color:h==="active"?"green":"default",children:h==="active"?l("settings.organizations.active",{defaultValue:"Active"}):h})},{title:l("settings.organizations.users.roles",{defaultValue:"Roles"}),key:"roles",render:(h,G)=>{var te;return e.jsxRuntimeExports.jsx(t.Space,{wrap:!0,children:((te=G.organization_roles)==null?void 0:te.map(re=>e.jsxRuntimeExports.jsx(t.Tag,{children:re.name},re.id)))||e.jsxRuntimeExports.jsx(t.Tag,{children:"No roles"})})}},{title:m("actions",{defaultValue:"Actions"}),key:"actions",render:(h,G)=>e.jsxRuntimeExports.jsx(U.Actions,{actions:[{key:"edit",label:l("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>r(G)},{key:"delete",label:l("settings.organizations.users.remove",{defaultValue:"Remove"}),icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),danger:!0,onClick:async()=>L(G)}]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ArrowLeftOutlined,{}),onClick:()=>s("/system/settings#organizations"),children:m("back",{defaultValue:"Back"})}),e.jsxRuntimeExports.jsxs("span",{children:[l("settings.organizations.detail",{defaultValue:"Organization Detail"}),": ",_==null?void 0:_.name]})]}),extra:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:()=>{$(),H()},children:m("refresh",{defaultValue:"Refresh"})}),loading:I,children:e.jsxRuntimeExports.jsxs(t.Descriptions,{column:2,bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.name",{defaultValue:"Name"}),children:_==null?void 0:_.name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Tag,{color:(_==null?void 0:_.status)==="active"?"green":"default",children:(_==null?void 0:_.status)==="active"?l("settings.organizations.active",{defaultValue:"Active"}):l("settings.organizations.disabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.description",{defaultValue:"Description"}),span:2,children:(_==null?void 0:_.description)||"-"})]})}),e.jsxRuntimeExports.jsx(t.Card,{title:l("settings.organizations.users.title",{defaultValue:"Organization Users"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:d,children:l("settings.organizations.users.add",{defaultValue:"Add User"})}),style:{marginTop:16},children:e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:l("settings.organizations.users.searchPlaceholder",{defaultValue:"Search users..."}),allowClear:!0,onSearch:h=>{A(h),R(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:ie,dataSource:(P==null?void 0:P.data)||[],loading:B,rowKey:"id",pagination:{current:C,pageSize:v,total:(P==null?void 0:P.total)||0,showSizeChanger:!0,showTotal:h=>m("pagination.total",{defaultValue:`Total ${h} items`}),onChange:(h,G)=>{R(h),T(G)}}})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.organizations.users.add",{defaultValue:"Add User"}),open:E,onOk:W,onCancel:()=>{b(!1),x.resetFields()},confirmLoading:z,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:x,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"user_id",label:l("settings.organizations.users.user",{defaultValue:"User"}),rules:[{required:!0,message:l("settings.organizations.users.userRequired",{defaultValue:"Please select a user"})}],children:e.jsxRuntimeExports.jsx(t.Select,{showSearch:!0,placeholder:l("settings.organizations.users.selectUser",{defaultValue:"Select a user"}),loading:N,filterOption:(h,G)=>((G==null?void 0:G.label)??"").toLowerCase().includes(h.toLowerCase()),options:Y.map(h=>({label:`${h.full_name||h.username} (${h.email})`,value:h.id}))})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:l("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:l("settings.organizations.users.selectRoles",{defaultValue:"Select roles (optional)"}),loading:o,options:((oe=F==null?void 0:F.data)==null?void 0:oe.map(h=>({label:h.name,value:h.id})))||[]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),open:j,onOk:X,onCancel:()=>{a(!1),c.resetFields(),f(null)},confirmLoading:Q,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:l("settings.organizations.users.user",{defaultValue:"User"}),children:e.jsxRuntimeExports.jsx(t.Input,{value:(u==null?void 0:u.full_name)||(u==null?void 0:u.username),disabled:!0})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:l("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:l("settings.organizations.users.selectRoles",{defaultValue:"Select roles"}),loading:o,options:((ae=F==null?void 0:F.data)==null?void 0:ae.map(h=>({label:h.name,value:h.id})))||[]})})]})})]})},Me=Object.freeze(Object.defineProperty({__proto__:null,default:Oe},Symbol.toStringTag,{value:"Module"})),{TextArea:he}=t.Input,qe=s=>s.toLowerCase().endsWith(".md");function je(s){return s.map(n=>{var l;return{key:n.path,title:n.name,isLeaf:!n.is_dir,icon:n.is_dir?e.jsxRuntimeExports.jsx(V.FolderOutlined,{}):e.jsxRuntimeExports.jsx(V.FileOutlined,{}),children:(l=n.children)!=null&&l.length?je(n.children):void 0}})}function ce(s){return s.includes("/")?s.replace(/\/[^/]+$/,""):""}const Pe=()=>{const{id:s}=ee.useParams(),n=ee.useNavigate(),{t:l}=D.useTranslation("system"),[m,x]=p.useState(null),[c,E]=p.useState(null),[b,j]=p.useState(!1),[a,u]=p.useState(""),[f,M]=p.useState(!1),[A,C]=p.useState([]),[R,v]=p.useState(!1),[T,_]=p.useState(!1),[I,$]=p.useState(""),[P]=t.Form.useForm(),[B,H]=p.useState(null),[w,N]=p.useState(null),[F,o]=p.useState(""),[z]=t.Form.useForm(),{data:J}=S.useRequest(()=>s?k.api.system.getSkill({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s}),{data:Q,loading:se,refresh:K}=S.useRequest(()=>s?k.api.system.listSkillFilesTree({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s,onSuccess:y=>{if(!m){for(const i of y)if(!i.is_dir&&i.name==="SKILL.md"){E(i.path),x(i.path),j(!1);return}for(const i of y)if(!i.is_dir&&i.name==="SKILLS.md"){E(i.path),x(i.path),j(!1);return}}}}),d=(J==null?void 0:J.data)??J,r=(Q==null?void 0:Q.data)??Q??[],L=p.useMemo(()=>je(r),[r]),W=b&&c?c:m?ce(m):"";p.useEffect(()=>{m&&s?(k.api.system.getSkillFile({id:s,path:m}).then(y=>u((y==null?void 0:y.data)??y??"")).catch(()=>t.message.error(l("settings.skills.editor.failedToLoadFile",{defaultValue:"Failed to load file"}))),M(!1)):(u(""),M(!1))},[s,m,l]);const X=()=>{!s||!m||k.api.system.putSkillFile({id:s,path:m},a).then(()=>{t.message.success(l("settings.skills.editor.saved",{defaultValue:"Saved"})),M(!1)}).catch(()=>t.message.error(l("settings.skills.editor.failedToSave",{defaultValue:"Failed to save"})))},Y=(y,i)=>{const g=String(i.node.key),O=!i.node.isLeaf;E(g),j(O),i.node.isLeaf?x(g):x(null)},ie=y=>{y.event.preventDefault(),H({path:String(y.node.key),isDir:!y.node.isLeaf,x:y.event.clientX,y:y.event.clientY})},ne=p.useCallback(()=>H(null),[]),oe=p.useCallback(y=>{if(!s||!B)return;const{path:i,isDir:g}=B;switch(ne(),y){case"open":x(i),E(i),j(!1);break;case"rename":{const O=i.includes("/")?i.split("/").pop():i;N({path:i,isDir:g}),o(O),setTimeout(()=>z.setFieldsValue({name:O}),0);break}case"delete":t.Modal.confirm({title:l("settings.skills.editor.deleteConfirm",{defaultValue:"Delete?"}),content:g?l("settings.skills.editor.deleteConfirmContentDir",{path:i,defaultValue:`Delete ${i}? This will remove the folder and all its contents.`}):l("settings.skills.editor.deleteConfirmContent",{path:i,defaultValue:`Delete ${i}?`}),onOk:()=>k.api.system.deleteSkillPath({id:s,path:i}).then(()=>{t.message.success(l("settings.skills.editor.deleted",{defaultValue:"Deleted"})),m===i&&(x(null),u("")),c===i&&(E(null),j(!1)),K()}).catch(()=>t.message.error(l("settings.skills.editor.failedToDelete",{defaultValue:"Failed to delete"})))});break;case"newFile":E(i),j(g),v(!0);break;case"newDir":E(i),j(g),_(!0);break}},[s,B,ne,K,m,c,z,l]),ae=()=>{if(!s||!w)return;const y=(z.getFieldValue("name")??F).trim();if(!y){t.message.error(l("settings.skills.editor.nameRequired",{defaultValue:"Name is required"}));return}if(!w.isDir&&!/\.(md|txt)$/i.test(y)){t.message.error(l("settings.skills.editor.fileNameExtension",{defaultValue:"File name must end with .md or .txt"}));return}const i=ce(w.path),g=i?`${i}/${y}`:y;if(g===w.path){N(null);return}k.api.system.moveSkillPath({id:s},{from_path:w.path,to_path:g}).then(()=>{t.message.success(l("settings.skills.editor.renamed",{defaultValue:"Renamed"})),m===w.path&&x(g),c===w.path&&E(g),N(null),K()}).catch(()=>t.message.error(l("settings.skills.editor.failedToRename",{defaultValue:"Failed to rename"})))},h=y=>{if(!s)return;const i=String(y.dragNode.key),g=String(y.dragNode.title);let O;if(y.dropToGap){const q=ce(String(y.node.key));O=q?`${q}/${g}`:g}else O=`${y.node.key}/${g}`;O!==i&&k.api.system.moveSkillPath({id:s},{from_path:i,to_path:O}).then(()=>{t.message.success(l("settings.skills.editor.moved",{defaultValue:"Moved"})),m===i&&x(O),c===i&&E(O),K()}).catch(()=>t.message.error(l("settings.skills.editor.failedToMove",{defaultValue:"Failed to move"})))},G=()=>{const y=I.trim();if(!y||!s)return;const i=W?`${W}/${y}`:y;if(!/\.(md|txt)$/i.test(y)){t.message.error(l("settings.skills.editor.onlyMdTxtAllowed",{defaultValue:"Only .md and .txt files are allowed"}));return}k.api.system.putSkillFile({id:s,path:i},"").then(()=>{t.message.success(l("settings.skills.editor.fileCreated",{defaultValue:"File created"})),v(!1),$(""),K(),x(i),u("")}).catch(()=>t.message.error(l("settings.skills.editor.failedToCreateFile",{defaultValue:"Failed to create file"})))},te=()=>{var g;const y=(g=P.getFieldValue("name"))==null?void 0:g.trim();if(!y||!s)return;const i=W?`${W}/${y}`:y;k.api.system.createSkillDir({id:s},{path:i}).then(()=>{t.message.success(l("settings.skills.editor.folderCreated",{defaultValue:"Folder created"})),_(!1),P.resetFields(),K()}).catch(()=>t.message.error(l("settings.skills.editor.failedToCreateFolder",{defaultValue:"Failed to create folder"})))},re=()=>{const y=c||m;!s||!y||t.Modal.confirm({title:l("settings.skills.editor.deleteConfirm",{defaultValue:"Delete?"}),content:l("settings.skills.editor.deleteConfirmContent",{path:y,defaultValue:`Delete ${y}?`}),onOk:()=>k.api.system.deleteSkillPath({id:s,path:y}).then(()=>{t.message.success(l("settings.skills.editor.deleted",{defaultValue:"Deleted"})),m===y&&(x(null),u("")),c===y&&(E(null),j(!1)),K()}).catch(()=>t.message.error(l("settings.skills.editor.failedToDelete",{defaultValue:"Failed to delete"})))})};return s?e.jsxRuntimeExports.jsxs(t.Card,{title:(d==null?void 0:d.name)??l("settings.skills.editor.skill",{defaultValue:"Skill"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"link",onClick:()=>n("/system/settings#skills"),children:l("settings.skills.editor.backToSkills",{defaultValue:"Back to Skills"})}),style:{height:"100%",display:"flex",flexDirection:"column",minHeight:"calc(100vh - 160px)"},bodyStyle:{flex:1,minHeight:0,display:"flex",flexDirection:"column"},children:[e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:16,flex:1,minHeight:0},children:[e.jsxRuntimeExports.jsxs("div",{style:{width:260,border:"1px solid #d9d9d9",borderRadius:8,padding:8,display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxRuntimeExports.jsxs(t.Space,{style:{marginBottom:8,flexShrink:0},children:[e.jsxRuntimeExports.jsx(t.Button,{size:"small",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:()=>v(!0),children:l("settings.skills.editor.file",{defaultValue:"File"})}),e.jsxRuntimeExports.jsx(t.Button,{size:"small",icon:e.jsxRuntimeExports.jsx(V.FolderOutlined,{}),onClick:()=>_(!0),children:l("settings.skills.editor.folder",{defaultValue:"Folder"})})]}),se?e.jsxRuntimeExports.jsx("div",{children:l("settings.skills.editor.loading",{defaultValue:"Loading..."})}):e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto"},children:e.jsxRuntimeExports.jsx(t.Tree,{showIcon:!0,blockNode:!0,draggable:!0,expandedKeys:A,onExpand:y=>C(y),selectedKeys:c?[c]:[],onSelect:Y,onRightClick:ie,onDrop:h,treeData:L})})]}),e.jsxRuntimeExports.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",minHeight:0},children:[m&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Space,{style:{marginBottom:8,flexShrink:0},children:[e.jsxRuntimeExports.jsx("span",{children:m}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),disabled:!f,onClick:X,children:l("settings.skills.editor.save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{danger:!0,icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),onClick:re,children:l("settings.skills.editor.delete",{defaultValue:"Delete"})})]}),qe(m)?e.jsxRuntimeExports.jsxs("div",{style:{flex:1,minHeight:0,minWidth:0,display:"flex",gap:16},children:[e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,minWidth:0,display:"flex",flexDirection:"column"},children:e.jsxRuntimeExports.jsx(he,{value:a,onChange:y=>{u(y.target.value),M(!0)},style:{flex:1,minHeight:0,fontFamily:"monospace",resize:"none"},spellCheck:!1})}),e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,minWidth:0,overflow:"auto",border:"1px solid #d9d9d9",borderRadius:8,padding:12},children:e.jsxRuntimeExports.jsx(U.MarkdownViewer,{content:me.markdownWithMetadataAsTable(a)})})]}):e.jsxRuntimeExports.jsx(he,{value:a,onChange:y=>{u(y.target.value),M(!0)},style:{flex:1,minHeight:0,fontFamily:"monospace",resize:"none"},spellCheck:!1})]}),!m&&e.jsxRuntimeExports.jsx("div",{style:{color:"#999"},children:l("settings.skills.editor.selectFileToEdit",{defaultValue:"Select a file to edit"})})]})]}),B&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:ne,onContextMenu:y=>y.preventDefault(),"aria-hidden":!0}),e.jsxRuntimeExports.jsx("div",{style:{position:"fixed",left:B.x,top:B.y,zIndex:1e3},children:e.jsxRuntimeExports.jsx(t.Menu,{selectable:!1,items:[...B.isDir?[]:[{key:"open",icon:e.jsxRuntimeExports.jsx(V.FileOutlined,{}),label:l("settings.skills.editor.open",{defaultValue:"Open"})}],{key:"rename",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),label:l("settings.skills.editor.rename",{defaultValue:"Rename"})},{key:"delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),label:l("settings.skills.editor.delete",{defaultValue:"Delete"}),danger:!0},{key:"newFile",icon:e.jsxRuntimeExports.jsx(V.FileAddOutlined,{}),label:l("settings.skills.editor.newFile",{defaultValue:"New file"})},{key:"newDir",icon:e.jsxRuntimeExports.jsx(V.FolderAddOutlined,{}),label:l("settings.skills.editor.newFolder",{defaultValue:"New folder"})}],onClick:({key:y})=>oe(y)})})]}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.skills.editor.newFileTitle",{defaultValue:"New file"}),open:R,onOk:G,onCancel:()=>{v(!1),$("")},okText:l("settings.skills.editor.create",{defaultValue:"Create"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:l("settings.skills.editor.placeholderNewFile",{defaultValue:"filename.md or filename.txt"}),value:I,onChange:y=>$(y.target.value)})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.skills.editor.newFolderTitle",{defaultValue:"New folder"}),open:T,onOk:()=>P.validateFields().then(te),onCancel:()=>_(!1),okText:l("settings.skills.editor.create",{defaultValue:"Create"}),children:e.jsxRuntimeExports.jsx(t.Form,{form:P,layout:"vertical",children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:l("settings.skills.editor.folderName",{defaultValue:"Folder name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:l("settings.skills.editor.placeholderFolder",{defaultValue:"folder-name"})})})})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.skills.editor.renameTitle",{defaultValue:"Rename"}),open:!!w,onOk:ae,onCancel:()=>N(null),okText:l("settings.skills.editor.rename",{defaultValue:"Rename"}),destroyOnClose:!0,children:e.jsxRuntimeExports.jsx(t.Form,{form:z,layout:"vertical",onValuesChange:(y,i)=>o(i.name??""),children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:w!=null&&w.isDir?l("settings.skills.editor.folderName",{defaultValue:"Folder name"}):l("settings.skills.editor.fileName",{defaultValue:"File name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:w!=null&&w.isDir?l("settings.skills.editor.placeholderFolder",{defaultValue:"folder-name"}):l("settings.skills.editor.placeholderFileName",{defaultValue:"name.md"}),onPressEnter:()=>ae()})})})})]}):null},Le=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"})),Ue=()=>{var f;const{id:s}=ee.useParams(),n=ee.useNavigate(),{t:l}=D.useTranslation("system"),{data:m,loading:x}=S.useRequest(()=>s?k.api.system.getSkill({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s}),{data:c,loading:E}=S.useRequest(()=>s?k.api.system.previewSkill({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s,onError:()=>t.message.error(l("settings.skills.previewFailed",{defaultValue:"Failed to load preview"}))}),b=(m==null?void 0:m.data)??m,j=((f=c==null?void 0:c.data)==null?void 0:f.content)??(c==null?void 0:c.content)??"",a=me.skillPreviewContentWithMetadataAsTable(j);if(!s)return null;const u=x||E;return e.jsxRuntimeExports.jsx(t.Card,{title:(b==null?void 0:b.name)??l("settings.skills.editor.previewTitle",{defaultValue:"Skill Preview"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"link",onClick:()=>n("/system/settings#skills"),children:l("settings.skills.editor.backToSkills",{defaultValue:"Back to Skills"})}),children:e.jsxRuntimeExports.jsx(t.Spin,{spinning:u,children:e.jsxRuntimeExports.jsx("div",{style:{minHeight:200},children:!u&&e.jsxRuntimeExports.jsx(U.MarkdownViewer,{content:a})})})})},De=Object.freeze(Object.defineProperty({__proto__:null,default:Ue},Symbol.toStringTag,{value:"Module"})),Ne=()=>{const{t:s}=D.useTranslation("system"),[n]=ee.useSearchParams(),l=n.get("provider"),m=n.get("code"),x=n.get("state"),[c,E]=p.useState(null),[b,j]=p.useState(null),[a,u]=p.useState(null);return S.useRequest(async()=>{if(!m||!x||!l)throw new Error(s("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const f=await k.api.system.testOauthCallback({code:m,state:x,provider:l});if(!f.user_info)throw new Error(s("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!f.user)throw new Error(s("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));E(f.user),j(f.user_info)},{onSuccess:()=>{u({status:"success",message:s("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:f=>{u({status:"error",message:s("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:f.message})}}),a?e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(t.Result,{status:a.status,title:a.message,subTitle:a.error,extra:e.jsxRuntimeExports.jsxs(t.Space,{style:{display:!b||!c?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:b||{}})}),e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:c||{}})})]})})}):e.jsxRuntimeExports.jsx(U.Loading,{})},Be=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));exports.OAuthTestCallback=Be;exports.OrganizationDetail=Me;exports.SkillEditor=Le;exports.SkillPreview=De;exports.index=ze;
