"use strict";const e=require("./vendor.js"),t=require("antd"),P=require("react-i18next"),R=require("react"),S=require("ahooks"),T=require("@ant-design/icons"),y=require("./index.js"),W=require("./base.js"),N=require("./components.js"),K=require("react-quill"),H=require("react-router-dom"),Q=require("react-json-view"),D=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,ie={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},re=({initialData:s,onRefresh:a})=>{const{t:o}=P.useTranslation("system"),{t:V}=P.useTranslation("common"),[d]=t.Form.useForm(),[m,h]=R.useState((s==null?void 0:s.provider)||"custom"),[f,g]=R.useState((s==null?void 0:s.provider)==="custom"||(s==null?void 0:s.provider)==="autoDiscover"),[n,c]=R.useState((s==null?void 0:s.enabled)||!1),[u,I]=R.useState((s==null?void 0:s.auto_create_user)||!1),{loading:i,data:v,refresh:x}=S.useRequest(y.api.system.getOauthSettings,{manual:!!s,onSuccess:p=>{d.setFieldsValue(p),h(p.provider),g(p.provider==="custom"||p.provider==="autoDiscover"),c(p.enabled),I(p.auto_create_user)},onError:p=>{t.message.error(o("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",p)}});R.useEffect(()=>{s&&(d.setFieldsValue(s),h(s.provider),g(s.provider==="custom"||s.provider==="autoDiscover"),c(s.enabled),I(s.auto_create_user))},[s,d]);const w=p=>{h(p),g(p==="custom"||p==="autoDiscover");const k=ie[p];k&&d.setFieldsValue({auth_endpoint:k.endpoints.auth_endpoint,token_endpoint:k.endpoints.token_endpoint,userinfo_endpoint:k.endpoints.userinfo_endpoint,scope:k.scope,email_field:k.email_field,username_field:k.username_field,full_name_field:k.full_name_field,avatar_field:k.avatar_field,role_field:k.role_field,icon_url:k.icon_url,display_name:k.display_name})},q=p=>{c(p)},F=p=>{I(p)},{loading:j,run:U}=S.useRequest(y.api.system.updateOauthSettings,{manual:!0,onSuccess:()=>{t.message.success(o("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),a?a():x()},onError:p=>{t.message.error(o("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",p)}}),C=p=>{U(p)},M=()=>{a?a():x()},{loading:B,run:z}=S.useRequest(async({redirect_uri:p,...k})=>{let $;return p?$=new URL(p):$=new URL(window.location.origin),$.pathname=W.getURL("/system/settings/oauth/test-callback"),$.searchParams.set("provider",m),y.api.system.testOauthConnection({redirect_uri:$.toString(),...k})},{manual:!0,onSuccess:({url:p})=>{window.open(p,"_blank")},onError:p=>{t.message.error(o("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:p.message})),console.error("Failed to test OAuth connection",p)}}),O=()=>m==="custom";return e.jsxRuntimeExports.jsx(t.Spin,{spinning:i,children:e.jsxRuntimeExports.jsxs(t.Form,{form:d,layout:"vertical",onFinish:C,initialValues:s||v,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"enabled",label:o("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:o("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:q})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:o("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:o("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:n,message:o("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxRuntimeExports.jsxs(t.Select,{onChange:w,disabled:!n,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"github",children:o("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"google",children:o("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"dingtalk",children:o("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"wechat",children:o("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"autoDiscover",children:o("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"custom",children:o("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"display_name",label:o("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:o("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n,placeholder:m!=="custom"?o(`settings.oauth.provider.options.${m}`,{defaultValue:m}):""})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"icon_url",label:o("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:o("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:D,message:o("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n,placeholder:"https://example.com/icon.png"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_id",label:o("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:o("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:n,message:o("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_secret",label:o("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:o("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:n,message:o("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!n,autoComplete:"off",visibilityToggle:!1,placeholder:o("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),O()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auth_endpoint",label:o("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:o("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:o("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:D,message:o("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"wellknown_endpoint",hidden:m!=="autoDiscover",label:o("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:o("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:D,message:o("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:n&&m==="autoDiscover",message:o("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),O()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"token_endpoint",label:o("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:o("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:o("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:D,message:o("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),O()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"userinfo_endpoint",label:o("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:o("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:n&&m==="custom",message:o("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:D,message:o("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"scope",label:o("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:o("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:n,message:o("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"redirect_uri",label:o("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:o("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[p=>p.getFieldValue("redirect_uri")!==""?{pattern:D,message:o("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n,placeholder:`http://${window.location.host}${W.getURL(`/login?provider=settings.${m}`)}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auto_create_user",label:o("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:o("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:F,disabled:!n})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"default_role",label:o("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:o("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:n&&u,message:o("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!n||!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enabled",label:o("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:o("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!n})}),e.jsxRuntimeExports.jsx(t.Divider,{children:o("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:o("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:f?"":o("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"email_field",label:o("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:o("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"email",disabled:!n||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"username_field",label:o("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:o("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"login",autoComplete:"off",disabled:!n||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"full_name_field",label:o("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:o("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"name",disabled:!n||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"avatar_field",label:o("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:o("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"avatar_url",disabled:!n||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_field",label:o("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:o("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"role",disabled:!n||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:j,icon:e.jsxRuntimeExports.jsx(T.SaveOutlined,{}),children:V("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{loading:B,onClick:async()=>{const p=d.getFieldsValue();z(p)},children:o("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:M,icon:e.jsxRuntimeExports.jsx(T.ReloadOutlined,{}),children:V("refresh",{defaultValue:"Refresh"})})]})})]})})},ue=()=>{const{t:s}=P.useTranslation("system"),{t:a}=P.useTranslation("common"),[o]=t.Form.useForm(),{loading:V,data:d,refresh:m}=S.useRequest(y.api.system.getSecuritySettings,{onSuccess:n=>{o.setFieldsValue(n)},onError:n=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",n)}}),{loading:h,run:f}=S.useRequest(y.api.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),m()},onError:n=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",n)}}),g=n=>{f(n)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:V,children:e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:g,initialValues:d,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enforced",label:s("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:s("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_complexity",label:s("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:s("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"low",children:s("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"medium",children:s("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"high",children:s("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"very_high",children:s("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_min_length",label:s("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:s("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:6,max:32,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_expiry_days",label:s("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:s("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lock",label:s("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:s("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(n,c)=>n.login_failure_lock!==c.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_attempts",label:s("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:s("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(n,c)=>n.login_failure_lock!==c.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lockout_minutes",label:s("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:s("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_check",label:s("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:s("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(n,c)=>n.history_password_check!==c.history_password_check,children:({getFieldValue:n})=>n("history_password_check")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_count",label:s("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:s("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"inactive_account_lock_days",label:s("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:s("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_timeout_minutes",label:s("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:s("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_idle_timeout_minutes",label:s("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:s("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:h,icon:e.jsxRuntimeExports.jsx(T.SaveOutlined,{}),children:a("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>m(),icon:e.jsxRuntimeExports.jsx(T.ReloadOutlined,{}),children:a("refresh",{defaultValue:"Refresh"})})]})})]})})},de=({fetchItems:s,importItems:a,columns:o,...V})=>{const{t:d}=P.useTranslation("system"),[m,h]=R.useState([]),[f,g]=R.useState([]),{run:n,loading:c}=S.useRequest(s,{onError:i=>{t.message.error(d("settings.ldap.importError",{error:`${i.message}`}))},onSuccess:i=>{h(i)},manual:!0}),{run:u,loading:I}=S.useRequest(async()=>{for(const i of f.filter(v=>{const x=m.find(w=>w.ldap_dn===v);return!(!x||x.status==="imported")})){const v=await a([i]);h(x=>[...x].map(q=>{for(const F of v)if(q.ldap_dn===F.ldap_dn)return{...F,status:"imported"};return q}))}},{manual:!0});return R.useEffect(()=>{V.visible&&(h([]),n(),g([]))},[V.visible]),e.jsxRuntimeExports.jsx(t.Modal,{title:d("settings.ldap.importTitle"),...V,onOk:()=>{u()},width:900,confirmLoading:I,loading:c,children:e.jsxRuntimeExports.jsx(t.Table,{rowKey:"ldap_dn",rowSelection:{onChange:i=>{g(i)},getCheckboxProps:i=>({disabled:i.status==="imported"})},columns:o.map(({render:i,...v})=>i?{...v,render:(x,w,q)=>{const F=f.includes(w.ldap_dn)&&I&&w.status!=="imported";return i(x,w,q,F)}}:v),dataSource:m,pagination:!1,scroll:{y:400,x:"max-content"}})})},me=()=>{var w,q,F;const{t:s}=P.useTranslation("system"),[a]=t.Form.useForm(),[o,V]=R.useState(!1),[d,m]=R.useState(null),[h,f]=R.useState(!1),[g,n]=R.useState(!1),[c]=t.Form.useForm(),[u,I]=R.useState(!1);S.useRequest(y.api.system.getLdapSettings,{onSuccess:j=>{a.setFieldsValue(j),I(j.enabled)},onError:j=>{t.message.error(s("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${j.message}`}))}}),R.useEffect(()=>{m(null)},[h]);const i=async j=>{V(!0);try{await y.api.system.updateLdapSettings(j),t.message.success(s("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{t.message.error(s("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{V(!1)}},{run:v,loading:x}=S.useRequest(async j=>{const U=await a.validateFields();return await y.api.system.testLdapConnection({...j,...U})},{onSuccess:j=>{m(j)},onError:j=>{t.message.error(s("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${j.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Form,{form:a,layout:"vertical",onFinish:i,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:j=>I(j)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:u,message:s("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u,placeholder:"ldap://ldap.example.com:389"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:u,message:s("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:u,message:s("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:u,message:s("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u,placeholder:"dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:u,message:s("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:u,message:s("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:u,message:s("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:u,message:s("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"timeout",label:s("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:s("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",defaultValue:15,disabled:!u})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!u})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:o,children:s("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!u,style:{marginLeft:8},onClick:()=>f(!0),children:s("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["authorization:user:create"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!u,style:{marginLeft:8},onClick:()=>{n(!0)},children:s("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxRuntimeExports.jsxs(t.Modal,{title:s("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:h,onCancel:()=>f(!1),footer:null,children:[e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",onFinish:v,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:s("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!u})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:s("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!u})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!u,type:"primary",htmlType:"submit",children:s("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsxRuntimeExports.jsx(t.Button,{style:{marginLeft:8},onClick:()=>f(!1),children:s("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:x,children:e.jsxRuntimeExports.jsx(t.Skeleton,{active:x,loading:x,children:d&&(d.user?e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Username",span:3,children:d.user.username}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Email",span:3,children:d.user.email}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"FullName",span:3,children:d.user.full_name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"CreatedAt",span:3,children:d.user.created_at}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"UpdatedAt",span:3,children:d.user.updated_at})]}):e.jsxRuntimeExports.jsx(t.Steps,{direction:"vertical",current:(w=d.message)==null?void 0:w.findIndex(j=>!j.success),status:(q=d.message)!=null&&q.find(j=>!j.success)?"error":"finish",items:(F=d.message)==null?void 0:F.map(j=>({status:j.success?"finish":"error",title:j.message}))}))})})]}),e.jsxRuntimeExports.jsx(de,{visible:g,onCancel:()=>n(!1),fetchItems:()=>y.api.system.importLdapUsers({}),importItems:j=>y.api.system.importLdapUsers({user_dn:j}),columns:[{title:s("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:s("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:s("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:s("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(j,U,C,M)=>M?e.jsxRuntimeExports.jsx(t.Spin,{indicator:e.jsxRuntimeExports.jsx(T.LoadingOutlined,{spin:!0})}):j?e.jsxRuntimeExports.jsx(T.CheckCircleTwoTone,{twoToneColor:"#52c41a"}):U.id?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:s("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"green",children:s("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},ce=()=>{const{t:s}=P.useTranslation("system"),{t:a}=P.useTranslation("common"),[o]=t.Form.useForm(),[V,d]=R.useState(null),[m,h]=R.useState(!1),[f]=t.Form.useForm(),[g,n]=R.useState(!1),{loading:c}=S.useRequest(y.api.system.getSmtpSettings,{onSuccess:x=>{o.setFieldsValue(x),n(x.enabled)},onError:x=>{t.message.error(s("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${x.message}`}))}});R.useEffect(()=>{d(null)},[m]);const{run:u,loading:I}=S.useRequest(({port:x,...w})=>y.api.system.updateSmtpSettings({...w,port:Number(x)}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:x=>{t.message.error(s("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${x.message}`}))}}),{run:i,loading:v}=S.useRequest(async x=>{const{port:w,...q}=await o.validateFields();return await y.api.system.testSmtpConnection({...x,...q,port:Number(w)})},{onSuccess:x=>{d(x)},onError:x=>{t.message.error(s("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${x.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Spin,{spinning:c,children:e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:u,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:x=>n(x)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:g,message:s("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!g,placeholder:"smtp.example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:g,message:s("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",disabled:!g,placeholder:"587"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:g,message:s("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!g,placeholder:"user@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!g,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:g,message:s("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxRuntimeExports.jsxs(t.Radio.Group,{disabled:!g,children:[e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"None",children:s("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"SSL/TLS",children:s("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"STARTTLS",children:s("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:g,message:s("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:s("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!g,placeholder:"noreply@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!g,placeholder:s("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsxRuntimeExports.jsx(K,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsxRuntimeExports.jsx(K,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsxRuntimeExports.jsx(K,{theme:"snow"})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:setting:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:I,style:{marginRight:8},children:a("save",{defaultValue:"Save"})})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>h(!0),disabled:!g||v,loading:v,children:s("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:m,onCancel:()=>h(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>h(!1),children:a("cancel",{defaultValue:"Cancel"})},"back"),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",loading:v,onClick:()=>f.submit(),children:s("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxRuntimeExports.jsxs(t.Form,{form:f,layout:"vertical",onFinish:x=>i(x),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:s("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:s("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"test@example.com"})}),V&&e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testResult",{defaultValue:"Test Result"}),children:V.success?e.jsxRuntimeExports.jsx("span",{style:{color:"green"},children:s("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsxRuntimeExports.jsx("span",{style:{color:"red"},children:s("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:V.message})})})]})})]})},pe=()=>{const{t:s,i18n:a}=P.useTranslation("system"),{t:o}=P.useTranslation("common"),[V]=t.Form.useForm(),{loading:d,data:m,refresh:h}=S.useRequest(y.api.system.getSystemBaseSettings,{onSuccess:c=>{V.setFieldsValue(c)},onError:c=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",c)}}),{loading:f,run:g}=S.useRequest(y.api.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),h()},onError:c=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",c)}}),n=c=>{g(c)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:d,children:e.jsxRuntimeExports.jsxs(t.Form,{form:V,layout:"vertical",onFinish:n,initialValues:m,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.name",{defaultValue:"Name"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{items:[{key:"default",label:o("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",children:e.jsxRuntimeExports.jsx(t.Input,{})})})},...N.AllLangUIConfig.map(c=>({key:c.lang,label:a.language!==c.lang?o(`language.${c.lang}`,{defaultValue:c.label,lang:c.label}):c.label,forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:["name_i18n",c.lang],children:e.jsxRuntimeExports.jsx(t.Input,{})})})}))]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:s("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:f,icon:e.jsxRuntimeExports.jsx(T.SaveOutlined,{}),children:o("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>h(),icon:e.jsxRuntimeExports.jsx(T.ReloadOutlined,{}),children:o("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:xe}=t.Input,{Option:he}=t.Select,ge=()=>{const{t:s}=P.useTranslation("ai"),{t:a}=P.useTranslation("common"),[o]=t.Form.useForm(),[V,d]=R.useState(!1),[m,h]=R.useState(null),[f,g]=R.useState(""),[n,c]=R.useState(""),{loading:u,data:I,refresh:i}=S.useRequest(()=>y.api.ai.listAiModels({current:1,page_size:100,search:f}),{refreshDeps:[f],onError:r=>{t.message.error(s("models.fetchFailed",{defaultValue:"Failed to fetch AI models"})),console.error("Failed to fetch AI models:",r)}}),{loading:v,run:x}=S.useRequest(r=>y.api.ai.createAiModel(r),{manual:!0,onSuccess:()=>{t.message.success(s("models.createSuccess",{defaultValue:"AI model created successfully"})),d(!1),o.resetFields(),i()},onError:r=>{t.message.error(s("models.createFailed",{defaultValue:"Failed to create AI model"})),console.error("Failed to create AI model:",r)}}),{loading:w,run:q}=S.useRequest(({id:r,data:A})=>y.api.ai.updateAiModel({id:r},A),{manual:!0,onSuccess:()=>{t.message.success(s("models.updateSuccess",{defaultValue:"AI model updated successfully"})),d(!1),o.resetFields(),h(null),i()},onError:r=>{t.message.error(s("models.updateFailed",{defaultValue:"Failed to update AI model"})),console.error("Failed to update AI model:",r)}}),{run:F}=S.useRequest(r=>y.api.ai.deleteAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.deleteSuccess",{defaultValue:"AI model deleted successfully"})),i()},onError:r=>{t.message.error(s("models.deleteFailed",{defaultValue:"Failed to delete AI model"})),console.error("Failed to delete AI model:",r)}}),{loading:j,run:U}=S.useRequest(r=>y.api.ai.testAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.testSuccess",{defaultValue:"AI model connection test successful"}))},onError:r=>{t.message.error(s("models.testFailed",{defaultValue:"AI model connection test failed"})),console.error("Failed to test AI model:",r)}}),{run:C}=S.useRequest(r=>y.api.ai.setDefaultAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.setDefaultSuccess",{defaultValue:"Default AI model set successfully"})),i()},onError:r=>{t.message.error(s("models.setDefaultFailed",{defaultValue:"Failed to set default AI model"})),console.error("Failed to set default AI model:",r)}}),M=()=>{h(null),o.resetFields(),d(!0)},B=r=>{h(r),o.setFieldsValue({...r,api_key:""}),d(!0)},z=r=>{m?q({id:m.id,data:r}):x(r)},O=r=>{F(r)},p=r=>{c(r),U(r)},k=r=>{C(r)},$=[{title:s("models.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(r,A)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx("span",{children:r}),A.is_default&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.defaultModel",{defaultValue:"Default Model"}),children:e.jsxRuntimeExports.jsx(T.StarFilled,{style:{color:"#faad14"}})})]})},{title:s("models.provider",{defaultValue:"Provider"}),dataIndex:"provider",key:"provider",render:r=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:r.toUpperCase()})},{title:s("models.modelId",{defaultValue:"Model ID"}),dataIndex:"model_id",key:"model_id"},{title:s("models.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:r=>e.jsxRuntimeExports.jsx(t.Tag,{color:r==="enabled"?"green":"red",children:r==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:a("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(r,A)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.test",{defaultValue:"Test Connection"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.CheckCircleOutlined,{}),loading:j&&A.id===n,onClick:()=>p(A.id)})}),!A.is_default&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.setDefault",{defaultValue:"Set as Default"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.StarOutlined,{}),onClick:()=>k(A.id)})}),e.jsxRuntimeExports.jsx(t.Tooltip,{title:a("edit",{defaultValue:"Edit"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.EditOutlined,{}),onClick:()=>B(A)})}),e.jsxRuntimeExports.jsx(t.Popconfirm,{title:s("models.deleteConfirm",{defaultValue:"Are you sure you want to delete this AI model?"}),onConfirm:()=>O(A.id),okText:a("yes",{defaultValue:"Yes"}),cancelText:a("no",{defaultValue:"No"}),children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:a("delete",{defaultValue:"Delete"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",danger:!0,icon:e.jsxRuntimeExports.jsx(T.DeleteOutlined,{})})})})]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("models.searchPlaceholder",{defaultValue:"Search AI models..."}),style:{width:300},value:f,onChange:r=>g(r.target.value),allowClear:!0})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(T.ReloadOutlined,{}),onClick:i,loading:u,children:a("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(T.PlusOutlined,{}),onClick:M,children:s("models.create",{defaultValue:"Create AI Model"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:$,dataSource:(I==null?void 0:I.data)||[],loading:u,rowKey:"id",pagination:{total:(I==null?void 0:I.total)||0,current:(I==null?void 0:I.current)||1,pageSize:(I==null?void 0:I.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(r,A)=>s("common.pagination.total",{defaultValue:`${A[0]}-${A[1]} of ${r} items`,start:A[0],end:A[1],total:r})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:m?s("models.edit",{defaultValue:"Edit AI Model"}):s("models.create",{defaultValue:"Create AI Model"}),open:V,onCancel:()=>{d(!1),o.resetFields(),h(null)},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:z,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("models.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("models.nameRequired",{defaultValue:"Please enter model name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("models.namePlaceholder",{defaultValue:"Enter model name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("models.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(xe,{rows:3,placeholder:s("models.descriptionPlaceholder",{defaultValue:"Enter model description"})})}),e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,children:[e.jsxRuntimeExports.jsx(t.Col,{span:12,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:s("models.provider",{defaultValue:"Provider"}),rules:[{required:!0,message:s("models.providerRequired",{defaultValue:"Please select provider"})}],children:e.jsxRuntimeExports.jsx(t.Select,{placeholder:s("models.providerPlaceholder",{defaultValue:"Select provider"}),children:e.jsxRuntimeExports.jsx(he,{value:"openai",children:"OpenAI"})})})}),e.jsxRuntimeExports.jsx(t.Col,{span:12,children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"model_id",label:s("models.modelId",{defaultValue:"Model ID"}),rules:[{required:!0,message:s("models.modelIdRequired",{defaultValue:"Please enter model ID"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"gpt-4, gpt-3.5-turbo, etc."})})})]}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"api_key",label:s("models.apiKey",{defaultValue:"API Key"}),rules:m?[]:[{required:!0,message:s("models.apiKeyRequired",{defaultValue:"Please enter API key"})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{placeholder:m?s("models.apiKeyPlaceholderEdit",{defaultValue:"Leave empty to keep current API key"}):s("models.apiKeyPlaceholder",{defaultValue:"Enter API key"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"base_url",label:s("models.baseUrl",{defaultValue:"Base URL"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("models.baseUrlPlaceholder",{defaultValue:"Optional: Custom API endpoint"})})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{name:"is_default",valuePropName:"checked",children:[e.jsxRuntimeExports.jsx(t.Switch,{})," ",e.jsxRuntimeExports.jsx("span",{style:{marginLeft:8},children:s("models.setAsDefault",{defaultValue:"Set as default model"})})]}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:v||w,children:m?a("update",{defaultValue:"Update"}):a("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{d(!1),o.resetFields(),h(null)},children:a("cancel",{defaultValue:"Cancel"})})]})})]})})]})},{TextArea:X}=t.Input,{Option:je}=t.Select,fe=()=>{var J;const{t:s}=P.useTranslation("system"),{t:a}=P.useTranslation("common"),[o]=t.Form.useForm(),[V,d]=R.useState(!1),[m,h]=R.useState(null),[f,g]=R.useState(""),[n,c]=R.useState(!1),[u,I]=R.useState(null),[i,v]=R.useState(""),[x,w]=R.useState(""),{loading:q,data:F,refresh:j}=S.useRequest(()=>y.api.toolsets.listToolSets({current:1,page_size:100,search:f}),{refreshDeps:[f],onError:l=>{t.message.error(s("settings.toolsets.fetchFailed",{defaultValue:"Failed to fetch toolsets"})),console.error("Failed to fetch toolsets:",l)}}),{loading:U,data:C}=S.useRequest(()=>y.api.toolsets.getToolSetTypeDefinitions(),{refreshDeps:[],onError:l=>{t.message.error(s("settings.toolsets.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch toolset type definitions"})),console.error("Failed to fetch toolset type definitions:",l)}}),M=R.useMemo(()=>C==null?void 0:C.find(l=>l.tool_set_type===i),[C,i]),{loading:B,run:z}=S.useRequest(l=>y.api.toolsets.createToolSet({...l,type:l.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.createSuccess",{defaultValue:"toolset created successfully"})),d(!1),o.resetFields(),j()},onError:l=>{t.message.error(s("settings.toolsets.createFailed",{defaultValue:"Failed to create toolset"})),console.error("Failed to create toolset:",l)}}),{loading:O,run:p}=S.useRequest(({id:l,data:E})=>y.api.toolsets.updateToolSet({id:l},{...E,type:E.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.updateSuccess",{defaultValue:"toolset updated successfully"})),d(!1),o.resetFields(),h(null),j()},onError:l=>{t.message.error(s("settings.toolsets.updateFailed",{defaultValue:"Failed to update toolset"})),console.error("Failed to update toolset:",l)}}),{run:k}=S.useRequest(l=>y.api.toolsets.deleteToolSet({id:l}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.deleteSuccess",{defaultValue:"toolset deleted successfully"})),j()},onError:l=>{t.message.error(s("settings.toolsets.deleteFailed",{defaultValue:"Failed to delete toolset"})),console.error("Failed to delete toolset:",l)}}),{loading:$,run:r}=S.useRequest(l=>y.api.toolsets.testToolSet({id:l}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.testSuccess",{defaultValue:"toolset connection test successful"}))},onError:l=>{t.message.error(s("settings.toolsets.testFailed",{defaultValue:"toolset connection test failed"})),console.error("Failed to test toolset:",l)}}),A=()=>{h(null),o.resetFields(),v(""),d(!0)},Y=l=>{h(l),v(l.type);const E={...l};if(E.config){const _=C==null?void 0:C.find(b=>b.tool_set_type===l.type);if(_){const b={};_.config_fields.forEach(L=>{var G,Z;L.type==="object"&&((G=E.config)!=null&&G[L.name])?b[L.name]=JSON.stringify(E.config[L.name],null,2):((Z=E.config)==null?void 0:Z[L.name])!==void 0&&(b[L.name]=E.config[L.name])}),E.config=b}}o.setFieldsValue(E),d(!0)};console.log(i,C);const ee=l=>{v(l);const E=C==null?void 0:C.find(_=>_.tool_set_type===l);if(E){const _={};E.config_fields.forEach(b=>{if(b.default)switch(b.type){case"number":_[b.name]=Number(b.default);break;case"boolean":_[b.name]=b.default==="true";break;case"array":_[b.name]=b.default.split(",");break;default:_[b.name]=b.default}}),o.setFieldValue("config",_)}else o.setFieldValue("config",void 0)},te=l=>{if(l.config&&M){const E={};M.config_fields.forEach(_=>{var L;const b=(L=l.config)==null?void 0:L[_.name];if(b!==void 0)if(_.type==="object")try{E[_.name]=typeof b=="string"?JSON.parse(b):b}catch{E[_.name]=b}else E[_.name]=b}),l.config=E}m?p({id:m.id,data:l}):z(l)},se=l=>{k(l)},le=l=>{w(l),r(l)},oe=l=>{I(l),c(!0)},ne=l=>{const E=l.options&&l.options.length>0,_=[{required:l.required,message:s("settings.toolsets.fieldRequired",{defaultValue:`Please enter ${l.name}`,field:l.name})}];if(!E)switch(l.type){case"string":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.placeholder||`${s("common.enter",{defaultValue:"Enter"})} ${l.name}`})})},l.name);case"number":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.InputNumber,{style:{width:"100%"},placeholder:s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.placeholder||`${s("common.enter",{defaultValue:"Enter"})} ${l.name}`})})},l.name);case"boolean":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),valuePropName:"checked",tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Switch,{})},l.name);case"array":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Select,{mode:"tags",style:{width:"100%"},placeholder:s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.placeholder||`${s("common.enter",{defaultValue:"Enter"})} ${l.name}`}),tokenSeparators:[","]})},l.name);case"object":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:[..._,{validator:(b,L)=>{if(!L)return Promise.resolve();try{return JSON.parse(L),Promise.resolve()}catch{return Promise.reject(new Error(s("settings.toolsets.invalidJSON",{defaultValue:"Invalid JSON format"})))}}}],tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltips`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(X,{rows:4,placeholder:s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.placeholder||`${s("common.enter",{defaultValue:"Enter"})} ${l.name} (JSON format)`})})},l.name);case"password":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Input.Password,{placeholder:s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.placeholder||`${s("common.enter",{defaultValue:"Enter"})} ${l.name}`}),autoComplete:"new-password"})},l.name);default:return null}switch(l.type){case"string":case"number":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Select,{allowClear:!0,placeholder:l.placeholder?s(`settings.toolsets.${i}.${l.name}Placeholder`,{defaultValue:l.description}):`${s("common.select",{defaultValue:"Select"})} ${l.name}`,children:l.options.map(b=>e.jsxRuntimeExports.jsx(je,{value:b.value,children:b.label},b.value))})},l.name);case"array":return e.jsxRuntimeExports.jsx(t.Form.Item,{name:["config",l.name],label:s(`settings.toolsets.${i}.${l.name}`,{defaultValue:l.display_name||l.name}),rules:_,tooltip:l.description?s(`settings.toolsets.${i}.${l.name}Tooltip`,{defaultValue:l.description}):void 0,children:e.jsxRuntimeExports.jsx(t.Checkbox.Group,{style:{width:"100%"},children:e.jsxRuntimeExports.jsx(t.Space,{direction:"vertical",children:l.options.map(b=>e.jsxRuntimeExports.jsx(t.Checkbox,{value:b.value,children:b.label},b.value))})})},l.name);default:return null}},ae=[{title:s("settings.toolsets.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.toolsets.type",{defaultValue:"Type"}),dataIndex:"type",key:"type",render:l=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:l.toUpperCase()})},{title:s("settings.toolsets.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:l=>e.jsxRuntimeExports.jsx(t.Tag,{color:l==="enabled"?"green":"red",children:l==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:a("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(l,E)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("settings.toolsets.test",{defaultValue:"Test Connection"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.CheckCircleOutlined,{}),loading:$&&E.id===x,onClick:()=>le(E.id)})}),E.config&&Object.keys(E.config).length>0&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("settings.toolsets.viewConfig",{defaultValue:"View Configuration"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.SettingOutlined,{}),onClick:()=>oe(E.config)})}),e.jsxRuntimeExports.jsx(t.Tooltip,{title:a("edit",{defaultValue:"Edit"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",icon:e.jsxRuntimeExports.jsx(T.EditOutlined,{}),onClick:()=>Y(E)})}),e.jsxRuntimeExports.jsx(t.Popconfirm,{title:s("settings.toolsets.deleteConfirm",{defaultValue:"Are you sure you want to delete this toolset?"}),onConfirm:()=>se(E.id),okText:a("yes",{defaultValue:"Yes"}),cancelText:a("no",{defaultValue:"No"}),children:e.jsxRuntimeExports.jsx(t.Tooltip,{title:a("delete",{defaultValue:"Delete"}),children:e.jsxRuntimeExports.jsx(t.Button,{type:"text",danger:!0,icon:e.jsxRuntimeExports.jsx(T.DeleteOutlined,{})})})})]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("settings.toolsets.searchPlaceholder",{defaultValue:"Search toolsets..."}),style:{width:300},value:f,onChange:l=>g(l.target.value),allowClear:!0})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(T.ReloadOutlined,{}),onClick:j,loading:q,children:a("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(T.PlusOutlined,{}),onClick:A,children:s("settings.toolsets.create",{defaultValue:"Create Toolset"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:ae,dataSource:(F==null?void 0:F.data)||[],loading:q,rowKey:"id",pagination:{total:(F==null?void 0:F.total)||0,current:(F==null?void 0:F.current)||1,pageSize:(F==null?void 0:F.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(l,E)=>s("common.pagination.total",{defaultValue:`${E[0]}-${E[1]} of ${l} items`,start:E[0],end:E[1],total:l})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:m?s("settings.toolsets.edit",{defaultValue:"Edit Toolset"}):s("settings.toolsets.create",{defaultValue:"Create Toolset"}),open:V,onCancel:()=>{d(!1),o.resetFields(),h(null),v("")},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:o,layout:"vertical",onFinish:te,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.toolsets.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("settings.toolsets.nameRequired",{defaultValue:"Please enter toolset name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("settings.toolsets.namePlaceholder",{defaultValue:"Enter toolset name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.toolsets.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(X,{rows:3,placeholder:s("settings.toolsets.descriptionPlaceholder",{defaultValue:"Enter toolset description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"type",label:s("settings.toolsets.type",{defaultValue:"Type"}),rules:[{required:!0,message:s("settings.toolsets.typeRequired",{defaultValue:"Please select type"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:U,placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),onChange:ee,value:i,options:C==null?void 0:C.map(l=>({label:l.name,value:l.tool_set_type}))})}),(J=M==null?void 0:M.config_fields)==null?void 0:J.map(l=>ne(l)),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:B||O,children:m?a("update",{defaultValue:"Update"}):a("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{d(!1),o.resetFields(),h(null),v("")},children:a("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.configuration",{defaultValue:"Configuration"}),open:n,onCancel:()=>c(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>c(!1),children:a("close",{defaultValue:"Close"})},"close")],width:600,children:e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto"},children:JSON.stringify(u,null,2)})})]})},Ee=({transformItems:s=a=>a})=>{const{t:a}=P.useTranslation("system"),o=H.useNavigate(),V=H.useLocation(),h=V.hash.replace("#","")||"base",f=[{key:"base",label:a("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsxRuntimeExports.jsx(pe,{})},{key:"security",label:a("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsxRuntimeExports.jsx(ue,{})},{key:"oauth",label:a("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsxRuntimeExports.jsx(re,{})},{key:"ldap",label:a("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsxRuntimeExports.jsx(me,{})},{key:"smtp",label:a("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsxRuntimeExports.jsx(ce,{})},{key:"ai-models",label:a("settings.tabs.aiModels",{defaultValue:"AI Models"}),children:e.jsxRuntimeExports.jsx(ge,{})},{key:"ai-toolsets",label:a("settings.tabs.toolSets",{defaultValue:"Tool Sets"}),children:e.jsxRuntimeExports.jsx(fe,{})}];return e.jsxRuntimeExports.jsx(t.Card,{title:a("settings.title",{defaultValue:"System Settings"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{defaultActiveKey:h,onChange:g=>{o(`${V.pathname}#${g}`)},items:s(f)})})},Re=Object.freeze(Object.defineProperty({__proto__:null,default:Ee},Symbol.toStringTag,{value:"Module"})),be=()=>{const{t:s}=P.useTranslation("system"),[a]=H.useSearchParams(),o=a.get("provider"),V=a.get("code"),d=a.get("state"),[m,h]=R.useState(null),[f,g]=R.useState(null),[n,c]=R.useState(null);return S.useRequest(async()=>{if(!V||!d||!o)throw new Error(s("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const u=await y.api.system.testOauthCallback({code:V,state:d,provider:o});if(!u.user_info)throw new Error(s("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!u.user)throw new Error(s("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));h(u.user),g(u.user_info)},{onSuccess:()=>{c({status:"success",message:s("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:u=>{c({status:"error",message:s("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:u.message})}}),n?e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(t.Result,{status:n.status,title:n.message,subTitle:n.error,extra:e.jsxRuntimeExports.jsxs(t.Space,{style:{display:!f||!m?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsxRuntimeExports.jsx(Q,{src:f||{}})}),e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsxRuntimeExports.jsx(Q,{src:m||{}})})]})})}):e.jsxRuntimeExports.jsx(N.Loading,{})},Ve=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));exports.OAuthTestCallback=Ve;exports.index=Re;
