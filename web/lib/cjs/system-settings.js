"use strict";const e=require("./vendor.js"),t=require("antd"),U=require("react-i18next"),g=require("react"),S=require("ahooks"),V=require("@ant-design/icons"),F=require("./index.js"),me=require("./base.js"),N=require("./components.js"),Y=require("react-router-dom"),se=require("./system.js"),xe=require("./contexts.js"),ge=require("./authorization.js"),Re=require("antd-style"),ue=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,Ee={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},ye=({initialData:s,onRefresh:i})=>{const{t:l}=U.useTranslation("system"),{t:a}=U.useTranslation("common"),[c]=t.Form.useForm(),[x,R]=g.useState((s==null?void 0:s.provider)||"custom"),[j,y]=g.useState((s==null?void 0:s.provider)==="custom"||(s==null?void 0:s.provider)==="autoDiscover"),[o,p]=g.useState((s==null?void 0:s.enabled)||!1),[f,M]=g.useState((s==null?void 0:s.auto_create_user)||!1),{loading:w,data:v,refresh:E}=S.useRequest(F.api.system.getOauthSettings,{manual:!!s,onSuccess:b=>{c.setFieldsValue(b),R(b.provider),y(b.provider==="custom"||b.provider==="autoDiscover"),p(b.enabled),M(b.auto_create_user)},onError:b=>{t.message.error(l("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",b)}});g.useEffect(()=>{s&&(c.setFieldsValue(s),R(s.provider),y(s.provider==="custom"||s.provider==="autoDiscover"),p(s.enabled),M(s.auto_create_user))},[s,c]);const T=b=>{R(b),y(b==="custom"||b==="autoDiscover");const u=Ee[b];u&&c.setFieldsValue({auth_endpoint:u.endpoints.auth_endpoint,token_endpoint:u.endpoints.token_endpoint,userinfo_endpoint:u.endpoints.userinfo_endpoint,scope:u.scope,email_field:u.email_field,username_field:u.username_field,full_name_field:u.full_name_field,avatar_field:u.avatar_field,role_field:u.role_field,icon_url:u.icon_url,display_name:u.display_name})},I=b=>{p(b)},A=b=>{M(b)},{loading:k,run:$}=S.useRequest(F.api.system.updateOauthSettings,{manual:!0,onSuccess:()=>{t.message.success(l("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),i?i():E()},onError:b=>{t.message.error(l("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",b)}}),P=b=>{$(b)},H=()=>{i?i():E()},{loading:D,run:q}=S.useRequest(async({redirect_uri:b,...u})=>{let O;return b?O=new URL(b):O=new URL(window.location.origin),O.pathname=me.getURL("/system/settings/oauth/test-callback"),O.searchParams.set("provider",x),F.api.system.testOauthConnection({redirect_uri:O.toString(),...u})},{manual:!0,onSuccess:({url:b})=>{window.open(b,"_blank")},onError:b=>{t.message.error(l("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:b.message})),console.error("Failed to test OAuth connection",b)}}),z=()=>x==="custom";return e.jsxRuntimeExports.jsx(t.Spin,{spinning:w,children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",onFinish:P,initialValues:s||v,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"enabled",label:l("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:l("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:I})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:l("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:l("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:o,message:l("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxRuntimeExports.jsxs(t.Select,{onChange:T,disabled:!o,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"github",children:l("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"google",children:l("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"dingtalk",children:l("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"wechat",children:l("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"autoDiscover",children:l("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"custom",children:l("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"display_name",label:l("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:l("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o,placeholder:x!=="custom"?l(`settings.oauth.provider.options.${x}`,{defaultValue:x}):""})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"icon_url",label:l("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:l("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:ue,message:l("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o,placeholder:"https://example.com/icon.png"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_id",label:l("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:l("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:o,message:l("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_secret",label:l("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:l("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:o,message:l("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!o,autoComplete:"new-password",visibilityToggle:!1,placeholder:l("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),z()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auth_endpoint",label:l("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:l("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:o&&x==="custom",message:l("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:ue,message:l("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"wellknown_endpoint",hidden:x!=="autoDiscover",label:l("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:l("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:ue,message:l("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:o&&x==="autoDiscover",message:l("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),z()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"token_endpoint",label:l("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:l("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:o&&x==="custom",message:l("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:ue,message:l("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),z()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"userinfo_endpoint",label:l("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:l("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:o&&x==="custom",message:l("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:ue,message:l("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"scope",label:l("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:l("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:o,message:l("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"redirect_uri",label:l("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:l("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[b=>b.getFieldValue("redirect_uri")!==""?{pattern:ue,message:l("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o,placeholder:`http://${window.location.host}${me.getURL(`/login?provider=settings.${x}`)}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auto_create_user",label:l("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:l("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:A,disabled:!o})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"default_role",label:l("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:l("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:o&&f,message:l("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!o||!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_mapping_mode",label:l("settings.oauth.roleMappingMode.label",{defaultValue:"Role Mapping Mode"}),tooltip:l("settings.oauth.roleMappingMode.tooltip",{defaultValue:"Controls how user roles are synchronized from OAuth2 provider."}),initialValue:"auto",children:e.jsxRuntimeExports.jsxs(t.Select,{disabled:!o,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"disabled",children:l("settings.oauth.roleMappingMode.options.disabled.label",{defaultValue:"Disabled"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"auto",children:l("settings.oauth.roleMappingMode.options.auto.label",{defaultValue:"Auto"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"enforce",children:l("settings.oauth.roleMappingMode.options.enforce.label",{defaultValue:"Enforce"})})]})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:l("settings.oauth.roleMappingMode.infoTitle",{defaultValue:"Role Mapping Mode Information"}),description:e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.disabled.label",{defaultValue:"Disabled"}),":"]})," ",l("settings.oauth.roleMappingMode.options.disabled.description",{defaultValue:"Ignores role information from OAuth2 provider. New users get the default role."})]}),e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.auto.label",{defaultValue:"Auto"}),":"]})," ",l("settings.oauth.roleMappingMode.options.auto.description",{defaultValue:"Uses OAuth2 roles for new users or users without roles, but preserves existing role assignments."})]}),e.jsxRuntimeExports.jsxs("p",{children:[e.jsxRuntimeExports.jsxs("strong",{children:[l("settings.oauth.roleMappingMode.options.enforce.label",{defaultValue:"Enforce"}),":"]})," ",l("settings.oauth.roleMappingMode.options.enforce.description",{defaultValue:"Always overwrites user roles with OAuth2 roles when available."})]})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enabled",label:l("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:l("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!o})}),e.jsxRuntimeExports.jsx(t.Divider,{children:l("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:l("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:j?"":l("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"email_field",label:l("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:l("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"email",disabled:!o||!j})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"username_field",label:l("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:l("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"login",autoComplete:"off",disabled:!o||!j})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"full_name_field",label:l("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:l("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"name",disabled:!o||!j})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"avatar_field",label:l("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:l("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"avatar_url",disabled:!o||!j})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_field",label:l("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:l("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"role",disabled:!o||!j})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:k,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:a("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{loading:D,onClick:async()=>{const b=c.getFieldsValue();q(b)},children:l("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:H,icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:a("refresh",{defaultValue:"Refresh"})})]})})]})})},Ve=()=>{const{t:s}=U.useTranslation("system"),{t:i}=U.useTranslation("common"),[l]=t.Form.useForm(),{loading:a,data:c,refresh:x}=S.useRequest(F.api.system.getSecuritySettings,{onSuccess:o=>{l.setFieldsValue(o)},onError:o=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",o)}}),{loading:R,run:j}=S.useRequest(F.api.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),x()},onError:o=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",o)}}),y=o=>{j(o)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:a,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:y,initialValues:c,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enforced",label:s("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:s("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_complexity",label:s("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:s("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"low",children:s("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"medium",children:s("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"high",children:s("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"very_high",children:s("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_min_length",label:s("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:s("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:6,max:32,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_expiry_days",label:s("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:s("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lock",label:s("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:s("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(o,p)=>o.login_failure_lock!==p.login_failure_lock,children:({getFieldValue:o})=>o("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_attempts",label:s("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:s("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(o,p)=>o.login_failure_lock!==p.login_failure_lock,children:({getFieldValue:o})=>o("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lockout_minutes",label:s("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:s("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_check",label:s("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:s("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(o,p)=>o.history_password_check!==p.history_password_check,children:({getFieldValue:o})=>o("history_password_check")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_count",label:s("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:s("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"inactive_account_lock_days",label:s("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:s("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_timeout_minutes",label:s("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:s("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_idle_timeout_minutes",label:s("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:s("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:R,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:i("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>x(),icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:i("refresh",{defaultValue:"Refresh"})})]})})]})})},be=({fetchItems:s,importItems:i,columns:l,...a})=>{const{t:c}=U.useTranslation("system"),[x,R]=g.useState([]),[j,y]=g.useState([]),{run:o,loading:p}=S.useRequest(s,{onError:w=>{t.message.error(c("settings.ldap.importError",{error:`${w.message}`}))},onSuccess:w=>{R(w)},manual:!0}),{run:f,loading:M}=S.useRequest(async()=>{for(const w of j.filter(v=>{const E=x.find(T=>T.ldap_dn===v);return!(!E||E.status==="imported")})){const v=await i([w]);R(E=>[...E].map(I=>{for(const A of v)if(I.ldap_dn===A.ldap_dn)return{...A,status:"imported"};return I}))}},{manual:!0});return g.useEffect(()=>{a.visible&&(R([]),o(),y([]))},[a.visible]),e.jsxRuntimeExports.jsx(t.Modal,{title:c("settings.ldap.importTitle"),...a,onOk:()=>{f()},width:900,confirmLoading:M,loading:p,children:e.jsxRuntimeExports.jsx(t.Table,{rowKey:"ldap_dn",rowSelection:{onChange:w=>{y(w)},getCheckboxProps:w=>({disabled:w.status==="imported"})},columns:l.map(({render:w,...v})=>w?{...v,render:(E,T,I)=>{const A=j.includes(T.ldap_dn)&&M&&T.status!=="imported";return w(E,T,I,A)}}:v),dataSource:x,pagination:!1,scroll:{y:400,x:"max-content"}})})},Se=()=>{var T,I,A;const{t:s}=U.useTranslation("system"),[i]=t.Form.useForm(),[l,a]=g.useState(!1),[c,x]=g.useState(null),[R,j]=g.useState(!1),[y,o]=g.useState(!1),[p]=t.Form.useForm(),[f,M]=g.useState(!1);S.useRequest(F.api.system.getLdapSettings,{onSuccess:k=>{i.setFieldsValue(k),M(k.enabled)},onError:k=>{t.message.error(s("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${k.message}`}))}}),g.useEffect(()=>{x(null)},[R]);const w=async k=>{a(!0);try{await F.api.system.updateLdapSettings(k),t.message.success(s("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{t.message.error(s("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{a(!1)}},{run:v,loading:E}=S.useRequest(async k=>{const $=await i.validateFields();return await F.api.system.testLdapConnection({...k,...$})},{onSuccess:k=>{x(k)},onError:k=>{t.message.error(s("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${k.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Form,{form:i,layout:"vertical",onFinish:w,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:k=>M(k)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:f,message:s("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"ldap://ldap.example.com:389"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:f,message:s("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:f,message:s("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:f,message:s("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:f,message:s("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:f,message:s("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:f,message:s("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:f,message:s("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"timeout",label:s("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:s("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",defaultValue:15,disabled:!f})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!f})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:l,children:s("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,style:{marginLeft:8},onClick:()=>j(!0),children:s("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["authorization:user:create"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,style:{marginLeft:8},onClick:()=>{o(!0)},children:s("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxRuntimeExports.jsxs(t.Modal,{title:s("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:R,onCancel:()=>j(!1),footer:null,children:[e.jsxRuntimeExports.jsxs(t.Form,{form:p,layout:"vertical",onFinish:v,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:s("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:s("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!f})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!f,type:"primary",htmlType:"submit",children:s("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsxRuntimeExports.jsx(t.Button,{style:{marginLeft:8},onClick:()=>j(!1),children:s("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:E,children:e.jsxRuntimeExports.jsx(t.Skeleton,{active:E,loading:E,children:c&&(c.user?e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Username",span:3,children:c.user.username}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Email",span:3,children:c.user.email}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"FullName",span:3,children:c.user.full_name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"CreatedAt",span:3,children:c.user.created_at}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"UpdatedAt",span:3,children:c.user.updated_at})]}):e.jsxRuntimeExports.jsx(t.Steps,{direction:"vertical",current:(T=c.message)==null?void 0:T.findIndex(k=>!k.success),status:(I=c.message)!=null&&I.find(k=>!k.success)?"error":"finish",items:(A=c.message)==null?void 0:A.map(k=>({status:k.success?"finish":"error",title:k.message}))}))})})]}),e.jsxRuntimeExports.jsx(be,{visible:y,onCancel:()=>o(!1),fetchItems:()=>F.api.system.importLdapUsers({}),importItems:k=>F.api.system.importLdapUsers({user_dn:k}),columns:[{title:s("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:s("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:s("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:s("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(k,$,P,H)=>H?e.jsxRuntimeExports.jsx(t.Spin,{indicator:e.jsxRuntimeExports.jsx(V.LoadingOutlined,{spin:!0})}):k?e.jsxRuntimeExports.jsx(V.CheckCircleTwoTone,{twoToneColor:"#52c41a"}):$.id?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:s("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"green",children:s("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},Fe=()=>{const{t:s}=U.useTranslation("system"),{t:i}=U.useTranslation("common"),[l]=t.Form.useForm(),[a,c]=g.useState(null),[x,R]=g.useState(!1),[j]=t.Form.useForm(),[y,o]=g.useState(!1),{loading:p}=S.useRequest(F.api.system.getSmtpSettings,{onSuccess:E=>{l.setFieldsValue(E),o(E.enabled)},onError:E=>{t.message.error(s("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${E.message}`}))}});g.useEffect(()=>{c(null)},[x]);const{run:f,loading:M}=S.useRequest(({port:E,...T})=>F.api.system.updateSmtpSettings({...T,port:Number(E)}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:E=>{t.message.error(s("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${E.message}`}))}}),{run:w,loading:v}=S.useRequest(async E=>{const{port:T,...I}=await l.validateFields();return await F.api.system.testSmtpConnection({...E,...I,port:Number(T)})},{onSuccess:E=>{c(E)},onError:E=>{t.message.error(s("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${E.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Spin,{spinning:p,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:f,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:E=>o(E)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:y,message:s("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!y,placeholder:"smtp.example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:y,message:s("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",disabled:!y,placeholder:"587"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:y,message:s("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!y,placeholder:"user@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!y,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:y,message:s("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxRuntimeExports.jsxs(t.Radio.Group,{disabled:!y,children:[e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"None",children:s("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"SSL/TLS",children:s("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"STARTTLS",children:s("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:y,message:s("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:s("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!y,placeholder:"noreply@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!y,placeholder:s("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:setting:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:M,style:{marginRight:8},children:i("save",{defaultValue:"Save"})})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>R(!0),disabled:!y||v,loading:v,children:s("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:x,onCancel:()=>R(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>R(!1),children:i("cancel",{defaultValue:"Cancel"})},"back"),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",loading:v,onClick:()=>j.submit(),children:s("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxRuntimeExports.jsxs(t.Form,{form:j,layout:"vertical",onFinish:E=>w(E),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:s("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:s("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"test@example.com"})}),a&&e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testResult",{defaultValue:"Test Result"}),children:a.success?e.jsxRuntimeExports.jsx("span",{style:{color:"green"},children:s("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsxRuntimeExports.jsx("span",{style:{color:"red"},children:s("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:a.message})})})]})})]})},ke=()=>{const{t:s,i18n:i}=U.useTranslation("system"),{t:l}=U.useTranslation("common"),[a]=t.Form.useForm(),{loading:c,data:x,refresh:R}=S.useRequest(F.api.system.getSystemBaseSettings,{onSuccess:p=>{a.setFieldsValue(p)},onError:p=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",p)}}),{loading:j,run:y}=S.useRequest(F.api.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),R()},onError:p=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",p)}}),o=p=>{y(p)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:c,children:e.jsxRuntimeExports.jsxs(t.Form,{form:a,layout:"vertical",onFinish:o,initialValues:x,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.name",{defaultValue:"Name"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{items:[{key:"default",label:l("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",children:e.jsxRuntimeExports.jsx(t.Input,{})})})},...N.AllLangUIConfig.map(p=>({key:p.lang,label:i.language!==p.lang?l(`language.${p.lang}`,{defaultValue:p.label,lang:p.label}):p.label,forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:["name_i18n",p.lang],children:e.jsxRuntimeExports.jsx(t.Input,{})})})}))]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:s("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.enableMultiOrg",{defaultValue:"Enable Multi-Organization"}),name:"enable_multi_org",tooltip:s("settings.base.enableMultiOrgTooltip",{defaultValue:"Enable multi-organization feature. When enabled, organizations can be managed in the Organization Management tab."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:j,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:l("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>R(),icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:l("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:ve}=t.Input,Ie=()=>{var ee;const{t:s}=U.useTranslation("ai"),{t:i}=U.useTranslation("common"),[l]=t.Form.useForm(),[a,c]=g.useState(!1),[x,R]=g.useState(null),[j,y]=g.useState(""),[o,p]=g.useState(""),[f,M]=g.useState({}),{loading:w,data:v}=S.useRequest(()=>F.api.ai.getAiTypeDefinitions(),{refreshDeps:[],onError:m=>{t.message.error(s("models.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch AI type definitions"})),console.error("Failed to fetch AI type definitions:",m)}}),E=g.useMemo(()=>v==null?void 0:v.find(m=>m.provider===o),[v,o]),{loading:T,data:I,refresh:A}=S.useRequest(()=>F.api.ai.listAiModels({current:1,page_size:100,search:j}),{refreshDeps:[j],onError:m=>{t.message.error(s("models.fetchFailed",{defaultValue:"Failed to fetch AI models"})),console.error("Failed to fetch AI models:",m)}}),{loading:k,run:$}=S.useRequest(({config:m,...d})=>F.api.ai.createAiModel({config:m??{},...d}),{manual:!0,onSuccess:()=>{t.message.success(s("models.createSuccess",{defaultValue:"AI model created successfully"})),c(!1),l.resetFields(),A()},onError:m=>{t.message.error(s("models.createFailed",{defaultValue:"Failed to create AI model"})),console.error("Failed to create AI model:",m)}}),{loading:P,run:H}=S.useRequest(({id:m,data:d})=>F.api.ai.updateAiModel({id:m},d),{manual:!0,onSuccess:()=>{t.message.success(s("models.updateSuccess",{defaultValue:"AI model updated successfully"})),c(!1),l.resetFields(),R(null),A()},onError:m=>{t.message.error(s("models.updateFailed",{defaultValue:"Failed to update AI model"})),console.error("Failed to update AI model:",m)}}),{runAsync:D}=S.useRequest(m=>F.api.ai.deleteAiModel({id:m}),{manual:!0,onSuccess:()=>{t.message.success(s("models.deleteSuccess",{defaultValue:"AI model deleted successfully"})),A()},onError:m=>{t.message.error(s("models.deleteFailed",{defaultValue:"Failed to delete AI model"})),console.error("Failed to delete AI model:",m)}}),{runAsync:q}=S.useRequest(m=>F.api.ai.testAiModel({id:m}),{manual:!0,onSuccess:()=>{t.message.success(s("models.testSuccess",{defaultValue:"AI model connection test successful"}))},onError:m=>{t.message.error(s("models.testFailed",{defaultValue:"AI model connection test failed"})),console.error("Failed to test AI model:",m)}}),{runAsync:z}=S.useRequest(m=>F.api.ai.setDefaultAiModel({id:m}),{manual:!0,onSuccess:()=>{t.message.success(s("models.setDefaultSuccess",{defaultValue:"Default AI model set successfully"})),A()},onError:m=>{t.message.error(s("models.setDefaultFailed",{defaultValue:"Failed to set default AI model"})),console.error("Failed to set default AI model:",m)}}),b=()=>{R(null),p(""),M({}),l.resetFields(),c(!0)},u=m=>{R(m),p(m.provider);const d=m.config||{},L={name:m.name,description:m.description,provider:m.provider,is_default:m.is_default,config:d,status:m.status};console.log(L),M(L),l.setFieldsValue(L),c(!0)},O=m=>{p(m),E!=null&&E.config_fields&&E.config_fields.forEach(d=>{l.setFieldValue(d.name,void 0)})},Z=m=>{const d={};E!=null&&E.config_fields&&E.config_fields.forEach(W=>{var X;const K=(X=m.config)==null?void 0:X[W.name];K!=null&&K!==""&&(d[W.name]=K)});const L={name:m.name,description:m.description,provider:m.provider,config:d,is_default:m.is_default,status:m.status};x?H({id:x.id,data:L}):$(L)},J=m=>{var L;if(!((L=m.data_source)!=null&&L.depends_on))return{};const d={};return m.data_source.depends_on.forEach(W=>{d[W]=f[W]}),d},Q=[{title:s("models.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(m,d)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx("span",{children:m}),d.is_default&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.defaultModel",{defaultValue:"Default Model"}),children:e.jsxRuntimeExports.jsx(V.StarFilled,{style:{color:"#faad14"}})})]})},{title:s("models.provider",{defaultValue:"Provider"}),dataIndex:"provider",key:"provider",render:m=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:m.toUpperCase()})},{title:s("models.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:m=>e.jsxRuntimeExports.jsx(t.Tag,{color:m==="enabled"?"green":"red",children:m==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:i("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(m,d)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"test",permission:"ai:models:test",icon:e.jsxRuntimeExports.jsx(V.CheckCircleOutlined,{}),tooltip:s("models.test",{defaultValue:"Test Connection"}),onClick:async()=>q(d.id)},{key:"setDefault",permission:"ai:models:setDefault",icon:e.jsxRuntimeExports.jsx(V.StarOutlined,{}),tooltip:s("models.setDefault",{defaultValue:"Set as Default"}),onClick:async()=>z(d.id)},{key:"update",permission:"ai:models:update",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),tooltip:i("edit",{defaultValue:"Edit"}),onClick:async()=>u(d)},{key:"delete",permission:"ai:models:delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),tooltip:i("delete",{defaultValue:"Delete"}),onClick:async()=>D(d.id),danger:!0}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("models.searchPlaceholder",{defaultValue:"Search AI models..."}),style:{width:300},value:j,onChange:m=>y(m.target.value),allowClear:!0})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:A,loading:T,children:i("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"ai:models:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:b,children:s("models.create",{defaultValue:"Create AI Model"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:Q,dataSource:(I==null?void 0:I.data)||[],loading:T,rowKey:"id",pagination:{total:(I==null?void 0:I.total)||0,current:(I==null?void 0:I.current)||1,pageSize:(I==null?void 0:I.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(m,d)=>s("common.pagination.total",{defaultValue:`${d[0]}-${d[1]} of ${m} items`,start:d[0],end:d[1],total:m})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:x?s("models.edit",{defaultValue:"Edit AI Model"}):s("models.create",{defaultValue:"Create AI Model"}),open:a,onCancel:()=>{c(!1),l.resetFields(),R(null)},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:Z,onValuesChange:(m,d)=>M(d),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("models.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("models.nameRequired",{defaultValue:"Please enter model name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("models.namePlaceholder",{defaultValue:"Enter model name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("models.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(ve,{rows:3,placeholder:s("models.descriptionPlaceholder",{defaultValue:"Enter model description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:s("models.provider",{defaultValue:"Provider"}),rules:[{required:!0,message:s("models.providerRequired",{defaultValue:"Please select provider"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:w,placeholder:s("models.providerPlaceholder",{defaultValue:"Select provider"}),onChange:O,value:o,options:v==null?void 0:v.map(m=>({label:m.name,value:m.provider}))})}),(ee=E==null?void 0:E.config_fields)==null?void 0:ee.map(m=>e.jsxRuntimeExports.jsx(N.DynamicConfigField,{field:m,selectedType:o,dependentValues:J(m),formValues:f},m.name)),e.jsxRuntimeExports.jsxs(t.Form.Item,{name:"is_default",valuePropName:"checked",children:[e.jsxRuntimeExports.jsx(t.Switch,{})," ",e.jsxRuntimeExports.jsx("span",{style:{marginLeft:8},children:s("models.setAsDefault",{defaultValue:"Set as default model"})})]}),e.jsxRuntimeExports.jsx(t.Form.Item,{hidden:!0,name:"status",label:s("models.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:k||P,children:x?i("update",{defaultValue:"Update"}):i("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{c(!1),l.resetFields(),R(null),p(""),M({})},children:i("cancel",{defaultValue:"Cancel"})})]})})]})})]})},{TextArea:Ce}=t.Input,_e=()=>{var de;const{t:s}=U.useTranslation("system"),{t:i}=U.useTranslation("common"),[l]=t.Form.useForm(),[a,c]=g.useState(!1),[x,R]=g.useState(null),[j,y]=g.useState(""),[o,p]=g.useState(!1),[f,M]=g.useState(null),[w,v]=g.useState(""),[E,T]=g.useState(!1),[I,A]=g.useState([]),[k,$]=g.useState({}),[P,H]=g.useState(),{loading:D,data:q,refresh:z}=S.useRequest(()=>F.api.system.listToolSets({current:1,page_size:100,search:j,type:P}),{refreshDeps:[j,P],onError:n=>{t.message.error(s("settings.toolsets.fetchFailed",{defaultValue:"Failed to fetch toolsets"})),console.error("Failed to fetch toolsets:",n)}}),{loading:b,data:u}=S.useRequest(()=>F.api.system.getToolSetTypeDefinitions(),{refreshDeps:[],onError:n=>{t.message.error(s("settings.toolsets.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch toolset type definitions"})),console.error("Failed to fetch toolset type definitions:",n)}}),O=g.useMemo(()=>u==null?void 0:u.find(n=>n.tool_set_type===w),[u,w]),{loading:Z,run:J}=S.useRequest(n=>F.api.system.createToolSet({...n,type:n.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.createSuccess",{defaultValue:"toolset created successfully"})),c(!1),l.resetFields(),z()},onError:n=>{t.message.error(s("settings.toolsets.createFailed",{defaultValue:"Failed to create toolset"})),console.error("Failed to create toolset:",n)}}),{loading:Q,run:ee}=S.useRequest(({id:n,data:r})=>F.api.system.updateToolSet({id:n},{...r,type:r.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.updateSuccess",{defaultValue:"toolset updated successfully"})),c(!1),l.resetFields(),R(null),z()},onError:n=>{t.message.error(s("settings.toolsets.updateFailed",{defaultValue:"Failed to update toolset"})),console.error("Failed to update toolset:",n)}}),{run:m}=S.useRequest(n=>F.api.system.deleteToolSet({id:n}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.deleteSuccess",{defaultValue:"toolset deleted successfully"})),z()},onError:n=>{t.message.error(s("settings.toolsets.deleteFailed",{defaultValue:"Failed to delete toolset"})),console.error("Failed to delete toolset:",n)}}),{runAsync:d}=S.useRequest(n=>F.api.system.testToolSet({id:n}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.testSuccess",{defaultValue:"toolset connection test successful"}))},onError:n=>{t.message.error(s("settings.toolsets.testFailed",{defaultValue:"toolset connection test failed"})),console.error("Failed to test toolset:",n)}}),{loading:L,runAsync:W}=S.useRequest(n=>F.api.system.getToolSetTools({id:n}),{manual:!0,onSuccess:n=>{A(n||[]),T(!0)},onError:n=>{t.message.error(s("settings.toolsets.fetchToolsFailed",{defaultValue:"Failed to fetch tools"})),console.error("Failed to fetch tools:",n)}}),{runAsync:K}=S.useRequest(({id:n,status:r})=>F.api.system.updateToolSetStatus({id:n},{status:r}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),z()},onError:n=>{t.message.error(s("settings.toolsets.statusUpdateFailed",{defaultValue:"Failed to update status"})),console.error("Failed to update status:",n)}}),X=()=>{R(null),l.resetFields(),v(""),c(!0)},le=n=>{R(n),v(n.type);const r={...n};if(r.config){const C=u==null?void 0:u.find(_=>_.tool_set_type===n.type);if(C){const _={};C.config_fields.forEach(G=>{var re,pe;G.type==="object"&&((re=r.config)!=null&&re[G.name])?_[G.name]=JSON.stringify(r.config[G.name],null,2):((pe=r.config)==null?void 0:pe[G.name])!==void 0&&(_[G.name]=r.config[G.name])}),r.config=_}}l.setFieldsValue(r),c(!0)};console.log(w,u);const ae=n=>{v(n);const r=u==null?void 0:u.find(C=>C.tool_set_type===n);if(r){const C={};r.config_fields.forEach(_=>{if(_.default)switch(_.type){case"number":C[_.name]=Number(_.default);break;case"boolean":C[_.name]=_.default==="true";break;case"array":C[_.name]=_.default.split(",");break;default:C[_.name]=_.default}}),l.setFieldValue("config",C)}else l.setFieldValue("config",void 0)},ie=n=>{if(n.config&&O){const r={};O.config_fields.forEach(C=>{var G;const _=(G=n.config)==null?void 0:G[C.name];if(_!==void 0)if(C.type==="object")try{r[C.name]=typeof _=="string"?JSON.parse(_):_}catch{r[C.name]=_}else r[C.name]=_}),n.config=r}x?ee({id:x.id,data:n}):J(n)},ne=n=>{m(n)},h=n=>{M(n),p(!0)},B=n=>{console.log(new Date,"handleToggleStatus");const r=n.status==="enabled"?"disabled":"enabled";return K({id:n.id,status:r}).then(()=>{console.log(new Date,"handleToggleStatus1")})},te=n=>{var C;if(!((C=n.data_source)!=null&&C.depends_on)||n.data_source.depends_on.length===0)return{};const r={};return n.data_source.depends_on.forEach(_=>{var re;const G=(re=k.config)==null?void 0:re[_];G!==void 0&&(r[_]=G)}),r};console.log(q);const oe=[{title:s("settings.toolsets.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.toolsets.type",{defaultValue:"Type"}),dataIndex:"type",key:"type",render:n=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:n.toUpperCase()})},{title:s("settings.toolsets.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:n=>e.jsxRuntimeExports.jsx(t.Tag,{color:n==="enabled"?"green":"red",children:n==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:i("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(n,r)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"test",permission:"system:toolsets:test",tooltip:s("settings.toolsets.test",{defaultValue:"Test Connection"}),icon:e.jsxRuntimeExports.jsx(V.ThunderboltOutlined,{}),disabled:r.status!=="enabled",onClick:async()=>d(r.id)},{key:"viewTools",icon:e.jsxRuntimeExports.jsx(V.ToolOutlined,{}),permission:"system:toolsets:view",disabled:r.status!=="enabled",tooltip:s("settings.toolsets.viewTools",{defaultValue:"View Tools"}),onClick:async()=>W(r.id)},{key:"viewConfig",icon:e.jsxRuntimeExports.jsx(V.SettingOutlined,{}),permission:"system:toolsets:view",tooltip:s("settings.toolsets.viewConfig",{defaultValue:"View Configuration"}),onClick:async()=>h(r.config),disabled:!r.config},{key:"edit",permission:"system:toolsets:update",tooltip:s("settings.toolsets.edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>le(r)},{key:"toggleStatus",icon:r.status==="enabled"?e.jsxRuntimeExports.jsx(V.LockOutlined,{}):e.jsxRuntimeExports.jsx(V.CheckCircleOutlined,{}),onClick:async()=>B(r),permission:"system:toolsets:update",tooltip:r.status==="enabled"?i("disable",{defaultValue:"Disable"}):i("enable",{defaultValue:"Enable"})},{key:"delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),permission:"system:toolsets:delete",tooltip:i("delete",{defaultValue:"Delete"}),onClick:async()=>ne(r.id),danger:!0,confirm:{title:s("settings.toolsets.deleteConfirm",{defaultValue:"Are you sure you want to delete this toolset?"}),onConfirm:async()=>ne(r.id),okText:i("confirm",{defaultValue:"Confirm"}),cancelText:i("cancel",{defaultValue:"Cancel"})}}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("settings.toolsets.searchPlaceholder",{defaultValue:"Search toolsets..."}),style:{width:300},value:j,onChange:n=>y(n.target.value),allowClear:!0}),e.jsxRuntimeExports.jsxs(t.Select,{placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),value:P,onChange:n=>H(n),options:u==null?void 0:u.map(n=>({label:n.name,value:n.tool_set_type})),style:{minWidth:110},allowClear:!0,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"",children:"All"}),u==null?void 0:u.map(n=>e.jsxRuntimeExports.jsx(t.Select.Option,{value:n.tool_set_type,children:n.name},n.tool_set_type))]})]})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:z,loading:D,children:i("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:toolsets:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:X,children:s("settings.toolsets.create",{defaultValue:"Create Toolset"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:oe,dataSource:(q==null?void 0:q.data)||[],loading:D,rowKey:"id",pagination:{total:(q==null?void 0:q.total)||0,current:(q==null?void 0:q.current)||1,pageSize:(q==null?void 0:q.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,r)=>s("common.pagination.total",{defaultValue:`${r[0]}-${r[1]} of ${n} items`,start:r[0],end:r[1],total:n})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:x?s("settings.toolsets.edit",{defaultValue:"Edit Toolset"}):s("settings.toolsets.create",{defaultValue:"Create Toolset"}),open:a,onCancel:()=>{c(!1),l.resetFields(),R(null),v("")},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:ie,onValuesChange:(n,r)=>$(r),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.toolsets.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("settings.toolsets.nameRequired",{defaultValue:"Please enter toolset name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("settings.toolsets.namePlaceholder",{defaultValue:"Enter toolset name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.toolsets.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Ce,{rows:3,placeholder:s("settings.toolsets.descriptionPlaceholder",{defaultValue:"Enter toolset description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"type",label:s("settings.toolsets.type",{defaultValue:"Type"}),rules:[{required:!0,message:s("settings.toolsets.typeRequired",{defaultValue:"Please select type"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:b,placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),onChange:ae,value:w,options:u==null?void 0:u.map(n=>({label:n.name,value:n.tool_set_type}))})}),(de=O==null?void 0:O.config_fields)==null?void 0:de.map(n=>e.jsxRuntimeExports.jsx(N.DynamicConfigField,{field:n,selectedType:w,dependentValues:te(n),formValues:k},n.name)),e.jsxRuntimeExports.jsx(t.Form.Item,{hidden:!0,name:"status",label:s("settings.toolsets.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:Z||Q,children:x?i("update",{defaultValue:"Update"}):i("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{c(!1),l.resetFields(),R(null),v("")},children:i("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.configuration",{defaultValue:"Configuration"}),open:o,onCancel:()=>p(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>p(!1),children:i("close",{defaultValue:"Close"})},"close")],width:600,children:e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto"},children:JSON.stringify(f,null,2)})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.tools",{defaultValue:"Tools"}),open:E,onCancel:()=>T(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>T(!1),children:i("close",{defaultValue:"Close"})},"close")],width:800,children:e.jsxRuntimeExports.jsx("div",{style:{maxHeight:"600px",overflow:"auto"},children:L?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40},children:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{style:{fontSize:24},spin:!0})}):I.length===0?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40,color:"#999"},children:s("settings.toolsets.noTools",{defaultValue:"No tools available"})}):I.map((n,r)=>{var C,_,G;return e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(V.ToolOutlined,{}),e.jsxRuntimeExports.jsx("strong",{children:((C=n.function)==null?void 0:C.name)||"Unknown"})]}),children:e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,children:[e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.description",{defaultValue:"Description"}),":"]})}),e.jsxRuntimeExports.jsx("p",{style:{marginBottom:16},children:((_=n.function)==null?void 0:_.description)||"-"})]}),((G=n.function)==null?void 0:G.parameters)&&e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.parameters",{defaultValue:"Parameters"}),":"]})}),e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto",fontSize:12},children:JSON.stringify(n.function.parameters,null,2)})]})]})},r)})})})]})},{TextArea:fe}=t.Input,we=()=>{const{t:s}=U.useTranslation("system"),{t:i}=U.useTranslation("common"),l=Y.useNavigate(),[a]=t.Form.useForm(),[c,x]=g.useState(""),[R,j]=g.useState(),[y,o]=g.useState(!1),[p,f]=g.useState(null),[M,w]=g.useState(!1),[v]=t.Form.useForm(),{loading:E,data:T,refresh:I}=S.useRequest(()=>F.api.system.listSkills({current:1,page_size:100,search:c||void 0,domain:R}),{refreshDeps:[c,R],onError:()=>{t.message.error(s("settings.skills.fetchFailed",{defaultValue:"Failed to fetch skills"}))}}),{data:A}=S.useRequest(()=>F.api.system.listSkillDomains()),k=A??[],$=(T==null?void 0:T.data)??[],P=(T==null?void 0:T.total)??0,{loading:H,run:D}=S.useRequest(d=>F.api.system.createSkill(d),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.createSuccess",{defaultValue:"Skill created"})),o(!1),a.resetFields(),I()},onError:()=>{t.message.error(s("settings.skills.createFailed",{defaultValue:"Failed to create skill"}))}}),{loading:q,run:z}=S.useRequest(({id:d,body:L})=>F.api.system.updateSkill({id:d},L),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.updateSuccess",{defaultValue:"Skill updated"})),o(!1),f(null),a.resetFields(),I()},onError:()=>{t.message.error(s("settings.skills.updateFailed",{defaultValue:"Failed to update skill"}))}}),{run:b}=S.useRequest(d=>F.api.system.deleteSkill({id:d}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.deleteSuccess",{defaultValue:"Skill deleted"})),I()},onError:()=>{t.message.error(s("settings.skills.deleteFailed",{defaultValue:"Failed to delete skill"}))}}),{loading:u,run:O}=S.useRequest(d=>F.api.system.uploadSkill(d.body,d.file),{manual:!0,onSuccess:()=>{t.message.success(s("settings.skills.uploadSuccess",{defaultValue:"Skill uploaded"})),w(!1),v.resetFields(),I()},onError:()=>{t.message.error(s("settings.skills.uploadFailed",{defaultValue:"Upload failed"}))}}),Z=()=>{f(null),a.resetFields(),o(!0)},J=d=>{f(d),a.setFieldsValue({name:d.name,description:d.description,category:d.category,domain:d.domain}),o(!0)},Q=()=>{a.validateFields().then(d=>{p?z({id:p.id,body:{name:d.name,description:d.description??"",category:d.category??"",domain:d.domain??""}}):D({name:d.name,description:d.description??"",category:d.category??"",domain:d.domain??"",content:d.content??""})})},ee=()=>{var X,le;const d=(X=v.getFieldValue("file"))==null?void 0:X.fileList,L=((le=d==null?void 0:d[0])==null?void 0:le.originFileObj)??(d==null?void 0:d[0]);if(!L){t.message.error(s("settings.skills.selectFile",{defaultValue:"Please select a file"}));return}const W=v.getFieldValue("category"),K=v.getFieldValue("domain");O({body:{category:W,domain:K},file:L})},m=[{title:s("settings.skills.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.skills.description",{defaultValue:"Description"}),dataIndex:"description",key:"description",ellipsis:!0},{title:s("settings.skills.category",{defaultValue:"Category"}),dataIndex:"category",key:"category",render:d=>d?e.jsxRuntimeExports.jsx(t.Tag,{children:d}):"-"},{title:s("settings.skills.domain",{defaultValue:"Domain"}),dataIndex:"domain",key:"domain",render:d=>d?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:d}):"-"},{title:i("actions",{defaultValue:"Actions"}),key:"actions",render:(d,L)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:edit_files",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.FileTextOutlined,{}),onClick:()=>l(`/system/settings/skills/${L.id}/edit`),children:s("settings.skills.editFiles",{defaultValue:"Edit files"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:view",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.EyeOutlined,{}),onClick:()=>l(`/system/settings/skills/${L.id}/preview`),children:i("preview",{defaultValue:"Preview"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:()=>J(L),children:i("edit",{defaultValue:"Edit"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:delete",children:e.jsxRuntimeExports.jsx(t.Button,{type:"link",size:"small",danger:!0,icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),onClick:()=>t.Modal.confirm({title:i("confirmDelete",{defaultValue:"Confirm delete?"}),onOk:()=>b(L.id)}),children:i("delete",{defaultValue:"Delete"})})})]})}];return e.jsxRuntimeExports.jsxs(t.Card,{title:s("settings.skills.title",{defaultValue:"AI Agent Skills"}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:i("search",{defaultValue:"Search"}),allowClear:!0,onSearch:x,style:{width:200}}),e.jsxRuntimeExports.jsx(t.Select,{placeholder:s("settings.skills.domain",{defaultValue:"Domain"}),allowClear:!0,style:{width:120},value:R,onChange:j,options:k.map(d=>({value:d,label:d}))}),e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:()=>I(),children:i("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:Z,children:s("settings.skills.create",{defaultValue:"Create skill"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:skills:create",children:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.UploadOutlined,{}),onClick:()=>w(!0),children:s("settings.skills.upload",{defaultValue:"Upload"})})})]}),children:[e.jsxRuntimeExports.jsx(t.Table,{rowKey:"id",loading:E,columns:m,dataSource:$,pagination:{total:P,pageSize:10,showSizeChanger:!0}}),e.jsxRuntimeExports.jsx(t.Modal,{title:p?s("settings.skills.editSkill",{defaultValue:"Edit skill"}):s("settings.skills.createSkill",{defaultValue:"Create skill"}),open:y,onOk:Q,onCancel:()=>{o(!1),f(null)},confirmLoading:H||q,width:560,children:e.jsxRuntimeExports.jsxs(t.Form,{form:a,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.skills.name",{defaultValue:"Name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.skills.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(fe,{rows:2})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"category",label:s("settings.skills.category",{defaultValue:"Category"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"domain",label:s("settings.skills.domain",{defaultValue:"Domain"}),children:e.jsxRuntimeExports.jsx(t.Select,{allowClear:!0,placeholder:i("optional",{defaultValue:"Optional"}),options:k.map(d=>({value:d,label:d}))})}),!p&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"content",label:s("settings.skills.initialContent",{defaultValue:"Initial SKILL.md content (optional)"}),children:e.jsxRuntimeExports.jsx(fe,{rows:6,placeholder:`---
name: my-skill
description: ...
---

# My Skill`})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.skills.upload",{defaultValue:"Upload skill"}),open:M,onOk:ee,onCancel:()=>w(!1),confirmLoading:u,children:e.jsxRuntimeExports.jsxs(t.Form,{form:v,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"file",label:s("settings.skills.file",{defaultValue:"File (.md or .zip)"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Upload,{maxCount:1,beforeUpload:()=>!1,accept:".md,.zip",children:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.UploadOutlined,{}),children:i("selectFile",{defaultValue:"Select file"})})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"category",label:s("settings.skills.category",{defaultValue:"Category"}),children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"domain",label:s("settings.skills.domain",{defaultValue:"Domain"}),children:e.jsxRuntimeExports.jsx(t.Select,{allowClear:!0,placeholder:i("optional",{defaultValue:"Optional"}),options:k.map(d=>({value:d,label:d}))})})]})})]})},Te=()=>{const{t:s}=U.useTranslation("system"),{t:i}=U.useTranslation("common"),[l]=t.Form.useForm(),{loading:a,refresh:c}=S.useRequest(F.api.system.getTaskSettings,{onSuccess:y=>{y&&l.setFieldsValue({max_concurrent:y.max_concurrent})},onError:()=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"}))}}),{loading:x,run:R}=S.useRequest(F.api.system.updateTaskSettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),c()},onError:()=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"}))}}),j=y=>{R(y)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:a,children:e.jsxRuntimeExports.jsxs(t.Form,{form:l,layout:"vertical",onFinish:j,initialValues:{max_concurrent:10},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"max_concurrent",label:s("settings.task.maxConcurrent",{defaultValue:"Max concurrent tasks"}),tooltip:s("settings.task.maxConcurrentTooltip",{defaultValue:"Maximum number of tasks that can run at the same time."}),rules:[{type:"number",min:1,max:100}],children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:100,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:x,icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),children:i("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>c(),icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),children:i("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:Ae}=t.Input,Oe=()=>{const s=Y.useNavigate(),{t:i}=U.useTranslation("system"),{t:l}=U.useTranslation("common"),[a]=t.Form.useForm(),[c,x]=g.useState(!1),[R,j]=g.useState(null),[y,o]=g.useState(""),[p,f]=g.useState(1),[M,w]=g.useState(10),{loading:v,data:E,refresh:T}=S.useRequest(()=>se.listOrganizations({current:p,page_size:M,search:y}),{refreshDeps:[p,M,y],onError:u=>{t.message.error(i("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organizations"})),console.error("Failed to fetch organizations:",u)}}),{loading:I,run:A}=S.useRequest(u=>se.createOrganization(u),{manual:!0,onSuccess:()=>{t.message.success(i("settings.organizations.createSuccess",{defaultValue:"Organization created successfully"})),x(!1),a.resetFields(),j(null),T()},onError:u=>{t.message.error((u==null?void 0:u.err)||i("settings.organizations.createFailed",{defaultValue:"Failed to create organization"}))}}),{loading:k,run:$}=S.useRequest(({id:u,...O})=>se.updateOrganization({id:u},O),{manual:!0,onSuccess:()=>{t.message.success(i("settings.organizations.updateSuccess",{defaultValue:"Organization updated successfully"})),x(!1),a.resetFields(),j(null),T()},onError:u=>{t.message.error((u==null?void 0:u.err)||i("settings.organizations.updateFailed",{defaultValue:"Failed to update organization"}))}}),{run:P}=S.useRequest(u=>se.deleteOrganization({id:u}),{manual:!0,onSuccess:()=>{t.message.success(i("settings.organizations.deleteSuccess",{defaultValue:"Organization deleted successfully"})),T()},onError:u=>{t.message.error((u==null?void 0:u.err)||i("settings.organizations.deleteFailed",{defaultValue:"Failed to delete organization"}))}}),H=()=>{j(null),a.resetFields(),a.setFieldsValue({status:"active"}),x(!0)},D=u=>{j(u),a.setFieldsValue({name:u.name,description:u.description,status:u.status}),x(!0)},q=u=>{t.Modal.confirm({title:i("settings.organizations.deleteConfirm",{defaultValue:"Delete Organization"}),content:i("settings.organizations.deleteConfirmContent",{defaultValue:`Are you sure you want to delete organization "${u.name}"? This action cannot be undone.`}),onOk:()=>P(u.id)})},z=()=>{a.validateFields().then(u=>{R?$({id:R.id,...u}):A(u)})},b=[{title:i("settings.organizations.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:i("settings.organizations.description",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:i("settings.organizations.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:u=>e.jsxRuntimeExports.jsx(t.Tag,{color:u==="active"?"green":"default",children:u==="active"?i("settings.organizations.active",{defaultValue:"Active"}):i("settings.organizations.disabled",{defaultValue:"Disabled"})})},{title:l("actions",{defaultValue:"Actions"}),key:"actions",render:(u,O)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"view",label:l("view",{defaultValue:"View"}),icon:e.jsxRuntimeExports.jsx(V.EyeOutlined,{}),onClick:async()=>s(`/system/settings/organizations/${O.id}`),permission:"system:organization:view"},{key:"edit",label:l("edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>D(O),permission:"system:organization:update"},{key:"delete",label:l("delete",{defaultValue:"Delete"}),icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),danger:!0,onClick:async()=>q(O),permission:"system:organization:delete"}]})}];return e.jsxRuntimeExports.jsxs(t.Card,{title:i("settings.organizations.title",{defaultValue:"Organization Management"}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:T,children:l("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:organization:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:H,children:i("settings.organizations.create",{defaultValue:"Create Organization"})})})]}),children:[e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:i("settings.organizations.searchPlaceholder",{defaultValue:"Search organizations..."}),allowClear:!0,onSearch:u=>{o(u),f(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:b,dataSource:(E==null?void 0:E.data)||[],loading:v,rowKey:"id",pagination:{current:p,pageSize:M,total:(E==null?void 0:E.total)||0,showSizeChanger:!0,showTotal:(u,O)=>i("common.pagination.total",{defaultValue:`${O[0]}-${O[1]} of ${u} items`,start:O[0],end:O[1],total:u}),onChange:(u,O)=>{f(u),w(O)}}})]}),e.jsxRuntimeExports.jsx(t.Modal,{title:R?i("settings.organizations.edit",{defaultValue:"Edit Organization"}):i("settings.organizations.create",{defaultValue:"Create Organization"}),open:c,onOk:z,onCancel:()=>{x(!1),a.resetFields(),j(null)},confirmLoading:I||k,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:a,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:i("settings.organizations.name",{defaultValue:"Name"}),rules:[{required:!0,message:i("settings.organizations.nameRequired",{defaultValue:"Please enter organization name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:i("settings.organizations.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Ae,{rows:3})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:i("settings.organizations.status",{defaultValue:"Status"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"active",children:i("settings.organizations.active",{defaultValue:"Active"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"disabled",children:i("settings.organizations.disabled",{defaultValue:"Disabled"})})]})})]})})]})},ze=({transformItems:s=i=>i})=>{const{t:i}=U.useTranslation("system"),l=Y.useNavigate(),a=Y.useLocation(),R=a.hash.replace("#","")||"base",{enableMultiOrg:j}=xe.useSite(),{hasPermission:y}=xe.usePermission(),o=[{key:"base",label:i("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsxRuntimeExports.jsx(ke,{}),hidden:!y("system:settings:update")},{key:"security",label:i("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsxRuntimeExports.jsx(Ve,{}),hidden:!y("system:security:update")},{key:"oauth",label:i("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsxRuntimeExports.jsx(ye,{}),hidden:!y("system:settings:update")},{key:"ldap",label:i("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsxRuntimeExports.jsx(Se,{}),hidden:!y("system:settings:update")},{key:"smtp",label:i("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsxRuntimeExports.jsx(Fe,{}),hidden:!y("system:settings:update")},{key:"ai-models",label:i("settings.tabs.aiModels",{defaultValue:"AI Models"}),children:e.jsxRuntimeExports.jsx(Ie,{}),hidden:!y("ai:models:view")},{key:"ai-toolsets",label:i("settings.tabs.toolSets",{defaultValue:"Tool Sets"}),children:e.jsxRuntimeExports.jsx(_e,{}),hidden:!y("system:toolsets:view")},{key:"skills",label:i("settings.tabs.skills",{defaultValue:"Skills"}),children:e.jsxRuntimeExports.jsx(we,{}),hidden:!y("system:skills:view")},{key:"task",label:i("settings.tabs.task",{defaultValue:"Task Settings"}),children:e.jsxRuntimeExports.jsx(Te,{}),hidden:!y("system:settings:update")},...j?[{key:"organizations",label:i("settings.tabs.organizations",{defaultValue:"Organizations"}),children:e.jsxRuntimeExports.jsx(Oe,{}),hidden:!y("system:organization:view")}]:[]];return e.jsxRuntimeExports.jsx(t.Card,{title:i("settings.title",{defaultValue:"System Settings"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{defaultActiveKey:R,onChange:p=>{l(`${a.pathname}#${p}`)},items:s(o.filter(p=>!p.hidden),i)})})},Me=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"})),qe=()=>{var ae,ie,ne;const s=Y.useNavigate(),{id:i}=Y.useParams(),{t:l}=U.useTranslation("system"),{t:a}=U.useTranslation("common"),[c]=t.Form.useForm(),[x]=t.Form.useForm(),[R,j]=g.useState(!1),[y,o]=g.useState(!1),[p,f]=g.useState(null),[M,w]=g.useState(""),[v,E]=g.useState(1),[T,I]=g.useState(10),{data:A,loading:k,refresh:$}=S.useRequest(()=>se.getOrganization({id:i}),{ready:!!i,onError:h=>{t.message.error(l("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organization"})),console.error("Failed to fetch organization:",h)}}),{data:P,loading:H,refresh:D}=S.useRequest(()=>se.listOrganizationUsers({id:i,current:v,page_size:T,search:M}),{ready:!!i,refreshDeps:[i,v,T,M],onError:h=>{t.message.error(l("settings.organizations.users.fetchFailed",{defaultValue:"Failed to fetch organization users"})),console.error("Failed to fetch organization users:",h)}}),{data:q,loading:z}=S.useRequest(()=>ge.listUsers({current:1,page_size:1e3}),{ready:R}),{data:b,loading:u}=S.useRequest(()=>ge.listRoles({organization_id:i,current:1,page_size:1e3}),{ready:!!i}),{loading:O,run:Z}=S.useRequest(h=>se.addUserToOrganization({id:i},h),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.addSuccess",{defaultValue:"User added to organization successfully"})),j(!1),c.resetFields(),D()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.addFailed",{defaultValue:"Failed to add user to organization"}))}}),{loading:J,run:Q}=S.useRequest(h=>se.updateUserOrganizationRoles({id:i,user_id:p==null?void 0:p.id},h),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.updateRolesSuccess",{defaultValue:"User roles updated successfully"})),o(!1),x.resetFields(),f(null),D()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.updateRolesFailed",{defaultValue:"Failed to update user roles"}))}}),{run:ee}=S.useRequest(h=>se.removeUserFromOrganization({id:i,user_id:h}),{manual:!0,onSuccess:()=>{t.message.success(l("settings.organizations.users.removeSuccess",{defaultValue:"User removed from organization successfully"})),D()},onError:h=>{t.message.error((h==null?void 0:h.err)||l("settings.organizations.users.removeFailed",{defaultValue:"Failed to remove user from organization"}))}}),m=()=>{j(!0),c.resetFields()},d=h=>{var B;f(h),x.setFieldsValue({role_ids:((B=h.organization_roles)==null?void 0:B.map(te=>te.id))||[]}),o(!0)},L=h=>{t.Modal.confirm({title:l("settings.organizations.users.removeConfirm",{defaultValue:"Remove User"}),content:l("settings.organizations.users.removeConfirmContent",{defaultValue:`Are you sure you want to remove user "${h.full_name||h.username}" from this organization? This will also remove all their roles in this organization.`}),onOk:()=>ee(h.id)})},W=()=>{c.validateFields().then(h=>{Z(h)})},K=()=>{x.validateFields().then(h=>{Q(h)})},X=((ae=q==null?void 0:q.data)==null?void 0:ae.filter(h=>{var B;return!((B=P==null?void 0:P.data)!=null&&B.some(te=>te.id===h.id))}))||[],le=[{title:l("settings.organizations.users.username",{defaultValue:"Username"}),dataIndex:"username",key:"username"},{title:l("settings.organizations.users.email",{defaultValue:"Email"}),dataIndex:"email",key:"email"},{title:l("settings.organizations.users.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name",key:"full_name"},{title:l("settings.organizations.users.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:h=>e.jsxRuntimeExports.jsx(t.Tag,{color:h==="active"?"green":"default",children:h==="active"?l("settings.organizations.active",{defaultValue:"Active"}):h})},{title:l("settings.organizations.users.roles",{defaultValue:"Roles"}),key:"roles",render:(h,B)=>{var te;return e.jsxRuntimeExports.jsx(t.Space,{wrap:!0,children:((te=B.organization_roles)==null?void 0:te.map(oe=>e.jsxRuntimeExports.jsx(t.Tag,{children:oe.name},oe.id)))||e.jsxRuntimeExports.jsx(t.Tag,{children:"No roles"})})}},{title:a("actions",{defaultValue:"Actions"}),key:"actions",render:(h,B)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"edit",label:l("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),onClick:async()=>d(B)},{key:"delete",label:l("settings.organizations.users.remove",{defaultValue:"Remove"}),icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),danger:!0,onClick:async()=>L(B)}]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ArrowLeftOutlined,{}),onClick:()=>s("/system/settings#organizations"),children:a("back",{defaultValue:"Back"})}),e.jsxRuntimeExports.jsxs("span",{children:[l("settings.organizations.detail",{defaultValue:"Organization Detail"}),": ",A==null?void 0:A.name]})]}),extra:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(V.ReloadOutlined,{}),onClick:()=>{$(),D()},children:a("refresh",{defaultValue:"Refresh"})}),loading:k,children:e.jsxRuntimeExports.jsxs(t.Descriptions,{column:2,bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.name",{defaultValue:"Name"}),children:A==null?void 0:A.name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Tag,{color:(A==null?void 0:A.status)==="active"?"green":"default",children:(A==null?void 0:A.status)==="active"?l("settings.organizations.active",{defaultValue:"Active"}):l("settings.organizations.disabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:l("settings.organizations.description",{defaultValue:"Description"}),span:2,children:(A==null?void 0:A.description)||"-"})]})}),e.jsxRuntimeExports.jsx(t.Card,{title:l("settings.organizations.users.title",{defaultValue:"Organization Users"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:m,children:l("settings.organizations.users.add",{defaultValue:"Add User"})}),style:{marginTop:16},children:e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:l("settings.organizations.users.searchPlaceholder",{defaultValue:"Search users..."}),allowClear:!0,onSearch:h=>{w(h),E(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:le,dataSource:(P==null?void 0:P.data)||[],loading:H,rowKey:"id",pagination:{current:v,pageSize:T,total:(P==null?void 0:P.total)||0,showSizeChanger:!0,showTotal:h=>a("pagination.total",{defaultValue:`Total ${h} items`}),onChange:(h,B)=>{E(h),I(B)}}})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.organizations.users.add",{defaultValue:"Add User"}),open:R,onOk:W,onCancel:()=>{j(!1),c.resetFields()},confirmLoading:O,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"user_id",label:l("settings.organizations.users.user",{defaultValue:"User"}),rules:[{required:!0,message:l("settings.organizations.users.userRequired",{defaultValue:"Please select a user"})}],children:e.jsxRuntimeExports.jsx(t.Select,{showSearch:!0,placeholder:l("settings.organizations.users.selectUser",{defaultValue:"Select a user"}),loading:z,filterOption:(h,B)=>((B==null?void 0:B.label)??"").toLowerCase().includes(h.toLowerCase()),options:X.map(h=>({label:`${h.full_name||h.username} (${h.email})`,value:h.id}))})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:l("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:l("settings.organizations.users.selectRoles",{defaultValue:"Select roles (optional)"}),loading:u,options:((ie=b==null?void 0:b.data)==null?void 0:ie.map(h=>({label:h.name,value:h.id})))||[]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:l("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),open:y,onOk:K,onCancel:()=>{o(!1),x.resetFields(),f(null)},confirmLoading:J,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:x,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:l("settings.organizations.users.user",{defaultValue:"User"}),children:e.jsxRuntimeExports.jsx(t.Input,{value:(p==null?void 0:p.full_name)||(p==null?void 0:p.username),disabled:!0})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:l("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:l("settings.organizations.users.selectRoles",{defaultValue:"Select roles"}),loading:u,options:((ne=b==null?void 0:b.data)==null?void 0:ne.map(h=>({label:h.name,value:h.id})))||[]})})]})})]})},Pe=Object.freeze(Object.defineProperty({__proto__:null,default:qe},Symbol.toStringTag,{value:"Module"})),Le=Re.createStyles(({css:s})=>({fileTree:s`
    .ant-tree-node-content-wrapper{
      padding-inline: 0px;
    }
    .ant-tree-draggable-icon{
      display: none;
    }
    `})),{TextArea:he}=t.Input,Ue=s=>s.toLowerCase().endsWith(".md");function je(s){return s.map(i=>{var l;return{key:i.path,title:i.name,isLeaf:!i.is_dir,icon:i.is_dir?e.jsxRuntimeExports.jsx(V.FolderOutlined,{}):e.jsxRuntimeExports.jsx(V.FileOutlined,{}),children:(l=i.children)!=null&&l.length?je(i.children):void 0}})}function ce(s){return s.includes("/")?s.replace(/\/[^/]+$/,""):""}const Ne=()=>{const{styles:s}=Le(),{id:i}=Y.useParams(),l=Y.useNavigate(),{t:a}=U.useTranslation("system"),[c,x]=g.useState(null),[R,j]=g.useState(null),[y,o]=g.useState(!1),[p,f]=g.useState(""),[M,w]=g.useState(!1),[v,E]=g.useState([]),[T,I]=g.useState(!1),[A,k]=g.useState(!1),[$,P]=g.useState(""),[H]=t.Form.useForm(),[D,q]=g.useState(null),[z,b]=g.useState(null),[u,O]=g.useState(""),[Z]=t.Form.useForm(),{data:J}=S.useRequest(()=>i?F.api.system.getSkill({id:i}):Promise.reject(new Error("No id")),{refreshDeps:[i],ready:!!i}),{data:Q,loading:ee,refresh:m}=S.useRequest(()=>i?F.api.system.listSkillFilesTree({id:i}):Promise.reject(new Error("No id")),{refreshDeps:[i],ready:!!i,onSuccess:n=>{if(!c){for(const r of n)if(!r.is_dir&&r.name==="SKILL.md"){j(r.path),x(r.path),o(!1);return}for(const r of n)if(!r.is_dir&&r.name==="SKILLS.md"){j(r.path),x(r.path),o(!1);return}}}}),d=(J==null?void 0:J.data)??J,L=(Q==null?void 0:Q.data)??Q??[],W=g.useMemo(()=>je(L),[L]),K=y&&R?R:c?ce(c):"";g.useEffect(()=>{c&&i?(F.api.system.getSkillFile({id:i,path:c}).then(n=>f((n==null?void 0:n.data)??n??"")).catch(()=>t.message.error(a("settings.skills.editor.failedToLoadFile",{defaultValue:"Failed to load file"}))),w(!1)):(f(""),w(!1))},[i,c,a]);const X=()=>{!i||!c||F.api.system.putSkillFile({id:i,path:c},p).then(()=>{t.message.success(a("settings.skills.editor.saved",{defaultValue:"Saved"})),w(!1)}).catch(()=>t.message.error(a("settings.skills.editor.failedToSave",{defaultValue:"Failed to save"})))},le=(n,r)=>{const C=String(r.node.key),_=!r.node.isLeaf;j(C),o(_),r.node.isLeaf?x(C):x(null)},ae=n=>{n.event.preventDefault(),q({path:String(n.node.key),isDir:!n.node.isLeaf,x:n.event.clientX,y:n.event.clientY})},ie=g.useCallback(()=>q(null),[]),ne=g.useCallback(n=>{if(!i||!D)return;const{path:r,isDir:C}=D;switch(ie(),n){case"open":x(r),j(r),o(!1);break;case"rename":{const _=r.includes("/")?r.split("/").pop():r;b({path:r,isDir:C}),O(_),setTimeout(()=>Z.setFieldsValue({name:_}),0);break}case"delete":t.Modal.confirm({title:a("settings.skills.editor.deleteConfirm",{defaultValue:"Delete?"}),content:C?a("settings.skills.editor.deleteConfirmContentDir",{path:r,defaultValue:`Delete ${r}? This will remove the folder and all its contents.`}):a("settings.skills.editor.deleteConfirmContent",{path:r,defaultValue:`Delete ${r}?`}),onOk:()=>F.api.system.deleteSkillPath({id:i,path:r}).then(()=>{t.message.success(a("settings.skills.editor.deleted",{defaultValue:"Deleted"})),c===r&&(x(null),f("")),R===r&&(j(null),o(!1)),m()}).catch(()=>t.message.error(a("settings.skills.editor.failedToDelete",{defaultValue:"Failed to delete"})))});break;case"newFile":j(r),o(C),I(!0);break;case"newDir":j(r),o(C),k(!0);break}},[i,D,ie,m,c,R,Z,a]),h=()=>{if(!i||!z)return;const n=(Z.getFieldValue("name")??u).trim();if(!n){t.message.error(a("settings.skills.editor.nameRequired",{defaultValue:"Name is required"}));return}if(!z.isDir&&!/\.(md|txt)$/i.test(n)){t.message.error(a("settings.skills.editor.fileNameExtension",{defaultValue:"File name must end with .md or .txt"}));return}const r=ce(z.path),C=r?`${r}/${n}`:n;if(C===z.path){b(null);return}F.api.system.moveSkillPath({id:i},{from_path:z.path,to_path:C}).then(()=>{t.message.success(a("settings.skills.editor.renamed",{defaultValue:"Renamed"})),c===z.path&&x(C),R===z.path&&j(C),b(null),m()}).catch(()=>t.message.error(a("settings.skills.editor.failedToRename",{defaultValue:"Failed to rename"})))},B=n=>{if(!i)return;const r=String(n.dragNode.key),C=String(n.dragNode.title);let _;if(n.dropToGap){const G=ce(String(n.node.key));_=G?`${G}/${C}`:C}else _=`${n.node.key}/${C}`;_!==r&&F.api.system.moveSkillPath({id:i},{from_path:r,to_path:_}).then(()=>{t.message.success(a("settings.skills.editor.moved",{defaultValue:"Moved"})),c===r&&x(_),R===r&&j(_),m()}).catch(()=>t.message.error(a("settings.skills.editor.failedToMove",{defaultValue:"Failed to move"})))},te=()=>{const n=$.trim();if(!n||!i)return;const r=K?`${K}/${n}`:n;if(!/\.(md|txt)$/i.test(n)){t.message.error(a("settings.skills.editor.onlyMdTxtAllowed",{defaultValue:"Only .md and .txt files are allowed"}));return}F.api.system.putSkillFile({id:i,path:r},"").then(()=>{t.message.success(a("settings.skills.editor.fileCreated",{defaultValue:"File created"})),I(!1),P(""),m(),x(r),f("")}).catch(()=>t.message.error(a("settings.skills.editor.failedToCreateFile",{defaultValue:"Failed to create file"})))},oe=()=>{var C;const n=(C=H.getFieldValue("name"))==null?void 0:C.trim();if(!n||!i)return;const r=K?`${K}/${n}`:n;F.api.system.createSkillDir({id:i},{path:r}).then(()=>{t.message.success(a("settings.skills.editor.folderCreated",{defaultValue:"Folder created"})),k(!1),H.resetFields(),m()}).catch(()=>t.message.error(a("settings.skills.editor.failedToCreateFolder",{defaultValue:"Failed to create folder"})))},de=()=>{const n=R||c;!i||!n||t.Modal.confirm({title:a("settings.skills.editor.deleteConfirm",{defaultValue:"Delete?"}),content:a("settings.skills.editor.deleteConfirmContent",{path:n,defaultValue:`Delete ${n}?`}),onOk:()=>F.api.system.deleteSkillPath({id:i,path:n}).then(()=>{t.message.success(a("settings.skills.editor.deleted",{defaultValue:"Deleted"})),c===n&&(x(null),f("")),R===n&&(j(null),o(!1)),m()}).catch(()=>t.message.error(a("settings.skills.editor.failedToDelete",{defaultValue:"Failed to delete"})))})};return i?e.jsxRuntimeExports.jsxs(t.Card,{title:(d==null?void 0:d.name)??a("settings.skills.editor.skill",{defaultValue:"Skill"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"link",onClick:()=>l("/system/settings#skills"),children:a("settings.skills.editor.backToSkills",{defaultValue:"Back to Skills"})}),style:{height:"100%",display:"flex",flexDirection:"column",minHeight:"calc(100vh - 160px)"},styles:{body:{flex:1,minHeight:0,display:"flex",flexDirection:"column"}},children:[e.jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:16,flex:1,minHeight:0},children:[e.jsxRuntimeExports.jsxs("div",{style:{width:260,border:"1px solid #d9d9d9",borderRadius:8,padding:8,display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxRuntimeExports.jsxs(t.Space,{style:{marginBottom:8,flexShrink:0},children:[e.jsxRuntimeExports.jsx(t.Button,{size:"small",icon:e.jsxRuntimeExports.jsx(V.PlusOutlined,{}),onClick:()=>I(!0),children:a("settings.skills.editor.file",{defaultValue:"File"})}),e.jsxRuntimeExports.jsx(t.Button,{size:"small",icon:e.jsxRuntimeExports.jsx(V.FolderOutlined,{}),onClick:()=>k(!0),children:a("settings.skills.editor.folder",{defaultValue:"Folder"})})]}),ee?e.jsxRuntimeExports.jsx("div",{children:a("settings.skills.editor.loading",{defaultValue:"Loading..."})}):e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,overflow:"auto"},children:e.jsxRuntimeExports.jsx(t.Tree,{showIcon:!0,blockNode:!0,draggable:!0,expandedKeys:v,onExpand:n=>E(n),selectedKeys:R?[R]:[],onSelect:le,onRightClick:ae,onDrop:B,className:s.fileTree,treeData:W})})]}),e.jsxRuntimeExports.jsxs("div",{style:{flex:1,minWidth:0,display:"flex",flexDirection:"column",minHeight:0},children:[c&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Space,{style:{marginBottom:8,flexShrink:0},children:[e.jsxRuntimeExports.jsx("span",{children:c}),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(V.SaveOutlined,{}),disabled:!M,onClick:X,children:a("settings.skills.editor.save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{danger:!0,icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),onClick:de,children:a("settings.skills.editor.delete",{defaultValue:"Delete"})})]}),Ue(c)?e.jsxRuntimeExports.jsxs("div",{style:{flex:1,minHeight:0,minWidth:0,display:"flex",gap:16},children:[e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,minWidth:0,display:"flex",flexDirection:"column"},children:e.jsxRuntimeExports.jsx(he,{value:p,onChange:n=>{f(n.target.value),w(!0)},style:{flex:1,minHeight:0,fontFamily:"monospace",resize:"none"},spellCheck:!1})}),e.jsxRuntimeExports.jsx("div",{style:{flex:1,minHeight:0,minWidth:0,overflow:"auto",border:"1px solid #d9d9d9",borderRadius:8,padding:12},children:e.jsxRuntimeExports.jsx(N.MarkdownViewer,{content:me.markdownWithMetadataAsTable(p)})})]}):e.jsxRuntimeExports.jsx(he,{value:p,onChange:n=>{f(n.target.value),w(!0)},style:{flex:1,minHeight:0,fontFamily:"monospace",resize:"none"},spellCheck:!1})]}),!c&&e.jsxRuntimeExports.jsx("div",{style:{color:"#999"},children:a("settings.skills.editor.selectFileToEdit",{defaultValue:"Select a file to edit"})})]})]}),D&&e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("div",{style:{position:"fixed",inset:0,zIndex:999},onClick:ie,onContextMenu:n=>n.preventDefault(),"aria-hidden":!0}),e.jsxRuntimeExports.jsx("div",{style:{position:"fixed",left:D.x,top:D.y,zIndex:1e3},children:e.jsxRuntimeExports.jsx(t.Menu,{selectable:!1,items:[...D.isDir?[]:[{key:"open",icon:e.jsxRuntimeExports.jsx(V.FileOutlined,{}),label:a("settings.skills.editor.open",{defaultValue:"Open"})}],{key:"rename",icon:e.jsxRuntimeExports.jsx(V.EditOutlined,{}),label:a("settings.skills.editor.rename",{defaultValue:"Rename"})},{key:"delete",icon:e.jsxRuntimeExports.jsx(V.DeleteOutlined,{}),label:a("settings.skills.editor.delete",{defaultValue:"Delete"}),danger:!0},{key:"newFile",icon:e.jsxRuntimeExports.jsx(V.FileAddOutlined,{}),label:a("settings.skills.editor.newFile",{defaultValue:"New file"})},{key:"newDir",icon:e.jsxRuntimeExports.jsx(V.FolderAddOutlined,{}),label:a("settings.skills.editor.newFolder",{defaultValue:"New folder"})}],onClick:({key:n})=>ne(n)})})]}),e.jsxRuntimeExports.jsx(t.Modal,{title:a("settings.skills.editor.newFileTitle",{defaultValue:"New file"}),open:T,onOk:te,onCancel:()=>{I(!1),P("")},okText:a("settings.skills.editor.create",{defaultValue:"Create"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:a("settings.skills.editor.placeholderNewFile",{defaultValue:"filename.md or filename.txt"}),value:$,onChange:n=>P(n.target.value)})}),e.jsxRuntimeExports.jsx(t.Modal,{title:a("settings.skills.editor.newFolderTitle",{defaultValue:"New folder"}),open:A,onOk:()=>H.validateFields().then(oe),onCancel:()=>k(!1),okText:a("settings.skills.editor.create",{defaultValue:"Create"}),children:e.jsxRuntimeExports.jsx(t.Form,{form:H,layout:"vertical",children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:a("settings.skills.editor.folderName",{defaultValue:"Folder name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:a("settings.skills.editor.placeholderFolder",{defaultValue:"folder-name"})})})})}),e.jsxRuntimeExports.jsx(t.Modal,{title:a("settings.skills.editor.renameTitle",{defaultValue:"Rename"}),open:!!z,onOk:h,onCancel:()=>b(null),okText:a("settings.skills.editor.rename",{defaultValue:"Rename"}),destroyOnClose:!0,children:e.jsxRuntimeExports.jsx(t.Form,{form:Z,layout:"vertical",onValuesChange:(n,r)=>O(r.name??""),children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:z!=null&&z.isDir?a("settings.skills.editor.folderName",{defaultValue:"Folder name"}):a("settings.skills.editor.fileName",{defaultValue:"File name"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:z!=null&&z.isDir?a("settings.skills.editor.placeholderFolder",{defaultValue:"folder-name"}):a("settings.skills.editor.placeholderFileName",{defaultValue:"name.md"}),onPressEnter:()=>h()})})})})]}):null},De=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"})),Be=()=>{var f;const{id:s}=Y.useParams(),i=Y.useNavigate(),{t:l}=U.useTranslation("system"),{data:a,loading:c}=S.useRequest(()=>s?F.api.system.getSkill({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s}),{data:x,loading:R}=S.useRequest(()=>s?F.api.system.previewSkill({id:s}):Promise.reject(new Error("No id")),{refreshDeps:[s],ready:!!s,onError:()=>t.message.error(l("settings.skills.previewFailed",{defaultValue:"Failed to load preview"}))}),j=(a==null?void 0:a.data)??a,y=((f=x==null?void 0:x.data)==null?void 0:f.content)??(x==null?void 0:x.content)??"",o=me.skillPreviewContentWithMetadataAsTable(y);if(!s)return null;const p=c||R;return e.jsxRuntimeExports.jsx(t.Card,{title:(j==null?void 0:j.name)??l("settings.skills.editor.previewTitle",{defaultValue:"Skill Preview"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"link",onClick:()=>i("/system/settings#skills"),children:l("settings.skills.editor.backToSkills",{defaultValue:"Back to Skills"})}),children:e.jsxRuntimeExports.jsx(t.Spin,{spinning:p,children:e.jsxRuntimeExports.jsx("div",{style:{minHeight:200},children:!p&&e.jsxRuntimeExports.jsx(N.MarkdownViewer,{content:o})})})})},$e=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"})),Ge=()=>{const{t:s}=U.useTranslation("system"),[i]=Y.useSearchParams(),l=i.get("provider"),a=i.get("code"),c=i.get("state"),[x,R]=g.useState(null),[j,y]=g.useState(null),[o,p]=g.useState(null);return S.useRequest(async()=>{if(!a||!c||!l)throw new Error(s("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const f=await F.api.system.testOauthCallback({code:a,state:c,provider:l});if(!f.user_info)throw new Error(s("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!f.user)throw new Error(s("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));R(f.user),y(f.user_info)},{onSuccess:()=>{p({status:"success",message:s("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:f=>{p({status:"error",message:s("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:f.message})}}),o?e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(t.Result,{status:o.status,title:o.message,subTitle:o.error,extra:e.jsxRuntimeExports.jsxs(t.Space,{style:{display:!j||!x?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:j||{}})}),e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:x||{}})})]})})}):e.jsxRuntimeExports.jsx(N.Loading,{})},He=Object.freeze(Object.defineProperty({__proto__:null,default:Ge},Symbol.toStringTag,{value:"Module"}));exports.OAuthTestCallback=He;exports.OrganizationDetail=Pe;exports.SkillEditor=De;exports.SkillPreview=$e;exports.index=Me;
