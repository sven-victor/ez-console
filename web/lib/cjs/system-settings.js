"use strict";const e=require("./vendor.js"),t=require("antd"),M=require("react-i18next"),g=require("react"),V=require("ahooks"),S=require("@ant-design/icons"),T=require("./index.js"),pe=require("./base.js"),N=require("./components.js"),de=require("react-quill"),te=require("react-router-dom"),Z=require("./system.js"),xe=require("./contexts.js"),ge=require("./authorization.js"),fe=require("react-json-view"),ee=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,he={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},je=({initialData:s,onRefresh:a})=>{const{t:n}=M.useTranslation("system"),{t:E}=M.useTranslation("common"),[c]=t.Form.useForm(),[x,b]=g.useState((s==null?void 0:s.provider)||"custom"),[R,f]=g.useState((s==null?void 0:s.provider)==="custom"||(s==null?void 0:s.provider)==="autoDiscover"),[i,u]=g.useState((s==null?void 0:s.enabled)||!1),[p,A]=g.useState((s==null?void 0:s.auto_create_user)||!1),{loading:w,data:_,refresh:m}=V.useRequest(T.api.system.getOauthSettings,{manual:!!s,onSuccess:h=>{c.setFieldsValue(h),b(h.provider),f(h.provider==="custom"||h.provider==="autoDiscover"),u(h.enabled),A(h.auto_create_user)},onError:h=>{t.message.error(n("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",h)}});g.useEffect(()=>{s&&(c.setFieldsValue(s),b(s.provider),f(s.provider==="custom"||s.provider==="autoDiscover"),u(s.enabled),A(s.auto_create_user))},[s,c]);const v=h=>{b(h),f(h==="custom"||h==="autoDiscover");const o=he[h];o&&c.setFieldsValue({auth_endpoint:o.endpoints.auth_endpoint,token_endpoint:o.endpoints.token_endpoint,userinfo_endpoint:o.endpoints.userinfo_endpoint,scope:o.scope,email_field:o.email_field,username_field:o.username_field,full_name_field:o.full_name_field,avatar_field:o.avatar_field,role_field:o.role_field,icon_url:o.icon_url,display_name:o.display_name})},I=h=>{u(h)},F=h=>{A(h)},{loading:y,run:D}=V.useRequest(T.api.system.updateOauthSettings,{manual:!0,onSuccess:()=>{t.message.success(n("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),a?a():m()},onError:h=>{t.message.error(n("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",h)}}),P=h=>{D(h)},K=()=>{a?a():m()},{loading:$,run:z}=V.useRequest(async({redirect_uri:h,...o})=>{let q;return h?q=new URL(h):q=new URL(window.location.origin),q.pathname=pe.getURL("/system/settings/oauth/test-callback"),q.searchParams.set("provider",x),T.api.system.testOauthConnection({redirect_uri:q.toString(),...o})},{manual:!0,onSuccess:({url:h})=>{window.open(h,"_blank")},onError:h=>{t.message.error(n("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:h.message})),console.error("Failed to test OAuth connection",h)}}),B=()=>x==="custom";return e.jsxRuntimeExports.jsx(t.Spin,{spinning:w,children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",onFinish:P,initialValues:s||_,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"enabled",label:n("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:n("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:I})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:n("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:n("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:i,message:n("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxRuntimeExports.jsxs(t.Select,{onChange:v,disabled:!i,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"github",children:n("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"google",children:n("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"dingtalk",children:n("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"wechat",children:n("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"autoDiscover",children:n("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"custom",children:n("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"display_name",label:n("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:n("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i,placeholder:x!=="custom"?n(`settings.oauth.provider.options.${x}`,{defaultValue:x}):""})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"icon_url",label:n("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:n("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:ee,message:n("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i,placeholder:"https://example.com/icon.png"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_id",label:n("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:n("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:i,message:n("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"client_secret",label:n("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:n("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:i,message:n("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!i,autoComplete:"off",visibilityToggle:!1,placeholder:n("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),B()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auth_endpoint",label:n("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:n("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:i&&x==="custom",message:n("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:ee,message:n("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"wellknown_endpoint",hidden:x!=="autoDiscover",label:n("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:n("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:ee,message:n("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:i&&x==="autoDiscover",message:n("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),B()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"token_endpoint",label:n("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:n("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:i&&x==="custom",message:n("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:ee,message:n("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),B()&&e.jsxRuntimeExports.jsx(t.Form.Item,{name:"userinfo_endpoint",label:n("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:n("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:i&&x==="custom",message:n("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:ee,message:n("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"scope",label:n("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:n("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:i,message:n("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"redirect_uri",label:n("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:n("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[h=>h.getFieldValue("redirect_uri")!==""?{pattern:ee,message:n("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i,placeholder:`http://${window.location.host}${pe.getURL(`/login?provider=settings.${x}`)}`})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"auto_create_user",label:n("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:n("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:F,disabled:!i})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"default_role",label:n("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:n("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:i&&p,message:n("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!i||!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enabled",label:n("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:n("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!i})}),e.jsxRuntimeExports.jsx(t.Divider,{children:n("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsxRuntimeExports.jsx(t.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:n("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:R?"":n("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"email_field",label:n("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:n("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"email",disabled:!i||!R})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"username_field",label:n("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:n("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"login",autoComplete:"off",disabled:!i||!R})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"full_name_field",label:n("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:n("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"name",disabled:!i||!R})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"avatar_field",label:n("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:n("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"avatar_url",disabled:!i||!R})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_field",label:n("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:n("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"role",disabled:!i||!R})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:y,icon:e.jsxRuntimeExports.jsx(S.SaveOutlined,{}),children:E("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{loading:$,onClick:async()=>{const h=c.getFieldsValue();z(h)},children:n("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:K,icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),children:E("refresh",{defaultValue:"Refresh"})})]})})]})})},Re=()=>{const{t:s}=M.useTranslation("system"),{t:a}=M.useTranslation("common"),[n]=t.Form.useForm(),{loading:E,data:c,refresh:x}=V.useRequest(T.api.system.getSecuritySettings,{onSuccess:i=>{n.setFieldsValue(i)},onError:i=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",i)}}),{loading:b,run:R}=V.useRequest(T.api.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),x()},onError:i=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",i)}}),f=i=>{R(i)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:E,children:e.jsxRuntimeExports.jsxs(t.Form,{form:n,layout:"vertical",onFinish:f,initialValues:c,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"mfa_enforced",label:s("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:s("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_complexity",label:s("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:s("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"low",children:s("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"medium",children:s("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"high",children:s("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"very_high",children:s("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_min_length",label:s("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:s("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:6,max:32,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"password_expiry_days",label:s("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:s("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lock",label:s("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:s("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(i,u)=>i.login_failure_lock!==u.login_failure_lock,children:({getFieldValue:i})=>i("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_attempts",label:s("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:s("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(i,u)=>i.login_failure_lock!==u.login_failure_lock,children:({getFieldValue:i})=>i("login_failure_lock")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"login_failure_lockout_minutes",label:s("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:s("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_check",label:s("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:s("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{noStyle:!0,shouldUpdate:(i,u)=>i.history_password_check!==u.history_password_check,children:({getFieldValue:i})=>i("history_password_check")?e.jsxRuntimeExports.jsx(t.Form.Item,{name:"history_password_count",label:s("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:s("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"inactive_account_lock_days",label:s("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:s("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:0,style:{width:"100%"},addonAfter:s("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_timeout_minutes",label:s("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:s("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"session_idle_timeout_minutes",label:s("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:s("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(t.InputNumber,{min:5,style:{width:"100%"},addonAfter:s("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:b,icon:e.jsxRuntimeExports.jsx(S.SaveOutlined,{}),children:a("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>x(),icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),children:a("refresh",{defaultValue:"Refresh"})})]})})]})})},Ee=({fetchItems:s,importItems:a,columns:n,...E})=>{const{t:c}=M.useTranslation("system"),[x,b]=g.useState([]),[R,f]=g.useState([]),{run:i,loading:u}=V.useRequest(s,{onError:w=>{t.message.error(c("settings.ldap.importError",{error:`${w.message}`}))},onSuccess:w=>{b(w)},manual:!0}),{run:p,loading:A}=V.useRequest(async()=>{for(const w of R.filter(_=>{const m=x.find(v=>v.ldap_dn===_);return!(!m||m.status==="imported")})){const _=await a([w]);b(m=>[...m].map(I=>{for(const F of _)if(I.ldap_dn===F.ldap_dn)return{...F,status:"imported"};return I}))}},{manual:!0});return g.useEffect(()=>{E.visible&&(b([]),i(),f([]))},[E.visible]),e.jsxRuntimeExports.jsx(t.Modal,{title:c("settings.ldap.importTitle"),...E,onOk:()=>{p()},width:900,confirmLoading:A,loading:u,children:e.jsxRuntimeExports.jsx(t.Table,{rowKey:"ldap_dn",rowSelection:{onChange:w=>{f(w)},getCheckboxProps:w=>({disabled:w.status==="imported"})},columns:n.map(({render:w,..._})=>w?{..._,render:(m,v,I)=>{const F=R.includes(v.ldap_dn)&&A&&v.status!=="imported";return w(m,v,I,F)}}:_),dataSource:x,pagination:!1,scroll:{y:400,x:"max-content"}})})},be=()=>{var v,I,F;const{t:s}=M.useTranslation("system"),[a]=t.Form.useForm(),[n,E]=g.useState(!1),[c,x]=g.useState(null),[b,R]=g.useState(!1),[f,i]=g.useState(!1),[u]=t.Form.useForm(),[p,A]=g.useState(!1);V.useRequest(T.api.system.getLdapSettings,{onSuccess:y=>{a.setFieldsValue(y),A(y.enabled)},onError:y=>{t.message.error(s("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${y.message}`}))}}),g.useEffect(()=>{x(null)},[b]);const w=async y=>{E(!0);try{await T.api.system.updateLdapSettings(y),t.message.success(s("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{t.message.error(s("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{E(!1)}},{run:_,loading:m}=V.useRequest(async y=>{const D=await a.validateFields();return await T.api.system.testLdapConnection({...y,...D})},{onSuccess:y=>{x(y)},onError:y=>{t.message.error(s("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${y.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(t.Form,{form:a,layout:"vertical",onFinish:w,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:y=>A(y)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:p,message:s("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p,placeholder:"ldap://ldap.example.com:389"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:p,message:s("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:p,message:s("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:p,message:s("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p,placeholder:"dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:p,message:s("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:p,message:s("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:p,message:s("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:p,message:s("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"timeout",label:s("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:s("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",defaultValue:15,disabled:!p})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsxRuntimeExports.jsx(t.Input.TextArea,{placeholder:s("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!p})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:n,children:s("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!p,style:{marginLeft:8},onClick:()=>R(!0),children:s("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["authorization:user:create"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!p,style:{marginLeft:8},onClick:()=>{i(!0)},children:s("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxRuntimeExports.jsxs(t.Modal,{title:s("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:b,onCancel:()=>R(!1),footer:null,children:[e.jsxRuntimeExports.jsxs(t.Form,{form:u,layout:"vertical",onFinish:_,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:s("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!p})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:s("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!p})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(t.Button,{disabled:!p,type:"primary",htmlType:"submit",children:s("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsxRuntimeExports.jsx(t.Button,{style:{marginLeft:8},onClick:()=>R(!1),children:s("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsxRuntimeExports.jsx(t.Spin,{spinning:m,children:e.jsxRuntimeExports.jsx(t.Skeleton,{active:m,loading:m,children:c&&(c.user?e.jsxRuntimeExports.jsxs(t.Descriptions,{bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Username",span:3,children:c.user.username}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"Email",span:3,children:c.user.email}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"FullName",span:3,children:c.user.full_name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"CreatedAt",span:3,children:c.user.created_at}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:"UpdatedAt",span:3,children:c.user.updated_at})]}):e.jsxRuntimeExports.jsx(t.Steps,{direction:"vertical",current:(v=c.message)==null?void 0:v.findIndex(y=>!y.success),status:(I=c.message)!=null&&I.find(y=>!y.success)?"error":"finish",items:(F=c.message)==null?void 0:F.map(y=>({status:y.success?"finish":"error",title:y.message}))}))})})]}),e.jsxRuntimeExports.jsx(Ee,{visible:f,onCancel:()=>i(!1),fetchItems:()=>T.api.system.importLdapUsers({}),importItems:y=>T.api.system.importLdapUsers({user_dn:y}),columns:[{title:s("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:s("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:s("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:s("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(y,D,P,K)=>K?e.jsxRuntimeExports.jsx(t.Spin,{indicator:e.jsxRuntimeExports.jsx(S.LoadingOutlined,{spin:!0})}):y?e.jsxRuntimeExports.jsx(S.CheckCircleTwoTone,{twoToneColor:"#52c41a"}):D.id?e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:s("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsxRuntimeExports.jsx(t.Tag,{color:"green",children:s("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},Ve=()=>{const{t:s}=M.useTranslation("system"),{t:a}=M.useTranslation("common"),[n]=t.Form.useForm(),[E,c]=g.useState(null),[x,b]=g.useState(!1),[R]=t.Form.useForm(),[f,i]=g.useState(!1),{loading:u}=V.useRequest(T.api.system.getSmtpSettings,{onSuccess:m=>{n.setFieldsValue(m),i(m.enabled)},onError:m=>{t.message.error(s("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${m.message}`}))}});g.useEffect(()=>{c(null)},[x]);const{run:p,loading:A}=V.useRequest(({port:m,...v})=>T.api.system.updateSmtpSettings({...v,port:Number(m)}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:m=>{t.message.error(s("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${m.message}`}))}}),{run:w,loading:_}=V.useRequest(async m=>{const{port:v,...I}=await n.validateFields();return await T.api.system.testSmtpConnection({...m,...I,port:Number(v)})},{onSuccess:m=>{c(m)},onError:m=>{t.message.error(s("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${m.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(t.Spin,{spinning:u,children:e.jsxRuntimeExports.jsxs(t.Form,{form:n,layout:"vertical",onFinish:p,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(t.Switch,{onChange:m=>i(m)})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:f,message:s("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"smtp.example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:f,message:s("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{type:"number",disabled:!f,placeholder:"587"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:f,message:s("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"user@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsxRuntimeExports.jsx(t.Input.Password,{disabled:!f,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:f,message:s("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxRuntimeExports.jsxs(t.Radio.Group,{disabled:!f,children:[e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"None",children:s("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"SSL/TLS",children:s("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsxRuntimeExports.jsx(t.Radio.Button,{value:"STARTTLS",children:s("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:f,message:s("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:s("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:"noreply@example.com"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsxRuntimeExports.jsx(t.Input,{disabled:!f,placeholder:s("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsxRuntimeExports.jsx(t.Divider,{children:s("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsxRuntimeExports.jsx(de,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsxRuntimeExports.jsx(de,{theme:"snow"})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsxRuntimeExports.jsx(de,{theme:"snow"})}),e.jsxRuntimeExports.jsxs(t.Form.Item,{children:[e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:setting:update",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:A,style:{marginRight:8},children:a("save",{defaultValue:"Save"})})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>b(!0),disabled:!f||_,loading:_,children:s("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:x,onCancel:()=>b(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>b(!1),children:a("cancel",{defaultValue:"Cancel"})},"back"),e.jsxRuntimeExports.jsx(t.Button,{type:"primary",loading:_,onClick:()=>R.submit(),children:s("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxRuntimeExports.jsxs(t.Form,{form:R,layout:"vertical",onFinish:m=>w(m),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:s("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:s("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:"test@example.com"})}),E&&e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.smtp.testResult",{defaultValue:"Test Result"}),children:E.success?e.jsxRuntimeExports.jsx("span",{style:{color:"green"},children:s("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsxRuntimeExports.jsx("span",{style:{color:"red"},children:s("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:E.message})})})]})})]})},ye=()=>{const{t:s,i18n:a}=M.useTranslation("system"),{t:n}=M.useTranslation("common"),[E]=t.Form.useForm(),{loading:c,data:x,refresh:b}=V.useRequest(T.api.system.getSystemBaseSettings,{onSuccess:u=>{E.setFieldsValue(u)},onError:u=>{t.message.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",u)}}),{loading:R,run:f}=V.useRequest(T.api.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{t.message.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),b()},onError:u=>{t.message.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",u)}}),i=u=>{f(u)};return e.jsxRuntimeExports.jsx(t.Spin,{spinning:c,children:e.jsxRuntimeExports.jsxs(t.Form,{form:E,layout:"vertical",onFinish:i,initialValues:x,children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.name",{defaultValue:"Name"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{items:[{key:"default",label:n("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",children:e.jsxRuntimeExports.jsx(t.Input,{})})})},...N.AllLangUIConfig.map(u=>({key:u.lang,label:a.language!==u.lang?n(`language.${u.lang}`,{defaultValue:u.label,lang:u.label}):u.label,forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(t.Form.Item,{name:["name_i18n",u.lang],children:e.jsxRuntimeExports.jsx(t.Input,{})})})}))]})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:s("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{label:s("settings.base.enableMultiOrg",{defaultValue:"Enable Multi-Organization"}),name:"enable_multi_org",tooltip:s("settings.base.enableMultiOrgTooltip",{defaultValue:"Enable multi-organization feature. When enabled, organizations can be managed in the Organization Management tab."}),children:e.jsxRuntimeExports.jsx(t.Switch,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:R,icon:e.jsxRuntimeExports.jsx(S.SaveOutlined,{}),children:n("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>b(),icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),children:n("refresh",{defaultValue:"Refresh"})})]})})]})})},{TextArea:Se}=t.Input,Fe=()=>{var Q;const{t:s}=M.useTranslation("ai"),{t:a}=M.useTranslation("common"),[n]=t.Form.useForm(),[E,c]=g.useState(!1),[x,b]=g.useState(null),[R,f]=g.useState(""),[i,u]=g.useState(""),[p,A]=g.useState({}),{loading:w,data:_}=V.useRequest(()=>T.api.ai.getAiTypeDefinitions(),{refreshDeps:[],onError:r=>{t.message.error(s("models.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch AI type definitions"})),console.error("Failed to fetch AI type definitions:",r)}}),m=g.useMemo(()=>_==null?void 0:_.find(r=>r.provider===i),[_,i]),{loading:v,data:I,refresh:F}=V.useRequest(()=>T.api.ai.listAiModels({current:1,page_size:100,search:R}),{refreshDeps:[R],onError:r=>{t.message.error(s("models.fetchFailed",{defaultValue:"Failed to fetch AI models"})),console.error("Failed to fetch AI models:",r)}}),{loading:y,run:D}=V.useRequest(({config:r,...C})=>T.api.ai.createAiModel({config:r??{},...C}),{manual:!0,onSuccess:()=>{t.message.success(s("models.createSuccess",{defaultValue:"AI model created successfully"})),c(!1),n.resetFields(),F()},onError:r=>{t.message.error(s("models.createFailed",{defaultValue:"Failed to create AI model"})),console.error("Failed to create AI model:",r)}}),{loading:P,run:K}=V.useRequest(({id:r,data:C})=>T.api.ai.updateAiModel({id:r},C),{manual:!0,onSuccess:()=>{t.message.success(s("models.updateSuccess",{defaultValue:"AI model updated successfully"})),c(!1),n.resetFields(),b(null),F()},onError:r=>{t.message.error(s("models.updateFailed",{defaultValue:"Failed to update AI model"})),console.error("Failed to update AI model:",r)}}),{runAsync:$}=V.useRequest(r=>T.api.ai.deleteAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.deleteSuccess",{defaultValue:"AI model deleted successfully"})),F()},onError:r=>{t.message.error(s("models.deleteFailed",{defaultValue:"Failed to delete AI model"})),console.error("Failed to delete AI model:",r)}}),{runAsync:z}=V.useRequest(r=>T.api.ai.testAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.testSuccess",{defaultValue:"AI model connection test successful"}))},onError:r=>{t.message.error(s("models.testFailed",{defaultValue:"AI model connection test failed"})),console.error("Failed to test AI model:",r)}}),{runAsync:B}=V.useRequest(r=>T.api.ai.setDefaultAiModel({id:r}),{manual:!0,onSuccess:()=>{t.message.success(s("models.setDefaultSuccess",{defaultValue:"Default AI model set successfully"})),F()},onError:r=>{t.message.error(s("models.setDefaultFailed",{defaultValue:"Failed to set default AI model"})),console.error("Failed to set default AI model:",r)}}),h=()=>{b(null),u(""),A({}),n.resetFields(),c(!0)},o=r=>{b(r),u(r.provider);const C=r.config||{},G={name:r.name,description:r.description,provider:r.provider,is_default:r.is_default,config:C};m!=null&&m.config_fields&&m.config_fields.forEach(H=>{H.type==="password"&&(G[H.name]="")}),A(G),n.setFieldsValue(G),c(!0)},q=r=>{u(r),m!=null&&m.config_fields&&m.config_fields.forEach(C=>{n.setFieldValue(C.name,void 0)})},se=r=>{const C={};m!=null&&m.config_fields&&m.config_fields.forEach(H=>{var X;const W=(X=r.config)==null?void 0:X[H.name];W!=null&&W!==""&&(C[H.name]=W)});const G={name:r.name,description:r.description,provider:r.provider,config:C,is_default:r.is_default};x?K({id:x.id,data:G}):D(G)},ne=r=>{var G;if(!((G=r.data_source)!=null&&G.depends_on))return{};const C={};return r.data_source.depends_on.forEach(H=>{C[H]=p[H]}),C},ae=[{title:s("models.name",{defaultValue:"Name"}),dataIndex:"name",key:"name",render:(r,C)=>e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx("span",{children:r}),C.is_default&&e.jsxRuntimeExports.jsx(t.Tooltip,{title:s("models.defaultModel",{defaultValue:"Default Model"}),children:e.jsxRuntimeExports.jsx(S.StarFilled,{style:{color:"#faad14"}})})]})},{title:s("models.provider",{defaultValue:"Provider"}),dataIndex:"provider",key:"provider",render:r=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:r.toUpperCase()})},{title:s("models.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:r=>e.jsxRuntimeExports.jsx(t.Tag,{color:r==="enabled"?"green":"red",children:r==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:a("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(r,C)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"test",permission:"ai:models:test",icon:e.jsxRuntimeExports.jsx(S.CheckCircleOutlined,{}),tooltip:s("models.test",{defaultValue:"Test Connection"}),onClick:async()=>z(C.id)},{key:"setDefault",permission:"ai:models:setDefault",icon:e.jsxRuntimeExports.jsx(S.StarOutlined,{}),tooltip:s("models.setDefault",{defaultValue:"Set as Default"}),onClick:async()=>B(C.id)},{key:"update",permission:"ai:models:update",icon:e.jsxRuntimeExports.jsx(S.EditOutlined,{}),tooltip:a("edit",{defaultValue:"Edit"}),onClick:async()=>o(C)},{key:"delete",permission:"ai:models:delete",icon:e.jsxRuntimeExports.jsx(S.DeleteOutlined,{}),tooltip:a("delete",{defaultValue:"Delete"}),onClick:async()=>$(C.id),danger:!0}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("models.searchPlaceholder",{defaultValue:"Search AI models..."}),style:{width:300},value:R,onChange:r=>f(r.target.value),allowClear:!0})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),onClick:F,loading:v,children:a("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"ai:models:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.PlusOutlined,{}),onClick:h,children:s("models.create",{defaultValue:"Create AI Model"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:ae,dataSource:(I==null?void 0:I.data)||[],loading:v,rowKey:"id",pagination:{total:(I==null?void 0:I.total)||0,current:(I==null?void 0:I.current)||1,pageSize:(I==null?void 0:I.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(r,C)=>s("common.pagination.total",{defaultValue:`${C[0]}-${C[1]} of ${r} items`,start:C[0],end:C[1],total:r})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:x?s("models.edit",{defaultValue:"Edit AI Model"}):s("models.create",{defaultValue:"Create AI Model"}),open:E,onCancel:()=>{c(!1),n.resetFields(),b(null)},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:n,layout:"vertical",onFinish:se,onValuesChange:(r,C)=>A(C),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("models.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("models.nameRequired",{defaultValue:"Please enter model name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("models.namePlaceholder",{defaultValue:"Enter model name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("models.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Se,{rows:3,placeholder:s("models.descriptionPlaceholder",{defaultValue:"Enter model description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"provider",label:s("models.provider",{defaultValue:"Provider"}),rules:[{required:!0,message:s("models.providerRequired",{defaultValue:"Please select provider"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:w,placeholder:s("models.providerPlaceholder",{defaultValue:"Select provider"}),onChange:q,value:i,options:_==null?void 0:_.map(r=>({label:r.name,value:r.provider}))})}),(Q=m==null?void 0:m.config_fields)==null?void 0:Q.map(r=>e.jsxRuntimeExports.jsx(N.DynamicConfigField,{field:r,selectedType:i,dependentValues:ne(r),formValues:p},r.name)),e.jsxRuntimeExports.jsxs(t.Form.Item,{name:"is_default",valuePropName:"checked",children:[e.jsxRuntimeExports.jsx(t.Switch,{})," ",e.jsxRuntimeExports.jsx("span",{style:{marginLeft:8},children:s("models.setAsDefault",{defaultValue:"Set as default model"})})]}),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:y||P,children:x?a("update",{defaultValue:"Update"}):a("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{c(!1),n.resetFields(),b(null),u(""),A({})},children:a("cancel",{defaultValue:"Cancel"})})]})})]})})]})},{TextArea:_e}=t.Input,ve=()=>{var me;const{t:s}=M.useTranslation("system"),{t:a}=M.useTranslation("common"),[n]=t.Form.useForm(),[E,c]=g.useState(!1),[x,b]=g.useState(null),[R,f]=g.useState(""),[i,u]=g.useState(!1),[p,A]=g.useState(null),[w,_]=g.useState(""),[m,v]=g.useState(!1),[I,F]=g.useState([]),[y,D]=g.useState({}),[P,K]=g.useState(),{loading:$,data:z,refresh:B}=V.useRequest(()=>T.api.system.listToolSets({current:1,page_size:100,search:R,type:P}),{refreshDeps:[R,P],onError:l=>{t.message.error(s("settings.toolsets.fetchFailed",{defaultValue:"Failed to fetch toolsets"})),console.error("Failed to fetch toolsets:",l)}}),{loading:h,data:o}=V.useRequest(()=>T.api.system.getToolSetTypeDefinitions(),{refreshDeps:[],onError:l=>{t.message.error(s("settings.toolsets.fetchTypeDefinitionsFailed",{defaultValue:"Failed to fetch toolset type definitions"})),console.error("Failed to fetch toolset type definitions:",l)}}),q=g.useMemo(()=>o==null?void 0:o.find(l=>l.tool_set_type===w),[o,w]),{loading:se,run:ne}=V.useRequest(l=>T.api.system.createToolSet({...l,type:l.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.createSuccess",{defaultValue:"toolset created successfully"})),c(!1),n.resetFields(),B()},onError:l=>{t.message.error(s("settings.toolsets.createFailed",{defaultValue:"Failed to create toolset"})),console.error("Failed to create toolset:",l)}}),{loading:ae,run:Q}=V.useRequest(({id:l,data:j})=>T.api.system.updateToolSet({id:l},{...j,type:j.type}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.updateSuccess",{defaultValue:"toolset updated successfully"})),c(!1),n.resetFields(),b(null),B()},onError:l=>{t.message.error(s("settings.toolsets.updateFailed",{defaultValue:"Failed to update toolset"})),console.error("Failed to update toolset:",l)}}),{run:r}=V.useRequest(l=>T.api.system.deleteToolSet({id:l}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.deleteSuccess",{defaultValue:"toolset deleted successfully"})),B()},onError:l=>{t.message.error(s("settings.toolsets.deleteFailed",{defaultValue:"Failed to delete toolset"})),console.error("Failed to delete toolset:",l)}}),{runAsync:C}=V.useRequest(l=>T.api.system.testToolSet({id:l}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.testSuccess",{defaultValue:"toolset connection test successful"}))},onError:l=>{t.message.error(s("settings.toolsets.testFailed",{defaultValue:"toolset connection test failed"})),console.error("Failed to test toolset:",l)}}),{loading:G,runAsync:H}=V.useRequest(l=>T.api.system.getToolSetTools({id:l}),{manual:!0,onSuccess:l=>{F(l||[]),v(!0)},onError:l=>{t.message.error(s("settings.toolsets.fetchToolsFailed",{defaultValue:"Failed to fetch tools"})),console.error("Failed to fetch tools:",l)}}),{runAsync:W}=V.useRequest(({id:l,status:j})=>T.api.system.updateToolSetStatus({id:l},{status:j}),{manual:!0,onSuccess:()=>{t.message.success(s("settings.toolsets.statusUpdateSuccess",{defaultValue:"Status updated successfully"})),B()},onError:l=>{t.message.error(s("settings.toolsets.statusUpdateFailed",{defaultValue:"Failed to update status"})),console.error("Failed to update status:",l)}}),X=()=>{b(null),n.resetFields(),_(""),c(!0)},ue=l=>{b(l),_(l.type);const j={...l};if(j.config){const O=o==null?void 0:o.find(k=>k.tool_set_type===l.type);if(O){const k={};O.config_fields.forEach(L=>{var Y,ce;L.type==="object"&&((Y=j.config)!=null&&Y[L.name])?k[L.name]=JSON.stringify(j.config[L.name],null,2):((ce=j.config)==null?void 0:ce[L.name])!==void 0&&(k[L.name]=j.config[L.name])}),j.config=k}}n.setFieldsValue(j),c(!0)};console.log(w,o);const oe=l=>{_(l);const j=o==null?void 0:o.find(O=>O.tool_set_type===l);if(j){const O={};j.config_fields.forEach(k=>{if(k.default)switch(k.type){case"number":O[k.name]=Number(k.default);break;case"boolean":O[k.name]=k.default==="true";break;case"array":O[k.name]=k.default.split(",");break;default:O[k.name]=k.default}}),n.setFieldValue("config",O)}else n.setFieldValue("config",void 0)},ie=l=>{if(l.config&&q){const j={};q.config_fields.forEach(O=>{var L;const k=(L=l.config)==null?void 0:L[O.name];if(k!==void 0)if(O.type==="object")try{j[O.name]=typeof k=="string"?JSON.parse(k):k}catch{j[O.name]=k}else j[O.name]=k}),l.config=j}x?Q({id:x.id,data:l}):ne(l)},le=l=>{r(l)},d=l=>{A(l),u(!0)},U=l=>{console.log(new Date,"handleToggleStatus");const j=l.status==="enabled"?"disabled":"enabled";return W({id:l.id,status:j}).then(()=>{console.log(new Date,"handleToggleStatus1")})},J=l=>{var O;if(!((O=l.data_source)!=null&&O.depends_on)||l.data_source.depends_on.length===0)return{};const j={};return l.data_source.depends_on.forEach(k=>{var Y;const L=(Y=y.config)==null?void 0:Y[k];L!==void 0&&(j[k]=L)}),j};console.log(z);const re=[{title:s("settings.toolsets.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:s("settings.toolsets.type",{defaultValue:"Type"}),dataIndex:"type",key:"type",render:l=>e.jsxRuntimeExports.jsx(t.Tag,{color:"blue",children:l.toUpperCase()})},{title:s("settings.toolsets.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:l=>e.jsxRuntimeExports.jsx(t.Tag,{color:l==="enabled"?"green":"red",children:l==="enabled"?s("common.enabled",{defaultValue:"Enabled"}):s("common.disabled",{defaultValue:"Disabled"})})},{title:a("actions",{defaultValue:"Actions"}),key:"actions",width:200,render:(l,j)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"test",permission:"system:toolsets:test",tooltip:s("settings.toolsets.test",{defaultValue:"Test Connection"}),icon:e.jsxRuntimeExports.jsx(S.ThunderboltOutlined,{}),onClick:async()=>C(j.id)},{key:"viewTools",icon:e.jsxRuntimeExports.jsx(S.ToolOutlined,{}),permission:"system:toolsets:view",tooltip:s("settings.toolsets.viewTools",{defaultValue:"View Tools"}),onClick:async()=>H(j.id)},{key:"viewConfig",icon:e.jsxRuntimeExports.jsx(S.SettingOutlined,{}),permission:"system:toolsets:view",tooltip:s("settings.toolsets.viewConfig",{defaultValue:"View Configuration"}),onClick:async()=>d(j.config),disabled:!j.config},{key:"edit",permission:"system:toolsets:update",tooltip:s("settings.toolsets.edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(S.EditOutlined,{}),onClick:async()=>ue(j)},{key:"toggleStatus",icon:j.status==="enabled"?e.jsxRuntimeExports.jsx(S.LockOutlined,{}):e.jsxRuntimeExports.jsx(S.CheckCircleOutlined,{}),onClick:async()=>U(j),permission:"system:toolsets:update",tooltip:j.status==="enabled"?a("disable",{defaultValue:"Disable"}):a("enable",{defaultValue:"Enable"})},{key:"delete",icon:e.jsxRuntimeExports.jsx(S.DeleteOutlined,{}),permission:"system:toolsets:delete",tooltip:a("delete",{defaultValue:"Delete"}),onClick:async()=>le(j.id),danger:!0,confirm:{title:s("settings.toolsets.deleteConfirm",{defaultValue:"Are you sure you want to delete this toolset?"}),onConfirm:async()=>le(j.id),okText:a("confirm",{defaultValue:"Confirm"}),cancelText:a("cancel",{defaultValue:"Cancel"})}}]},"actions")}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},children:e.jsxRuntimeExports.jsxs(t.Row,{justify:"space-between",align:"middle",children:[e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:s("settings.toolsets.searchPlaceholder",{defaultValue:"Search toolsets..."}),style:{width:300},value:R,onChange:l=>f(l.target.value),allowClear:!0}),e.jsxRuntimeExports.jsxs(t.Select,{placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),value:P,onChange:l=>K(l),options:o==null?void 0:o.map(l=>({label:l.name,value:l.tool_set_type})),style:{minWidth:110},allowClear:!0,children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"",children:"All"}),o==null?void 0:o.map(l=>e.jsxRuntimeExports.jsx(t.Select.Option,{value:l.tool_set_type,children:l.name},l.tool_set_type))]})]})}),e.jsxRuntimeExports.jsx(t.Col,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),onClick:B,loading:$,children:a("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:toolsets:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.PlusOutlined,{}),onClick:X,children:s("settings.toolsets.create",{defaultValue:"Create Toolset"})})})]})})]})}),e.jsxRuntimeExports.jsx(t.Card,{children:e.jsxRuntimeExports.jsx(t.Table,{columns:re,dataSource:(z==null?void 0:z.data)||[],loading:$,rowKey:"id",pagination:{total:(z==null?void 0:z.total)||0,current:(z==null?void 0:z.current)||1,pageSize:(z==null?void 0:z.page_size)||10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(l,j)=>s("common.pagination.total",{defaultValue:`${j[0]}-${j[1]} of ${l} items`,start:j[0],end:j[1],total:l})}})}),e.jsxRuntimeExports.jsx(t.Modal,{title:x?s("settings.toolsets.edit",{defaultValue:"Edit Toolset"}):s("settings.toolsets.create",{defaultValue:"Create Toolset"}),open:E,onCancel:()=>{c(!1),n.resetFields(),b(null),_("")},footer:null,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:n,layout:"vertical",onFinish:ie,onValuesChange:(l,j)=>D(j),children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:s("settings.toolsets.name",{defaultValue:"Name"}),rules:[{required:!0,message:s("settings.toolsets.nameRequired",{defaultValue:"Please enter toolset name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{placeholder:s("settings.toolsets.namePlaceholder",{defaultValue:"Enter toolset name"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:s("settings.toolsets.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(_e,{rows:3,placeholder:s("settings.toolsets.descriptionPlaceholder",{defaultValue:"Enter toolset description"})})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"type",label:s("settings.toolsets.type",{defaultValue:"Type"}),rules:[{required:!0,message:s("settings.toolsets.typeRequired",{defaultValue:"Please select type"})}],children:e.jsxRuntimeExports.jsx(t.Select,{loading:h,placeholder:s("settings.toolsets.typePlaceholder",{defaultValue:"Select type"}),onChange:oe,value:w,options:o==null?void 0:o.map(l=>({label:l.name,value:l.tool_set_type}))})}),(me=q==null?void 0:q.config_fields)==null?void 0:me.map(l=>e.jsxRuntimeExports.jsx(N.DynamicConfigField,{field:l,selectedType:w,dependentValues:J(l),formValues:y},l.name)),e.jsxRuntimeExports.jsx(t.Form.Item,{children:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{type:"primary",htmlType:"submit",loading:se||ae,children:x?a("update",{defaultValue:"Update"}):a("create",{defaultValue:"Create"})}),e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>{c(!1),n.resetFields(),b(null),_("")},children:a("cancel",{defaultValue:"Cancel"})})]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.configuration",{defaultValue:"Configuration"}),open:i,onCancel:()=>u(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>u(!1),children:a("close",{defaultValue:"Close"})},"close")],width:600,children:e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto"},children:JSON.stringify(p,null,2)})}),e.jsxRuntimeExports.jsx(t.Modal,{title:s("settings.toolsets.tools",{defaultValue:"Tools"}),open:m,onCancel:()=>v(!1),footer:[e.jsxRuntimeExports.jsx(t.Button,{onClick:()=>v(!1),children:a("close",{defaultValue:"Close"})},"close")],width:800,children:e.jsxRuntimeExports.jsx("div",{style:{maxHeight:"600px",overflow:"auto"},children:G?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40},children:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{style:{fontSize:24},spin:!0})}):I.length===0?e.jsxRuntimeExports.jsx("div",{style:{textAlign:"center",padding:40,color:"#999"},children:s("settings.toolsets.noTools",{defaultValue:"No tools available"})}):I.map((l,j)=>{var O,k,L;return e.jsxRuntimeExports.jsx(t.Card,{style:{marginBottom:16},title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(S.ToolOutlined,{}),e.jsxRuntimeExports.jsx("strong",{children:((O=l.function)==null?void 0:O.name)||"Unknown"})]}),children:e.jsxRuntimeExports.jsxs(t.Row,{gutter:16,children:[e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.description",{defaultValue:"Description"}),":"]})}),e.jsxRuntimeExports.jsx("p",{style:{marginBottom:16},children:((k=l.function)==null?void 0:k.description)||"-"})]}),((L=l.function)==null?void 0:L.parameters)&&e.jsxRuntimeExports.jsxs(t.Col,{span:24,children:[e.jsxRuntimeExports.jsx("p",{children:e.jsxRuntimeExports.jsxs("strong",{children:[s("settings.toolsets.parameters",{defaultValue:"Parameters"}),":"]})}),e.jsxRuntimeExports.jsx("pre",{style:{background:"#f5f5f5",padding:16,borderRadius:4,overflow:"auto",fontSize:12},children:JSON.stringify(l.function.parameters,null,2)})]})]})},j)})})})]})},{TextArea:Ie}=t.Input,Ce=()=>{const s=te.useNavigate(),{t:a}=M.useTranslation("system"),{t:n}=M.useTranslation("common"),[E]=t.Form.useForm(),[c,x]=g.useState(!1),[b,R]=g.useState(null),[f,i]=g.useState(""),[u,p]=g.useState(1),[A,w]=g.useState(10),{loading:_,data:m,refresh:v}=V.useRequest(()=>Z.listOrganizations({current:u,page_size:A,search:f}),{refreshDeps:[u,A,f],onError:o=>{t.message.error(a("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organizations"})),console.error("Failed to fetch organizations:",o)}}),{loading:I,run:F}=V.useRequest(o=>Z.createOrganization(o),{manual:!0,onSuccess:()=>{t.message.success(a("settings.organizations.createSuccess",{defaultValue:"Organization created successfully"})),x(!1),E.resetFields(),R(null),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||a("settings.organizations.createFailed",{defaultValue:"Failed to create organization"}))}}),{loading:y,run:D}=V.useRequest(({id:o,...q})=>Z.updateOrganization({id:o},q),{manual:!0,onSuccess:()=>{t.message.success(a("settings.organizations.updateSuccess",{defaultValue:"Organization updated successfully"})),x(!1),E.resetFields(),R(null),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||a("settings.organizations.updateFailed",{defaultValue:"Failed to update organization"}))}}),{run:P}=V.useRequest(o=>Z.deleteOrganization({id:o}),{manual:!0,onSuccess:()=>{t.message.success(a("settings.organizations.deleteSuccess",{defaultValue:"Organization deleted successfully"})),v()},onError:o=>{t.message.error((o==null?void 0:o.err)||a("settings.organizations.deleteFailed",{defaultValue:"Failed to delete organization"}))}}),K=()=>{R(null),E.resetFields(),E.setFieldsValue({status:"active"}),x(!0)},$=o=>{R(o),E.setFieldsValue({name:o.name,description:o.description,status:o.status}),x(!0)},z=o=>{t.Modal.confirm({title:a("settings.organizations.deleteConfirm",{defaultValue:"Delete Organization"}),content:a("settings.organizations.deleteConfirmContent",{defaultValue:`Are you sure you want to delete organization "${o.name}"? This action cannot be undone.`}),onOk:()=>P(o.id)})},B=()=>{E.validateFields().then(o=>{b?D({id:b.id,...o}):F(o)})},h=[{title:a("settings.organizations.name",{defaultValue:"Name"}),dataIndex:"name",key:"name"},{title:a("settings.organizations.description",{defaultValue:"Description"}),dataIndex:"description",key:"description"},{title:a("settings.organizations.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:o=>e.jsxRuntimeExports.jsx(t.Tag,{color:o==="active"?"green":"default",children:o==="active"?a("settings.organizations.active",{defaultValue:"Active"}):a("settings.organizations.disabled",{defaultValue:"Disabled"})})},{title:n("actions",{defaultValue:"Actions"}),key:"actions",render:(o,q)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"view",label:n("view",{defaultValue:"View"}),icon:e.jsxRuntimeExports.jsx(S.EyeOutlined,{}),onClick:async()=>s(`/system/settings/organizations/${q.id}`),permission:"system:organization:view"},{key:"edit",label:n("edit",{defaultValue:"Edit"}),icon:e.jsxRuntimeExports.jsx(S.EditOutlined,{}),onClick:async()=>$(q),permission:"system:organization:update"},{key:"delete",label:n("delete",{defaultValue:"Delete"}),icon:e.jsxRuntimeExports.jsx(S.DeleteOutlined,{}),danger:!0,onClick:async()=>z(q),permission:"system:organization:delete"}]})}];return e.jsxRuntimeExports.jsxs(t.Card,{title:a("settings.organizations.title",{defaultValue:"Organization Management"}),extra:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),onClick:v,children:n("refresh",{defaultValue:"Refresh"})}),e.jsxRuntimeExports.jsx(N.PermissionGuard,{permission:"system:organization:create",children:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.PlusOutlined,{}),onClick:K,children:a("settings.organizations.create",{defaultValue:"Create Organization"})})})]}),children:[e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:a("settings.organizations.searchPlaceholder",{defaultValue:"Search organizations..."}),allowClear:!0,onSearch:o=>{i(o),p(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:h,dataSource:(m==null?void 0:m.data)||[],loading:_,rowKey:"id",pagination:{current:u,pageSize:A,total:(m==null?void 0:m.total)||0,showSizeChanger:!0,showTotal:o=>n("pagination.total",{defaultValue:`Total ${o} items`}),onChange:(o,q)=>{p(o),w(q)}}})]}),e.jsxRuntimeExports.jsx(t.Modal,{title:b?a("settings.organizations.edit",{defaultValue:"Edit Organization"}):a("settings.organizations.create",{defaultValue:"Create Organization"}),open:c,onOk:B,onCancel:()=>{x(!1),E.resetFields(),R(null)},confirmLoading:I||y,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:E,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"name",label:a("settings.organizations.name",{defaultValue:"Name"}),rules:[{required:!0,message:a("settings.organizations.nameRequired",{defaultValue:"Please enter organization name"})}],children:e.jsxRuntimeExports.jsx(t.Input,{})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"description",label:a("settings.organizations.description",{defaultValue:"Description"}),children:e.jsxRuntimeExports.jsx(Ie,{rows:3})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"status",label:a("settings.organizations.status",{defaultValue:"Status"}),rules:[{required:!0}],children:e.jsxRuntimeExports.jsxs(t.Select,{children:[e.jsxRuntimeExports.jsx(t.Select.Option,{value:"active",children:a("settings.organizations.active",{defaultValue:"Active"})}),e.jsxRuntimeExports.jsx(t.Select.Option,{value:"disabled",children:a("settings.organizations.disabled",{defaultValue:"Disabled"})})]})})]})})]})},Te=({transformItems:s=a=>a})=>{const{t:a}=M.useTranslation("system"),n=te.useNavigate(),E=te.useLocation(),b=E.hash.replace("#","")||"base",{enableMultiOrg:R}=xe.useSite(),{hasPermission:f}=xe.usePermission(),i=[{key:"base",label:a("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsxRuntimeExports.jsx(ye,{}),hidden:!f("system:settings:update")},{key:"security",label:a("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsxRuntimeExports.jsx(Re,{}),hidden:!f("system:security:update")},{key:"oauth",label:a("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsxRuntimeExports.jsx(je,{}),hidden:!f("system:settings:update")},{key:"ldap",label:a("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsxRuntimeExports.jsx(be,{}),hidden:!f("system:settings:update")},{key:"smtp",label:a("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsxRuntimeExports.jsx(Ve,{}),hidden:!f("system:settings:update")},{key:"ai-models",label:a("settings.tabs.aiModels",{defaultValue:"AI Models"}),children:e.jsxRuntimeExports.jsx(Fe,{}),hidden:!f("ai:models:view")},{key:"ai-toolsets",label:a("settings.tabs.toolSets",{defaultValue:"Tool Sets"}),children:e.jsxRuntimeExports.jsx(ve,{}),hidden:!f("system:toolsets:view")},...R?[{key:"organizations",label:a("settings.tabs.organizations",{defaultValue:"Organizations"}),children:e.jsxRuntimeExports.jsx(Ce,{}),hidden:!f("system:organization:view")}]:[]];return console.log(i,f("system:settings:update")),e.jsxRuntimeExports.jsx(t.Card,{title:a("settings.title",{defaultValue:"System Settings"}),children:e.jsxRuntimeExports.jsx(t.Tabs,{defaultActiveKey:b,onChange:u=>{n(`${E.pathname}#${u}`)},items:s(i.filter(u=>!u.hidden),a)})})},we=Object.freeze(Object.defineProperty({__proto__:null,default:Te},Symbol.toStringTag,{value:"Module"})),ke=()=>{var oe,ie,le;const s=te.useNavigate(),{id:a}=te.useParams(),{t:n}=M.useTranslation("system"),{t:E}=M.useTranslation("common"),[c]=t.Form.useForm(),[x]=t.Form.useForm(),[b,R]=g.useState(!1),[f,i]=g.useState(!1),[u,p]=g.useState(null),[A,w]=g.useState(""),[_,m]=g.useState(1),[v,I]=g.useState(10),{data:F,loading:y,refresh:D}=V.useRequest(()=>Z.getOrganization({id:a}),{ready:!!a,onError:d=>{t.message.error(n("settings.organizations.fetchFailed",{defaultValue:"Failed to fetch organization"})),console.error("Failed to fetch organization:",d)}}),{data:P,loading:K,refresh:$}=V.useRequest(()=>Z.listOrganizationUsers({id:a,current:_,page_size:v,search:A}),{ready:!!a,refreshDeps:[a,_,v,A],onError:d=>{t.message.error(n("settings.organizations.users.fetchFailed",{defaultValue:"Failed to fetch organization users"})),console.error("Failed to fetch organization users:",d)}}),{data:z,loading:B}=V.useRequest(()=>ge.listUsers({current:1,page_size:1e3}),{ready:b}),{data:h,loading:o}=V.useRequest(()=>ge.listRoles({organization_id:a,current:1,page_size:1e3}),{ready:!!a}),{loading:q,run:se}=V.useRequest(d=>Z.addUserToOrganization({id:a},d),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.users.addSuccess",{defaultValue:"User added to organization successfully"})),R(!1),c.resetFields(),$()},onError:d=>{t.message.error((d==null?void 0:d.err)||n("settings.organizations.users.addFailed",{defaultValue:"Failed to add user to organization"}))}}),{loading:ne,run:ae}=V.useRequest(d=>Z.updateUserOrganizationRoles({id:a,user_id:u==null?void 0:u.id},d),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.users.updateRolesSuccess",{defaultValue:"User roles updated successfully"})),i(!1),x.resetFields(),p(null),$()},onError:d=>{t.message.error((d==null?void 0:d.err)||n("settings.organizations.users.updateRolesFailed",{defaultValue:"Failed to update user roles"}))}}),{run:Q}=V.useRequest(d=>Z.removeUserFromOrganization({id:a,user_id:d}),{manual:!0,onSuccess:()=>{t.message.success(n("settings.organizations.users.removeSuccess",{defaultValue:"User removed from organization successfully"})),$()},onError:d=>{t.message.error((d==null?void 0:d.err)||n("settings.organizations.users.removeFailed",{defaultValue:"Failed to remove user from organization"}))}}),r=()=>{R(!0),c.resetFields()},C=d=>{var U;p(d),x.setFieldsValue({role_ids:((U=d.organization_roles)==null?void 0:U.map(J=>J.id))||[]}),i(!0)},G=d=>{t.Modal.confirm({title:n("settings.organizations.users.removeConfirm",{defaultValue:"Remove User"}),content:n("settings.organizations.users.removeConfirmContent",{defaultValue:`Are you sure you want to remove user "${d.full_name||d.username}" from this organization? This will also remove all their roles in this organization.`}),onOk:()=>Q(d.id)})},H=()=>{c.validateFields().then(d=>{se(d)})},W=()=>{x.validateFields().then(d=>{ae(d)})},X=((oe=z==null?void 0:z.data)==null?void 0:oe.filter(d=>{var U;return!((U=P==null?void 0:P.data)!=null&&U.some(J=>J.id===d.id))}))||[],ue=[{title:n("settings.organizations.users.username",{defaultValue:"Username"}),dataIndex:"username",key:"username"},{title:n("settings.organizations.users.email",{defaultValue:"Email"}),dataIndex:"email",key:"email"},{title:n("settings.organizations.users.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name",key:"full_name"},{title:n("settings.organizations.users.status",{defaultValue:"Status"}),dataIndex:"status",key:"status",render:d=>e.jsxRuntimeExports.jsx(t.Tag,{color:d==="active"?"green":"default",children:d==="active"?n("settings.organizations.active",{defaultValue:"Active"}):d})},{title:n("settings.organizations.users.roles",{defaultValue:"Roles"}),key:"roles",render:(d,U)=>{var J;return e.jsxRuntimeExports.jsx(t.Space,{wrap:!0,children:((J=U.organization_roles)==null?void 0:J.map(re=>e.jsxRuntimeExports.jsx(t.Tag,{children:re.name},re.id)))||e.jsxRuntimeExports.jsx(t.Tag,{children:"No roles"})})}},{title:E("actions",{defaultValue:"Actions"}),key:"actions",render:(d,U)=>e.jsxRuntimeExports.jsx(N.Actions,{actions:[{key:"edit",label:n("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),icon:e.jsxRuntimeExports.jsx(S.EditOutlined,{}),onClick:async()=>C(U)},{key:"delete",label:n("settings.organizations.users.remove",{defaultValue:"Remove"}),icon:e.jsxRuntimeExports.jsx(S.DeleteOutlined,{}),danger:!0,onClick:async()=>G(U)}]})}];return e.jsxRuntimeExports.jsxs("div",{children:[e.jsxRuntimeExports.jsx(t.Card,{title:e.jsxRuntimeExports.jsxs(t.Space,{children:[e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(S.ArrowLeftOutlined,{}),onClick:()=>s("/system/settings#organizations"),children:E("back",{defaultValue:"Back"})}),e.jsxRuntimeExports.jsxs("span",{children:[n("settings.organizations.detail",{defaultValue:"Organization Detail"}),": ",F==null?void 0:F.name]})]}),extra:e.jsxRuntimeExports.jsx(t.Button,{icon:e.jsxRuntimeExports.jsx(S.ReloadOutlined,{}),onClick:()=>{D(),$()},children:E("refresh",{defaultValue:"Refresh"})}),loading:y,children:e.jsxRuntimeExports.jsxs(t.Descriptions,{column:2,bordered:!0,children:[e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:n("settings.organizations.name",{defaultValue:"Name"}),children:F==null?void 0:F.name}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:n("settings.organizations.status",{defaultValue:"Status"}),children:e.jsxRuntimeExports.jsx(t.Tag,{color:(F==null?void 0:F.status)==="active"?"green":"default",children:(F==null?void 0:F.status)==="active"?n("settings.organizations.active",{defaultValue:"Active"}):n("settings.organizations.disabled",{defaultValue:"Disabled"})})}),e.jsxRuntimeExports.jsx(t.Descriptions.Item,{label:n("settings.organizations.description",{defaultValue:"Description"}),span:2,children:(F==null?void 0:F.description)||"-"})]})}),e.jsxRuntimeExports.jsx(t.Card,{title:n("settings.organizations.users.title",{defaultValue:"Organization Users"}),extra:e.jsxRuntimeExports.jsx(t.Button,{type:"primary",icon:e.jsxRuntimeExports.jsx(S.PlusOutlined,{}),onClick:r,children:n("settings.organizations.users.add",{defaultValue:"Add User"})}),style:{marginTop:16},children:e.jsxRuntimeExports.jsxs(t.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[e.jsxRuntimeExports.jsx(t.Input.Search,{placeholder:n("settings.organizations.users.searchPlaceholder",{defaultValue:"Search users..."}),allowClear:!0,onSearch:d=>{w(d),m(1)},style:{width:300}}),e.jsxRuntimeExports.jsx(t.Table,{columns:ue,dataSource:(P==null?void 0:P.data)||[],loading:K,rowKey:"id",pagination:{current:_,pageSize:v,total:(P==null?void 0:P.total)||0,showSizeChanger:!0,showTotal:d=>E("pagination.total",{defaultValue:`Total ${d} items`}),onChange:(d,U)=>{m(d),I(U)}}})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:n("settings.organizations.users.add",{defaultValue:"Add User"}),open:b,onOk:H,onCancel:()=>{R(!1),c.resetFields()},confirmLoading:q,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:c,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{name:"user_id",label:n("settings.organizations.users.user",{defaultValue:"User"}),rules:[{required:!0,message:n("settings.organizations.users.userRequired",{defaultValue:"Please select a user"})}],children:e.jsxRuntimeExports.jsx(t.Select,{showSearch:!0,placeholder:n("settings.organizations.users.selectUser",{defaultValue:"Select a user"}),loading:B,filterOption:(d,U)=>((U==null?void 0:U.label)??"").toLowerCase().includes(d.toLowerCase()),options:X.map(d=>({label:`${d.full_name||d.username} (${d.email})`,value:d.id}))})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:n("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:n("settings.organizations.users.selectRoles",{defaultValue:"Select roles (optional)"}),loading:o,options:((ie=h==null?void 0:h.data)==null?void 0:ie.map(d=>({label:d.name,value:d.id})))||[]})})]})}),e.jsxRuntimeExports.jsx(t.Modal,{title:n("settings.organizations.users.editRoles",{defaultValue:"Edit Roles"}),open:f,onOk:W,onCancel:()=>{i(!1),x.resetFields(),p(null)},confirmLoading:ne,width:600,children:e.jsxRuntimeExports.jsxs(t.Form,{form:x,layout:"vertical",children:[e.jsxRuntimeExports.jsx(t.Form.Item,{label:n("settings.organizations.users.user",{defaultValue:"User"}),children:e.jsxRuntimeExports.jsx(t.Input,{value:(u==null?void 0:u.full_name)||(u==null?void 0:u.username),disabled:!0})}),e.jsxRuntimeExports.jsx(t.Form.Item,{name:"role_ids",label:n("settings.organizations.users.roles",{defaultValue:"Roles"}),children:e.jsxRuntimeExports.jsx(t.Select,{mode:"multiple",placeholder:n("settings.organizations.users.selectRoles",{defaultValue:"Select roles"}),loading:o,options:((le=h==null?void 0:h.data)==null?void 0:le.map(d=>({label:d.name,value:d.id})))||[]})})]})})]})},Ae=Object.freeze(Object.defineProperty({__proto__:null,default:ke},Symbol.toStringTag,{value:"Module"})),ze=()=>{const{t:s}=M.useTranslation("system"),[a]=te.useSearchParams(),n=a.get("provider"),E=a.get("code"),c=a.get("state"),[x,b]=g.useState(null),[R,f]=g.useState(null),[i,u]=g.useState(null);return V.useRequest(async()=>{if(!E||!c||!n)throw new Error(s("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const p=await T.api.system.testOauthCallback({code:E,state:c,provider:n});if(!p.user_info)throw new Error(s("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!p.user)throw new Error(s("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));b(p.user),f(p.user_info)},{onSuccess:()=>{u({status:"success",message:s("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:p=>{u({status:"error",message:s("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:p.message})}}),i?e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(t.Result,{status:i.status,title:i.message,subTitle:i.error,extra:e.jsxRuntimeExports.jsxs(t.Space,{style:{display:!R||!x?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsxRuntimeExports.jsx(fe,{src:R||{}})}),e.jsxRuntimeExports.jsx(t.Card,{title:s("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsxRuntimeExports.jsx(fe,{src:x||{}})})]})})}):e.jsxRuntimeExports.jsx(N.Loading,{})},qe=Object.freeze(Object.defineProperty({__proto__:null,default:ze},Symbol.toStringTag,{value:"Module"}));exports.OAuthTestCallback=qe;exports.OrganizationDetail=Ae;exports.index=we;
