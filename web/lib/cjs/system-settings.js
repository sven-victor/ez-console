"use strict";const e=require("./vendor.js"),g=require("react"),j=require("./index.js"),k=require("./base.js"),_=require("./components.js"),C=require("react-router-dom"),S=/^(https?:\/\/)(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])(:[0-9]+)?(\/[\w\-._~:/?#[\]@!$&'()*+,;=]*)*$/,L={github:{email_field:"email",username_field:"login",full_name_field:"name",avatar_field:"avatar_url",role_field:"",icon_url:"https://github.githubassets.com/favicons/favicon.svg",display_name:"GitHub",endpoints:{auth_endpoint:"https://github.com/login/oauth/authorize",token_endpoint:"https://github.com/login/oauth/access_token",userinfo_endpoint:"https://api.github.com/user"},scope:"user:email"},google:{email_field:"email",username_field:"email",full_name_field:"name",avatar_field:"picture",role_field:"",icon_url:"https://www.google.com/favicon.ico",display_name:"Google",endpoints:{auth_endpoint:"https://accounts.google.com/o/oauth2/v2/auth",token_endpoint:"https://oauth2.googleapis.com/token",userinfo_endpoint:"https://openidconnect.googleapis.com/v1/userinfo"},scope:"profile email"},dingtalk:{email_field:"email",username_field:"nick",full_name_field:"name",avatar_field:"avatar",role_field:"",icon_url:"https://img.alicdn.com/tfs/TB1pTD.XQT2gK0jSZFkXXcIQFXa-160-160.png",display_name:"DingTalk",endpoints:{auth_endpoint:"https://oapi.dingtalk.com/connect/qrconnect",token_endpoint:"https://oapi.dingtalk.com/gettoken",userinfo_endpoint:"https://oapi.dingtalk.com/topapi/user/get"},scope:"snsapi_login"},wechat:{email_field:"",username_field:"openid",full_name_field:"nickname",avatar_field:"headimgurl",role_field:"",icon_url:"https://res.wx.qq.com/a/wx_fed/assets/res/NTI4MWU5.ico",display_name:"WeChat",endpoints:{auth_endpoint:"https://open.weixin.qq.com/connect/qrconnect",token_endpoint:"https://api.weixin.qq.com/sns/oauth2/access_token",userinfo_endpoint:"https://api.weixin.qq.com/sns/userinfo"},scope:"snsapi_login"},custom:{email_field:"",username_field:"",full_name_field:"",avatar_field:"",role_field:"",icon_url:"",display_name:"",endpoints:{auth_endpoint:"",token_endpoint:"",userinfo_endpoint:""},scope:""}},M=({initialData:t,onRefresh:c})=>{const{t:s}=e.useTranslation("system"),{t:h}=e.useTranslation("common"),[r]=e.Form.useForm(),[u,x]=g.useState((t==null?void 0:t.provider)||"custom"),[p,d]=g.useState((t==null?void 0:t.provider)==="custom"||(t==null?void 0:t.provider)==="autoDiscover"),[n,l]=g.useState((t==null?void 0:t.enabled)||!1),[i,y]=g.useState((t==null?void 0:t.auto_create_user)||!1),{loading:f,data:E,refresh:o}=e.useRequest(j.api.system.getOauthSettings,{manual:!!t,onSuccess:a=>{r.setFieldsValue(a),x(a.provider),d(a.provider==="custom"||a.provider==="autoDiscover"),l(a.enabled),y(a.auto_create_user)},onError:a=>{e.staticMethods.error(s("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get OAuth settings",a)}});g.useEffect(()=>{t&&(r.setFieldsValue(t),x(t.provider),d(t.provider==="custom"||t.provider==="autoDiscover"),l(t.enabled),y(t.auto_create_user))},[t,r]);const R=a=>{x(a),d(a==="custom"||a==="autoDiscover");const b=L[a];b&&r.setFieldsValue({auth_endpoint:b.endpoints.auth_endpoint,token_endpoint:b.endpoints.token_endpoint,userinfo_endpoint:b.endpoints.userinfo_endpoint,scope:b.scope,email_field:b.email_field,username_field:b.username_field,full_name_field:b.full_name_field,avatar_field:b.avatar_field,role_field:b.role_field,icon_url:b.icon_url,display_name:b.display_name})},V=a=>{l(a)},I=a=>{y(a)},{loading:m,run:F}=e.useRequest(j.api.system.updateOauthSettings,{manual:!0,onSuccess:()=>{e.staticMethods.success(s("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),c?c():o()},onError:a=>{e.staticMethods.error(s("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update OAuth settings",a)}}),A=a=>{F(a)},w=()=>{c?c():o()},{loading:q,run:P}=e.useRequest(async({redirect_uri:a,...b})=>{let v;return a?v=new URL(a):v=new URL(window.location.origin),v.pathname=k.getURL("/system/settings/oauth/test-callback"),v.searchParams.set("provider",u),j.api.system.testOauthConnection({redirect_uri:v.toString(),...b})},{manual:!0,onSuccess:({url:a})=>{window.open(a,"_blank")},onError:a=>{e.staticMethods.error(s("settings.oauth.testConnection.failed",{defaultValue:"Failed to test connection: {{error}}",error:a.message})),console.error("Failed to test OAuth connection",a)}}),T=()=>u==="custom";return e.jsxRuntimeExports.jsx(e.Spin,{spinning:f,children:e.jsxRuntimeExports.jsxs(e.Form,{form:r,layout:"vertical",onFinish:A,initialValues:t||E,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{name:"enabled",label:s("settings.oauth.enabled.label",{defaultValue:"Enable OAuth"}),valuePropName:"checked",tooltip:s("settings.oauth.enabled.tooltip",{defaultValue:"Enable or disable OAuth login for the system."}),children:e.jsxRuntimeExports.jsx(e.Switch,{onChange:V})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"provider",label:s("settings.oauth.provider.label",{defaultValue:"OAuth Provider"}),tooltip:s("settings.oauth.provider.tooltip",{defaultValue:"Select an OAuth provider or configure a custom one."}),rules:[{required:n,message:s("settings.oauth.provider.required",{defaultValue:"Please select an OAuth provider."})}],children:e.jsxRuntimeExports.jsxs(e.Select,{onChange:R,disabled:!n,children:[e.jsxRuntimeExports.jsx(e.Select.Option,{value:"github",children:s("settings.oauth.provider.options.github",{defaultValue:"GitHub"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"google",children:s("settings.oauth.provider.options.google",{defaultValue:"Google"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"dingtalk",children:s("settings.oauth.provider.options.dingtalk",{defaultValue:"DingTalk"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"wechat",children:s("settings.oauth.provider.options.wechat",{defaultValue:"WeChat"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"autoDiscover",children:s("settings.oauth.provider.options.autoDiscover",{defaultValue:"Auto Discover"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"custom",children:s("settings.oauth.provider.options.custom",{defaultValue:"Custom"})})]})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"display_name",label:s("settings.oauth.displayName.label",{defaultValue:"Display Name"}),tooltip:s("settings.oauth.displayName.tooltip",{defaultValue:"The name displayed on the login button for this provider."}),children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n,placeholder:u!=="custom"?s(`settings.oauth.provider.options.${u}`,{defaultValue:u}):""})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"icon_url",label:s("settings.oauth.iconUrl.label",{defaultValue:"Icon URL"}),tooltip:s("settings.oauth.iconUrl.tooltip",{defaultValue:"URL of the icon for this provider. Displayed on the login button."}),rules:[{pattern:S,message:s("settings.oauth.iconUrl.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n,placeholder:"https://example.com/icon.png"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"client_id",label:s("settings.oauth.clientId.label",{defaultValue:"Client ID"}),tooltip:s("settings.oauth.clientId.tooltip",{defaultValue:"The Client ID provided by the OAuth provider."}),rules:[{required:n,message:s("settings.oauth.clientId.required",{defaultValue:"Client ID is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"client_secret",label:s("settings.oauth.clientSecret.label",{defaultValue:"Client Secret"}),tooltip:s("settings.oauth.clientSecret.tooltip",{defaultValue:"The Client Secret provided by the OAuth provider. This will be stored encrypted."}),rules:[{required:n,message:s("settings.oauth.clientSecret.required",{defaultValue:"Client Secret is required."})}],children:e.jsxRuntimeExports.jsx(e.Input.Password,{disabled:!n,autoComplete:"off",visibilityToggle:!1,placeholder:s("settings.oauth.clientSecret.unchanged",{defaultValue:"Leave blank to keep unchanged"})})}),T()&&e.jsxRuntimeExports.jsx(e.Form.Item,{name:"auth_endpoint",label:s("settings.oauth.authEndpoint.label",{defaultValue:"Authorization Endpoint"}),tooltip:s("settings.oauth.authEndpoint.tooltip",{defaultValue:"The authorization endpoint URL of the OAuth provider."}),rules:[{required:n&&u==="custom",message:s("settings.oauth.authEndpoint.required",{defaultValue:"Authorization Endpoint is required."})},{pattern:S,message:s("settings.oauth.authEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"wellknown_endpoint",hidden:u!=="autoDiscover",label:s("settings.oauth.wellknownEndpoint.label",{defaultValue:"Wellknown Endpoint"}),tooltip:s("settings.oauth.wellknownEndpoint.tooltip",{defaultValue:"The wellknown endpoint URL of the OAuth provider."}),rules:[{pattern:S,message:s("settings.oauth.wellknownEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})},{required:n&&u==="autoDiscover",message:s("settings.oauth.wellknownEndpoint.required",{defaultValue:"Wellknown Endpoint is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),T()&&e.jsxRuntimeExports.jsx(e.Form.Item,{name:"token_endpoint",label:s("settings.oauth.tokenEndpoint.label",{defaultValue:"Token Endpoint"}),tooltip:s("settings.oauth.tokenEndpoint.tooltip",{defaultValue:"The token endpoint URL of the OAuth provider."}),rules:[{required:n&&u==="custom",message:s("settings.oauth.tokenEndpoint.required",{defaultValue:"Token Endpoint is required."})},{pattern:S,message:s("settings.oauth.tokenEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),T()&&e.jsxRuntimeExports.jsx(e.Form.Item,{name:"userinfo_endpoint",label:s("settings.oauth.userInfoEndpoint.label",{defaultValue:"User Info Endpoint"}),tooltip:s("settings.oauth.userInfoEndpoint.tooltip",{defaultValue:"The user information endpoint URL of the OAuth provider."}),rules:[{required:n&&u==="custom",message:s("settings.oauth.userInfoEndpoint.required",{defaultValue:"User Info Endpoint is required."})},{pattern:S,message:s("settings.oauth.userInfoEndpoint.invalidUrl",{defaultValue:"Please enter a valid URL."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"scope",label:s("settings.oauth.scope.label",{defaultValue:"Authorization Scope"}),tooltip:s("settings.oauth.scope.tooltip",{defaultValue:"The scopes to request from the OAuth provider, separated by spaces."}),rules:[{required:n,message:s("settings.oauth.scope.required",{defaultValue:"Scope is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"redirect_uri",label:s("settings.oauth.redirectUri.label",{defaultValue:"Redirect URI"}),tooltip:s("settings.oauth.redirectUri.tooltip",{defaultValue:"The Redirect URI registered with the OAuth provider. This should match the one configured in your application."}),rules:[a=>a.getFieldValue("redirect_uri")!==""?{pattern:S,message:s("settings.oauth.redirectUri.invalidUrl",{defaultValue:"Please enter a valid URL."})}:{required:!1}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n,placeholder:`http://${window.location.host}${k.getURL(`/login?provider=settings.${u}`)}`})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"auto_create_user",label:s("settings.oauth.autoCreateUser.label",{defaultValue:"Auto Create User"}),valuePropName:"checked",tooltip:s("settings.oauth.autoCreateUser.tooltip",{defaultValue:"Automatically create a new user if one does not exist with the OAuth email."}),children:e.jsxRuntimeExports.jsx(e.Switch,{onChange:I,disabled:!n})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"default_role",label:s("settings.oauth.defaultRole.label",{defaultValue:"Default Role"}),tooltip:s("settings.oauth.defaultRole.tooltip",{defaultValue:"The default role to assign to new users created via OAuth. Enter role ID."}),rules:[{required:n&&i,message:s("settings.oauth.defaultRole.required",{defaultValue:"Default Role is required when auto create user is enabled."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!n||!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"mfa_enabled",label:s("settings.oauth.mfaEnabled.label",{defaultValue:"MFA Enabled"}),valuePropName:"checked",tooltip:s("settings.oauth.mfaEnabled.tooltip",{defaultValue:"Enable MFA for OAuth login(Only valid when MFA is enabled by the user)."}),children:e.jsxRuntimeExports.jsx(e.Switch,{disabled:!n})}),e.jsxRuntimeExports.jsx(e.Divider,{children:s("settings.oauth.fieldMapping.title",{defaultValue:"Field Mapping"})}),e.jsxRuntimeExports.jsx(e.Alert,{style:{marginBottom:16},type:"info",showIcon:!0,message:s("settings.oauth.fieldMapping.autoDetectHint",{defaultValue:"For preset providers, fields are typically auto-detected. Customize if needed."}),description:p?"":s("settings.oauth.fieldMapping.presetDescription",{defaultValue:'These fields are pre-filled based on the selected provider. You can switch to "Custom" provider to edit them directly.'})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"email_field",label:s("settings.oauth.fieldMapping.emailField.label",{defaultValue:"Email Field"}),tooltip:s("settings.oauth.fieldMapping.emailField.tooltip",{defaultValue:"The field name in the user info response that contains the user email. (e.g., email)"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"email",disabled:!n||!p})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"username_field",label:s("settings.oauth.fieldMapping.usernameField.label",{defaultValue:"Username Field"}),tooltip:s("settings.oauth.fieldMapping.usernameField.tooltip",{defaultValue:"The field name in the user info response that contains the username. (e.g., login, sub)"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"login",autoComplete:"off",disabled:!n||!p})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"full_name_field",label:s("settings.oauth.fieldMapping.fullNameField.label",{defaultValue:"Full Name Field"}),tooltip:s("settings.oauth.fieldMapping.fullNameField.tooltip",{defaultValue:"The field name in the user info response that contains the user's full name. (e.g., name)"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"name",disabled:!n||!p})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"avatar_field",label:s("settings.oauth.fieldMapping.avatarField.label",{defaultValue:"Avatar URL Field"}),tooltip:s("settings.oauth.fieldMapping.avatarField.tooltip",{defaultValue:"The field name in the user info response that contains the URL to the user's avatar. (e.g., picture, avatar_url)"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"avatar_url",disabled:!n||!p})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"role_field",label:s("settings.oauth.fieldMapping.roleField.label",{defaultValue:"Role Field"}),tooltip:s("settings.oauth.fieldMapping.roleField.tooltip",{defaultValue:"The field name in the user info response that contains the user's role. (Optional)"}),children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"role",disabled:!n||!p})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:m,icon:e.jsxRuntimeExports.jsx(e.RefIcon$35,{}),children:h("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(e.Button,{loading:q,onClick:async()=>{const a=r.getFieldsValue();P(a)},children:s("settings.oauth.testConnection.button",{defaultValue:"Test Connection"})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:w,icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),children:h("refresh",{defaultValue:"Refresh"})})]})})]})})},U=()=>{const{t}=e.useTranslation("system"),{t:c}=e.useTranslation("common"),[s]=e.Form.useForm(),{loading:h,data:r,refresh:u}=e.useRequest(j.api.system.getSecuritySettings,{onSuccess:n=>{s.setFieldsValue(n)},onError:n=>{e.staticMethods.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",n)}}),{loading:x,run:p}=e.useRequest(j.api.system.updateSecuritySettings,{manual:!0,onSuccess:()=>{e.staticMethods.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),u()},onError:n=>{e.staticMethods.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",n)}}),d=n=>{p(n)};return e.jsxRuntimeExports.jsx(e.Spin,{spinning:h,children:e.jsxRuntimeExports.jsxs(e.Form,{form:s,layout:"vertical",onFinish:d,initialValues:r,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{name:"mfa_enforced",label:t("settings.security.mfa.label",{defaultValue:"Enforce Multi-Factor Authentication (MFA)"}),valuePropName:"checked",tooltip:t("settings.security.mfa.tooltip",{defaultValue:"If enabled, all users will be required to set up MFA."}),children:e.jsxRuntimeExports.jsx(e.Switch,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"password_complexity",label:t("settings.security.passwordComplexity.label",{defaultValue:"Password Complexity"}),tooltip:t("settings.security.passwordComplexity.tooltip",{defaultValue:"Define the complexity requirements for user passwords."}),children:e.jsxRuntimeExports.jsxs(e.Select,{children:[e.jsxRuntimeExports.jsx(e.Select.Option,{value:"low",children:t("settings.security.passwordComplexity.options.low",{defaultValue:"Low"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"medium",children:t("settings.security.passwordComplexity.options.medium",{defaultValue:"Medium"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"high",children:t("settings.security.passwordComplexity.options.high",{defaultValue:"High"})}),e.jsxRuntimeExports.jsx(e.Select.Option,{value:"very_high",children:t("settings.security.passwordComplexity.options.veryHigh",{defaultValue:"Very High"})})]})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"password_min_length",label:t("settings.security.passwordMinLength.label",{defaultValue:"Minimum Password Length"}),tooltip:t("settings.security.passwordMinLength.tooltip",{defaultValue:"The minimum number of characters required for a password."}),rules:[{type:"number",min:6,max:32}],children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:6,max:32,style:{width:"100%"}})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"password_expiry_days",label:t("settings.security.passwordExpiry.label",{defaultValue:"Password Expiry (Days)"}),tooltip:t("settings.security.passwordExpiry.tooltip",{defaultValue:"Number of days after which passwords expire. Set to 0 to disable expiry."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"login_failure_lock",label:t("settings.security.loginFailureLock.label",{defaultValue:"Lock Account on Login Failure"}),valuePropName:"checked",tooltip:t("settings.security.loginFailureLock.tooltip",{defaultValue:"Lock user accounts after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(e.Switch,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{noStyle:!0,shouldUpdate:(n,l)=>n.login_failure_lock!==l.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsxRuntimeExports.jsx(e.Form.Item,{name:"login_failure_attempts",label:t("settings.security.loginFailureAttempts.label",{defaultValue:"Login Failure Attempts"}),tooltip:t("settings.security.loginFailureAttempts.tooltip",{defaultValue:"Number of failed login attempts before locking the account."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(e.Form.Item,{noStyle:!0,shouldUpdate:(n,l)=>n.login_failure_lock!==l.login_failure_lock,children:({getFieldValue:n})=>n("login_failure_lock")?e.jsxRuntimeExports.jsx(e.Form.Item,{name:"login_failure_lockout_minutes",label:t("settings.security.loginFailureLockoutMinutes.label",{defaultValue:"Login Failure Lockout (Minutes)"}),tooltip:t("settings.security.loginFailureLockoutMinutes.tooltip",{defaultValue:"Number of minutes to lock the account after a specified number of failed login attempts."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:1,max:10,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}):null}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"history_password_check",label:t("settings.security.historyPasswordCheck.label",{defaultValue:"Enforce Password History Policy"}),valuePropName:"checked",tooltip:t("settings.security.historyPasswordCheck.tooltip",{defaultValue:"Prevent users from reusing recent passwords."}),children:e.jsxRuntimeExports.jsx(e.Switch,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{noStyle:!0,shouldUpdate:(n,l)=>n.history_password_check!==l.history_password_check,children:({getFieldValue:n})=>n("history_password_check")?e.jsxRuntimeExports.jsx(e.Form.Item,{name:"history_password_count",label:t("settings.security.historyPasswordCount.label",{defaultValue:"Password History Count"}),tooltip:t("settings.security.historyPasswordCount.tooltip",{defaultValue:"Number of previous passwords to remember and prevent reuse."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:1,max:10,style:{width:"100%"}})}):null}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"inactive_account_lock_days",label:t("settings.security.inactiveAccountLock.label",{defaultValue:"Auto-lock Inactive Accounts (Days)"}),tooltip:t("settings.security.inactiveAccountLock.tooltip",{defaultValue:"Number of days of inactivity after which user accounts are automatically locked. Set to 0 to disable."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:0,style:{width:"100%"},addonAfter:t("settings.days",{defaultValue:"Days"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"session_timeout_minutes",label:t("settings.security.sessionTimeout.label",{defaultValue:"Session Timeout (Minutes)"}),tooltip:t("settings.security.sessionTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"session_idle_timeout_minutes",label:t("settings.security.sessionIdleTimeout.label",{defaultValue:"Session Idle Timeout (Minutes)"}),tooltip:t("settings.security.sessionIdleTimeout.tooltip",{defaultValue:"Automatically log out users after a period of inactivity."}),children:e.jsxRuntimeExports.jsx(e.TypedInputNumber,{min:5,style:{width:"100%"},addonAfter:t("settings.minutes",{defaultValue:"Minutes"})})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:x,icon:e.jsxRuntimeExports.jsx(e.RefIcon$35,{}),children:c("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>u(),icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),children:c("refresh",{defaultValue:"Refresh"})})]})})]})})},N=({fetchItems:t,importItems:c,columns:s,...h})=>{const{t:r}=e.useTranslation("system"),[u,x]=g.useState([]),[p,d]=g.useState([]),{run:n,loading:l}=e.useRequest(t,{onError:f=>{e.staticMethods.error(r("settings.ldap.importError",{error:`${f.message}`}))},onSuccess:f=>{x(f)},manual:!0}),{run:i,loading:y}=e.useRequest(async()=>{for(const f of p.filter(E=>{const o=u.find(R=>R.ldap_dn===E);return!(!o||o.status==="imported")})){const E=await c([f]);x(o=>[...o].map(V=>{for(const I of E)if(V.ldap_dn===I.ldap_dn)return{...I,status:"imported"};return V}))}},{manual:!0});return g.useEffect(()=>{h.visible&&(x([]),n(),d([]))},[h.visible]),e.jsxRuntimeExports.jsx(e.Modal,{title:r("settings.ldap.importTitle"),...h,onOk:()=>{i()},width:900,confirmLoading:y,loading:l,children:e.jsxRuntimeExports.jsx(e.ForwardTable,{rowKey:"ldap_dn",rowSelection:{onChange:f=>{d(f)},getCheckboxProps:f=>({disabled:f.status==="imported"})},columns:s.map(({render:f,...E})=>f?{...E,render:(o,R,V)=>{const I=p.includes(R.ldap_dn)&&y&&R.status!=="imported";return f(o,R,V,I)}}:E),dataSource:u,pagination:!1,scroll:{y:400,x:"max-content"}})})},O=()=>{var R,V,I;const{t}=e.useTranslation("system"),[c]=e.Form.useForm(),[s,h]=g.useState(!1),[r,u]=g.useState(null),[x,p]=g.useState(!1),[d,n]=g.useState(!1),[l]=e.Form.useForm(),[i,y]=g.useState(!1);e.useRequest(j.api.system.getLdapSettings,{onSuccess:m=>{c.setFieldsValue(m),y(m.enabled)},onError:m=>{e.staticMethods.error(t("settings.ldap.loadError",{defaultValue:"Failed to load LDAP settings: {{error}}",error:`${m.message}`}))}}),g.useEffect(()=>{u(null)},[x]);const f=async m=>{h(!0);try{await j.api.system.updateLdapSettings(m),e.staticMethods.success(t("settings.ldap.saveSuccess",{defaultValue:"LDAP settings saved successfully."}))}catch{e.staticMethods.error(t("settings.ldap.saveError",{defaultValue:"Failed to save LDAP settings."}))}finally{h(!1)}},{run:E,loading:o}=e.useRequest(async m=>{const F=await c.validateFields();return await j.api.system.testLdapConnection({...m,...F})},{onSuccess:m=>{u(m)},onError:m=>{e.staticMethods.error(t("settings.ldap.testError",{defaultValue:"LDAP connection test failed: {{error}}",error:`${m.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs(e.Form,{form:c,layout:"vertical",onFinish:f,initialValues:{user_attr:"uid",email_attr:"mail",display_name_attr:"displayName",default_role:"user"},children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.enabled",{defaultValue:"Enable LDAP Authentication"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(e.Switch,{onChange:m=>y(m)})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.serverUrl",{defaultValue:"LDAP Server URL"}),name:"server_url",rules:[{required:i,message:t("settings.ldap.serverUrlRequired",{defaultValue:"LDAP Server URL is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i,placeholder:"ldap://ldap.example.com:389"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.bindDn",{defaultValue:"Bind DN"}),name:"bind_dn",rules:[{required:i,message:t("settings.ldap.bindDnRequired",{defaultValue:"Bind DN is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i,placeholder:"cn=admin,dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.bindPassword",{defaultValue:"Bind Password"}),name:"bind_password",rules:[{required:i,message:t("settings.ldap.bindPasswordRequired",{defaultValue:"Bind Password is required."})}],children:e.jsxRuntimeExports.jsx(e.Input.Password,{hidden:!0,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.baseDn",{defaultValue:"Base DN"}),name:"base_dn",rules:[{required:i,message:t("settings.ldap.baseDnRequired",{defaultValue:"Base DN is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i,placeholder:"dc=example,dc=com"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.userFilter",{defaultValue:"User Filter"}),name:"user_filter",children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i,hidden:!0,autoComplete:"off",placeholder:"(objectClass=person)"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.userAttr",{defaultValue:"User Attribute"}),name:"user_attr",rules:[{required:i,message:t("settings.ldap.userAttrRequired",{defaultValue:"User Attribute is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.emailAttr",{defaultValue:"Email Attribute"}),name:"email_attr",rules:[{required:i,message:t("settings.ldap.emailAttrRequired",{defaultValue:"Email Attribute is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.displayNameAttr",{defaultValue:"Display Name Attribute"}),name:"display_name_attr",rules:[{required:i,message:t("settings.ldap.displayNameAttrRequired",{defaultValue:"Display Name Attribute is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.defaultRole",{defaultValue:"Default Role"}),name:"default_role",rules:[{required:i,message:t("settings.ldap.defaultRoleRequired",{defaultValue:"Default Role is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{name:"timeout",label:t("settings.ldap.timeout",{defaultValue:"Timeout"}),tooltip:t("settings.ldap.timeoutTooltip",{defaultValue:"Timeout for LDAP connection in seconds"}),children:e.jsxRuntimeExports.jsx(e.Input,{type:"number",defaultValue:15,disabled:!i})}),e.jsxRuntimeExports.jsx(e.Divider,{children:t("settings.ldap.tlsDivider",{defaultValue:"TLS Configuration"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.startTls",{defaultValue:"Use StartTLS"}),name:"start_tls",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(e.Switch,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.insecure",{defaultValue:"Skip TLS Verification (Insecure)"}),name:"insecure",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(e.Switch,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.caCert",{defaultValue:"CA Certificate"}),name:"ca_cert",children:e.jsxRuntimeExports.jsx(e.Input.TextArea,{placeholder:t("settings.ldap.caCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.clientCert",{defaultValue:"Client Certificate"}),name:"client_cert",children:e.jsxRuntimeExports.jsx(e.Input.TextArea,{placeholder:t("settings.ldap.clientCertPlaceholder",{defaultValue:`-----BEGIN CERTIFICATE-----
...`}),disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.clientKey",{defaultValue:"Client Key"}),name:"client_key",children:e.jsxRuntimeExports.jsx(e.Input.TextArea,{placeholder:t("settings.ldap.clientKeyPlaceholder",{defaultValue:`-----BEGIN PRIVATE KEY-----
...`}),disabled:!i})}),e.jsxRuntimeExports.jsxs(e.Form.Item,{children:[e.jsxRuntimeExports.jsx(_.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:s,children:t("settings.ldap.save",{defaultValue:"Save Settings"})})}),e.jsxRuntimeExports.jsx(_.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(e.Button,{disabled:!i,style:{marginLeft:8},onClick:()=>p(!0),children:t("settings.ldap.testConnection",{defaultValue:"Test Connection"})})}),e.jsxRuntimeExports.jsx(_.PermissionGuard,{permissions:["authorization:user:create"],children:e.jsxRuntimeExports.jsx(e.Button,{disabled:!i,style:{marginLeft:8},onClick:()=>{n(!0)},children:t("settings.ldap.import",{defaultValue:"Import Users"})})})]})]}),e.jsxRuntimeExports.jsxs(e.Modal,{title:t("settings.ldap.test.title",{defaultValue:"Test LDAP Connection"}),open:x,onCancel:()=>p(!1),footer:null,children:[e.jsxRuntimeExports.jsxs(e.Form,{form:l,layout:"vertical",onFinish:E,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.test.username",{defaultValue:"LDAP Username"}),name:"username",rules:[{required:!0,message:t("settings.ldap.test.usernameRequired",{defaultValue:"Please enter LDAP username for testing."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!i})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.ldap.test.password",{defaultValue:"LDAP Password"}),name:"password",rules:[{required:!0,message:t("settings.ldap.test.passwordRequired",{defaultValue:"Please enter LDAP password for testing."})}],children:e.jsxRuntimeExports.jsx(e.Input.Password,{disabled:!i})}),e.jsxRuntimeExports.jsxs(e.Form.Item,{children:[e.jsxRuntimeExports.jsx(_.PermissionGuard,{permissions:["system:settings:update"],children:e.jsxRuntimeExports.jsx(e.Button,{disabled:!i,type:"primary",htmlType:"submit",children:t("settings.ldap.test.test",{defaultValue:"Test"})})}),e.jsxRuntimeExports.jsx(e.Button,{style:{marginLeft:8},onClick:()=>p(!1),children:t("settings.ldap.test.cancel",{defaultValue:"Cancel"})})]})]}),e.jsxRuntimeExports.jsx(e.Spin,{spinning:o,children:e.jsxRuntimeExports.jsx(e.Skeleton,{active:o,loading:o,children:r&&(r.user?e.jsxRuntimeExports.jsxs(e.Descriptions,{bordered:!0,children:[e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:"Username",span:3,children:r.user.username}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:"Email",span:3,children:r.user.email}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:"FullName",span:3,children:r.user.full_name}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:"CreatedAt",span:3,children:r.user.created_at}),e.jsxRuntimeExports.jsx(e.Descriptions.Item,{label:"UpdatedAt",span:3,children:r.user.updated_at})]}):e.jsxRuntimeExports.jsx(e.Steps,{direction:"vertical",current:(R=r.message)==null?void 0:R.findIndex(m=>!m.success),status:(V=r.message)!=null&&V.find(m=>!m.success)?"error":"finish",items:(I=r.message)==null?void 0:I.map(m=>({status:m.success?"finish":"error",title:m.message}))}))})})]}),e.jsxRuntimeExports.jsx(N,{visible:d,onCancel:()=>n(!1),fetchItems:()=>j.api.system.importLdapUsers({}),importItems:m=>j.api.system.importLdapUsers({user_dn:m}),columns:[{title:t("settings.ldap.username",{defaultValue:"Username"}),dataIndex:"username"},{title:t("settings.ldap.email",{defaultValue:"Email"}),dataIndex:"email"},{title:t("settings.ldap.fullName",{defaultValue:"Full Name"}),dataIndex:"full_name"},{title:t("settings.ldap.importStatus",{defaultValue:"Import Status"}),dataIndex:"imported",fixed:"right",render:(m,F,A,w)=>w?e.jsxRuntimeExports.jsx(e.Spin,{indicator:e.jsxRuntimeExports.jsx(e.RefIcon$36,{spin:!0})}):m?e.jsxRuntimeExports.jsx(e.RefIcon$37,{twoToneColor:"#52c41a"}):F.id?e.jsxRuntimeExports.jsx(e.Tag,{color:"blue",children:t("settings.ldap.importTypeBound",{defaultValue:"Bound"})}):e.jsxRuntimeExports.jsx(e.Tag,{color:"green",children:t("settings.ldap.importTypeNew",{defaultValue:"New"})})}]})]})},D=()=>{const{t}=e.useTranslation("system"),{t:c}=e.useTranslation("common"),[s]=e.Form.useForm(),[h,r]=g.useState(null),[u,x]=g.useState(!1),[p]=e.Form.useForm(),[d,n]=g.useState(!1),{loading:l}=e.useRequest(j.api.system.getSmtpSettings,{onSuccess:o=>{s.setFieldsValue(o),n(o.enabled)},onError:o=>{e.staticMethods.error(t("settings.smtp.loadError",{defaultValue:"Failed to load SMTP settings: {{error}}",error:`${o.message}`}))}});g.useEffect(()=>{r(null)},[u]);const{run:i,loading:y}=e.useRequest(({port:o,...R})=>j.api.system.updateSmtpSettings({...R,port:Number(o)}),{manual:!0,onSuccess:()=>{e.staticMethods.success(t("settings.smtp.saveSuccess",{defaultValue:"SMTP settings saved successfully."}))},onError:o=>{e.staticMethods.error(t("settings.smtp.saveError",{defaultValue:"Failed to save SMTP settings: {{error}}",error:`${o.message}`}))}}),{run:f,loading:E}=e.useRequest(async o=>{const{port:R,...V}=await s.validateFields();return await j.api.system.testSmtpConnection({...o,...V,port:Number(R)})},{onSuccess:o=>{r(o)},onError:o=>{e.staticMethods.error(t("settings.smtp.testError",{defaultValue:"SMTP connection test failed: {{error}}",error:`${o.message}`}))},manual:!0});return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx(e.Spin,{spinning:l,children:e.jsxRuntimeExports.jsxs(e.Form,{form:s,layout:"vertical",onFinish:i,initialValues:{port:587,encryption:"STARTTLS"},children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.enabled",{defaultValue:"Enable SMTP"}),name:"enabled",valuePropName:"checked",children:e.jsxRuntimeExports.jsx(e.Switch,{onChange:o=>n(o)})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.host",{defaultValue:"SMTP Host"}),name:"host",rules:[{required:d,message:t("settings.smtp.hostRequired",{defaultValue:"SMTP Host is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!d,placeholder:"smtp.example.com"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.port",{defaultValue:"SMTP Port"}),name:"port",rules:[{required:d,message:t("settings.smtp.portRequired",{defaultValue:"SMTP Port is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{type:"number",disabled:!d,placeholder:"587"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.username",{defaultValue:"Username"}),name:"username",rules:[{required:d,message:t("settings.smtp.usernameRequired",{defaultValue:"Username is required."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!d,placeholder:"user@example.com"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.password",{defaultValue:"Password"}),name:"password",children:e.jsxRuntimeExports.jsx(e.Input.Password,{disabled:!d,autoComplete:"new-password"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.encryption",{defaultValue:"Encryption"}),name:"encryption",rules:[{required:d,message:t("settings.smtp.encryptionRequired",{defaultValue:"Encryption is required."})}],children:e.jsxRuntimeExports.jsxs(e.Radio.Group,{disabled:!d,children:[e.jsxRuntimeExports.jsx(e.Radio.Button,{value:"None",children:t("settings.smtp.encryptionNone",{defaultValue:"None"})}),e.jsxRuntimeExports.jsx(e.Radio.Button,{value:"SSL/TLS",children:t("settings.smtp.encryptionSslTls",{defaultValue:"SSL/TLS"})}),e.jsxRuntimeExports.jsx(e.Radio.Button,{value:"STARTTLS",children:t("settings.smtp.encryptionStartTls",{defaultValue:"STARTTLS"})})]})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.fromAddress",{defaultValue:"From Address"}),name:"from_address",rules:[{required:d,message:t("settings.smtp.fromAddressRequired",{defaultValue:"From Address is required."})},{type:"email",message:t("settings.smtp.fromAddressInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!d,placeholder:"noreply@example.com"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.fromName",{defaultValue:"From Name"}),name:"from_name",children:e.jsxRuntimeExports.jsx(e.Input,{disabled:!d,placeholder:t("settings.smtp.fromNamePlaceholder",{defaultValue:"System Notifications"})})}),e.jsxRuntimeExports.jsx(e.Divider,{children:t("settings.smtp.templateDivider",{defaultValue:"Template Configuration"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.resetPasswordTemplate",{defaultValue:"Reset Password Template"}),name:"reset_password_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.userLockedTemplate",{defaultValue:"User Locked Template"}),name:"user_locked_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.mfaCodeTemplate",{defaultValue:"MFA Code Template"}),name:"mfa_code_template",children:e.jsxRuntimeExports.jsx(e.ReactQuill,{theme:"snow"})}),e.jsxRuntimeExports.jsxs(e.Form.Item,{children:[e.jsxRuntimeExports.jsx(_.PermissionGuard,{permission:"system:setting:update",children:e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:y,style:{marginRight:8},children:c("save",{defaultValue:"Save"})})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>x(!0),disabled:!d||E,loading:E,children:t("settings.smtp.testConnection",{defaultValue:"Test Connection"})})]})]})}),e.jsxRuntimeExports.jsx(e.Modal,{title:t("settings.smtp.testConnectionTitle",{defaultValue:"Test SMTP Connection"}),open:u,onCancel:()=>x(!1),footer:[e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>x(!1),children:c("cancel",{defaultValue:"Cancel"})},"back"),e.jsxRuntimeExports.jsx(e.Button,{type:"primary",loading:E,onClick:()=>p.submit(),children:t("settings.smtp.sendTestEmail",{defaultValue:"Send Test Email"})},"submit")],children:e.jsxRuntimeExports.jsxs(e.Form,{form:p,layout:"vertical",onFinish:o=>f(o),children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.testEmailRecipient",{defaultValue:"Recipient Email Address"}),name:"to",rules:[{required:!0,message:t("settings.smtp.testEmailRecipientRequired",{defaultValue:"Recipient email address is required."})},{type:"email",message:t("settings.smtp.testEmailRecipientInvalid",{defaultValue:"Invalid email address."})}],children:e.jsxRuntimeExports.jsx(e.Input,{placeholder:"test@example.com"})}),h&&e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.smtp.testResult",{defaultValue:"Test Result"}),children:h.success?e.jsxRuntimeExports.jsx("span",{style:{color:"green"},children:t("settings.smtp.testSuccess",{defaultValue:"Connection successful!"})}):e.jsxRuntimeExports.jsx("span",{style:{color:"red"},children:t("settings.smtp.testFailed",{defaultValue:"Connection failed: {{error}}",error:h.message})})})]})})]})},B=()=>{const{t,i18n:c}=e.useTranslation("system"),{t:s}=e.useTranslation("common"),[h]=e.Form.useForm(),{loading:r,data:u,refresh:x}=e.useRequest(j.api.system.getSystemBaseSettings,{onSuccess:l=>{h.setFieldsValue(l)},onError:l=>{e.staticMethods.error(t("settings.fetchFailed",{defaultValue:"Failed to fetch settings"})),console.error("Failed to get system settings",l)}}),{loading:p,run:d}=e.useRequest(j.api.system.updateSystemBaseSettings,{manual:!0,onSuccess:()=>{e.staticMethods.success(t("settings.updateSuccess",{defaultValue:"Settings updated successfully"})),x()},onError:l=>{e.staticMethods.error(t("settings.updateFailed",{defaultValue:"Failed to update settings"})),console.error("Failed to update system settings",l)}}),n=l=>{d(l)};return e.jsxRuntimeExports.jsx(e.Spin,{spinning:r,children:e.jsxRuntimeExports.jsxs(e.Form,{form:h,layout:"vertical",onFinish:n,initialValues:u,children:[e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.base.name",{defaultValue:"Name"}),children:e.jsxRuntimeExports.jsx(e.Tabs,{items:[{key:"default",label:s("language.default",{defaultValue:"Default"}),forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:"name",children:e.jsxRuntimeExports.jsx(e.Input,{})})})},..._.AllLangUIConfig.map(l=>({key:l.lang,label:c.language!==l.lang?s(`language.${l.lang}`,{defaultValue:l.label,lang:l.label}):l.label,forceRender:!0,children:e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:e.jsxRuntimeExports.jsx(e.Form.Item,{name:["name_i18n",l.lang],children:e.jsxRuntimeExports.jsx(e.Input,{})})})}))]})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.base.logo",{defaultValue:"Logo"}),name:"logo",children:e.jsxRuntimeExports.jsx(e.Input,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.base.homePage",{defaultValue:"Home Page"}),name:"home_page",children:e.jsxRuntimeExports.jsx(e.Input,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{label:t("settings.base.disableLocalUserLogin",{defaultValue:"Disable Local User Login"}),name:"disable_local_user_login",tooltip:t("settings.base.disableLocalUserLoginTooltip",{defaultValue:"Disable local user login, It is only valid when other authentication methods are enabled."}),children:e.jsxRuntimeExports.jsx(e.Switch,{})}),e.jsxRuntimeExports.jsx(e.Form.Item,{children:e.jsxRuntimeExports.jsxs(e.Space,{children:[e.jsxRuntimeExports.jsx(e.Button,{type:"primary",htmlType:"submit",loading:p,icon:e.jsxRuntimeExports.jsx(e.RefIcon$35,{}),children:s("save",{defaultValue:"Save"})}),e.jsxRuntimeExports.jsx(e.Button,{onClick:()=>x(),icon:e.jsxRuntimeExports.jsx(e.RefIcon$11,{}),children:s("refresh",{defaultValue:"Refresh"})})]})})]})})},$=()=>{const{t}=e.useTranslation("system"),c=C.useNavigate(),s=C.useLocation(),u=s.hash.replace("#","")||"base",x=[{key:"base",label:t("settings.tabs.base",{defaultValue:"Base Settings"}),children:e.jsxRuntimeExports.jsx(B,{})},{key:"security",label:t("settings.tabs.security",{defaultValue:"Security Settings"}),children:e.jsxRuntimeExports.jsx(U,{})},{key:"oauth",label:t("settings.tabs.oauth",{defaultValue:"OAuth Settings"}),children:e.jsxRuntimeExports.jsx(M,{})},{key:"ldap",label:t("settings.tabs.ldap",{defaultValue:"LDAP Settings"}),children:e.jsxRuntimeExports.jsx(O,{})},{key:"smtp",label:t("settings.tabs.smtp",{defaultValue:"SMTP Settings"}),children:e.jsxRuntimeExports.jsx(D,{})}];return e.jsxRuntimeExports.jsx(e.Card,{title:t("settings.title",{defaultValue:"System Settings"}),children:e.jsxRuntimeExports.jsx(e.Tabs,{defaultActiveKey:u,onChange:p=>{c(`${s.pathname}#${p}`)},items:x})})},z=Object.freeze(Object.defineProperty({__proto__:null,default:$},Symbol.toStringTag,{value:"Module"})),G=()=>{const{t}=e.useTranslation("system"),[c]=C.useSearchParams(),s=c.get("provider"),h=c.get("code"),r=c.get("state"),[u,x]=g.useState(null),[p,d]=g.useState(null),[n,l]=g.useState(null);return e.useRequest(async()=>{if(!h||!r||!s)throw new Error(t("settings.oauth.testConnection.missingRequiredParameters",{defaultValue:"Missing required parameters"}));const i=await j.api.system.testOauthCallback({code:h,state:r,provider:s});if(!i.user_info)throw new Error(t("settings.oauth.testConnection.responseUserInfoIsNull",{defaultValue:"response user_info is null"}));if(!i.user)throw new Error(t("settings.oauth.testConnection.responseUserIsNull",{defaultValue:"response user is null"}));x(i.user),d(i.user_info)},{onSuccess:()=>{l({status:"success",message:t("settings.oauth.testConnection.success",{defaultValue:"Successfully tested connection"})})},onError:i=>{l({status:"error",message:t("settings.oauth.testConnection.callbackFailed",{defaultValue:"Failed to test connection"}),error:i.message})}}),n?e.jsxRuntimeExports.jsx("div",{children:e.jsxRuntimeExports.jsx(e.Result,{status:n.status,title:n.message,subTitle:n.error,extra:e.jsxRuntimeExports.jsxs(e.Space,{style:{display:!p||!u?"none":"inline-block",textAlign:"left"},direction:"vertical",children:[e.jsxRuntimeExports.jsx(e.Card,{title:t("settings.oauth.testConnection.oauthUserInfo",{defaultValue:"OAuth User Info"}),children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:p||{}})}),e.jsxRuntimeExports.jsx(e.Card,{title:t("settings.oauth.testConnection.loginUserInfo",{defaultValue:"Login User Info"}),style:{marginTop:16},children:e.jsxRuntimeExports.jsx(e.ReactJson,{src:u||{}})})]})})}):e.jsxRuntimeExports.jsx(_.Loading,{})},H=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"}));exports.OAuthTestCallback=H;exports.index=z;
