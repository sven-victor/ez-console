"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const s=require("./vendor.js"),x=require("react"),n=require("antd"),i=require("@ant-design/icons"),p=require("react-i18next"),o=require("./index.js"),u=require("./components.js"),m=require("./base.js"),g={pending:"default",running:"processing",success:"success",failed:"error",cancelled:"default"},w=()=>{const{t:a}=p.useTranslation("task"),{t:c}=p.useTranslation("common"),l=x.useRef(null),[d,j]=x.useState(""),f=async t=>{var e,r;try{await o.api.tasks.cancelTask({id:t}),n.message.success(a("cancelSuccess",{defaultValue:"Task cancelled."})),(r=(e=l.current)==null?void 0:e.reload)==null||r.call(e)}catch{n.message.error(a("cancelFailed",{defaultValue:"Failed to cancel task."}))}},h=async t=>{var e,r;try{await o.api.tasks.retryTask({id:t}),n.message.success(a("retrySuccess",{defaultValue:"Task retry requested."})),(r=(e=l.current)==null?void 0:e.reload)==null||r.call(e)}catch{n.message.error(a("retryFailed",{defaultValue:"Failed to retry task."}))}},k=async t=>{var e,r;try{await o.api.tasks.deleteTask({id:t}),n.message.success(a("deleteSuccess",{defaultValue:"Task deleted."})),(r=(e=l.current)==null?void 0:e.reload)==null||r.call(e)}catch{n.message.error(a("deleteFailed",{defaultValue:"Failed to delete task."}))}},y=async t=>{const e=await o.api.base.downloadFile({fileKey:t},{params:{method:"sign"}}),r=`/api/files/${t}?signature=${e.signature}&expires=${e.expires}`;window.open(r,"_blank")},R=[{title:a("typeLabel",{defaultValue:"Type"}),dataIndex:"type",key:"type",width:120},{title:a("statusLabel",{defaultValue:"Status"}),dataIndex:"status",key:"status",width:100,render:t=>s.jsxRuntimeExports.jsx(n.Tag,{color:g[t]||"default",children:a(`status.${t}`,{defaultValue:t})})},{title:a("progress",{defaultValue:"Progress"}),dataIndex:"progress",key:"progress",width:100,render:(t,e)=>e.status==="running"||e.status==="pending"?`${t}%`:"-"},{title:a("creatorId",{defaultValue:"Creator"}),dataIndex:"creator_id",key:"creator_id",width:120,ellipsis:!0},{title:a("createdAt",{defaultValue:"Created At"}),dataIndex:"created_at",key:"created_at",width:170,render:t=>t?new Date(t).toLocaleString():"-"},{title:c("actions",{defaultValue:"Actions"}),key:"action",width:220,fixed:"right",render:(t,e)=>s.jsxRuntimeExports.jsxs(n.Space,{size:"small",children:[(e.status==="running"||e.status==="pending")&&s.jsxRuntimeExports.jsx(u.PermissionGuard,{permission:"task:cancel",children:s.jsxRuntimeExports.jsx(u.Actions,{actions:[{key:"cancel",label:a("cancel",{defaultValue:"Cancel"}),icon:s.jsxRuntimeExports.jsx(i.StopOutlined,{}),confirm:{title:a("cancelConfirm",{defaultValue:"Cancel this task?"}),onConfirm:()=>f(e.id)}}]})}),(e.status==="failed"||e.status==="cancelled")&&s.jsxRuntimeExports.jsx(u.PermissionGuard,{permission:"task:retry",children:s.jsxRuntimeExports.jsx(n.Tooltip,{title:a("retry",{defaultValue:"Retry"}),children:s.jsxRuntimeExports.jsx(n.Button,{type:"text",size:"small",icon:s.jsxRuntimeExports.jsx(i.RedoOutlined,{}),onClick:()=>h(e.id)})})}),e.artifact_file_key&&s.jsxRuntimeExports.jsx(u.PermissionGuard,{permission:"task:view",children:s.jsxRuntimeExports.jsx(n.Tooltip,{title:a("download",{defaultValue:"Download"}),children:s.jsxRuntimeExports.jsx(n.Button,{type:"text",size:"small",icon:s.jsxRuntimeExports.jsx(i.DownloadOutlined,{}),onClick:()=>y(e.artifact_file_key)})})}),s.jsxRuntimeExports.jsx(u.PermissionGuard,{permission:"task:delete",children:s.jsxRuntimeExports.jsx(u.Actions,{actions:[{key:"delete",label:a("delete",{defaultValue:"Delete"}),icon:s.jsxRuntimeExports.jsx(i.DeleteOutlined,{}),danger:!0,confirm:{title:a("deleteConfirm",{defaultValue:"Delete this task?"}),onConfirm:()=>k(e.id)}}]})})]})}],E=t=>o.api.tasks.listTasks({current:t.current??m.PAGINATION.DEFAULT_CURRENT,page_size:t.page_size??m.PAGINATION.DEFAULT_PAGE_SIZE,search:d||void 0});return s.jsxRuntimeExports.jsx(n.Card,{title:a("listTitle",{defaultValue:"Task List"}),children:s.jsxRuntimeExports.jsxs(n.Space,{direction:"vertical",style:{width:"100%"},size:"middle",children:[s.jsxRuntimeExports.jsxs(n.Space,{wrap:!0,children:[s.jsxRuntimeExports.jsx(n.Input,{placeholder:a("searchPlaceholder",{defaultValue:"Search by type or ID"}),prefix:s.jsxRuntimeExports.jsx(i.SearchOutlined,{}),value:d,onChange:t=>j(t.target.value),onPressEnter:()=>{var t,e;return(e=(t=l.current)==null?void 0:t.reload)==null?void 0:e.call(t)},style:{width:220},allowClear:!0}),s.jsxRuntimeExports.jsx(n.Button,{icon:s.jsxRuntimeExports.jsx(i.SearchOutlined,{}),onClick:()=>{var t,e;return(e=(t=l.current)==null?void 0:t.reload)==null?void 0:e.call(t)},children:c("search",{defaultValue:"Search"})}),s.jsxRuntimeExports.jsx(n.Button,{icon:s.jsxRuntimeExports.jsx(i.ReloadOutlined,{}),onClick:()=>{var t,e;return(e=(t=l.current)==null?void 0:t.reload)==null?void 0:e.call(t)},children:c("refresh",{defaultValue:"Refresh"})})]}),s.jsxRuntimeExports.jsx(u.Table,{ref:l,request:E,columns:R,rowKey:"id",scroll:{x:900}})]})})};exports.default=w;
